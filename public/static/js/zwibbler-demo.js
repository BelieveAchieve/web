/**
   Zwibbler

   Copyright 2019 Hanov Solutions Inc. All Rights Reserved. This software is
   NOT open source. For licensing information, contact the author.

   steve.hanov@gmail.com

   @license
 */
(function(){var aa="function"==typeof Object.defineProperties?Object.defineProperty:function(c,a,b){c!=Array.prototype&&c!=Object.prototype&&(c[a]=b.value)},ba="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this;function da(c,a){if(a){for(var b=ba,d=c.split("."),e=0;e<d.length-1;e++){var g=d[e];g in b||(b[g]={});b=b[g]}d=d[d.length-1];e=b[d];g=a(e);g!=e&&null!=g&&aa(b,d,{configurable:!0,writable:!0,value:g})}}var ea;
if("function"==typeof Object.setPrototypeOf)ea=Object.setPrototypeOf;else{var fa;a:{var ha={gq:!0},ia={};try{ia.__proto__=ha;fa=ia.gq;break a}catch(c){}fa=!1}ea=fa?function(c,a){c.__proto__=a;if(c.__proto__!==a)throw new TypeError(c+" is not extensible");return c}:null}var ja=ea;da("Object.setPrototypeOf",function(c){return c||ja});function ka(){ka=function(){};ba.Symbol||(ba.Symbol=la)}var la=function(){var c=0;return function(a){return"jscomp_symbol_"+(a||"")+c++}}();
function ma(){ka();var c=ba.Symbol.iterator;c||(c=ba.Symbol.iterator=ba.Symbol("iterator"));"function"!=typeof Array.prototype[c]&&aa(Array.prototype,c,{configurable:!0,writable:!0,value:function(){return na(this)}});ma=function(){}}function na(c){var a=0;return oa(function(){return a<c.length?{done:!1,value:c[a++]}:{done:!0}})}function oa(c){ma();c={next:c};c[ba.Symbol.iterator]=function(){return this};return c}
function pa(c,a){ma();c instanceof String&&(c+="");var b=0,d={next:function(){if(b<c.length){var e=b++;return{value:a(e,c[e]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d}da("Array.prototype.values",function(c){return c?c:function(){return pa(this,function(a,b){return b})}});da("Array.prototype.keys",function(c){return c?c:function(){return pa(this,function(a){return a})}});
da("Array.prototype.fill",function(c){return c?c:function(a,b,d){var e=this.length||0;0>b&&(b=Math.max(0,e+b));if(null==d||d>e)d=e;d=Number(d);0>d&&(d=Math.max(0,e+d));for(b=Number(b||0);b<d;b++)this[b]=a;return this}});
var n=function(){var c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d])};return function(a,b){function d(){this.constructor=a}c(a,b);a.prototype=null===b?Object.create(b):(d.prototype=b.prototype,new d)}}();function qa(c){for(var a="",b,d,e,g,f,h,l=0;l<c.length;)b=c.charCodeAt(l++),d=c.charCodeAt(l++),e=c.charCodeAt(l++),g=b>>2,b=(b&3)<<4|d>>4,f=(d&15)<<2|e>>6,h=e&63,isNaN(d)?f=h=64:isNaN(e)&&(h=64),a=a+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(g)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(b)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(f)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(h);
return a};var ra=function(){function c(a,b,d){void 0===d&&(d="");this.name=a;this.attributes=b;this.text=d;this.children=[]}c.prototype.toString=function(){var a=[];this.Zm(a,"");a=a.join("");for(var b="",d=0;d<a.length;d++){var e=a.charCodeAt(d);128>e?b+=String.fromCharCode(e):(127<e&&2048>e?b+=String.fromCharCode(e>>6|192):(b+=String.fromCharCode(e>>12|224),b+=String.fromCharCode(e>>6&63|128)),b+=String.fromCharCode(e&63|128))}return b};c.prototype.Zm=function(a,b){var d;if(this.hasAttributes()||0!==this.children.length){a.push(b);
a.push("<");a.push(this.name);for(d in this.attributes)this.attributes.hasOwnProperty(d)&&(a.push(" "),a.push(d),void 0!==this.attributes[d]&&null!==this.attributes[d]&&(a.push('="'),a.push(this.Rm(""+this.attributes[d])),a.push('"')));if(this.children.length||""!==this.text){a.push(">\n");for(d=0;d<this.children.length;d++)this.children[d].Zm(a,b+"  ");""!==this.text&&a.push(b+"  "+this.Rm(this.text));a.push(b+"</"+this.name+">")}else a.push("/>");a.push("\n")}};c.prototype.hasAttributes=function(){for(var a in this.attributes)if(this.attributes.hasOwnProperty(a))return!0;
return!1};c.prototype.rj=function(a){for(var b in a)a.hasOwnProperty(b)&&(this.attributes[b]=a[b])};c.prototype.Bd=function(a){this.children.push(a)};c.prototype.Rm=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")};return c}();var u=function(){function c(a,b){this.type=a;this.values=b}c.xi=function(a){a.toLowerCase()in c.wm&&(a=c.wm[a.toLowerCase()]);var b=/#([0-9a-f])([0-9a-f])([0-9a-f])/i,d=/rgb\( *([0-9]+) *, *([0-9]+) *, *([0-9]+) *\)/,e=/rgba\( *([0-9]+) *, *([0-9]+) *, *([0-9]+) *, *([0-9\.]+) *\)/;var g=/#([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])/i.exec(a);if(null!==g)a=parseInt(g[1],16)/255,b=parseInt(g[2],16)/255,d=parseInt(g[3],16)/255,g=1;else if(g=e.exec(a),null!==g)a=parseFloat(g[1])/255,b=parseFloat(g[2])/
255,d=parseFloat(g[3])/255,g=parseFloat(g[4]);else if(g=d.exec(a),null!==g)a=parseFloat(g[1])/255,b=parseFloat(g[2])/255,d=parseFloat(g[3])/255,g=1;else if(g=b.exec(a),null!==g)a=parseInt(g[1],16),a=(16*a+a)/255,b=parseInt(g[2],16),b=(16*b+b)/255,d=parseInt(g[2],16),d=(16*d+d)/255,g=1;else return null;return new c(c.RGBA,[a,b,d,g])};c.Fd=function(a){return c.xi(a)||new c(c.RGBA,[1,0,1,1])};c.tv=function(a){var b=/#[0-9a-f]+|rgba?\([^\)]+\)|[a-z]+/gi,d=[],e;do(e=b.exec(a))&&d.push(e[0]);while(e);return d};
c.prototype.toString=function(){function a(a){a=Math.round(255*a);return 16>a?"0"+a.toString(16):a.toString(16)}var b=this.ei(c.RGBA);return 1===b.values[3]?"#"+a(b.values[0])+a(b.values[1])+a(b.values[2]):"rgba("+Math.round(255*b.values[0])+","+Math.round(255*b.values[1])+","+Math.round(255*b.values[2])+","+b.values[3]+")"};c.prototype.ei=function(a){return c.Tq[this.type][a](this)};c.prototype.Lb=function(a){a.type!==this.type&&(a=a.ei(this.type));if(this.type===c.De){var b=this.values[0],d=a.values[0];
b=b>d?Math.min(b-d,d-b+360):Math.min(d-b,b-d+360);b/=360;return Math.pow(b*b+(this.values[1]-a.values[1])*(this.values[1]-a.values[1])+(this.values[2]-a.values[2])*(this.values[2]-a.values[2]),.5)}return Math.pow((this.values[0]-a.values[0])*(this.values[0]-a.values[0])+(this.values[1]-a.values[1])*(this.values[1]-a.values[1])+(this.values[2]-a.values[2])*(this.values[2]-a.values[2]),.5)};c.RGBA=0;c.Im=1;c.De=2;c.Qp=3;c.gv=3;c.Tq=[[sa,ta,va,wa],[xa,sa,ya,za],[Ba,Ca,sa,Da],[Fa,Ga,Ha,sa]];c.wm={aliceblue:"#f0f8ff",
antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",
darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",
honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",
limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",
orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",
steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",transparent:"rgba(0,0,0,0.0)",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};return c}(),Ia=.9505,Ja=1,Ka=1.089;
function Ba(c){var a=c.values[0],b=c.values[1],d=c.values[2];0>a&&(a+=360);var e=a/60-Math.floor(a/60),g=d*(1-b),f=d*(1-e*b);b=d*(1-(1-e)*b);var h=e=0,l=0;switch(Math.floor(a/60)%6){case 0:e=d;h=b;l=g;break;case 1:e=f;h=d;l=g;break;case 2:e=g;h=d;l=b;break;case 3:e=g;h=f;l=d;break;case 4:e=b;h=g;l=d;break;case 5:e=d,h=g,l=f}return new u(u.RGBA,[e,h,l,c.values[3]])}
function va(c){var a=c.values[0],b=c.values[1],d=c.values[2],e=Math.max(a,b,d),g=Math.min(a,b,d);return new u(u.De,[e===g?0:e===a?(60*(b-d)/(e-g)+360)%360:e===b?60*(d-a)/(e-g)+120:60*(a-b)/(e-g)+240,0===e?0:1-g/e,e,c.values[3]])}function za(c){function a(a){return a>6/29*(6/29)*(6/29)?Math.pow(a,1/3):1/3*(29/6)*(29/6)*a+4/29}var b=a(c.values[1]/Ja);return new u(u.Qp,[116*b-16,500*(a(c.values[0]/Ia)-b),200*(b-a(c.values[2]/Ka)),c.values[3]])}
function Ga(c){var a=(c.values[0]+16)/116,b=a+c.values[1]/500,d=a-c.values[2]/200,e=6/29;return new u(u.Im,[b>e?Ia*b*b*b:3*(b-16/116)*e*e*Ia,a>e?Ja*a*a*a:3*(a-16/116)*e*e*Ja,d>e?Ka*d*d*d:3*(d-16/116)*e*e*Ka,c.values[3]])}function ta(c){for(var a=[],b=0;3>b;b++)a[b]=.04045>=c.values[b]?c.values[b]/12.92:Math.pow((c.values[b]+.055)/1.055,2.4);return new u(u.Im,[.4124*a[0]+.3576*a[1]+.1805*a[2],.2126*a[0]+.7152*a[1]+.0722*a[2],.0193*a[0]+.1192*a[1]+.9505*a[2],c.values[3]])}
function xa(c){var a=[],b=[0,0,0,0];a[0]=3.241*c.values[0]-1.5374*c.values[1]-.4986*c.values[2];a[1]=-.9692*c.values[0]+1.876*c.values[1]+.0416*c.values[2];a[2]=.0556*c.values[0]-.204*c.values[1]+1.057*c.values[2];for(var d=0;3>d;d++)b[d]=.0031308>=a[d]?12.92*a[d]:1.055*Math.pow(a[d],1/2.4)-.055;b[3]=c.values[3];return new u(u.RGBA,b)}function sa(c){return new u(c.type,c.values.concat())}function wa(c){return za(ta(c))}function Fa(c){return xa(Ga(c))}function ya(c){return va(xa(c))}
function Ca(c){return ta(Ba(c))}function Da(c){return wa(Ba(c))}function Ha(c){return ya(Ga(c))};var w=new (function(){function c(){this.disabled={};this.Nd=[];this.Pq=!1}c.prototype.enable=function(a,b){void 0===b&&(b=!0);this.disabled[a]=!b};c.prototype.create=function(a,b){void 0===b&&(b=!0);!1===b&&(this.disabled[a]=!0);var d=this;return function(){for(var b=0;b<arguments.length;b++);d.Qs(a,arguments)}};c.prototype.addListener=function(a){this.Nd.push(a);return a};c.prototype.removeListener=function(a){for(var b=0;b<this.Nd.length;b++)if(this.Nd[b]===a){this.Nd.splice(b,1);break}};c.prototype.ir=
function(){this.Pq||this.addListener(function(a,b){console.log(a+": "+b)})};c.prototype.Qs=function(a,b){var d=[],e;if(!this.disabled[a]){var c=b[0].split("%s");d.push(c[0]);for(e=1;e<c.length;e++)e-1>=b.length-1?d.push("<too few args>"):"string"===typeof b[e]||"number"===typeof b[e]?d.push(b[e]):void 0===b[e]?d.push("(undefined)"):null===b[e]?d.push("(null)"):b[e]instanceof Object&&b[e].toString instanceof Function?d.push(b[e].toString()):d.push(JSON.stringify(b[e])),d.push(c[e]);d=d.join("");e=
0;for(c=this.Nd;e<c.length;e++)(0,c[e])(a,d)}};return c}());var La=function(){function c(a){this.code="en";this.data={};this.log=w.create("LANGUAGE");this.data=this.Qo(a,{})}c.prototype.pp=function(a){a=a.split(",");this.log("Choice of languages: %s",a);for(var b=0;b<a.length;b++){var d=a[b].split("-")[0];if(d in this.data){this.log("Using language code %s",d);this.code=d;break}else this.log("No language for code %s",d)}};c.prototype.ck=function(a){this.Qo(a,this.data)};c.prototype.Qo=function(a,b){for(var d=a.split("\n"),e=/^([ \t]*)([^:]+):([^:]+):(.*)/,
c=0;c<d.length;c++){var f=e.exec(d[c]);if(f){var h=f[2],l=f[3];f=f[4];h in b||(b[h]={});l in b[h]&&this.log("Warning: Replacing %s:%s",h,l);b[h][l]=f}}return b};c.prototype.fn=function(){var a=this;return function(b){for(var d=[],e=1;e<arguments.length;e++)d[e-1]=arguments[e];return a.Tm(b,d)}};c.prototype.get=function(a){for(var b=[],d=1;d<arguments.length;d++)b[d-1]=arguments[d];return this.Tm(a,b)};c.prototype.Tm=function(a,b){var d="<not translated:"+a+">";this.code in this.data&&a in this.data[this.code]&&
(d=this.data[this.code][a]);for(var e=0;e<b.length;e++)d=d.replace("^"+e,b[e]);return d};return c}();var Ma=function(){function c(a){this.next=a}c.prototype.Ip=function(a){for(var b=0;b<a.length;b++)this.hb(a.charCodeAt(b))};c.prototype.hb=function(a){this.next.hb(a)};c.prototype.flush=function(){this.next.flush()};c.prototype.Tf=function(){return this.next.Tf()};return c}(),Na=function(){function c(){this.data="";this.log=w.create("BYTESTREAM")}c.prototype.Ip=function(a){for(var b=0;b<a.length;b++)this.hb(a.charCodeAt(b))};c.prototype.Tf=function(){return this};c.prototype.hb=function(a){if(255<
a||0>a)throw"Bad data written to byte buffer";this.data+=String.fromCharCode(a)};c.prototype.flush=function(){};c.prototype.toString=function(){return this.data};c.prototype.Tb=function(){for(var a=[],b=0;b<this.data.length;b++)a.push(this.data.charCodeAt(b));return a};c.Fm=function(a,b){c.zm[a]=b};c.vg=function(a){var b=new c;a=a.split(",");a.reverse();for(var d=0;d<a.length;d++){var e=a[d];e.length&&(b=c.zm[e](b))}return b};c.zm={};return c}();function Oa(){}var Pa=setTimeout,Qa=[],Ra=!1;function Sa(){for(var c=0;c<Qa.length;c++)Qa[c][0](Qa[c][1]);Qa=[];Ra=!1}function Va(c,a){Qa.push([c,a]);Ra||(Ra=!0,Pa(Sa,0))}function Wa(c,a){function b(b){Xa(a,b)}function d(b){Ya(a,b)}try{c(b,d)}catch(e){d(e)}}function Za(c){var a=c.pt,b=a.Yd;a=a.sk;var d=c.Xl[b];c=c.then;if("function"===typeof d){b="fulfilled";try{a=d(a)}catch(e){Ya(c,e)}}$a(c,a)||("fulfilled"===b&&Xa(c,a),"rejected"===b&&Ya(c,a))}
function $a(c,a){var b=!1;try{if(c===a)throw new TypeError("A promises callback cannot return that same promise.");if(a&&("function"===typeof a||"object"===typeof a)){var d=a.then;if("function"===typeof d)return d.call(a,function(d){b||(b=!0,a!==d?Xa(c,d):ab(c,d))},function(a){b||(b=!0,Ya(c,a))}),!0}}catch(e){return b||Ya(c,e),!0}return!1}function Xa(c,a){c!==a&&$a(c,a)||ab(c,a)}function ab(c,a){"pending"===c.Yd&&(c.Yd="sealed",c.sk=a,Va(bb,c))}
function Ya(c,a){"pending"===c.Yd&&(c.Yd="sealed",c.sk=a,Va(cb,c))}function db(c){var a=c.$l;c.$l=[];for(c=0;c<a.length;c++)Za(a[c])}function bb(c){c.Yd="fulfilled";db(c)}function cb(c){c.Yd="rejected";db(c)}
var eb=function(){function c(a){this.Yd="pending";this.sk=void 0;this.$l=[];Wa(a,this)}c.prototype.then=function(a,b){var d={pt:this,then:new c(Oa),Xl:{}};d.Xl.fulfilled=a;d.Xl.rejected=b;"fulfilled"===this.Yd||"rejected"===this.Yd?Va(Za,d):this.$l.push(d);return d.then};c.prototype["catch"]=function(a){return this.then(null,a)};c.resolve=function(a){return a&&"object"===typeof a&&a.constructor===this?a:new this(function(b){b(a)})};c.reject=function(a){return new this(function(b,d){d(a)})};return c}();
eb.prototype.then=eb.prototype.then;var fb=function(){function c(a){this.Aa=a}c.prototype.Wc=function(a){for(var b in a){if(0<=b.indexOf("-"))throw Error("setStyle: styles must be camelcase; not "+b);this.Aa.style[b]=""+a[b]}return this};c.prototype.rj=function(a){for(var b in a)this.Aa.setAttribute(b,a[b]);return this};c.prototype.yd=function(a){a.appendChild(this.Aa);return this};c.prototype.Yk=function(a){a.parentNode&&a.parentNode.insertBefore(this.Aa,a.nextSibling)};c.prototype.insertBefore=function(a){a.parentNode&&a.parentNode.insertBefore(this.Aa,
a)};c.prototype.remove=function(){this.Aa.parentNode&&this.Aa.parentNode.removeChild(this.Aa);return this};c.prototype.me=function(a){return window.getComputedStyle(this.Aa)[a]||""};c.prototype.pc=function(){var a=this.Aa.getBoundingClientRect();return{top:a.top+window.pageYOffset,left:a.left+window.pageXOffset}};c.prototype.uj=function(a){var b=(b=this.os())?b.pc():{left:0,top:0};this.Aa.style.left=a.left-b.left+"px";this.Aa.style.top=a.top-b.top+"px"};c.prototype.os=function(){if(!(this.Aa instanceof
HTMLElement)||"fixed"===this.me("position"))return y(document.body);for(var a=this.Aa.parentElement;a&&"static"===y(a).me("position");)a=a.parentElement;return a?y(a):null};c.prototype.He=function(a){this.Aa.classList.add(a);return this};c.prototype.dm=function(a,b){b?this.Aa.classList.add(a):this.Aa.classList.remove(a)};c.prototype.addEventListener=function(a,b,d){void 0===d&&(d=!1);var e=0;for(a=a.split(" ");e<a.length;e++)this.Aa.addEventListener(a[e],b,d);return this};c.prototype.removeEventListener=
function(a,b,d){void 0===d&&(d=!1);var e=0;for(a=a.split(" ");e<a.length;e++)this.Aa.removeEventListener(a[e],b,d);return this};c.prototype.matches=function(a){if(this.Aa.matches)return this.Aa.matches(a);var b=0;for(a=a.split(",");b<a.length;b++){var d=a[b];d=d.trim();if(0!=d.length)return"["==d[0]?this.Aa.hasAttribute(d.substr(1,d.length-2)):this.Aa.tagName===d.toUpperCase()}return!1};c.prototype.clear=function(){for(;null!==this.Aa.firstChild;)this.Aa.removeChild(this.Aa.firstChild);return this};
c.prototype.wh=function(a){this.Aa.innerText=a;return this};return c}();function y(c){if("string"===typeof c){if("<"==c[0]){var a=document.createElement("div");a.innerHTML=c;c=[];for(a=a.firstChild;a;)a instanceof HTMLElement&&c.push(a),a=a.nextSibling;return new fb(c[0])}return new fb(document.createElement(c))}return new fb(c)}
function gb(c){return new eb(function(a,b){var d=new XMLHttpRequest;c.mimeType&&d.overrideMimeType(c.mimeType);c.withCredentials&&(d.withCredentials=!0);var e=c.method||"GET",g=c.Po||{},f=c.url,h="",l=!0,k;for(k in g)l||(h+="&"),l=!1,h+=k+"="+encodeURIComponent(g[k]);"GET"===e&&0<h.length&&(f+="?"+h,h="");d.onreadystatechange=function(){if(4===d.readyState)if(200===d.status)a(d);else{var e=d.statusText;0===d.status?e="Could not contact server.":d.getResponseHeader("status")&&(e=d.getResponseHeader("status"));
b(Error(d.status+" "+e))}};d.open(e,f,!0);"string"===typeof c.data&&(h=c.data);c.contentType?d.setRequestHeader("Content-type","application/json"):"POST"===e&&d.setRequestHeader("Content-Type","application/x-www-form-urlencoded");c.zn?setTimeout(function(){d.send(h)},c.zn):d.send(h)})}var hb=[],ib=null;
function jb(c){for(var a=0;a<hb.length;a++)if(hb[a]===c)return;hb.push(c);ib||(ib=document.createElement("style"),document.head&&document.head.insertBefore(ib,document.head.firstChild));ib.appendChild(document.createTextNode(c))};var ob=function(c){function a(a){a=c.call(this,a)||this;a.Bg=0;a.total=0;a.size=0;a.keys="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return a}n(a,c);a.prototype.hb=function(a){this.Bg=this.Bg<<8|a;this.size+=8;for(this.total+=1;6<=this.size;)this.next.hb(this.keys.charCodeAt(this.Bg>>this.size-6&63)),this.size-=6};a.prototype.flush=function(){var a=(3-this.total%3)%3;this.size&&(this.next.hb(this.keys.charCodeAt(this.Bg>>this.size-6&63)),this.Bg=this.size=0);for(;a--;)this.next.hb(61);
this.next.flush()};return a}(Ma);Na.Fm("Base64Encoder",function(c){return new ob(c)});var pb=w.create("MISC");function qb(c){return"jQuery"in window&&c instanceof window.jQuery?c[0]:c instanceof HTMLElement?c:"string"===typeof c?document.querySelector(c):null}function rb(c){var a=document.createElement("canvas");c&&c.appendChild(a);a.style.background="transparent";return a}var sb=/MSIE ([0-9]{1,}[\.0-9]{0,})/,tb=0,ub=!1;function vb(){for(var c=document.getElementsByTagName("*"),a=0,b=0;b<c.length;b++){var d=parseInt(y(c[b]).me("z-index"),10)||0;d>a&&(a=d)}return a}
function wb(){if(null===xb){var c=document.createElement("div");c.style.visibility="hidden";c.style.width="100px";document.body.appendChild(c);var a=c.offsetWidth;c.style.overflow="scroll";var b=document.createElement("div");b.style.width="100%";c.appendChild(b);b=b.offsetWidth;c.parentNode.removeChild(c);xb=a-b;pb("ScrollbarWidth calculated as %spx",xb)}return xb}var xb=0;function yb(c,a){var b=u.Fd(c);b.values[3]=a;return b.toString()}
function zb(c){var a=atob(c.split(",")[1]);c=c.split(",")[0].split(":")[1].split(";")[0];for(var b=new ArrayBuffer(a.length),d=new Uint8Array(b),e=0;e<a.length;e++)d[e]=a.charCodeAt(e);return new Blob([b],{type:c})}
function Ab(){var c=document.documentElement,a=c.scrollWidth>c.clientWidth;c=c.scrollHeight>c.clientHeight?wb():0;a=a?wb():0;return{width:window.innerWidth-c,height:window.innerHeight-a,x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}}function Bb(c){var a=Ab(),b=y(c).pc();b.left=Math.min(b.left,a.x+a.width-c.offsetWidth);b.top=Math.min(b.top,a.y+a.height-c.offsetHeight);y(c).uj(b)}
function Cb(c){var a=c.getContext("2d");if(null===a)return"error";var b=a.getImageData(0,0,c.width,c.height);c=b.width;var d=b.height;a=c*d*3;var e=a+54,g=[66,77,e&255,e>>8&255,e>>16&255,e>>24&255,0,0,0,0,54,0,0,0],f=[40,0,0,0,c&255,c>>8&255,c>>16&255,c>>24&255,d&255,d>>8&255,d>>16&255,d>>24&255,1,0,24,0,0,0,0,0,a&255,a>>8&255,a>>16&255,a>>24&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];a=(4-3*c%4)%4;b=b.data;e=c<<2;for(var h=Na.vg("Base64Encoder"),l=0;l<g.length;l++)h.hb(g[l]);for(l=0;l<f.length;l++)h.hb(f[l]);
do{g=e*(d-1);for(f=0;f<c;f++)l=f<<2,h.hb(b[g+l+2]),h.hb(b[g+l+1]),h.hb(b[g+l]);for(g=0;g<a;g++)h.hb(0)}while(--d);h.flush();return"data:image/bmp;base64,"+h.Tf().toString()}
function Db(c,a){"erase"===a?c.wd?(c.strokeStyle="#000000",c.globalCompositeOperation="destination-out",--c.lineWidth,c.stroke(),c.globalCompositeOperation="source-over",c.strokeStyle=c.wd,c.lineWidth+=2,c.stroke(),--c.lineWidth):(c.strokeStyle="#000000",c.globalCompositeOperation="destination-out",c.stroke(),c.globalCompositeOperation="source-over"):(c.strokeStyle=a,c.stroke())}
function Eb(){for(var c=0;c<arguments.length;c++);c=arguments[0];for(var a=1;a<arguments.length;a++){var b=arguments[a],d;for(d in b)b.hasOwnProperty(d)&&(c[d]=b[d])}return c};var Fb=function(){function c(a,b,d,e,c){void 0===a&&(a="transparent");void 0===b&&(b=0);void 0===d&&(d=0);void 0===e&&(e=0);void 0===c&&(c=0);this.Ne=a;this.left=b;this.top=d;this.right=e;this.bottom=c;this.zIndex=1;this.insertBefore=null;this.ta=document.createElement("div")}c.prototype.ne=function(){this.ta&&y(this.ta).remove()};c.prototype.show=function(a){y(this.ta).Wc({position:"fixed",background:this.Ne,opacity:.25,left:this.left+"px",top:this.top+"px",right:this.right+"px",bottom:this.bottom+
"px",display:"block"});this.ta.addEventListener("click",a);this.ta.style.zIndex=this.zIndex.toString();this.insertBefore?this.insertBefore.parentNode&&this.insertBefore.parentNode.insertBefore(this.ta,this.insertBefore):document.body.appendChild(this.ta)};return c}();var Gb=w.create("Graphics",!0),z=function(){function c(a,b){this.x=a;this.y=b}c.prototype.Lb=function(a){return Math.sqrt((a.x-this.x)*(a.x-this.x)+(a.y-this.y)*(a.y-this.y))};c.prototype.toString=function(){return"("+this.x+", "+this.y+")"};c.prototype.Ed=function(a){return this.x===a.x&&this.y===a.y};c.prototype.clone=function(){return new c(this.x,this.y)};c.prototype.Bn=function(a,b){var d=a.x,e=a.y,c=this.x,f=this.y,h=b.x-d,l=b.y-e,k=h*h+l*l;if(0===k)return this.Lb(a);k=((c-d)*h+(f-e)*l)/k;1<
k?k=1:0>k&&(k=0);d=d+k*h-c;e=e+k*l-f;return Math.sqrt(d*d+e*e)};return c}(),Hb=function(){function c(a,b){this.width=a;this.height=b}c.prototype.yp=function(){return new B(0,0,this.width,this.height)};return c}();function C(c,a,b,d){return Math.sqrt((c-b)*(c-b)+(a-d)*(a-d))}function D(c,a,b,d){var e=C(c,a,b,d);return 0===e?{x:1,y:0}:{x:(b-c)/e,y:(d-a)/e}}function Ib(c){c.x*=-1;c.y*=-1;return c}
var B=function(){function c(a,b,d,e){this.x=a;this.y=b;this.width=d;this.height=e;this.Zo()}c.load=function(a){return new c(a.x,a.y,a.width,a.height)};c.wg=function(a){if(0===a.length)return new c(0,0,0,0);for(var b=a[0].x,d=a[0].x,e=a[0].y,g=a[0].y,f=1;f<a.length;f++)a[f].x<b&&(b=a[f].x),a[f].x>d&&(d=a[f].x),a[f].y<e&&(e=a[f].y),a[f].y>g&&(g=a[f].y);return new c(b,e,d-b,g-e)};c.prototype.save=function(){return{x:this.x,y:this.y,width:this.width,height:this.height}};c.prototype.clone=function(){return new c(this.x,
this.y,this.width,this.height)};c.prototype.Ed=function(a){return this.x===a.x&&this.y===a.y&&this.width===a.width&&this.height===a.height};c.prototype.Eh=function(a){a.x<this.x&&(this.width+=this.x-a.x,this.x=a.x);a.y<this.y&&(this.height+=this.y-a.y,this.y=a.y);a.x+a.width>this.x+this.width&&(this.width+=a.x+a.width-this.x-this.width);a.y+a.height>this.y+this.height&&(this.height+=a.y+a.height-this.y-this.height)};c.prototype.hm=function(a,b){a<this.x?(this.width+=this.x-a,this.x=a):a>this.x+this.width&&
(this.width=a-this.x);b<this.y?(this.height+=this.y-b,this.y=b):b>this.y+this.height&&(this.height=b-this.y)};c.prototype.contains=function(a){return this.x<=a.x&&this.x+this.width>a.x+a.width&&this.y<=a.y&&this.y+this.height>a.y+a.height};c.prototype.hn=function(){return this.width*this.height};c.prototype.fd=function(a,b,d){void 0===d&&(d=0);return this.x-d<=a&&this.x+this.width+d>a&&this.y-d<=b&&this.y+this.height+d>b};c.prototype.Zo=function(){0>this.width&&(this.x+=this.width,this.width=-this.width);
0>this.height&&(this.y+=this.height,this.height=-this.height)};c.prototype.pd=function(a,b){void 0===b&&(b=a);this.x-=a/2;this.y-=b/2;this.width+=a;this.height+=b};c.prototype.transform=function(a){var b=a.apply(this.x,this.y);var d=a.apply(this.x+this.width,this.y);var e=a.apply(this.x+this.width,this.y+this.height);a=a.apply(this.x,this.y+this.height);this.x=Math.min(b.x,d.x,e.x,a.x);this.y=Math.min(b.y,d.y,e.y,a.y);this.width=Math.max(b.x,d.x,e.x,a.x)-this.x;this.height=Math.max(b.y,d.y,e.y,a.y)-
this.y};c.prototype.right=function(){return this.x+this.width};c.prototype.bottom=function(){return this.y+this.height};c.prototype.ed=function(){return new z(this.x+this.width/2,this.y+this.height/2)};c.prototype.toString=function(){return"Rectangle("+this.x+", "+this.y+", "+this.width+", "+this.height+")"};return c}(),F=function(){function c(){this.log=w.create("MATRIX");this.Ub="Matrix";if(0===arguments.length)this.m11=1,this.m21=this.m12=0,this.m22=1,this.Ga=this.Fa=0;else if(1===arguments.length){if(6!==
arguments[0].length)throw"Bad array initializer for Matrix.";this.m11=arguments[0][0];this.m12=arguments[0][1];this.m21=arguments[0][2];this.m22=arguments[0][3];this.Fa=arguments[0][4];this.Ga=arguments[0][5]}else this.m11=arguments[0],this.m12=arguments[1],this.m21=arguments[2],this.m22=arguments[3],this.Fa=arguments[4],this.Ga=arguments[5]}c.prototype.toString=function(){return"[ "+this.m11+" "+this.m12+" "+this.Fa+"    "+this.m21+" "+this.m22+" "+this.Ga+"    0 0 1 ]"};c.prototype.Tb=function(){return[this.m11,
this.m12,this.m21,this.m22,this.Fa,this.Ga]};c.prototype.al=function(){return 1===this.m11&&0===this.m12&&0===this.m21&&1===this.m22&&0===this.Fa&&0===this.Ga};c.prototype.Ed=function(a){return this.m11===a.m11&&this.m12===a.m12&&this.m21===a.m21&&this.m22===a.m22&&this.Fa===a.Fa&&this.Ga===a.Ga};c.prototype.multiply=function(a){var b=new c;b.m11=this.m11*a.m11+this.m12*a.m21;b.m21=this.m21*a.m11+this.m22*a.m21;b.m12=this.m11*a.m12+this.m12*a.m22;b.m22=this.m21*a.m12+this.m22*a.m22;b.Fa=this.m11*
a.Fa+this.m12*a.Ga+this.Fa;b.Ga=this.m21*a.Fa+this.m22*a.Ga+this.Ga;return b};c.prototype.apply=function(a,b){return new z(this.m11*a+this.m12*b+this.Fa,this.m21*a+this.m22*b+this.Ga)};c.prototype.Df=function(a){var b;void 0===b&&(b=!1);b?a.setTransform(this.m11,this.m21,this.m12,this.m22,this.Fa,this.Ga):a.transform(this.m11,this.m21,this.m12,this.m22,this.Fa,this.Ga)};c.prototype.clone=function(){return new c(this.m11,this.m12,this.m21,this.m22,this.Fa,this.Ga)};c.prototype.inverse=function(){var a=
this.m11*this.m22-this.m12*this.m21;return new c(this.m22/a,-this.m12/a,-this.m21/a,this.m11/a,(this.m12*this.Ga-this.Fa*this.m22)/a,(this.Fa*this.m21-this.m11*this.Ga)/a)};c.prototype.Cp=function(){var a=this.m11,b=this.m21,d=this.m12,e=this.m22,g=Math.sqrt(a*a+b*b),f=Math.sqrt(d*d+e*e);return new c(a/g,d/f,b/g,e/f,this.Fa,this.Ga)};c.prototype.ec=function(){return new z(Math.sqrt(this.m11*this.m11+this.m21*this.m21),Math.sqrt(this.m12*this.m12+this.m22*this.m22))};c.prototype.Ks=function(){return 1===
this.m11&&1===this.m22&&0===this.m12&&0===this.m21};c.prototype.translate=function(a,b){return this.multiply(new E(a,b))};c.prototype.rotate=function(a,b,d){return this.multiply(new Jb(a,b,d))};return c}(),Jb=function(c){function a(a,d,e){var b=Math.cos(a);a=Math.sin(a);return c.call(this,b,a,-a,b,-d*b-e*a+d,d*a-e*b+e)||this}n(a,c);return a}(F),E=function(c){function a(a,d){return c.call(this,1,0,0,1,a,d)||this}n(a,c);return a}(F),Kb=function(c){function a(a,d,e,g){return void 0===e||void 0===g?c.call(this,
a,0,0,d,0,0)||this:c.call(this,a,0,0,d,e-a*e,g-d*g)||this}n(a,c);return a}(F),Lb=function(c){function a(a,d,e){var b=Math.cos(2*a);a=Math.sin(2*a);return c.call(this,b,a,a,-b,-d*b-e*a+d,-d*a+e*b+e)||this}n(a,c);return a}(F);
function Mb(c,a,b,d,e,g,f,h,l,k){if(!(8<++Mb.depth)){var m=(a+d)/2,q=(b+e)/2,p=(d+g)/2,r=(e+f)/2,t=(g+h)/2,v=(f+l)/2,A=(m+p)/2,I=(q+r)/2;p=(p+t)/2;r=(r+v)/2;var N=(A+p)/2,x=(I+r)/2,ca=h-a,M=l-b;d=Math.abs((d-h)*M-(e-l)*ca);g=Math.abs((g-h)*M-(f-l)*ca);(d+g)*(d+g)<k*(ca*ca+M*M)?c.push(new z(N,x)):(Mb(c,a,b,m,q,A,I,N,x,k),Mb(c,N,x,p,r,t,v,h,l,k))}--Mb.depth}(Mb||(Mb={})).depth=0;
function Nb(c,a,b,d,e,g,f,h){if(!(8<++Mb.depth)){var l=(a+d)/2,k=(b+e)/2,m=(d+g)/2,q=(e+f)/2,p=(l+m)/2,r=(k+q)/2,t=g-a,v=f-b;d=Math.abs((d-g)*v-(e-f)*t);d*d<=h*(t*t+v*v)?c.push(new z(p,r)):(Nb(c,a,b,l,k,p,r,h),Nb(c,p,r,m,q,g,f,h))}--Mb.depth}
function Ob(c,a,b){var d,e=!1,g=c.length;1<g&&c[g-1].x===c[0].x&&c[g-1].y===c[0].y&&--g;if(3>g)return!1;var f=c[g-1].x;var h=c[g-1].y;for(d=0;d<g;d++){var l=c[d].x;var k=c[d].y;if(l>f){var m=f;var q=l;var p=h;h=k}else m=l,q=f,p=k;l<a===a<=f&&(b-p)*(q-m)<(h-p)*(a-m)&&(e=!e);f=l;h=k}return e}function Pb(c,a,b,d){d*=d;for(var e=1;e<c.length;e++){var g=c[e-1].x,f=c[e-1].y,h=c[e].x-g,l=c[e].y-f,k=((a-g)*h+(b-f)*l)/(h*h+l*l);1<k?k=1:0>k&&(k=0);g=g+k*h-a;f=f+k*l-b;if(g*g+f*f<=d)return!0}return!1}
(function(){function c(a){this.Nb=a}c.prototype.clear=function(){for(var a=0;a<this.Nb.width*this.Nb.height*4;a++)this.Nb.data[a]=0};c.prototype.getImageData=function(){return this.Nb};c.prototype.width=function(){return this.Nb.width};c.prototype.height=function(){return this.Nb.height};c.prototype.get=function(a,b){var d=this.Nb.width*b*4+4*a;return this.Nb.data[d]|this.Nb.data[d+1]<<8|this.Nb.data[d+2]<<16|this.Nb.data[d+3]<<24};c.prototype.set=function(a,b,d){a=this.Nb.width*b*4+4*a;this.Nb.data[a]=
d&255;this.Nb.data[a+1]=d>>8&255;this.Nb.data[a+2]=d>>16&255;this.Nb.data[a+3]=d>>24&255};return c})();
(function(){function c(a,b){this.data=[];this.Lf=a;this.Ph=b;this.data=[]}c.prototype.width=function(){return this.Lf};c.prototype.height=function(){return this.Ph};c.prototype.getImageData=function(){var a=document.createElement("canvas");a.width=this.Lf;a.height=this.Ph;a=a.getContext("2d").getImageData(0,0,this.Lf,this.Ph);for(var b=this.Lf*this.Ph,d=0;d<b;d++){var e=!0===this.data[d]?255:0;a.data[4*d]=e;a.data[4*d+1]=e;a.data[4*d+2]=e;a.data[4*d+3]=255}return a};c.prototype.get=function(a,b){return!0===
this.data[this.Lf*b+a]};c.prototype.set=function(a,b,d){this.data[this.Lf*b+a]=d};return c})();
var H=function(){function c(a){this.closed=!1;this.ba=[];a instanceof B&&(this.moveTo(a.x,a.y),this.lineTo(a.x+a.width,a.y),this.lineTo(a.x+a.width,a.y+a.height),this.lineTo(a.x,a.y+a.height),this.lineTo(a.x,a.y),this.closePath())}c.prototype.clear=function(){this.closed=!1;this.ba=[]};c.prototype.beginPath=function(){};c.prototype.rect=function(){};c.prototype.moveTo=function(a,b){this.ba.push(c.jc,a,b)};c.prototype.lineTo=function(a,b){this.ba.push(c.ic,a,b)};c.prototype.bezierCurveTo=function(a,
b,d,e,g,f){this.ba.push(c.ae,a,b,d,e,g,f)};c.prototype.quadraticCurveTo=function(a,b,d,e){this.ba.push(c.ce,a,b,d,e)};c.prototype.arc=function(){};c.prototype.arcTo=function(){};c.prototype.closePath=function(){this.ba.push(c.hc)};c.prototype.ha=function(a){for(var b=0;b<this.ba.length;){switch(this.ba[b]){case c.jc:a.moveTo&&a.moveTo(this.ba[b+1],this.ba[b+2]);break;case c.ic:a.lineTo&&a.lineTo(this.ba[b+1],this.ba[b+2]);break;case c.ae:a.bezierCurveTo&&a.bezierCurveTo(this.ba[b+1],this.ba[b+2],
this.ba[b+3],this.ba[b+4],this.ba[b+5],this.ba[b+6]);break;case c.ce:a.quadraticCurveTo&&a.quadraticCurveTo(this.ba[b+1],this.ba[b+2],this.ba[b+3],this.ba[b+4]);break;case c.hc:a.closePath&&a.closePath();break;default:alert("Error!")}b+=c.kc[this.ba[b]]}};c.prototype.Ot=function(){for(var a=0,b=0,d=0,e=[];a<this.ba.length;){switch(this.ba[a]){case c.hc:e.push([c.hc]);break;case c.jc:b=this.ba[a+1];d=this.ba[a+2];break;case c.ic:e.push([c.ic,b,d]);b=this.ba[a+1];d=this.ba[a+2];break;case c.ae:e.push([c.ae,
this.ba[a+3],this.ba[a+4],this.ba[a+1],this.ba[a+2],b,d]);b=this.ba[a+5];d=this.ba[a+6];break;case c.ce:e.push([c.ce,this.ba[a+1],this.ba[a+2],b,d]),b=this.ba[a+3],d=this.ba[a+4]}a+=c.kc[this.ba[a]]}this.ba.length&&e.push([c.jc,b,d]);a=new c;for(b=e.length-1;0<=b;b--)Array.prototype.push.apply(a.ba,e[b]);a.closed=this.closed;return a};c.prototype.ye=function(){for(var a=0,b,d=[];a<this.ba.length;){var e=c.Em[this.ba[a]];for(b=0;b<e;b++)d.push(new z(this.ba[a+1+2*b],this.ba[a+1+2*b+1]));a+=c.kc[this.ba[a]]}return d};
c.prototype.transform=function(a){for(var b=0,d,e;b<this.ba.length;){e=c.Em[this.ba[b]];for(d=0;d<e;d++){var g=a.apply(this.ba[b+1+2*d],this.ba[b+1+2*d+1]);this.ba[b+1+2*d]=g.x;this.ba[b+1+2*d+1]=g.y}b+=c.kc[this.ba[b]]}};c.prototype.clone=function(){var a=new c;a.ba=this.ba.concat();return a};c.prototype.qn=function(a){for(var b=0,d,e=d=0,g=new B(this.ba[1],this.ba[2],0,0),f;b<this.ba.length;){switch(this.ba[b]){case c.jc:case c.ic:d=this.ba[b+1];e=this.ba[b+2];g.hm(d,e);break;case c.ae:var h=f=
[],l=this.ba[b+5],k=this.ba[b+6];Mb(h,d,e,this.ba[b+1],this.ba[b+2],this.ba[b+3],this.ba[b+4],l,k,a*a);h.push(new z(l,k));for(d=0;d<f.length;d++)g.hm(f[d].x,f[d].y);d=this.ba[b+5];e=this.ba[b+6];break;case c.ce:h=f=[];l=this.ba[b+3];k=this.ba[b+4];Nb(h,d,e,this.ba[b+1],this.ba[b+2],l,k,a*a);h.push(new z(l,k));for(d=0;d<f.length;d++)g.hm(f[d].x,f[d].y);d=this.ba[b+3];e=this.ba[b+4]}b+=c.kc[this.ba[b]]}return g};c.prototype.append=function(a){this.ba=this.ba.concat(a.ba)};c.prototype.cm=function(a){for(var b=
0,d=0,e=0,g=new c,f;b<this.ba.length;){switch(this.ba[b]){case c.jc:d=this.ba[b+1];e=this.ba[b+2];g.moveTo(d,e);break;case c.ic:d=this.ba[b+1];e=this.ba[b+2];g.lineTo(d,e);break;case c.ae:var h=f=[],l=this.ba[b+5],k=this.ba[b+6];Mb(h,d,e,this.ba[b+1],this.ba[b+2],this.ba[b+3],this.ba[b+4],l,k,a*a);h.push(new z(l,k));2===f.length&&1E-4>d*(f[0].y-f[1].y)+f[0].x*(f[1].y-e)+f[1].x*(e-f[0].y)&&(f[0]=f[1],f.length=1);for(d=0;d<f.length;d++)g.lineTo(f[d].x,f[d].y);d=this.ba[b+5];e=this.ba[b+6];break;case c.ce:h=
f=[];l=this.ba[b+3];k=this.ba[b+4];Nb(h,d,e,this.ba[b+1],this.ba[b+2],l,k,a*a);h.push(new z(l,k));for(d=0;d<f.length;d++)g.lineTo(f[d].x,f[d].y);d=this.ba[b+3];e=this.ba[b+4];break;case c.hc:g.closePath()}b+=c.kc[this.ba[b]]}return g};c.prototype.wt=function(a,b){var d;void 0===d&&(d=0);return Ob(this.ye(),a,b)||0<d&&this.To(a,b,d)};c.prototype.To=function(a,b,d){var e=0,g=0,f=0;for(d*=d;f<this.ba.length;){switch(this.ba[f]){case c.jc:e=this.ba[f+1];g=this.ba[f+2];break;case c.ic:var h=this.ba[f+
1];var l=this.ba[f+2];var k=h-e;var m=l-g;var q=k*k+m*m;q=((a-e)*k+(b-g)*m)/q;1<q?q=1:0>q&&(q=0);e+=q*k;m=g+q*m;g=e-a;m-=b;g=g*g+m*m;if(g<=d)return!0;e=h;g=l}f+=c.kc[this.ba[f]]}return!1};c.prototype.pi=function(a,b){for(var d=0,e=0,g=b[0],f,h=new z(0,0),l;d<this.ba.length;){switch(this.ba[d]){case c.jc:l=this.ba[d+1];f=this.ba[d+2];a.moveTo(l,f);h=new z(l,f);break;case c.ic:l=this.ba[d+1];var k=f=this.ba[d+2],m=new z(l,k);f=h.Lb(m);if(!(0>=f)){for(;f>g;)h.x+=(m.x-h.x)*g/f,h.y+=(m.y-h.y)*g/f,e&1?
a.moveTo(h.x,h.y):a.lineTo(h.x,h.y),f-=g,e=(e+1)%b.length,g=b[e];f<=g&&(h=new z(l,k),e&1?a.moveTo(h.x,h.y):a.lineTo(h.x,h.y),g-=f)}}d+=c.kc[this.ba[d]]}};c.prototype.hn=function(){function a(a,b){g-=(a-d)*(b+e);d=a;e=b}for(var b=0,d,e,g=0;b<this.ba.length;){switch(this.ba[b]){case c.jc:d=this.ba[b+1];e=this.ba[b+2];break;case c.ic:a(this.ba[b+1],this.ba[b+2]);break;case c.ae:a(this.ba[b+5],this.ba[b+6]);break;case c.ce:a(this.ba[b+3],this.ba[b+4])}b+=c.kc[this.ba[b]]}return g/2};c.prototype.Fn=function(a){for(var b=
0,d=0,e=0,g=!1;b<this.ba.length;){switch(this.ba[b]){case c.jc:d=this.ba[b+1];e=this.ba[b+2];g=!0;break;case c.ic:a(d,e,this.ba[b+1],this.ba[b+2],g),d=this.ba[b+1],e=this.ba[b+2],g=!1}b+=c.kc[this.ba[b]]}};c.prototype.Bq=function(){var a=0;this.Fn(function(b,d,e,c){a+=C(b,d,e,c)});return a};c.prototype.Dq=function(a){var b=new c,d=0;this.Fn(function(e,c,f,h,l){if(d<=a){l&&b.moveTo(e,c);l=C(e,c,f,h);if(d+l>=a){var g=a-d;f=e+(f-e)*g/l;h=c+(h-c)*g/l}d+=l;b.lineTo(f,h)}});return b};c.jc=0;c.ic=1;c.ae=
2;c.ce=3;c.hc=4;c.kc=[3,3,7,5,1];c.Em=[1,1,3,2,0];return c}();function Qb(c,a,b,d,e){var g;if(2>=d-b)e.push(c[b]);else{var f=c[b],h=c[d-1],l=0,k=0;for(g=b+1;g<d;g++){var m=c[g].Bn(f,h);m>l&&(l=m,k=g)}0<k&&l>a?(Qb(c,a,b,k,e),Qb(c,a,k,d,e)):e.push(f)}}function Rb(c,a){var b=[];Qb(c,a,0,c.length,b);0<c.length&&0<b.length&&!c[c.length-1].Ed(b[b.length-1])&&b.push(c[c.length-1]);return b}
var Sb=function(){function c(){this.la=[];if(1===arguments.length){var a=arguments[0];if(a instanceof B)this.la.push(new z(a.x,a.y)),this.la.push(new z(a.right(),a.y)),this.la.push(new z(a.right(),a.bottom())),this.la.push(new z(a.x,a.bottom()));else if(a instanceof Array)this.la=a;else throw alert("Bad parameter passed to Polygon() constructor."),"Error";}}c.prototype.Fs=function(a){var b=this.ye();a=a.ye();for(var d=0;d<b.length;d++){var e=b[d];if(!Ob(a,e.x,e.y))return!1}return!0};c.prototype.transform=
function(a){for(var b=0;b<this.la.length;b++)this.la[b]=a.apply(this.la[b].x,this.la[b].y)};c.prototype.add=function(a,b){this.la.push(new z(a,b))};c.prototype.fd=function(a,b,d){void 0===d&&(d=0);return Ob(this.la,a,b)||d&&Pb(this.la,a,b,d)};c.prototype.Aq=function(){return B.wg(this.la)};c.prototype.clone=function(){return new c(this.la.slice(0))};c.prototype.Ed=function(a){if(this.la.length!==a.la.length)return!1;for(var b=0;b<this.la.length;b++){var d=this.la[b],e=a.la[b];if(d.x!==e.x||d.y!==
e.y)return!1}return!0};c.prototype.pd=function(a){for(var b=[],d=0;d<this.la.length;d++){var e=this.la[0===d?this.la.length-1:d-1],c=this.la[d],f=this.la[d===this.la.length-1?0:d+1],h=C(e.x,e.y,c.x,c.y),l=C(f.x,f.y,c.x,c.y);b.push({x:c.x+((c.x-e.x)/h+(c.x-f.x)/l)/Math.sqrt(2)*a,y:c.y+((c.y-e.y)/h+(c.y-f.y)/l)/Math.sqrt(2)*a})}this.la=b};c.prototype.ha=function(a){if(!(1>this.la.length)){a.moveTo(this.la[0].x,this.la[0].y);for(var b=1;b<this.la.length;b++)a.lineTo(this.la[b].x,this.la[b].y);a.closePath()}};
c.prototype.ye=function(){return this.la};c.ev=function(a,b){for(var d=0,e=0,c=!1,f=[],h=[],l=0;l<b.length;l++)h.push(0);for(;;){var k=0,m=-1;for(l=0;l<b.length;l++)if(h[l]<b[l].length){var q=b[l][h[l]];if(0===l||q<k){k=q;m=l;var p=1-h[l]%2}}if(-1===m)return f;h[m]+=1;"intersection"===a?p?(e+=1,e===b.length&&(d=k)):(e===b.length&&(f.push(d),f.push(k)),--e):p?(e+=1,0===m?(c=!0,1===e)&&(d=k):c&&2===e&&(f.push(d),f.push(k))):(c&&1===e&&(f.push(d),f.push(k)),--e,0===m&&(c=!1),c&&1===e&&(d=k))}};return c}();
function Tb(c,a,b,d,e,g,f,h){b-=c;d-=a;f-=e;h-=g;var l=-f*d+b*h;if(0===l)return null;e=(f*(a-g)-h*(c-e))/l;return new z(c+e*b,a+e*d)}
function Ub(c,a){function b(a){var b,e;var c=[];var l=b=0;for(e=a.length;l<e;l++){var k=a[l];a[b+1]&&(c[b]=d(k,a[b+1]));b+=1}return c}function d(a,b){return new z(a.x+(b.x-a.x)/2,a.y+(b.y-a.y)/2)}return a?Ub(b(b(function(a){var b,e;a=[a[0]].concat(a).concat(a[a.length-1]);var c=[];var l=b=0;for(e=a.length;l<e;l++){var k=a[l];c[2*b]=k;a[b+1]&&(c[2*b+1]=d(k,a[b+1]));b+=1}return c}(c))),a-1):c}
(function(){function c(){this.items=[];this.pa=new F}c.prototype.toString=function(){return this.items.join(" ")};c.prototype.arc=function(){throw Error("SvgPathContext.arc is not implemented.");};c.prototype.arcTo=function(){throw Error("SvgPathContext.arcTo is not implemented.");};c.prototype.moveTo=function(a,b){var d=this.pa.apply(a,b);this.items.push("M",d.x,d.y)};c.prototype.lineTo=function(a,b){var d=this.pa.apply(a,b);this.items.push("L",d.x,d.y)};c.prototype.transform=function(a,b,d,e,c,
f){a=new F(a,d,b,e,c,f);this.pa=this.pa.multiply(a)};c.prototype.rect=function(){};c.prototype.bezierCurveTo=function(a,b,d,e,c,f){a=this.pa.apply(a,b);d=this.pa.apply(d,e);c=this.pa.apply(c,f);this.items.push("C",a.x,a.y,d.x,d.y,c.x,c.y)};c.prototype.quadraticCurveTo=function(){throw Error("SvgPathContext.quadraticCurveTo is not implemented.");};c.prototype.beginPath=function(){};c.prototype.closePath=function(){this.items.push("Z")};return c})();
function Vb(c,a,b,d,e){if(!(2>a.length)){void 0===d&&(d=!0);void 0===e&&(e=!0);var g=a[0].x===a[a.length-1].x&&a[0].y===a[a.length-1].y,f=[],h=[],l=new z(0,0),k=l,m=l,q=l,p=l,r=[];b/=2;var t;for(t=1;t<a.length;t++){m=a[t-1];p=a[t];q=D(m.x,m.y,p.x,p.y);l=new z(q.y,-q.x);k=new z(m.x-q.x*b-l.x*b,m.y-q.y*b-l.y*b);m=new z(m.x-q.x*b+l.x*b,m.y-q.y*b+l.y*b);if(h.length){var v=h[h.length-1];var A=r[r.length-1];k=Tb(v.x,v.y,v.x+A.x,v.y+A.y,k.x,k.y,k.x+q.x,k.y+q.y)||k;v=f[f.length-1];m=Tb(v.x,v.y,v.x+A.x,v.y+
A.y,m.x,m.y,m.x+q.x,m.y+q.y)||m}h.push(k);f.push(m);r.push(q)}g?(v=h[0],A=r[0],k=Tb(v.x,v.y,v.x+A.x,v.y+A.y,k.x,k.y,k.x+q.x,k.y+q.y)||k,v=f[0],m=Tb(v.x,v.y,v.x+A.x,v.y+A.y,m.x,m.y,m.x+q.x,m.y+q.y)||m,h[0].x=k.x,h[0].y=k.y,f[0].x=m.x,f[0].y=m.y,h.push(k),f.push(m)):(h.push(new z(p.x+q.x*b-l.x*b,p.y+q.y*b-l.y*b)),f.push(new z(p.x+q.x*b+l.x*b,p.y+q.y*b+l.y*b)));if(e){c.moveTo(h[0].x,h[0].y);for(t=1;t<h.length;t++)c.lineTo(h[t].x,h[t].y);g&&(c.closePath(),c.moveTo(f[f.length-1].x,f[f.length-1].y))}else d&&
c.moveTo(f[f.length-1].x,f[f.length-1].y);if(d){for(t=f.length-1;0<=t;t--)c.lineTo(f[t].x,f[t].y);!g&&e&&c.lineTo(h[0].x,h[0].y)}}}
(function(){function c(a){this.la=a;this.n=0;this.kb=new z(0,0)}c.prototype.next=function(a){if(0===this.la.length)return null;if(0===this.n)return this.kb=this.la[0].clone(),this.n+=1,this.kb.clone();for(;this.n<this.la.length;){var b=this.kb.Lb(this.la[this.n]);if(0===b)this.n+=1;else if(b<=a)a-=b,this.n+=1;else return this.kb.x+=(this.la[this.n].x-this.kb.x)*a/b,this.kb.y+=(this.la[this.n].y-this.kb.y)*a/b,this.kb.clone()}return null};return c})();function Wb(c){return"object"===typeof c&&"[object Array]"===Object.prototype.toString.apply(c)}function Xb(c){return"string"===typeof c}function J(c){return"number"===typeof c}function Yb(c){return"object"===typeof c};var K=function(){function c(a,b){this.id=a;this.ea=b;this.parent=null;this.aa={};this.rect=new B(0,0,1,1);this.Qh=!1;this.Ka=new B(0,0,1,1);this.Rb=this.order=0;this.log=w.create("BaseNode");this.aa.matrix=new F;this.aa.layer="default";this.fk(c.za)}c.xd=function(a,b){c.types[a]=b};c.create=function(a,b,d){return a in c.types?new c.types[a](b,d):null};c.prototype.fk=function(a){for(var b in a)a.hasOwnProperty(b)&&(this.aa[b]=a[b])};c.prototype.clip=function(){};c.prototype.toString=function(){return this.type()+
":"+this.id};c.prototype.Zg=function(){return!1};c.prototype.Oi=function(){return null};c.prototype.ri=function(){};c.prototype.no=function(){return!1};c.prototype.$g=function(){return"text"in this.aa};c.prototype.Mn=function(a,b){var d=typeof this.aa[a],e=typeof b;d!==e&&"string"===e&&"number"===d&&(this.log("Convert property %s to a number.",a),b=parseFloat(b));return b};c.prototype.clone=function(a){a=c.create(this.type(),a(),this.ea);a.Ib(this.dc());return a};c.prototype.dc=function(){var a={},
b;for(b in this.aa)this.aa.hasOwnProperty(b)&&(a[b]=this.ja(b));return a};c.prototype.Ib=function(a){for(var b in a)a.hasOwnProperty(b)&&this.setProperty(b,a[b])};c.prototype.Ac=function(){var a=this.ja("layer");return a?""+a:"default"};c.prototype.po=function(){return void 0!==this.children};c.prototype.qo=function(){return null!==this.parent&&null!==this.parent.parent&&"PageNode"!==this.parent.type()};c.prototype.type=function(){return"BaseNode"};c.prototype.Ha=function(){return this.ja("matrix")};
c.prototype.Id=function(){return this.Ha().inverse()};c.prototype.lg=function(a){this.setProperty("matrix",a)};c.prototype.setProperty=function(a,b){b=this.Mn(a,b);if(a in this.aa||"customData"===a||"tag"===a||"locked"===a||"lockSize"===a||"lockRotation"===a||"lockPosition"===a||"lockEditMode"===a||"rotationHandles"===a||"lockAspectRatio"===a||"zIndex"===a||"snap"===a||"opacity"===a||"_"===a[0])Wb(b)&&(b=b.slice(0)),"opacity"===a&&(b=parseFloat(b)),this.aa[a]=b};c.prototype.ja=function(a){a=this.aa[a];
a instanceof Array&&(a=a.slice(0));return a};c.prototype.yi=function(){var a=new Sb(this.Ka);a.transform(this.Ha());return a};c.prototype.od=function(){return this.ja("zIndex")||0};c.prototype.transform=function(a){this.lg(a.multiply(this.Ha()))};c.prototype.format=function(){};c.prototype.qb=function(a,b){var d=this.Id().apply(a,b);return this.hidden()||this.ja("locked")||!this.Ka.fd(d.x,d.y)?null:this};c.prototype.Vd=function(a){this.Qh=a};c.prototype.hidden=function(){return this.Qh};c.prototype.mg=
function(){};c.prototype.bj=function(){};c.prototype.ej=function(){};c.prototype.ph=function(a){if(a.ph){var b={"zwibbler:id":""+this.id};if("tag"in this.aa){var d=this.aa.tag;"string"!==typeof d&&(d=JSON.stringify(d));b["zwibbler:tag"]=d}a.ph(b)}};c.prototype.oh=function(a){a.oh&&a.oh()};c.prototype.ha=function(a){a.save();this.ph(a);var b=this.aa.matrix;a.transform(b.m11,b.m21,b.m12,b.m22,b.Fa,b.Ga);"erase"===this.aa.strokeStyle?a.wd?a.strokeStyle=a.wd:(a.strokeStyle="#000000",a.globalCompositeOperation=
"destination-out"):a.strokeStyle=this.aa.strokeStyle;a.fillStyle=this.aa.fillStyle;a.lineWidth=this.aa.lineWidth;this.aa.shadow&&(a.shadowOffsetX=3,a.shadowOffsetY=3,a.shadowBlur=5,a.shadowColor="rgba(0,0,0,0.5)");"opacity"in this.aa&&(a.globalAlpha=this.aa.opacity);this.Ee(a);this.oh(a);a.restore();c.ym&&(a.save(),a.beginPath(),a.lineWidth=1,a.strokeStyle="#ff8000",a.rect(this.rect.x,this.rect.y,this.rect.width,this.rect.height),a.stroke(),a.restore())};c.prototype.Hn=function(a,b){var d=b?function(b){a.fillStyle=
b;a.fill()}:function(b){a.strokeStyle=b;a.stroke()};a.wd?(a.globalCompositeOperation="destination-out",--a.lineWidth,d("#000000"),a.globalCompositeOperation="source-over",a.fillStyle=a.wd,a.lineWidth+=2,d(a.wd),--a.lineWidth):(a.globalCompositeOperation="destination-out",d("#000000"),a.globalCompositeOperation="source-over")};c.prototype.Ee=function(){};c.prototype.resolve=function(){return!1};c.prototype.Er=function(a,b,d,e){this.Pg||(this.Pg={});var c=this.Pg[a];if(!c||c.Gp!==e){c&&e===c.Gp||(c=
{Gp:e,value:e},this.Pg[a]=c);a=/url\(([^\)]+)\)/.exec(e);var f;a&&(f=a[1]);var h=this;f&&(c.value="rgba(0, 0, 0, 0.2)",d.add(this.id,"image",f,null,function(a){h.log("Got image response.");c.value=b.createPattern(a,"repeat")||"magenta";d.gg(h.id)}))}};c.prototype.Vr=function(a){return this.Pg&&(a=this.Pg[a])?a.value:"magenta"};c.prototype.Hd=function(){return""};c.prototype.af=function(){};c.prototype.Ci=function(){return null};c.prototype.Di=function(){return null};c.prototype.Ze=function(){return this.parent?
this.parent.Hk(this):-1};c.prototype.np=function(){};c.za={fillStyle:"#cccccc",strokeStyle:"#000000",lineWidth:2,shadow:!1};c.ym=!1;c.types={};return c}();var Zb=function(c){function a(a,d){var b=c.call(this,a,d)||this;b.la=[];b.bc=[];b.log=w.create("BRUSH",!0);b.log("New BrushNode created.");b.aa.points=[];b.aa.strokeStyle="#ff00ff";b.aa.lineWidth=10;return b}n(a,c);a.prototype.type=function(){return"BrushNode"};a.prototype.setProperty=function(a,d){"fillStyle"===a&&(a="strokeStyle");a in this.aa||"dashes"===a||"lineCap"===a?this.aa[a]=d:c.prototype.setProperty.call(this,a,d)};a.prototype.ja=function(a){"fillStyle"===a&&(a="strokeStyle");return c.prototype.ja.call(this,
a)};a.prototype.format=function(){var a,d;this.la.length=0;var e=this.aa.points;var c=a=0;for(d=e.length-1;a<=d;c=a+=2)this.la.push(new z(e[c],e[c+1]));c=B.wg(this.la);e=this.Ha().ec();a=this.aa.lineWidth;c.pd(a/e.x,a/e.y);this.Ka=c.clone();c=new Sb(c);c.transform(this.aa.matrix);this.rect=B.wg(c.la);this.bc=[];if("dashes"in this.aa)for(e=this.aa.dashes.split(","),c=0;c<e.length;c++)a=parseFloat(e[c]),isNaN(a)||this.bc.push(a);this.log("Format brushnode")};a.prototype.qb=function(a,d){if(this.rect.fd(a,
d)){var b=this.Id().apply(a,d);if(Pb(this.la,b.x,b.y,12+this.aa.lineWidth/2))return this}return null};a.prototype.Ee=function(b){var d=this.aa.points;if(0!==d.length){b.save();b.beginPath();var e=this.ja("lineCap")||"round";b.lineCap=e;b.lineJoin="round"===e?"round":"bevel";if(1<this.bc.length){e=this.la;var c=this.bc;if(0!==e.length){b.moveTo(e[0].x,e[0].y);var f=0;for(var h=1,l=c[0],k=e[0].clone(),m;h<e.length;)m=k.Lb(e[h]),0===m?h+=1:m<=l?(k=e[h].clone(),f&1?b.moveTo(k.x,k.y):b.lineTo(k.x,k.y),
l-=m,h+=1):(k.x+=(e[h].x-k.x)*l/m,k.y+=(e[h].y-k.y)*l/m,f&1?b.moveTo(k.x,k.y):b.lineTo(k.x,k.y),f=(f+1)%c.length,l=c[f])}}else for(b.moveTo(d[0],d[1]),e=c=2,f=d.length-1;c<=f;e=c+=2)b.lineTo(d[e],d[e+1]);this.Id().Df(b);Db(b,this.aa.strokeStyle);if(a.Up){this.Ha().Df(b);b.beginPath();e=c=0;for(f=d.length-1;c<=f;e=c+=2)b.rect(d[e]-2,d[e+1]-2,4,4);b.fillStyle="#ff0000";b.fill()}b.restore()}};a.Up=!1;return a}(K);K.xd("BrushNode",Zb);var $b=function(){function c(){this.text="";this.font="10px Arial";this.On="Arial";this.fontSize=10;this.lines=[];this.mm="top";this.Yg="left";this.ro=this.bold=!1;this.textDecoration="";this.log=w.create("TextBox");this.rect=new B(0,0,0,this.fontSize)}c.prototype.op=function(a,b,d,e,c){this.On=a;this.fontSize=b;this.bold=d;this.ro=e;this.textDecoration=c};c.prototype.wh=function(a){this.text=a};c.prototype.Hl=function(a,b){switch(a){case "left":case "center":case "right":this.Yg=a;break;case null:break;
default:this.log("Unknown alignment: %s",a)}switch(b){case "top":case "middle":case "bottom":this.mm=b;break;case null:break;default:this.log("Unknnown alignment: %s",b)}};c.prototype.format=function(a,b,d){this.font=""+this.fontSize+'px "'+this.On+'"';this.bold&&(this.font="bold "+this.font);this.ro&&(this.font="italic "+this.font);this.lines.length=0;var e;a.font=this.font;var c=0;this.rect.width=0;if(0===b){var f=this.text.split("\n");for(e=0;e<f.length;e++){var h=f[e];var l=a.measureText(h).width;
c+=this.fontSize;this.lines.push({x:0,y:c,width:l,text:h});this.rect.width=Math.max(this.rect.width,l)}}else{h=f=0;var k=!1;for(e=0;e<this.text.length;e++){var m=this.text.charAt(e);l=a.measureText(this.text.substr(f,e-f+1)).width;"\n"===m?k=!0:l>b?h?(e=h,k=!0):e>f&&(--e,k=!0):" "===m&&(h=e);k&&(l=" "===this.text.charAt(e)?a.measureText(this.text.substr(f,e-f)).width:a.measureText(this.text.substr(f,e-f+1)).width,c+=this.fontSize,this.lines.push({x:0,y:c,width:l,text:this.text.substr(f,e-f+1)}),f=
e+1,h=0,k=!1,this.rect.width=Math.max(this.rect.width,l))}l&&(c+=this.fontSize,this.lines.push({x:0,y:c,width:l,text:this.text.substr(f,e-f)}),this.rect.width=Math.max(this.rect.width,l))}this.rect.x=0;this.rect.y=0;this.rect.height=c;if("center"===this.Yg)for(e=0;e<this.lines.length;e++)a=this.lines[e],a.x=this.rect.width/2-a.width/2;else if("right"===this.Yg)for(e=0;e<this.lines.length;e++)a=this.lines[e],a.x=this.rect.width-a.width;b&&"center"===this.Yg?this.rect.x=b/2-this.rect.width/2:b&&"right"===
this.Yg&&(this.rect.x=b-this.rect.width);d&&"middle"===this.mm?this.rect.y=d/2-this.rect.height/2:d&&"bottom"===this.mm&&(this.rect.y=d-this.rect.height)};c.prototype.ha=function(a,b,d){this.fillText(a,b,d);this.En(a,b,d)};c.prototype.En=function(a,b,d){var e;if(0<=this.textDecoration.indexOf("underline")){a.save();a.beginPath();var c=1;for(e=0;e<this.lines.length;e++){var f=this.lines[e];a.moveTo(f.x+b,f.y+d+c);a.lineTo(f.x+b+f.width,f.y+d+c)}a.strokeStyle=a.fillStyle;a.lineWidth=1;a.stroke();a.beginPath();
a.restore()}if(0<=this.textDecoration.indexOf("line-through")){a.save();a.beginPath();c=.25*-this.fontSize;for(e=0;e<this.lines.length;e++)f=this.lines[e],a.moveTo(f.x+b,f.y+d+c),a.lineTo(f.x+b+f.width,f.y+d+c);a.strokeStyle=a.fillStyle;a.lineWidth=1;a.stroke();a.restore()}};c.prototype.fillText=function(a,b,d){a.textBaseline="alphabetic";a.font=this.font;for(var e=0;e<this.lines.length;e++){var c=this.lines[e];a.fillText(c.text,this.rect.x+c.x+b,this.rect.y+c.y+d)}};c.prototype.strokeText=function(a,
b,d){a.textBaseline="alphabetic";a.font=this.font;for(var e=0;e<this.lines.length;e++){var c=this.lines[e];a.strokeText(c.text,this.rect.x+c.x+b,this.rect.y+c.y+d)}};return c}();var ac=function(){function c(a,b){void 0===b&&(b="repeat");this.Ja=a;this.repeat=b}c.prototype.loaded=function(){return this.Ja instanceof HTMLImageElement?this.Ja.complete:!0};c.prototype.setTransform=function(){};return c}(),bc=function(){function c(a,b,d,e){this.uu=[];this.from=new z(a,b);this.ga=new z(d,e)}c.prototype.addColorStop=function(a,b){this.uu.push({offset:a,Ne:b})};return c}(),dc=function(){function c(){this.stack=[];this.pa=new F;this.lineCap="butt";this.lineJoin="miter";this.lineWidth=
1;this.strokeStyle=this.fillStyle="#000000";this.textBaseline="top";this.font="10px arial";this.globalCompositeOperation="source-over";this.globalAlpha=1;this.shadowBlur=this.shadowOffsetY=this.shadowOffsetX=0;this.shadowColor="rgba(0,0,0,0)"}c.prototype.save=function(){this.stack.push({pa:this.pa.clone(),fillStyle:this.fillStyle,font:this.font,lineJoin:this.lineJoin,lineCap:this.lineCap,lineWidth:this.lineWidth,strokeStyle:this.strokeStyle,textBaseline:this.textBaseline,globalCompositeOperation:this.globalCompositeOperation,
globalAlpha:this.globalAlpha,shadowOffsetX:this.shadowOffsetX,shadowOffsetY:this.shadowOffsetY,shadowBlur:this.shadowBlur,shadowColor:this.shadowColor,Me:this.Uj()})};c.prototype.restore=function(){var a=this.stack.pop();a&&(this.pa=a.pa,this.fillStyle=a.fillStyle,this.font=a.font,this.lineJoin=a.lineJoin,this.lineCap=a.lineCap,this.lineWidth=a.lineWidth,this.pa=a.pa,this.strokeStyle=a.strokeStyle,this.textBaseline=a.textBaseline,this.globalCompositeOperation=a.globalCompositeOperation,this.globalAlpha=
a.globalAlpha,this.shadowOffsetX=a.shadowOffsetX,this.shadowOffsetY=a.shadowOffsetY,this.shadowBlur=a.shadowBlur,this.shadowColor=a.shadowColor,this.Yj(a.Me))};c.prototype.drawImage=function(a,b,d,e,c,f,h,l,k){var g=a.width,q=a.height,p=0,r=g,t=q;void 0!==e&&void 0!==c&&void 0!==f&&void 0!==h&&void 0!==l&&void 0!==k?(p=b,0-d,r=e,t=c,b=f,d=h,g=l,q=k):void 0!==e&&void 0!==c&&(g=e,q=c);this.Rj(a,p,0,r,t,b,d,g,q)};c.prototype.beginPath=function(){};c.prototype.closePath=function(){};c.prototype.arc=function(a,
b,d,e,c,f){f&&(f=e,e=c,c=f);for(;0>e;)e+=2*Math.PI;for(;0>c;)c+=2*Math.PI;e>c&&(e-=2*Math.PI);var g=2*Math.PI;var l=e%g;var k=c%g;k===l&&(k+=2*Math.PI);c=[];e=Math.PI/2;f=l<k?1:-1;var m=l;for(g=Math.min(g,Math.abs(k-l));1E-5<g;){l=m+f*Math.min(g,e);var q=(l-m)/2,p=d*Math.cos(q),r=d*Math.sin(q),t=.5522847498*Math.tan(q);k=p+t*r;p=-r+t*p;r=-p;t=q+m;q=Math.cos(t);t=Math.sin(t);c.push({Vu:d*Math.cos(m),Zu:d*Math.sin(m),Wu:k*q-p*t,$u:k*t+p*q,Xu:k*q-r*t,av:k*t+r*q,Yu:d*Math.cos(l),bv:d*Math.sin(l)});g-=
Math.abs(l-m);m=l}for(d=0;d<c.length;d++)e=c[d],0===d&&this.moveTo(e.Vu+a,e.Zu+b),this.bezierCurveTo(e.Wu+a,e.$u+b,e.Xu+a,e.av+b,e.Yu+a,e.bv+b)};c.prototype.arcTo=function(){};c.prototype.strokeRect=function(a,b,d,e){this.beginPath();this.rect(a,b,d,e);this.stroke()};c.prototype.setTransform=function(a,b,d,e,c,f){this.pa=new F(a,d,b,e,c,f)};c.prototype.transform=function(a,b,d,e,c,f){a=new F(a,d,b,e,c,f);this.pa=this.pa.multiply(a)};c.prototype.translate=function(a,b){this.transform(1,0,0,1,a,b)};
c.prototype.scale=function(a,b){this.transform(a,0,0,b,0,0)};c.prototype.rotate=function(a){var b=Math.cos(a);a=Math.sin(a);this.transform(b,a,-a,b,0,0)};c.prototype.rect=function(a,b,d,e){this.beginPath();this.moveTo(a,b);this.lineTo(a+d,b);this.lineTo(a+d,b+e);this.lineTo(a,b+e);this.lineTo(a,b);this.closePath()};c.prototype.fillRect=function(a,b,d,e){this.rect(a,b,d,e);this.fill()};c.prototype.Ge=function(a){return cc(a)};c.prototype.createPattern=function(a,b){return new ac(a,b)};c.prototype.createLinearGradient=
function(a,b,d,e){return new bc(a,b,d,e)};return c}(),ec=function(){function c(a){this.fontFamily="";this.fontSize=10;this.lineHeight=this.fontVariant=this.fontWeight=this.fontStyle="normal";a=cc(a);this.fontFamily=a.fontFamily||"Arial";this.fontSize=parseFloat(a.fontSize);this.fontStyle=a.fontStyle;this.fontWeight=a.fontWeight;this.fontVariant=a.fontVariant;this.lineHeight=a.lineHeight}c.prototype.toString=function(){var a=this.fontSize+'px "'+this.fontFamily+'"';"bold"===this.fontWeight&&(a="bold "+
a);"italic"===this.fontStyle&&(a="italic"+a);return a};return c}();
function cc(c){var a=null,b="10",d="normal",e="normal",g="normal",f="normal",h=!1;c=c.split(/\s+/);a:for(;;){var l=c.shift();if(!l)break;switch(l){case "normal":break;case "italic":case "oblique":d=l;break;case "small-caps":g=l;break;case "bold":case "bolder":case "lighter":case "100":case "200":case "300":case "400":case "500":case "600":case "700":case "800":case "900":e=l;break;default:if(h){a=l;c.length&&(a+=" "+c.join(" "));2<a.length&&('"'===a.charAt(0)||"'"===a.charAt(0))&&(a=a.substr(1,a.length-
2));break a}else l=l.split("/"),b=l[0],h=!0,1<l.length&&(f=l[1])}}return{fontStyle:d,fontVariant:g,fontWeight:e,fontSize:b,lineHeight:f,fontFamily:a}};function fc(c){return{m11:c.m11,m12:c.m21,m21:c.m12,m22:c.m22,dx:c.Fa,dy:c.Ga}}
var O=function(){function c(a,b){this.node=a;this.request=b}c.prototype.Dr=function(a,b,d){this.node.Er(b,a,this.request,d)};c.prototype.Ur=function(a){return this.node.Vr(a)};c.prototype.It=function(){this.request.gg(this.node.id)};c.prototype.Os=function(a,b){this.request.add(this.node.id,"image",a,null,b)};c.prototype.qr=function(a){this.node.Hn(a,!0)};c.prototype.vu=function(a){this.node.Hn(a,!1)};c.prototype.Fr=function(a,b){var d=new $b;b.text&&d.wh(b.text);if(b.font){var e=cc(b.font);d.op(e.fontFamily||
"arial",parseFloat(e.fontSize),"bold"===e.fontWeight,"italic"===e.fontStyle,b.textDecoration||"")}d.Hl(b.halign||null,b.valign||null);d.format(a,b.width||0,b.height||0);return{draw:function(a,b,e){d.ha(a,b,e)},width:d.rect.width,height:d.rect.height}};c.prototype.ec=function(){return 1};c.prototype.ut=function(a){return new ec(a)};c.prototype.Nc=function(a){return this.request.Nc(a)};return c}(),gc=function(c){function a(a,d){var b=c.call(this,a,d)||this;b.Sa=null;b.log=w.create("CUSTOM");b.setProperty("matrix",
new F);return b}n(a,c);a.prototype.type=function(){return"CustomNode"};a.prototype.setProperty=function(a,d){if(null===this.Sa&&"nodeType"===a){var b=Q.qk[d];this.Sa=new b(this.id);for(var c in this.aa)this.setProperty(c,this.aa[c]);this.aa.nodeType=d}else this.aa[a]=d,"matrix"===a&&(d=fc(d)),this.Sa&&this.Sa.setProperty&&this.Sa.setProperty(a,d)};a.prototype.Zg=function(){return this.Sa&&this.Sa.hasEditMode?this.Sa.hasEditMode():!1};a.prototype.Mk=function(){var a=[];this.Sa&&this.Sa.getEditHandles&&
(a=this.Sa.getEditHandles());for(var d=this.Ha(),e=[],c=0;c<a.length;c++){var f=a[c];e.push(d.apply(f.x||0,f.y||0))}return e};a.prototype.qb=function(a,d){var b=this.Id().apply(a,d);return this.hidden()||this.ja("locked")||!this.Ka.fd(b.x,b.y)||this.Sa&&this.Sa.hittest&&!this.Sa.hittest(b.x,b.y)?null:this};a.prototype.ri=function(a,d){a.beginPath();for(var b=10/d,c=2/d,f=0,h=this.Mk();f<h.length;f++){var l=h[f];a.moveTo(l.x+b/d,l.y);a.arc(l.x,l.y,b,0,2*Math.PI,!1)}a.strokeStyle="#0050B7";a.lineWidth=
c;a.stroke()};a.prototype.Ci=function(a){var b=this.Mk();return a<b.length?b[a]:null};a.prototype.Oi=function(a,d,e){for(var b=this.Mk(),c=0;c<b.length;c++)if(20>b[c].Lb(new z(a,d))/e)return c;return null};a.prototype.af=function(a,d,e){this.Sa&&this.Sa.moveEditHandle&&(d=this.Id().apply(d,e),this.Sa.moveEditHandle(a,d.x,d.y))};a.prototype.ja=function(a){var b;this.Sa&&this.Sa.getProperty&&(b=this.Sa.getProperty(a));void 0===b&&(b=c.prototype.ja.call(this,a));"matrix"===a&&(b=b?b instanceof F?b:new F(b.m11||
1,b.m21||0,b.m12||0,b.m22||1,b.dx||0,b.dy||0):new F);return b};a.prototype.Vd=function(a){this.Sa.setHidden&&this.Sa.setHidden(a)};a.prototype.format=function(a,d){if(this.Sa)if(this.wi||(this.wi=new O(this,d)),"format"in this.Sa&&this.Sa.format(a,this.wi),this.Sa.getUntransformedRect){var b=this.Sa.getUntransformedRect();this.Ka=new B(b.x||0,b.y||0,b.width||0,b.height||0);this.rect=this.Ka.clone();this.rect.transform(this.Ha())}else this.log("Error: NodeType %s missing getUntransformedRect()",this.aa.nodeType)};
a.prototype.Ee=function(a){a.save();a.getTransform=function(){return a.Hh?fc(a.Hh):fc(new F)};this.wi.ec=function(){return a.Hh?a.Hh.ec().x:1};this.Sa.draw(a,this.wi);a.restore()};return a}(K);K.xd("CustomNode",gc);O.prototype.formatFill=O.prototype.Dr;O.prototype.getFill=O.prototype.Ur;O.prototype.reformat=O.prototype.It;O.prototype.loadImage=O.prototype.Os;O.prototype.fillEraser=O.prototype.qr;O.prototype.strokeEraser=O.prototype.vu;O.prototype.formatText=O.prototype.Fr;O.prototype.getScale=O.prototype.ec;
O.prototype.parseFont=O.prototype.ut;O.prototype.getConfig=O.prototype.Nc;var hc=function(c){function a(a,d){var b=c.call(this,a,d)||this;b.element=null;b.ji=void 0;b.gc=new Sb;b.Xk=new Sb;b.ke=new F;b.readOnly=!1;b.mb=!1;b.ld=null;b.width=0;b.height=0;b.uc=null;b.Vo="";b.log=w.create("DomNode",!0);b.tg=-1;b.canvas=null;b.aa.data="";b.aa.locked=!1;return b}n(a,c);a.prototype.type=function(){return"DomNode"};a.prototype.setProperty=function(a,d){if("data"===a)this.element&&(y(this.element).remove(),this.ji=this.element=null);else if("border"===a||"lockSize"===a||"lockRotate"===
a||"preview"===a){this.aa[a]=d;return}c.prototype.setProperty.call(this,a,d)};a.prototype.cu=function(a){null!==this.ld&&(this.log("Node %s receives DOM element and requests reformat",this.id),this.element&&(this.log("   Remove existing DOM element"),y(this.element).remove()),this.element=a,this.element.style.position="absolute",y(this.element).Yk(this.ld.canvas),this.width=this.element.offsetWidth||parseFloat(this.element.getAttribute("width")||"0"),this.height=this.element.offsetHeight||parseFloat(this.element.getAttribute("height")||
"0"),y(this.element).remove(),this.mg(this.readOnly,!0),this.element.style.top="0px",this.element.style.left="0px",this.element.style.boxSizing="border-box",this.element.classList.add("zwibbler-dom-node"),this.ak("transformOrigin","top left"),this.log("element height: %s, %s",this.element.offsetWidth,this.element.offsetHeight),this.ld.gg(this.id))};a.prototype.Vg=function(){return this.element};a.prototype.ak=function(a,d){if(null!==this.element){for(var b=a.charAt(0).toUpperCase()+a.substr(1),c=
["ms","Webkit","O","Moz"],f=0;f<c.length;f++)this.element.style[c[f]+b]=d;this.element.style[a]=d}};a.prototype.Vd=function(a){K.prototype.Vd.call(this,a);this.element&&(this.element.style.visibility=this.Qh?"hidden":"visible")};a.prototype.mg=function(a,d){void 0===d&&(d=!1);if(d||this.readOnly!==a)this.readOnly=a,this.element&&this.ld&&this.mb&&(this.sl(this.tg),y(this.element).Yk(this.ld.canvas))};a.prototype.format=function(a,d){var b=this;this.canvas=d.canvas;null===this.element&&this.ji!==this.ja("data")&&
d&&(this.ji=this.ja("data"),this.ld=d,this.log("DomNode %s requests conversion to DOM element",this.id),this.ld.Qq(this.ji,this.id));if(this.element){this.element.kv=this.id;var c=this.Ha(),f=c.ec();this.element.style.width=this.width*f.x+"px";this.element.style.height=this.height*f.y+"px";c=c.multiply(new Kb(1/f.x,1/f.y));f=this.ke;f=f.multiply(c);f.Ks()?(this.ak("transform",""),this.element.style.left=""+f.Fa+"px",this.element.style.top=""+f.Ga+"px"):(this.element.style.left="0px",this.element.style.top=
"0px",this.ak("transform","matrix("+f.m11+","+f.m21+","+f.m12+","+f.m22+","+f.Fa+","+f.Ga+")"));this.rect.x=0;this.rect.y=0;this.rect.width=this.width;this.rect.height=this.height;this.element.style.visibility=this.Qh?"hidden":"visible"}else this.rect.x=0,this.rect.y=0,this.rect.width=100,this.rect.height=22;this.gc=new Sb(this.rect);this.Ka=this.rect.clone();this.rect.transform(this.Ha());this.gc.transform(this.Ha());if(c=this.aa.border)this.rect.pd(c),this.Xk=this.gc.clone(),this.Xk.pd(c/2),this.gc.pd(c);
!this.aa.preview||null!==this.uc&&this.Vo===this.aa.preview?this.aa.preview||(this.uc=null):(this.log("Requesting new preview image for %s",this.aa.preview),this.uc=document.createElement("img"),this.Vo=this.uc.src=this.aa.preview,this.uc.onload=function(){b.log("Preview image loaded.");d.gg(b.id)},this.uc.onerror=function(){b.log("Failed to load preview image")})};a.prototype.Ee=function(a){var b=a.Hh;b&&this.ld&&(b.m11!==this.ke.m11||b.m21!==this.ke.m21||b.m12!==this.ke.m12||b.m22!==this.ke.m22||
b.Fa!==this.ke.Fa||b.Ga!==this.ke.Ga)&&(this.log("Moving DOM element as result of draw zooming"),this.ke=b,this.format(a,this.ld));if(this.element){var e=this.aa.border;if(e){var c=this.Xk;a.setTransform(1,0,0,1,0,0);a.beginPath();a.lineWidth=e;a.strokeStyle="#cccccc";a.moveTo(c.la[0].x,c.la[0].y);a.lineTo(c.la[1].x,c.la[1].y);a.lineTo(c.la[2].x,c.la[2].y);a.lineTo(c.la[3].x,c.la[3].y);a.lineTo(c.la[0].x,c.la[0].y);a.closePath();a.stroke()}}else a.beginPath(),a.lineWidth=1,a.fillStyle="#888888",a.strokeStyle=
"#CCCCCC",a.rect(0,0,100,22),a.stroke(),a.font="20px Arial",a.textBaseline="top",a.fillText("DomNode",0,0);if(this.uc&&this.uc.naturalHeight&&!b&&this.mb){this.log("Drawing preview image %s,%s ->%s,s",this.uc.naturalWidth,this.uc.naturalHeight,this.width,this.height);try{a.drawImage(this.uc,0,0,this.uc.naturalWidth,this.uc.naturalHeight,0,0,this.width,this.height)}catch(f){this.log("Tried to draw image, got error: %s",f.toString())}}else b&&(b=a.globalCompositeOperation,a.globalCompositeOperation=
"destination-out",a.fillRect(this.Ka.x,this.Ka.y,this.Ka.width,this.Ka.height),a.globalCompositeOperation=b)};a.prototype.clip=function(a){this.gc.ha(a)};a.prototype.qb=function(a,d){return!this.aa.locked&&this.rect.fd(a,d)&&this.gc.fd(a,d,3)?this:null};a.prototype.bj=function(){this.element&&this.ld&&(this.log("Added DOM NODE %s",this.id),this.sl(this.tg));this.mb=!0};a.prototype.ej=function(){this.log("Removed DOM NODE %s",this.id);this.element&&y(this.element).remove();this.mb=!1};a.prototype.sl=
function(a){if(this.element&&this.canvas&&!(0>a)){a!==this.tg?(this.element.classList.remove("zwibbler-zorder-"+this.tg),this.element.classList.add("zwibbler-zorder-"+a),this.tg=a,this.log("Add class zwibbler-zorder-%s",a)):this.log("order=zorder=%s",this.tg);var b=null;for(--a;0<=a;a--){var e=this.canvas.parentElement.querySelector(".zwibbler-zorder-"+a);if(e){b=e;this.log("Found element zorder-%s",a);break}this.log("Did not find element zorder-%s",a)}if(this.element.previousSibling!==b||null===
b)b?(this.log("Insert after previous."),y(this.element).Yk(b)):(this.log("Insert before canvas %s",this.canvas),y(this.element).insertBefore(this.canvas))}};a.prototype.np=function(a){this.sl(a)};return a}(K);K.xd("DomNode",hc);var ic=function(c){function a(a,d){var b=c.call(this,a,d)||this;b.children=[];return b}n(a,c);a.prototype.type=function(){return"GroupNode"};a.prototype.clone=function(b){for(var d=new a(b(),this.ea),e=0;e<this.children.length;e++){var c=this.children[e].clone(b);c.parent=d;d.children.push(c)}return d};a.prototype.format=function(a,d){for(var b=0;b<this.children.length;b++)this.children[b].format(a,d),0===b?this.rect=this.children[b].rect.clone():this.rect.Eh(this.children[b].rect)};a.prototype.ha=
function(a){for(var b=0;b<this.children.length;b++)this.children[b].ha(a)};a.prototype.qb=function(a,d){for(var b=this.children.length-1;0<=b;b--){var c=this.children[b].qb(a,d);if(c)return c}return null};a.prototype.Hk=function(a){for(var b=0;b<this.children.length;b++)if(a===this.children[b])return b;return-1};return a}(K);K.xd("GroupNode",ic);var jc=function(c){function a(a,d){var b=c.call(this,a,d)||this;b.vc=null;b.kd=null;b.width=100;b.height=20;b.gc=new Sb;b.Qe=[];b.Pc=new B(0,0,b.width,b.height);b.ac=new B(0,0,b.width,b.height);b.log=w.create("IMAGE",!0);delete b.aa.fillStyle;delete b.aa.strokeStyle;delete b.aa.lineWidth;b.aa.url="";return b}n(a,c);a.prototype.type=function(){return"ImageNode"};a.prototype.setProperty=function(a,d){c.prototype.setProperty.call(this,a,d);switch(a){case "url":this.kd=this.vc=null;break;case "brightness":case "contrast":case "gamma":this.kd=
null;this.aa[a]=d;break;case "allowCrop":case "crop":case "blendMode":case "opacity":case "width":case "height":this.aa[a]=d}};a.prototype.Yt=function(a){a.x=Math.max(a.x,0);a.y=Math.max(a.y,0);a.width=Math.min(a.width,this.Pc.width);a.height=Math.min(a.height,this.Pc.height);a.width=Math.max(1,a.width);a.height=Math.max(1,a.height);this.aa.crop=[a.x,a.y,a.width,a.height].join()};a.prototype.Un=function(){var a=this.aa.crop,d=new B(0,0,this.Pc.width,this.Pc.height);a&&(a=a.split(","),d.x=parseFloat(a[0])|
0,d.y=parseFloat(a[1])|0,d.width=parseFloat(a[2])|0,d.height=parseFloat(a[3])|0);return d};a.prototype.Qt=function(){var a={brightness:this.ja("brightness"),contrast:this.ja("contrast"),gamma:this.ja("gamma")};this.kd=void 0!==a.brightness&&void 0!==a.contrast&&void 0!==a.gamma&&this.vc?this.rr(this.vc,a)||this.vc:this.vc};a.prototype.format=function(a,d){function b(a,b,d){k.Qe.push({x:k.ac.x+a*k.ac.width,y:k.ac.y+b*k.ac.height,Ld:d})}var c=this;null===this.vc&&"ImageSurface"in window?(this.vc=new window.ImageSurface(this.aa.url),
this.Pc=new B(0,0,this.vc.width,this.vc.height)):null===this.vc?(this.Pc=new B(0,0,this.width,this.height),d.add(this.id,"image",this.aa.url,null,function(a){c.log("Got image response.");c.vc=a;return d.gg(c.id)})):this.Pc=new B(0,0,this.vc.width,this.vc.height);if(null===this.kd&&(this.Qt(),this.kd)){var f=this.ja("width"),h=this.ja("height");this.log("Override width/height as %s/%s",f,h);f&&(this.kd.style.width=f+"px");h&&(this.kd.style.height=h+"px")}this.ac=this.Un();this.rect=this.ac.clone();
if(f=this.ja("boundingPolygon")){h=[];for(var l=0;l<f.length;l+=2)h.push(new z(f[l],f[l+1]));this.gc=new Sb(h)}else this.gc=new Sb(this.rect);this.Ka=this.rect.clone();this.gc.transform(this.aa.matrix);this.rect.transform(this.aa.matrix);this.Qe.length=0;var k=this;b(.5,0,!0);b(1,.5,!1);b(.5,1,!0);b(0,.5,!1)};a.prototype.yi=function(){return this.gc};a.prototype.qb=function(a,d){return!this.aa.locked&&this.gc.fd(a,d,3)?this:null};a.prototype.Ee=function(b){var d,e,c=!1;if(this.kd)try{var f=b.globalCompositeOperation,
h=b.globalAlpha,l=this.ja("blendMode"),k=this.ja("opacity");l&&(b.globalCompositeOperation=""+l,this.log("Using globalCompsiteOperation=%s (requested %s)",b.globalCompositeOperation,l));void 0!==k&&(b.globalAlpha=k);var m=this.ja("lineWidth")||0;if(m){b.save();this.Id().Df(b);var q=this.gc.clone();q.pd(m/2);b.beginPath();q.ha(b);b.lineWidth=m;b.strokeStyle=this.ja("strokeStyle")||"#000000";b.stroke();b.restore()}b.drawImage(this.kd,this.ac.x,this.ac.y,this.ac.width,this.ac.height,this.ac.x,this.ac.y,
this.ac.width,this.ac.height);b.globalAlpha=h;b.globalCompositeOperation=f;if(a.xm){var p=this.gc.la;b.save();b.setTransform(1,0,0,1,0,0);b.beginPath();b.lineWidth=2;b.strokeStyle="#000000";b.moveTo(p[0].x,p[0].y);var r=d=1;for(e=p.length-1;d<=e;r=d+=1)b.lineTo(p[r].x,p[r].y);b.closePath();b.stroke();b.restore()}}catch(t){this.log("Error drawing image: %s",t.message),c=t}if(null===this.kd||c)b.save(),b.lineWidth=1,b.strokeStyle="#cccccc",b.strokeRect(0,0,this.width,this.height),b.restore()};a.prototype.Zg=
function(){return!0===this.ja("allowCrop")&&!0!==this.ja("lockEditMode")};a.prototype.ri=function(a,d){a.save();a.beginPath();a.lineWidth=1*d;a.strokeStyle="#0050B7";for(var b=this.Ha(),c=0;c<this.Qe.length;c++){var f=this.Qe[c],h=b.apply(f.x,f.y),l;if(f.Ld){var k=20;var m=l=0;var q=3;f=h.x-10;h=h.y-6}else k=0,l=20,m=3,q=0,f=h.x-6,h=h.y-10;for(var p=0;5>p;p++)a.moveTo(f,h),a.lineTo(f+k*d,h+l*d),f+=m*d,h+=q*d}a.stroke();a.restore()};a.prototype.Oi=function(a,d,e){var b=this.Ha();e*=10;for(var c=0;c<
this.Qe.length;c++){var h=this.Qe[c];h=b.apply(h.x,h.y);if(h.x-e<=a&&a<h.x+e&&h.y-e<=d&&d<h.y+e)return c}return null};a.prototype.Ci=function(a){a=this.Qe[a];return this.Ha().apply(a.x,a.y)};a.prototype.af=function(a,d,e){var b=this.Un();d=this.Id().apply(d,e);d.x=Math.round(d.x);d.y=Math.round(d.y);0===a&&0<=d.y&&d.y<this.Pc.height?(b.height-=d.y-b.y,b.y=d.y):1===a&&0<=d.x&&d.x<this.Pc.width?b.width=d.x-b.x:2===a&&0<=d.y&&d.y<this.Pc.height?b.height=d.y-b.y:3===a&&0<=d.x&&d.x<this.Pc.width&&(b.width-=
d.x-b.x,b.x=d.x);this.Yt(b)};a.prototype.rr=function(a,d){var b=a.width,c=a.height;if(!(a instanceof HTMLCanvasElement)){var f=document.createElement("canvas");f.width=b;f.height=c;f.getContext("2d").drawImage(a,0,0);a=f}f="number"===typeof d.brightness?d.brightness:-1;var h="number"===typeof d.contrast?d.contrast:-1,l="number"===typeof d.gamma?d.gamma:-1,k=document.createElement("canvas");this.log("filterSpec: %s",JSON.stringify(d));this.log("brightness=%s contrast=%s gamma=%s w=%s h=%s",f,h,l,b,
c);k.width=b+1;k.height=c;try{var m=a.getContext("2d").getImageData(0,0,b,c).data}catch(A){return this.log("Cannot filter external image."),null}b=k.getContext("2d").getImageData(0,0,b,c);c=b.data;for(var q=0;q<m.length;q+=4){var p=m[q]/255,r=m[q+1]/255,t=m[q+2]/255,v=m[q+3];0<=l&&(p=Math.pow(p,l),r=Math.pow(r,l),t=Math.pow(t,l));0<=f&&(p*=f,t*=f,r*=f);0<=h&&(p=p*h-.5*h+.5,r=r*h-.5*h+.5,t=t*h-.5*h+.5);c[q]=Math.min(255*p|0,255);c[q+1]=Math.min(255*r|0,255);c[q+2]=Math.min(255*t|0,255);c[q+3]=v}k.getContext("2d").putImageData(b,
0,0);return k};a.xm=!1;return a}(K);K.xd("ImageNode",jc);var kc=function(c){function a(b,d){var e=c.call(this,b,d)||this;e.ab=new $b;e.Wk=0;e.border={lineWidth:0,Ne:"#000000"};e.log=w.create("TEXT",!0);e.fk(a.Wp);e.aa.text="lorum ipsum dolor";return e}n(a,c);a.prototype.type=function(){return"TextNode"};a.prototype.setProperty=function(a,d){this.aa[a]=this.Mn(a,d);"textFillStyle"===a?this.aa.fillStyle=d:"fillStyle"===a&&(this.aa.textFillStyle=d)};a.prototype.format=function(a){this.ab.op(this.aa.fontName,this.aa.fontSize,this.aa.bold,this.aa.italic,this.aa.textDecoration);
var b=this.aa.text;b.length&&10===b.charCodeAt(b.length-1)&&(b=b.substr(0,b.length-1));this.ab.wh(b);var e=this.aa.matrix;b=e.apply(0,0);e=e.apply(1,0);b=b.Lb(e);e=this.ja("wrap");var c=!1!==this.ja("scaleFont");this.ab.Hl(this.aa.textAlign,"top");e?(e=this.aa.baseWidth,void 0===e&&(this.ab.format(a,0,0),e=Math.max(this.ab.rect.width,10),500<e&&(e=500),this.aa.baseWidth=e,this.log("Formatting text for first time; baseWidth=%s",e)),b=Math.ceil(b*e),this.ab.format(a,b,0),a=this.ab.rect.height,this.Ka=
new B(0,0,e,a)):c?(this.ab.format(a,0,0),b=this.ab.rect.width,a=this.ab.rect.height,this.Ka=new B(0,-(0+this.ja("fontSize")),b,a)):(this.ab.format(a,0,0),b=this.ab.rect.width,a=this.ab.rect.height,this.Ka=new B(0,0,b,a));a=new Sb(this.Ka);a.transform(this.Ha());this.rect=a.Aq();this.Wk=this.rect.height;this.rect.height+=.3*this.aa.fontSize;a=this.ja("lineWidth")+0;this.rect.pd(a,a);this.border=this.aa.border?this.st(this.aa.border):{lineWidth:0,Ne:"#000000"}};a.prototype.st=function(a){var b={lineWidth:0,
Ne:"#000000"};a=a.split(" ");for(var e=0;e<a.length;e++){var c=parseFloat(a[e]);if(isNaN(c)){if(c=u.xi(a[e]))b.Ne=c.toString()}else b.lineWidth=c}return b};a.prototype.Ha=function(){return!1===this.ja("scaleFont")?c.prototype.Ha.call(this).Cp():c.prototype.Ha.call(this)};a.prototype.ha=function(a){if(0!==this.aa.text.length){var b=.3*this.aa.fontSize;a.save();this.ph(a);"opacity"in this.aa&&(a.globalAlpha=this.aa.opacity);var e=this.aa.background;if(e||this.border.lineWidth)a.save(),this.Ha().Df(a),
e&&(a.fillStyle=e,a.fillRect(this.Ka.x,this.Ka.y,this.Ka.width,this.Ka.height+b)),this.border.lineWidth&&(a.beginPath(),a.strokeStyle=this.border.Ne,a.lineWidth=this.border.lineWidth,a.rect(this.Ka.x,this.Ka.y,this.Ka.width,this.Ka.height+b),a.stroke()),a.restore();this.ja("wrap")?this.Ha().Cp().Df(a):this.Ha().Df(a);a.strokeStyle=this.aa.strokeStyle;a.fillStyle=this.aa.fillStyle;a.lineWidth=this.aa.lineWidth;b=0;e=this.Ha().ec();e=this.Ka.height*e.y;if(this.aa.wrap||!1===this.ja("scaleFont"))switch(this.log("Available: %s rect: %s",
e,this.ab.rect),this.aa.verticalAlign){case "bottom":b+=e-this.ab.rect.height;break;case "middle":b+=(e-this.ab.rect.height)/2}else b=-(0+this.ja("fontSize"));this.aa.shadow&&(a.shadowOffsetX=3,a.shadowOffsetY=3,a.shadowBlur=5,a.shadowColor="rgba(0,0,0,0.5)");0<this.aa.lineWidth&&this.ab.strokeText(a,0,b);this.ab.fillText(a,0,b);this.ab.En(a,0,b);this.oh(a);a.restore();K.ym&&(a.save(),a.beginPath(),a.lineWidth=1,a.strokeStyle="#ff8000",a.rect(this.rect.x,this.rect.y,this.rect.width,this.rect.height),
a.stroke(),a.restore())}};a.Wp={textFillStyle:"#000000",fontName:"Arial",fontSize:20,lineWidth:0,fillStyle:"#000000",wrap:!1,textAlign:"left",bold:!1,italic:!1,background:"rgba(0,0,0,0.0)",textDecoration:""};return a}(K);K.xd("TextNode",kc);var lc=function(){function c(a,b){this.na=a;this.ga=b;this.ru=!0;this.log=w.create("MoveSegment")}c.prototype.ha=function(a){a.moveTo(this.ga.x,this.ga.y)};c.prototype.Xd=function(){return this.nc()};c.prototype.nc=function(){return{x:1,y:0}};return c}(),mc=function(){function c(a,b,d,e,c){this.na=a;this.ga=b;this.Ql=e;this.Td=c;this.log=w.create("LineSegment");this.uf=0;this.Da=new z(0,0);this.Ia=new z(0,0);this.length=0;this.from=new z(0,0);this.ga=b;this.na=a;this.Td=c;this.Ql=e;d.next();this.kj=
d.next();this.lj=d.next();this.moveTo=this.vf=null;this.format()}c.prototype.format=function(){var a=C(this.na.ga.x,this.na.ga.y,this.ga.x,this.ga.y);this.uf=this.length=a;var b=this.na.ga.clone();this.na instanceof c&&this.Td&&(this.Td=Math.min(this.Td,a/2,this.na.length/2),a=D(this.na.ga.x,this.na.ga.y,this.ga.x,this.ga.y),b.x+=a.x*this.Td,b.y+=a.y*this.Td,this.na.mu(this.Td),this.uf-=this.Td);this.from=b;null===this.vf&&(this.vf=this.ga);a=this.uf/10*this.Ql;10<a&&(a=10);var d=b.x,e=b.y,g=this.ga.x,
f=this.ga.y;d+=a;e+=a;this.Da=new z(d+this.kj*(g+a-d),e+this.kj*(f+a-e));d=b.x-a;g=this.ga.x-a;e=b.y-a;f=this.ga.y-a;this.Ia=new z(d+this.lj*(g-d),e+this.lj*(f-e))};c.prototype.mu=function(a){var b=D(this.from.x,this.from.y,this.ga.x,this.ga.y),d=this.ga.clone();d.x-=b.x*a;d.y-=b.y*a;this.vf=d;this.uf-=a;a=this.uf/10*this.Ql;10<a&&(a=10);b=this.from.x;var e=this.from.y,c=d.x,f=d.y;b+=a;e+=a;this.Da=new z(b+this.kj*(c+a-b),e+this.kj*(f+a-e));this.log("RECALC ctrl1=%s",this.Da);b=this.from.x-a;c=d.x-
a;e=this.from.y-a;f=d.y-a;this.Ia=new z(b+this.lj*(c-b),e+this.lj*(f-e))};c.prototype.vh=function(a){this.na=a;this.format();this.na instanceof c&&(this.moveTo=this.na.vf)};c.prototype.ha=function(a){null!==this.vf&&(this.Td&&(this.moveTo&&a.moveTo(this.moveTo.x,this.moveTo.y),a.quadraticCurveTo(this.na.ga.x,this.na.ga.y,this.from.x,this.from.y)),a.bezierCurveTo(this.Da.x,this.Da.y,this.Ia.x,this.Ia.y,this.vf.x,this.vf.y))};c.prototype.Xd=function(){return this.na?D(this.na.ga.x,this.na.ga.y,this.Da.x,
this.Da.y):this.nc()};c.prototype.nc=function(){return D(this.Ia.x,this.Ia.y,this.ga.x,this.ga.y)};return c}(),nc=function(){function c(a,b,d){this.Rl=d;this.ga=b;this.na=a;this.Rl=d;var e=C(a.ga.x,a.ga.y,b.x,b.y);e||(e=1);var c=(b.x-a.ga.x)/e,f=(b.y-a.ga.y)/e;this.Ia=new z(b.x-e*d*c,b.y-e*d*f);if((b=a.Ia)&&a.na){var h=D(a.na.ga.x,a.na.ga.y,a.ga.x,a.ga.y),l=C(a.na.ga.x,a.na.ga.y,a.ga.x,a.ga.y);c=.5*(c+h.x);f=.5*(f+h.y);b.x=a.ga.x-l*d*c;b.y=a.ga.y-l*d*f}this.Da=new z(a.ga.x+e*d*c,a.ga.y+e*d*f);this.length=
e}c.prototype.vh=function(a){this.na=a;var b=a.Ia,d=(this.ga.x-a.ga.x)/this.length,e=(this.ga.y-a.ga.y)/this.length,c=this.Rl;if(b&&a.na){var f=D(a.na.ga.x,a.na.ga.y,a.ga.x,a.ga.y),h=C(a.na.ga.x,a.na.ga.y,a.ga.x,a.ga.y);d=.5*(d+f.x);e=.5*(e+f.y);b.x=a.ga.x-h*c*d;b.y=a.ga.y-h*c*e}this.Da=new z(a.ga.x+this.length*c*d,a.ga.y+this.length*c*e)};c.prototype.ha=function(a){a.bezierCurveTo(this.Da.x,this.Da.y,this.Ia.x,this.Ia.y,this.ga.x,this.ga.y)};c.prototype.Xd=function(){return this.na?D(this.na.ga.x,
this.na.ga.y,this.Da.x,this.Da.y):{x:1,y:0}};c.prototype.nc=function(){return 0<this.Rl?D(this.Ia.x,this.Ia.y,this.ga.x,this.ga.y):D(this.na.ga.x,this.na.ga.y,this.ga.x,this.ga.y)};return c}(),oc=function(){function c(a,b,d){this.na=a;this.control=b;this.ga=d}c.prototype.ha=function(a){a.quadraticCurveTo(this.control.x,this.control.y,this.ga.x,this.ga.y)};c.prototype.Xd=function(){return this.na?D(this.na.ga.x,this.na.ga.y,this.control.x,this.control.y):{x:1,y:0}};c.prototype.nc=function(){return D(this.control.x,
this.control.y,this.ga.x,this.ga.y)};return c}(),pc=function(){function c(a,b,d,e){this.na=a;this.control=b;this.ga=d;this.Rd=e}c.prototype.ha=function(a){a.arcTo(this.control.x,this.control.y,this.ga.x,this.ga.y,this.Rd)};c.prototype.Xd=function(){return{x:1,y:0}};c.prototype.nc=function(){return D(0,0,1,0)};return c}(),qc=function(){function c(a,b,d,e,c,f,h){this.na=a;this.ed=b;this.ga=d;this.Rd=e;this.Ul=c;this.kr=f;this.Uq=h}c.prototype.ha=function(a){a.arc(this.ed.x,this.ed.y,this.Rd,this.Ul,
this.kr,0!==this.Uq)};c.prototype.Xd=function(){return{x:1,y:0}};c.prototype.nc=function(){return D(0,0,1,0)};return c}(),rc=function(){function c(a,b,d,e){this.Da=b;this.Ia=d;this.Da=b;this.Ia=d;this.ga=e;this.na=a}c.prototype.ha=function(a){a.bezierCurveTo(this.Da.x,this.Da.y,this.Ia.x,this.Ia.y,this.ga.x,this.ga.y)};c.prototype.Xd=function(){return this.na?D(this.na.ga.x,this.na.ga.y,this.Da.x,this.Da.y):{x:1,y:0}};c.prototype.nc=function(){return D(this.Ia.x,this.Ia.y,this.ga.x,this.ga.y)};return c}(),
sc=function(){function c(a,b,d,e){this.na=a;this.Da=b;this.Ia=d;this.ga=e}c.prototype.ha=function(a){if(this.na){var b=[];this.na.Ia&&b.push(this.na.Ia);this.Da&&b.push(this.Da);2===b.length?a.bezierCurveTo(b[0].x,b[0].y,b[1].x,b[1].y,this.ga.x,this.ga.y):1===b.length&&a.quadraticCurveTo(b[0].x,b[0].y,this.ga.x,this.ga.y)}};c.prototype.vh=function(a){this.na=a};c.prototype.Xd=function(){return this.na&&this.na.Ia?D(this.na.ga.x,this.na.ga.y,this.Da.x,this.Da.y):{x:1,y:0}};c.prototype.nc=function(){return this.Da?
D(this.Da.x,this.Da.y,this.ga.x,this.ga.y):{x:1,y:0}};return c}(),tc=function(){function c(a,b,d,e,c){this.na=a;this.Gg=b;this.ga=d;this.log=w.create("SEGMENT");this.na=a;this.Gg=b;c*=2;var g=2*e.next()-1;e.next();e=this.na.nc();if(!this.na.ru&&e){var h=C(a.ga.x,a.ga.y,b.x,b.y);this.Da=new z(a.ga.x+.5522847498*e.x*h,a.ga.y+.5522847498*e.y*h)}else this.Da=new z(a.ga.x+.5522847498*(b.x-a.ga.x),a.ga.y+.5522847498*(b.y-a.ga.y));this.Ia=new z(d.x-.5522847498*(d.x-b.x)*(1-g*c),d.y-.5522847498*(d.y-b.y)*
(1-g*c));this.ga=d}c.prototype.vh=function(a){this.na=a;var b=this.na.nc();if(b){var d=C(a.ga.x,a.ga.y,this.Gg.x,this.Gg.y);this.Da=new z(a.ga.x+.5522847498*b.x*d,a.ga.y+.5522847498*b.y*d)}else this.Da=new z(a.ga.x+.5522847498*(this.Gg.x-this.na.ga.x),a.ga.y+.5522847498*(this.Gg.y-this.na.ga.y))};c.prototype.ha=function(a){a.bezierCurveTo(this.Da.x,this.Da.y,this.Ia.x,this.Ia.y,this.ga.x,this.ga.y)};c.prototype.Xd=function(){return this.na?D(this.na.ga.x,this.na.ga.y,this.Da.x,this.Da.y):{x:1,y:0}};
c.prototype.nc=function(){return D(this.Ia.x,this.Ia.y,this.ga.x,this.ga.y)};return c}();var uc=function(){function c(a){this.fh=this.eh=0;if("string"===typeof a){for(;8>a.length;)a+=a;for(var b=16777619,d=0;d<a.length;d++)b=(16777619*b^a.charCodeAt(d))&4294967295;a=b}this.hp=a;this.reset()}c.prototype.reset=function(){this.fh=this.eh=this.hp};c.prototype.next=function(){this.fh=36969*(this.fh&65535)+(this.fh>>16);this.eh=18E3*(this.eh&65535)+(this.eh>>16);return((this.fh<<16)+this.eh)/4294967295/2+.5};return c}();var vc=function(){function c(a){this.tc=a;this.$h=[];this.Bl=!0;this.log=w.create("cloudAddon");this.Rd=a.ja("cloudRadius")}c.prototype.format=function(){var a=this.tc.Sc.ye();this.log("Format cloud; %s points",a.length);this.$h=this.Kq(a,this.Rd)};c.prototype.Kq=function(a,b){var d=[],e=5/6*b*2,c,f=a[a.length-1];for(c=0;c<a.length;c++){var h=a[c];var l=h.x-f.x,k=h.y-f.y,m=Math.sqrt(l*l+k*k);l/=m;k/=m;var q=m/e+.5|0;1>q&&(q=1);q=m/q;for(var p=0;p+.1*q<m;p+=q)d.push({x:f.x+p*l,y:f.y+p*k,nn:0,end:0});
f=h}h=d[d.length-1];for(c=0;c<d.length;c++)e=d[c],l=e.x-h.x,k=e.y-h.y,f=.5*Math.sqrt(l*l+k*k)/b,-1>f&&(f=-1),1<f&&(f=1),l=Math.atan2(k,l),f=Math.acos(f),f=[l-f,Math.PI+l+f],h.end=f[0],e.nn=f[1],h=e;return d};c.prototype.ha=function(a){this.log("Drawing cloud with %s circles",this.$h.length);var b=15*Math.PI/180,d=this.Rd;a.beginPath();for(var e=0;e<this.$h.length;e++){var c=this.$h[e];a.arc(c.x,c.y,d,c.nn,c.end+b)}a.stroke()};return c}();var wc=function(){function c(a){this.tc=a;this.Rd=0;this.Bl=!0;this.Mi=!1;this.path=new H;this.jj=new H;this.log=w.create("DoubleLineAddon")}c.prototype.format=function(){this.log("Formatting doubleline; thickness=%s",this.tc.ja("doubleLine"));var a=this.tc.hk(!1).cm(S.Mj),b=this.tc.Ir();if(0<b){var d=a.Bq();d>b&&(a=a.Dq(d-b))}a=a.ye();b=this.tc.ja("doubleLine");this.path=new H;this.jj=new H;d=this.tc.ja("doubleLineDashSide");this.Mi=!1;"outer"===d?(Vb(this.path,a,b,!0,!1),Vb(this.jj,a,b,!1,!0),this.Mi=
!0):"inner"===d?(Vb(this.path,a,b,!1,!0),Vb(this.jj,a,b,!0,!1),this.Mi=!0):Vb(this.path,a,b,!0,!0)};c.prototype.ha=function(a){a.beginPath();this.tc.bc.length&&this.Mi?(this.jj.pi(a,this.tc.bc),this.path.ha(a)):this.tc.bc.length?this.path.pi(a,this.tc.bc):this.path.ha(a)};return c}();var xc=function(){function c(a){this.la=a;this.n=0;this.kb=new z(0,0)}c.prototype.next=function(a){if(0===this.la.length)return null;if(0===this.n)return this.kb=this.la[0].clone(),this.n+=1,this.kb.clone();for(;this.n<this.la.length;){var b=this.kb.Lb(this.la[this.n]);if(0===b)this.n+=1;else if(b<=a)a-=b,this.n+=1;else return this.kb.x+=(this.la[this.n].x-this.kb.x)*a/b,this.kb.y+=(this.la[this.n].y-this.kb.y)*a/b,this.kb.clone()}return null};return c}(),yc=function(){function c(a){this.tc=a;this.Bl=
!0;this.la=[];this.log=w.create("WaveAddon");this.Rd=a.ja("waveRadius")}c.prototype.format=function(){var a=this.tc.hk(!1).cm(S.Mj).ye();this.log("Format cloud; %s points",a.length);this.la=this.Uu(a,this.Rd)};c.prototype.Uu=function(a,b){var d=new xc(a),e=1,c=[];if(2>a.length)return c;var f=0;for(var h=1;h<a.length;h++)f+=C(a[h-1].x,a[h-1].y,a[h].x,a[h].y);b=f/Math.round(f/(2*b)+.5)/2;for(f=[];;){h=d.next(2*b);if(!h)break;f.push(h)}f.push(a[a.length-1]);var l=f[0];c.push(l);for(d=1;d<f.length;d++){h=
f[d];var k=D(l.x,l.y,h.x,h.y);var m=b,q=new z(k.y*e,-1*k.x*e);l=new z(l.x+(k.x+q.x)*m,l.y+(k.y+q.y)*m);c.push(l);c.push(h);e*=-1;l=h}for(d=2;d<c.length-1;d+=2)e=c[d-1],f=c[d+1],c[d].x=e.x+(f.x-e.x)/2,c[d].y=e.y+(f.y-e.y)/2;return c};c.prototype.ha=function(a){a.beginPath();a.moveTo(this.la[0].x,this.la[0].y);for(var b=1;b<this.la.length-1;b+=2)a.quadraticCurveTo(this.la[b].x,this.la[b].y,this.la[b+1].x,this.la[b+1].y)};return c}();var S=function(c){function a(b,d){var e=c.call(this,b,d)||this;e.ra=[];e.Nf=0;e.ad=[];e.Sl=[];e.zp=!1;e.inverse=new F;e.origin=new z(0,0);e.bc=[];e.Sc=new H;e.eo=!1;e.backgroundImage=null;e.log=w.create("PATHNODE");e.log("New PathNode Created");e.Bb=new kc(0,d);e.Bb.setProperty("text",e.aa.text);e.fk(a.za);e.aa.closed=!1;e.aa.commands=[];e.aa.seed=0;return e}n(a,c);a.prototype.moveTo=function(b,d){var e=this.aa.commands;e.push(a.Gf);e.push(b);e.push(d)};a.prototype.yq=function(b,d,e,c,f,h){var g=
this.aa.commands;g.push(a.ug);g.push(f);g.push(h);g.push(b);g.push(d);g.push(e);g.push(c)};a.prototype.type=function(){return"PathNode"};a.prototype.$g=function(){return!0};a.prototype.setProperty=function(a,d){c.prototype.setProperty.call(this,a,d);switch(a){case "bold":case "fontName":case "fontSize":case "italic":case "text":case "textAlign":case "textDecoration":case "wrap":this.aa[a]=d;this.Bb.setProperty(a,d);break;case "textFillStyle":this.Bb.setProperty("fillStyle",d);this.aa[a]=d;break;case "textBackground":this.Bb.setProperty("background",
d);this.aa[a]=d;break;case "cloudRadius":case "waveRadius":case "doubleLine":case "doubleLineDashSide":case "spotHighlight":case "verticalAlign":this.aa[a]=d;break;case "backgroundImage":this.aa[a]=d,this.backgroundImage=null}};a.prototype.Ci=function(b){for(var d=0,e=this.aa.commands,c=b/3|0,f=0;f<c;f++)d+=a.Ta[e[d]]+1;f=b%3*2+1;c=e[d+f];d=e[d+f+1];this.log("getEditHandle(%s) = (%s, %s)",b,c,d);return this.Ha().apply(c,d)};a.prototype.af=function(b,d,e){for(var c=0,f=this.aa.commands,h=b/3|0,l=0;l<
h;l++)c+=a.Ta[f[c]]+1;h=this.inverse.apply(d,e);l=b%3*2+1;f[c+l]=h.x;f[c+l+1]=h.y;if(0===b&&this.aa.closed){for(b=null;c<f.length;)h=a.Ta[f[c]],2<=h&&(b=c),c+=h+1;b&&(c=b,h=this.inverse.apply(d,e),f[c+1]=h.x,f[c+2]=h.y)}};a.prototype.Hd=function(){return"commands"};a.prototype.Lt=function(b){for(var d=this.aa.commands,e=0,c=0;c<b/3;c++)e+=a.Ta[d[e]]+1;d.splice(e,a.Ta[d[e]]+1)};a.prototype.Ir=function(){return this.ja("arrowXOffset")||this.ja("arrowSize")};a.prototype.format=function(b,d){var e=this,
c=null;this.ra.length=0;this.inverse=this.aa.matrix.inverse();var f=new z(0,0),h=this.aa.commands,l=null,k=this.aa.matrix,m=new uc(this.aa.seed);this.Sl.length=0;for(var q=null,p=null,r=0;r<h.length;){switch(h[r++]){case a.Gf:f=k.apply(h[r++],h[r++]);p=new lc(l,f);this.ra.push(p);null===c&&(c=f);this.Sl.push(f);q=null;break;case a.be:l&&(f=k.apply(h[r++],h[r++]),this.ra.push(new mc(l,f,m,this.aa.sloppiness,this.aa.roundRadius)),this.Sl.push(f));break;case a.Hf:if(l){f=k.apply(h[r++],h[r++]);var t=
k.apply(h[r++],h[r++]);this.ra.push(new oc(l,t,f))}break;case a.Lj:if(l){f=k.apply(h[r++],h[r++]);t=k.apply(h[r++],h[r++]);var v=h[r++];this.ra.push(new pc(l,t,f,v))}break;case a.Kj:if(l){f=k.apply(h[r++],h[r++]);t=k.apply(h[r++],h[r++]);v=h[r++];var A=h[r++],I=h[r++],N=h[r++];this.ra.push(new qc(l,t,f,v,A,I,N))}break;case a.ug:l&&(f=k.apply(h[r++],h[r++]),v=k.apply(h[r++],h[r++]),t=k.apply(h[r++],h[r++]),this.ra.push(new rc(l,v,t,f)));break;case a.Hm:l&&(f=k.apply(h[r++],h[r++]),v=k.apply(h[r++],
h[r++]),t=k.apply(h[r++],h[r++]),this.ra.push(new sc(l,v,t,f)));break;case a.Ih:l&&(f=k.apply(h[r++],h[r++]),this.ra.push(new nc(l,f,this.aa.smoothness)));break;case a.Nj:l&&(f=k.apply(h[r++],h[r++]),v=k.apply(h[r++],h[r++]),this.ra.push(new tc(l,v,f,m,this.aa.sloppiness)));break;case a.hc:this.aa.closed=!0;q&&l&&q!==l&&q.vh&&p&&(q.vh(l),l.ga=p.ga);break;default:r++}l=this.ra[this.ra.length-1];null!==q||l instanceof lc||(q=l)}this.origin=c||new z(0,0);this.Nf=this.ra.length;this.Br(m);this.rect.x=
this.origin.x;this.rect.y=this.origin.y;this.rect.width=0;this.rect.height=0;c=this.aa.dashes.split(",");this.bc=[];for(r=0;r<c.length;r++)f=parseFloat(c[r]),isNaN(f)||this.bc.push(f);c=this.bc.length?a.Mj:a.Jp;this.Sc=this.hk(!0).cm(c);r=0+this.ja("shapeWidth");0<r&&(this.Sc=this.Sq(this.Sc,r));this.rect=this.Sc.qn(c);r=this.rect.width-2*(this.aa.lineWidth/2+1);f=this.aa.lineWidth;h=this.Sc.clone();h.transform(this.Id());this.Ka=h.qn(c);c=this.Ha().ec();this.Ka.pd(Math.ceil(f/c.x),Math.ceil(f/c.y));
this.rect.pd(f+1,f+1);8>this.rect.width&&(this.rect.x+=this.rect.width/2-4,this.rect.width=8);8>this.rect.height&&(this.rect.y+=this.rect.height/2-4,this.rect.height=8);if(""!==this.aa.text){c=this.rect.ed();this.Bb.setProperty("textAlign",this.aa.textAlign||"center");this.Bb.setProperty("baseWidth",r);this.Bb.format(b,d);r=c.x-this.Bb.rect.x-this.Bb.rect.width/2;f=0;switch(this.aa.verticalAlign){default:case "middle":f=c.y-this.Bb.rect.y-this.Bb.Wk/2;break;case "top":f=this.rect.y-this.Bb.rect.y;
break;case "bottom":f=this.rect.bottom()-this.Bb.Wk-this.Bb.rect.y}this.Bb.transform(new E(r,f));this.Bb.format(b,d)}this.zp=0===u.Fd(this.aa.fillStyle).values[3]&&!this.backgroundImage;this.ad.length=0;0<this.aa.cloudRadius?this.ad.push(new vc(this)):0<this.aa.waveRadius?this.ad.push(new yc(this)):this.aa.doubleLine&&this.ad.push(new wc(this));for(r=0;r<this.ad.length;r++)this.ad[r].format(b);(r=this.ja("backgroundImage"))&&null===this.backgroundImage&&d.add(this.id,"image",r,null,function(a){e.backgroundImage=
a;d.gg(e.id)})};a.prototype.Gi=function(){return this.Sc};a.prototype.Br=function(a){function b(b,d){b=b.clone();l&&(b.x+=d.x*f*.5,b.y+=d.y*f*.5);var g=b.x-d.x*f;var k=b.y-d.y*f;var m=g+d.y*c/2;var q=k-d.x*c/2;g+=-d.y*c/2;k+=d.x*c/2;e.ra.push(new lc(e.ra[e.ra.length-1],new z(g,k)));e.ra.push(new nc(e.ra[e.ra.length-1],b,h));e.ra.push(new nc(e.ra[e.ra.length-1],new z(m,q),h));"solid"===e.aa.arrowStyle&&e.ra.push(new mc(e.ra[e.ra.length-1],new z(g,k),a,e.aa.smoothness,0))}if(this.eo=0<this.aa.arrowSize&&
!this.aa.closed&&0<this.ra.length){var e=this,c=this.aa.arrowSize,f=this.aa.arrowXOffset,h=this.aa.smoothness,l=this.aa.doubleLine;null===f&&(f=c);var k=this.ra[this.ra.length-1];b(k.ga,k.nc());this.aa.doubleArrow&&b(this.ra[0].ga,Ib(this.ra[1].Xd()))}};a.prototype.close=function(){this.aa.commands.push(a.hc)};a.prototype.uq=function(){var a=this.ra[this.ra.length-1];8>=C(a.ga.x,a.ga.y,this.origin.x,this.origin.y)&&this.close()};a.prototype.Sq=function(a,d){this.log("ConvertToRects: width=%s",d);
for(var b=0,c=a.ba,f=0,h=0,l,k,m=new H;b<c.length;){this.log("cmd %s %s %s",c[b],c[b+1],c[b+2]);switch(c[b]){case H.jc:f=c[b+1];h=c[b+2];break;case H.ic:l=c[b+1];k=c[b+2];this.log("(%s,%s-%s,%s)",f,h,l,k);if(0<C(f,h,l,k)){var q=D(f,h,l,k),p=q.y*d/2;q=-q.x*d/2;m.moveTo(f+p,h+q);m.lineTo(l+p,k+q);m.lineTo(l-p,k-q);m.lineTo(f-p,h-q);m.closePath()}f=l;h=k}b+=H.kc[c[b]]}return m};a.prototype.clip=function(a){if(this.aa.closed){var b=new H;this.log("Clipping to a path");for(var e=0;e<this.ra.length;e++)this.ra[e].ha(b);
b.closePath();0>b.hn()&&(b=b.Ot());b.ha(a)}};a.prototype.ha=function(a){this.aa.spotHighlight?this.log("Not drawing node %s due to spothighlight",this.id):c.prototype.ha.call(this,a)};a.prototype.Ee=function(a){var b=this.inverse;a.save();a.lineJoin="round";a.transform(b.m11,b.m21,b.m12,b.m22,b.Fa,b.Ga);a.beginPath();a.lineCap="round";b=!0;var e;for(e=0;e<this.ad.length;e++)this.ad[e].Bl&&(b=!1);if(b)for(e=0;e<this.ra.length;e++)this.ra[e].ha(a);for(e=0;e<this.ad.length;e++)this.ad[e].ha(a);if(!b&&
0<this.aa.arrowSize)for(e=this.Nf;e<this.ra.length;e++)this.ra[e].ha(a);if(this.aa.closed){a.closePath();if(this.backgroundImage){a.fillStyle=a.createPattern(this.backgroundImage,"no-repeat")||"magenta";e=Math.max(this.rect.width/this.backgroundImage.naturalWidth,this.rect.height/this.backgroundImage.naturalHeight);var c=this.rect.width-this.backgroundImage.naturalWidth*e,f=this.rect.height-this.backgroundImage.naturalHeight*e;a.translate(this.rect.x+c/2,this.rect.y+f/2);a.scale(e,e);a.fill();a.scale(1/
e,1/e);a.translate(-this.rect.x-c/2,-this.rect.y-f/2)}else a.fill();a.shadowColor="rgba(0,0,0,0.0)"}b&&(this.bc.length&&0<this.aa.lineWidth?(a.beginPath(),this.Sc.pi(a,this.bc),a.lineCap="butt"):0<0+this.ja("shapeWidth")&&(a.beginPath(),this.Sc.ha(a)));0<this.aa.lineWidth&&a.stroke();if(this.aa.arrowSize&&"solid"===this.aa.arrowStyle){a.beginPath();for(e=this.Nf;e<this.ra.length;e++)this.ra[e].ha(a);a.fillStyle=this.aa.strokeStyle;a.fill()}""!==this.aa.text&&this.Bb.ha(a);a.restore()};a.prototype.qb=
function(a,d){if(this.hidden()||this.ja("locked"))return null;var b=12+this.aa.shapeWidth/2+this.aa.lineWidth/2;if(a>=this.rect.x-b&&a<this.rect.x+b+this.rect.width&&d>=this.rect.y-b&&d<this.rect.y+b+this.rect.height)if(this.aa.closed&&!this.zp){if(this.Sc.wt(a,d))return this}else if(this.Sc.To(a,d,b)||""!==this.aa.text&&this.Bb.qb(a,d))return this;return null};a.prototype.hk=function(a){var b=new H;if(0<this.aa.arrowSize&&!a)for(a=0;a<this.Nf;a++)this.ra[a].ha(b);else for(a=0;a<this.ra.length;a++)this.ra[a].ha(b);
this.aa.closed&&b.closePath();return b};a.prototype.lineTo=function(b,d){var e=this.aa.commands;e.push(a.be);e.push(b);e.push(d)};a.prototype.Ig=function(b,d){var e=this.aa.commands;e.push(a.Ih);e.push(b);e.push(d)};a.prototype.Zg=function(){return!1!==this.aa.editable&&!0!==this.aa.lockEditMode};a.prototype.Oi=function(a,d,e){e*=8;if(a>=this.origin.x-e&&a<this.origin.x+e&&d>=this.origin.y-e&&d<this.origin.y+e)return 0;for(var b=0;b<this.Nf;b++){var c=this.ra[b];if(a>=this.ra[b].ga.x-e&&a<this.ra[b].ga.x+
e&&d>=this.ra[b].ga.y-e&&d<this.ra[b].ga.y+e)return 3*b;if(c.control){if(a>=c.control.x-e&&a<c.control.x+e&&d>=c.control.y-e&&d<c.control.y+e)return 3*b+1}else if(c.Da){if(a>=c.Da.x-e&&a<c.Da.x+e&&d>=c.Da.y-e&&d<c.Da.y+e)return 3*b+1;if(c.Ia&&a>=c.Ia.x-e&&a<c.Ia.x+e&&d>=c.Ia.y-e&&d<c.Ia.y+e)return 3*b+2}}return null};a.prototype.Di=function(b){var d=this.aa.commands;b/=3;var e=0,c=!1,f=0,h;for(h=0;h<d.length;){var l=d[h];if(l===a.hc){c=!0;break}f+=1;h+=a.Ta[d[h]]+1}0===b&&c&&(b=f-1);for(h=0;h<d.length;e++){c=
null;switch(d[h]){case a.Gf:c="move_to";break;case a.be:c="line_to";break;case a.Hf:c="quadratic_to"}if(b===e)return c;h+=a.Ta[d[h]]+1}return null};a.Vp=function(b,d,e){d/=3;var c=0,f=[],h=new z(0,0),l=!1,k=0,m;for(m=0;m<b.length;){var q=b[m];if(q===a.hc){l=!0;break}k+=1;m+=a.Ta[b[m]]+1}0===d&&l&&(d=k-1);for(m=0;m<b.length;c++){q=b[m];l=!1;d===c&&(q===a.Hf&&"line_to"===e?(f.push(a.be,b[m+1],b[m+2]),l=!0):q===a.be&&"quadratic_to"===e&&(f.push(a.Hf,b[m+1],b[m+2],(h.x+b[m+1])/2,(h.y+b[m+2])/2),l=!0));
h=new z(b[m+1],b[m+2]);if(!l)for(q=0;q<1+a.Ta[b[m]];q++)f.push(b[m+q]);m+=a.Ta[b[m]]+1}return f};a.prototype.no=function(){return!0};a.prototype.ri=function(a,d,e){a.save();a.lineWidth=1*d;a.strokeStyle="#0050B7";a.fillStyle="#0050B7";d*=8;0===e?a.fillRect(this.origin.x-d,this.origin.y-d,2*d,2*d):a.strokeRect(this.origin.x-d,this.origin.y-d,2*d,2*d);for(var b=1;b<this.Nf;b++){var c=this.ra[b];a.beginPath();if(c.control)a.arc(c.control.x,c.control.y,d,0,2*Math.PI),a.arc(c.control.x,c.control.y,2*d,
0,2*Math.PI),e===3*b+1?a.fill():a.stroke();else if(c instanceof rc||c instanceof sc){var h=c.Da;var l=c.Ia;var k=c.na.ga;h&&(a.moveTo(k.x,k.y),a.lineTo(h.x,h.y),a.moveTo(h.x+d,h.y),a.arc(h.x,h.y,d,0,2*Math.PI),e===3*b+1?a.fill():a.stroke());a.beginPath();a.moveTo(c.ga.x,c.ga.y);a.lineTo(l.x,l.y);a.moveTo(l.x+d,l.y);a.arc(l.x,l.y,d,0,2*Math.PI);e===3*b+2?a.fill():a.stroke()}e===3*b?a.fillRect(this.ra[b].ga.x-d,this.ra[b].ga.y-d,2*d,2*d):a.strokeRect(this.ra[b].ga.x-d,this.ra[b].ga.y-d,2*d,2*d)}a.restore()};
a.Lp=function(a){var b=new T,e=0;for(a=a.ba;e<a.length;){switch(a[e]){case H.jc:b.moveTo(a[e+1],a[e+2]);break;case H.ic:b.lineTo(a[e+1],a[e+2]);break;case H.ae:b.bezierCurveTo(a[e+1],a[e+2],a[e+3],a[e+4],a[e+5],a[e+6]);break;case H.ce:b.quadraticCurveTo(a[e+1],a[e+2],a[e+3],a[e+4]);break;case H.hc:b.close()}e+=H.kc[a[e]]}return b.Tb()};a.za={strokeStyle:"#000000",fillStyle:"#ffffff",fontName:"Arial",fontSize:20,lineWidth:2,dashes:"",shapeWidth:0,smoothness:.3,sloppiness:0,shadow:!1,closed:!1,arrowSize:0,
arrowXOffset:null,arrowStyle:"simple",doubleArrow:!1,text:"",roundRadius:0,wrap:!1};a.Jp=8;a.Mj=2;a.Gf=0;a.be=1;a.Hf=2;a.Lj=3;a.ug=4;a.Ih=5;a.Nj=6;a.hc=7;a.Hm=8;a.Kj=9;a.fv=.5522847498;a.Ta=[];return a}(K);S.Ta[S.Gf]=2;S.Ta[S.be]=2;S.Ta[S.Hf]=4;S.Ta[S.Lj]=5;S.Ta[S.ug]=6;S.Ta[S.Ih]=2;S.Ta[S.Nj]=4;S.Ta[S.hc]=0;S.Ta[S.Hm]=6;S.Ta[S.Kj]=8;
var T=function(){function c(a){void 0===a&&(a=[]);this.ba=a}c.prototype.beginPath=function(){};c.prototype.Ke=function(a,b,d){for(var e=0,c=0;c<a;c++)e+=S.Ta[this.ba[e]]+1;this.ba[e+1]=b;this.ba[e+2]=d};c.prototype.moveTo=function(a,b){this.ba.push(S.Gf);this.ba.push(a);this.ba.push(b)};c.prototype.lineTo=function(a,b){this.ba.push(S.be);this.ba.push(a);this.ba.push(b)};c.prototype.Ig=function(a,b){this.ba.push(S.Ih);this.ba.push(a);this.ba.push(b)};c.prototype.quadraticCurveTo=function(a,b,d,e){this.ba.push(S.Hf);
this.ba.push(d);this.ba.push(e);this.ba.push(a);this.ba.push(b)};c.prototype.Pe=function(a,b,d,e){this.ba.push(S.Nj);this.ba.push(d);this.ba.push(e);this.ba.push(a);this.ba.push(b)};c.prototype.bezierCurveTo=function(a,b,d,e,c,f){this.ba.push(S.ug);this.ba.push(c);this.ba.push(f);this.ba.push(a);this.ba.push(b);this.ba.push(d);this.ba.push(e)};c.prototype.arc=function(a,b,d,e,c,f){void 0===f&&(f=!0);var g=(new Jb(-c,a,b)).apply(a+d,b);this.ba.push(S.Kj);this.ba.push(g.x);this.ba.push(g.y);this.ba.push(a);
this.ba.push(b);this.ba.push(d);this.ba.push(e);this.ba.push(c);this.ba.push(f?1:0)};c.prototype.arcTo=function(a,b,d,e,c){this.ba.push(S.Lj);this.ba.push(d);this.ba.push(e);this.ba.push(a);this.ba.push(b);this.ba.push(c)};c.prototype.Rn=function(){for(var a=[],b=0;b<this.ba.length;){for(var d=this.ba[b],e=0;e<S.Ta[d];e+=2)a.push(new z(this.ba[b+1+e],this.ba[b+1+e+1]));b+=S.Ta[d]+1}a=B.wg(a);return{x:a.x,y:a.y,width:a.width,height:a.height}};c.prototype.translate=function(a,b){for(var d=0;d<this.ba.length;){for(var e=
this.ba[d],c=0;c<S.Ta[e];c+=2)this.ba[d+1+c]+=a,this.ba[d+2+c]+=b;d+=S.Ta[e]+1}};c.prototype.closePath=function(){this.ba.push(S.hc)};c.prototype.close=function(){this.closePath()};c.prototype.Tb=function(){return this.ba};return c}();T.prototype.change=T.prototype.Ke;T.prototype.moveTo=T.prototype.moveTo;T.prototype.lineTo=T.prototype.lineTo;T.prototype.curveTo=T.prototype.Ig;T.prototype.quadraticCurveTo=T.prototype.quadraticCurveTo;T.prototype.cornerTo=T.prototype.Pe;T.prototype.bezierCurveTo=T.prototype.bezierCurveTo;
T.prototype.arc=T.prototype.arc;T.prototype.arcTo=T.prototype.arcTo;T.prototype.getBoundingBox=T.prototype.Rn;T.prototype.translate=T.prototype.translate;T.prototype.closePath=T.prototype.closePath;T.prototype.close=T.prototype.close;T.prototype.toArray=T.prototype.Tb;K.xd("PathNode",S);T.prototype.beginPath=T.prototype.beginPath;T.prototype.change=T.prototype.Ke;T.prototype.moveTo=T.prototype.moveTo;T.prototype.lineTo=T.prototype.lineTo;T.prototype.curveTo=T.prototype.Ig;
T.prototype.quadraticTo=T.prototype.uv;T.prototype.cornerTo=T.prototype.Pe;T.prototype.bezierTo=T.prototype.yq;T.prototype.arc=T.prototype.arc;T.prototype.arcTo=T.prototype.arcTo;T.prototype.getBoundingBox=T.prototype.Rn;T.prototype.translate=T.prototype.translate;T.prototype.closePath=T.prototype.closePath;T.prototype.close=T.prototype.close;T.prototype.toArray=T.prototype.Tb;var Ac=function(){function c(){this.items=[];this.next=0;this.he=!1;this.log=w.create("UNDOSTACK")}c.prototype.qa=function(a,b,d){void 0===b&&(b=!1);a=a instanceof zc?[a]:a;if(0!==a.length){this.next<this.items.length&&(this.items.length=this.next);if(!b)for(b=0;b<a.length;b++)a[b].tb(d);for(d=this.top();d;)if(d[d.length-1].Co(a[0])){if(a.shift(),0===a.length)break}else break;a.length&&this.items.push(a);this.he=!0;this.next=this.items.length}};c.prototype.gb=function(a){this.log("Undo index %s of %s",
this.next,this.items.length);if(this.Ad()){for(var b=this.items[--this.next],d=b.length-1;0<=d;d--)b[d].gb(a);return this.he=!0}return!1};c.prototype.Sd=function(a){this.log("Redo index %s of %s",this.next,this.items.length);if(this.zd()){for(var b=this.items[this.next++],d=0;d<b.length;d++)b[d].tb(a);return this.he=!0}return!1};c.prototype.Ad=function(){return 0<this.next};c.prototype.zd=function(){return this.next<this.items.length};c.prototype.clear=function(){this.next=this.items.length=0;this.he=
!1};c.prototype.top=function(){return this.items.length?this.items[this.items.length-1]:null};return c}(),zc=function(){function c(){}c.prototype.tb=function(){};c.prototype.gb=function(){};c.prototype.Co=function(){return!1};return c}();var Bc=function(c){function a(a,d){var b=c.call(this,a,d)||this;b.Vh="UnknownNode";b.width=100;b.height=20;b.ab=new $b;b.log=w.create("UNKNOWN",!0);b.ab.Hl("center","middle");return b}n(a,c);a.prototype.ju=function(a){this.Vh=a;this.ab.wh(a);this.log("Creating placeholder for node type %s",a)};a.prototype.type=function(){return this.Vh};a.prototype.setProperty=function(a,d){this.aa[a]=d};a.prototype.format=function(a){this.log("Formatting placeholder for %s",this.Vh);this.rect=new B(0,0,this.width,
this.height);this.rect.transform(this.aa.matrix);this.ab.format(a,this.width,this.height)};a.prototype.Ee=function(a){this.log("Drawing placeholder for for %s",this.Vh);a.save();a.lineWidth=1;a.fillStyle="#888888";a.fillRect(0,0,this.width,this.height);a.fillStyle="#000000";this.ab.ha(a,0,0);a.restore()};a.xm=!1;return a}(K);K.xd("UnknownNode",Bc);var Cc=function(c){function a(){var a=null!==c&&c.apply(this,arguments)||this;a.Ub="Action";a.log=w.create("ACTION");return a}n(a,c);a.prototype.tb=function(){};a.prototype.toString=function(){return""+this.Ub+"()"};return a}(zc),Dc=w.create("ACTION");function Ec(c,a,b){var d=K.create(c,a,b);d||(c in Q.qk?(d=new gc(a,b),d.setProperty("nodeType",c)):(Dc("Bad node type: %s",c),a=K.create("UnknownNode",a,b),a.ju(c),d=a));return d}
var U=function(c){function a(a,d,e,g,f){void 0===g&&(g=null);void 0===f&&(f=-1);var b=c.call(this)||this;b.id=a;b.type=d;b.aa=e;b.hj=g;b.index=f;b.node=null;b.Ub="CreateAction";return b}n(a,c);a.prototype.tb=function(a){var b=Ec(this.type,this.id,a);b.Ib(this.aa);null===this.hj&&(this.hj=a.Wg().id,this.index=-1);var e=a.xa(this.hj,!1);e instanceof ic&&(a.nb(e,b,this.index),this.log("Add %s id %s to parent %s index %s",b.type(),this.id,e.type(),this.index),this.node=b)};a.prototype.toString=function(){return""+
this.Ub+"("+this.type+":"+this.id+", "+JSON.stringify(this.aa)+", parent="+this.hj+", index="+this.index+")"};a.prototype.gb=function(a){this.node&&a.removeNode(this.node)};return a}(Cc),Fc=function(c){function a(a){var b=c.call(this)||this;b.Pa=a;b.pe=[];b.Ub="DeleteAction";return b}n(a,c);a.prototype.tb=function(a){var b;this.pe.length=0;var e=this.Pa;var c=0;for(b=e.length;c<b;c++){var f=e[c];(f=a.xa(f,!1))&&this.pe.push({node:f,parent:f.parent,index:a.removeNode(f)})}};a.prototype.gb=function(a){for(var b,
e=this.pe.length-1;0<=e;--e)b=this.pe[e],b.node&&b.parent&&a.nb(b.parent,b.node,b.index)};return a}(Cc),Gc=function(c){function a(a,d,e){var b=c.call(this)||this;b.Pa=a;b.name=d;b.value=e;b.Od=[];b.Ub="SetAction";return b}n(a,c);a.prototype.tb=function(a){var b;this.Od.length=0;var e=this.Pa;var c=0;for(b=e.length;c<b;c++){var f=e[c];if(f=a.xa(f,!0))this.Od.push(f.ja(this.name)),a.Vc(f,this.name,this.value)}};a.prototype.gb=function(a){var b,e,c;if(0!==this.Pa.length){var f=e=0;for(c=this.Pa.length-
1;0<=c?e<=c:e>=c;f=0<=c?++e:--e)(b=a.xa(this.Pa[f],!0))&&a.Vc(b,this.name,this.Od[f])}};a.prototype.Co=function(b){if(!(b instanceof a)||this.name!==b.name)return!1;switch(this.name){case "arrowSize":case "arrowStyle":case "arrowXOffset":case "background":case "bold":case "border":case "cloudRadius":case "dashes":case "doubleArrow":case "fillStyle":case "fontName":case "fontSize":case "italic":case "lineWidth":case "opacity":case "roudRadius":case "strokeStyle":case "textDecoration":break;default:return!1}this.Pa.sort();
b.Pa.sort();if(this.Pa.length!==b.Pa.length)return!1;for(var d=0;d<this.Pa.length;d++)if(this.Pa[d]!==b.Pa[d])return!1;this.log("Merging property change %s",this.name);this.value=b.value;return!0};return a}(Cc),Hc=function(c){function a(a,d){var b=c.call(this)||this;b.Pa=a;b.pa=d;b.Ub="TransformAction";b.inverse=d.inverse();return b}n(a,c);a.prototype.tb=function(a){for(var b=a.Qk(this.Pa,!0,!0),e=0;e<b.length;e++){var c=b[e],f=c.Ha();c.transform(this.pa);a.Xb.Ib(c.id,{matrix:c.Ha()},{matrix:f})}};
a.prototype.gb=function(a){for(var b=a.Qk(this.Pa,!0,!0),e=0;e<b.length;e++){var c=b[e],f=c.Ha();c.transform(this.inverse);a.Xb.Ib(c.id,{matrix:c.Ha()},{matrix:f})}};return a}(Cc),Ic=function(c){function a(a,d,e,g,f,h){var b=c.call(this)||this;b.id=a;b.handle=d;b.et=e;b.ft=g;b.x=f;b.y=h;b.Ub="MoveEditHandleAction";return b}n(a,c);a.prototype.tb=function(a){var b;if(b=a.xa(this.id,!0)){var e={};e[b.Hd()]=b.ja(b.Hd());b.af(this.handle,this.x,this.y);var c={};c[b.Hd()]=b.ja(b.Hd());a.Xb.Ib(b.id,c,e)}};
a.prototype.gb=function(a){var b;if(b=a.xa(this.id,!0)){var e={};e[b.Hd()]=b.ja(b.Hd());b.af(this.handle,this.et,this.ft);var c={};c[b.Hd()]=b.ja(b.Hd());a.Xb.Ib(b.id,c,e)}};return a}(Cc),Jc=function(c){function a(a,d){var b=c.call(this)||this;b.id=a;b.Pa=d;b.pe=[];b.node=null;b.Ub="GroupAction";return b}n(a,c);a.prototype.tb=function(a){var b;this.pe.length=0;var e=this.Pa;var c=0;for(b=e.length;c<b;c++){var f=e[c];(f=a.xa(f))&&this.pe.push({node:f,parent:f.parent,index:f.parent.Hk(f)})}this.node=
a.Hg(this.id,this.Pa)};a.prototype.gb=function(a){var b,e;if(0!==this.Pa.length&&this.node){for(b=e=this.Pa.length-1;0<=e&&!(0>b);b=e+=-1)b=this.pe[b],b.parent&&b.node&&a.nb(b.parent,b.node,b.index);a.removeNode(this.node)}};a.prototype.toString=function(){return"GroupAction("+JSON.stringify(this.Pa)+")"};return a}(Cc),Kc=function(c){function a(a){var b=c.call(this)||this;b.Pa=a;b.Kd=[];b.Ub="UngroupAction";return b}n(a,c);a.prototype.tb=function(a){var b,e,c={};var f=this.Pa;var h=0;for(b=f.length;h<
b;h++){var l=f[h];l=a.xa(l);if(l instanceof ic){var k=l;if(!(k.id in c)){c[k.id]=!0;var m={node:k,parent:k.parent,children:k.children.concat(),index:0};var q=m.children;var p=0;for(e=q.length;p<e;p++)l=q[p],a.nb(k.parent,l,-1);m.index=a.removeNode(k);this.Kd.push(m)}}}};a.prototype.gb=function(a){var b,e,c,f;if(0!==this.Kd.length){for(b=c=this.Kd.length-1;0<=c&&!(0>b);b=c+=-1)if(b=this.Kd[b],0!==b.children.length)for(a.nb(b.parent,b.node,b.index),e=f=b.children.length-1;0<=f&&!(0>e);e=f+=-1)a.nb(b.node,
b.children[e],-1);a.vi=!0}};return a}(Cc);function Lc(c,a){var b;if(c.po()){var d=c.children;var e=0;for(b=d.length;e<b;e++){var g=d[e];Lc(g,a)}}else c.transform(a)}
var Mc=function(c){function a(a,d,e){var b=c.call(this)||this;b.Pa=a;b.offsetX=d;b.offsetY=e;b.ua=[];b.Ub="DuplicateAction";return b}n(a,c);a.prototype.tb=function(a){var b;var e=new E(this.offsetX,this.offsetY);this.ua.length=0;var c=function(){return a.Wa()};var f=this.Pa;var h=0;for(b=f.length;h<b;h++){var l=f[h];if(l=a.xa(l))l=l.clone(c),e.al()||Lc(l,e),a.Wh(l),this.ua.push(l)}};a.prototype.gb=function(a){var b,e;if(0!==this.ua.length)for(b=e=this.ua.length-1;0<=e&&!(0>b);b=e+=-1)a.removeNode(this.ua[b])};
return a}(Cc),Nc=function(c){function a(a,d,e){var b=c.call(this)||this;b.Pa=a;b.type=d;b.Do=e;b.ua=[];b.ll=[];b.Ub="ChangeOrderAction";return b}n(a,c);a.prototype.tb=function(b){var d,e;this.ll.length=0;this.ua.length=0;var c=this.Pa;var f=0;for(e=c.length;f<e;f++){var h=c[f];if(h=b.xa(h))if(d=h.parent){var l=h.Ze();this.ll.push(l);this.ua.push(h);switch(this.type){case a.um:b.nb(d,h,-1);break;case a.Pj:b.nb(d,h,0);break;case a.Cm:0<l?b.nb(d,h,l-1):b.nb(d,h,l);break;case a.Dm:l<d.children.length?
b.nb(d,h,l+1):b.nb(d,h,l);break;case a.Gm:void 0===this.Do?b.nb(d,h,-1):b.nb(d,h,this.Do)}}}};a.prototype.gb=function(a){var b,e,c;if(0!==this.Pa.length)for(b=c=this.Pa.length-1;0<=c&&!(0>b);b=c+=-1){var f=this.ua[b];(e=f.parent)&&f&&a.nb(e,f,this.ll[b])}};a.um=0;a.Pj=1;a.Dm=2;a.Cm=3;a.Gm=4;return a}(Cc),Oc=function(c){function a(a,d,e){var b=c.call(this)||this;b.id=a;b.yu=d;b.xu=e;b.Ub="MoveNodeAction";b.Ho=0;b.cf=0;return b}n(a,c);a.prototype.tb=function(a){var b=a.xa(this.id),e=a.xa(this.yu);if(e&&
!(e instanceof ic)&&b)throw console.log("FATAL: Parent node: "+e.id+":"+e.type()+" child "+b.id+":"+b.type()),Error("Tried to move to a non-group node!");b&&b.parent&&e&&(this.Ho=b.parent.id,this.cf=b.Ze(),a.nb(e,b,this.xu))};a.prototype.gb=function(a){var b=a.xa(this.id),e=a.xa(this.Ho);b&&b.parent&&e&&a.nb(e,b,this.cf)};return a}(Cc),Pc=function(c){function a(a){var b=c.call(this)||this;b.aa=a;b.Od={};b.Ub="SetDocumentPropertiesAction";return b}n(a,c);a.prototype.tb=function(a){var b;this.Od={};
for(b in this.aa)this.aa.hasOwnProperty(b)&&(this.Od[b]=a.ja(b),a.setProperty(b,this.aa[b]))};a.prototype.gb=function(a){for(var b in this.Od)this.Od.hasOwnProperty(b)&&a.setProperty(b,this.Od[b])};return a}(Cc),Qc=function(c){function a(a){var b=c.call(this)||this;b.qt=a;b.Go=0;b.Ub="SetPageAction";return b}n(a,c);a.prototype.tb=function(a){this.Go=a.Ra;a.Sb(this.qt)};a.prototype.gb=function(a){a.Sb(this.Go)};return a}(Cc);function Rc(c){c=c.replace(/\+/g," ");return decodeURIComponent(c)};var Sc=function(){function c(){this.ih=!1;this.bb={};this.jd=[];this.log=w.create("EventEmitter");this.Ck={}}c.prototype.ma=function(a){for(var b=this,d=1;d<arguments.length;d++);this.jd.push(Array.prototype.slice.apply(arguments));1===this.jd.length&&setTimeout(function(){for(var a=0;a<b.jd.length;a++)b.vk.apply(b,b.jd[a]);b.jd.length=0},0)};c.prototype.Re=function(a){for(var b=1;b<arguments.length;b++);this.jd.push(Array.prototype.slice.apply(arguments));if(1===this.jd.length){for(b=0;b<this.jd.length;b++)this.vk.apply(this,
this.jd[b]);this.jd.length=0}};c.prototype.Ng=function(a){for(var b=this,d=1;d<arguments.length;d++);var e=Array.prototype.slice.apply(arguments),c=e[0];this.Ck[c]||(this.Ck[c]=!0,setTimeout(function(){b.Ck[c]=!1;b.vk.apply(b,e)},0))};c.prototype.vk=function(a){for(var b=[],d=1;d<arguments.length;d++)b[d-1]=arguments[d];if(a in this.bb){d=this.bb[a];this.ih||this.log("Emit %s",a);for(var e=0;e<d.length;e++)d[e].apply(null,b)}};c.prototype.sa=function(a,b){this.bb||(this.bb={});for(var d=0,e=a.split(" ");d<
e.length;d++)this.bind(e[d],b)};c.prototype.once=function(a,b){function d(){e.Ap(a,d);b.apply(null,arguments)}var e=this;e.bind(a,d)};c.prototype.bind=function(a,b){a in this.bb?this.bb[a].push(b):this.bb[a]=[b];return b};c.prototype.removeListener=function(a,b){return this.Ap(a,b)};c.prototype.Ap=function(a,b){var d,e;if(a in this.bb){var c=this.bb[a];var f=d=0;for(e=c.length-1;d<=e;f=d+=1)if(c[f]===b){c.splice(f,1);break}0===c.length&&delete this.bb[a]}};c.prototype.Dg=function(){this.bb={}};return c}();var Tc=function(){var c;if(document.currentScript&&(c=document.currentScript.getAttribute("src")))return c;if(!document.getElementsByTagName)return"";c=document.getElementsByTagName("script");if(0===c.length)return"";c=c[c.length-1];return void 0!==c.getAttribute.length?c.src:c.getAttribute("src")||""}(),Uc={autoGroup:!1,adaptiveBrushWidth:!1,adaptiveLineWidth:!1,angleArcs:0,allowSelectBox:"auto",allowResize:!0,allowTextInShape:!0,allowPointerEvents:!0,allowSystemClipboard:!1,allowZoom:!0,autoPickTool:!0,
autoPickToolText:!0,autoSnap:0,background:"clear",backgroundImage:null,collaborationServer:"wss://zwibbler.com/socket/{name}",clickToDrawShapes:!1,colourPicker:"wheel",debug:!1,defaultArrowStyle:"simple",defaultArrowSize:15,defaultArrowXOffset:null,defaultItalic:!1,defaultBold:!1,defaultBrushColour:"#000000",defaultBrushWidth:10,defaultFillStyle:"#e0e0e0",defaultFont:"Arial",defaultFontSize:20,defaultLineWidth:2,defaultPaperSize:"none",defaultRoundRectRadius:10,defaultSmoothness:"smooth",defaultStrokeStyle:"#000000",
defaultText:"Lorum ipsum dolor",defaultTextBackground:"rgba(0,0,0,0.0)",defaultTextAlign:"left",defaultTextDecoration:"none",defaultTextFillStyle:"#000000",defaultTextStrokeStyle:"#000000",defaultTextLineWidth:0,defaultZoom:1,drawShapeStyle:"box",fonts:["Arial","Times New Roman"],gridBlocks:10,gridColour:"#cccccc",gridSpacing:20,imageFolder:"$SCRIPT",iPadNoScrollText:!1,keyBringToFront:"Home",keyCancel:"ESC",keyCopy:"Ctrl+C,\u2318+C",keyCurveTool:"C",keyCut:"Ctrl+X,\u2318+X,Shift+Delete",keyDelete:"Delete,Backspace",
keyDown:"Down,Ctrl+Down",keyDuplicate:"Ctrl+D",keyEnter:"Enter",keyGroup:"Ctrl+G",keyLeft:"Left,Ctrl+Left",keyLineTool:"L",keyMoveDown:"PageDown",keyMoveUp:"PageUp",keyNext:"Down,Right",keyNextPage:"Shift+PageDown",keyPaste:"Ctrl+V,\u2318+V,Shift+Insert",keyPrevious:"Left,Up",keyPreviousPage:"Shift+Pageup",keyRedo:"Ctrl+Shift+Z",keyRight:"Right,Ctrl+Right",keySelectNone:"ESC",keySelectAll:"Ctrl+A",keySendToBack:"End",keyUndo:"Ctrl+Z",keyUngroup:"Ctrl+Shift+G",keyUp:"Up,Ctrl+Up",keyZoomIn:"+,Shift+=",
keyZoomNormal:"=",keyZoomOut:"-",keyZoomToPage:"F4",keyZoomToWidth:"Shift+F4",language:"en",latency:0,leaveTextToolOnBlur:!1,maximumZoom:0,minimumZoom:0,multilineText:!1,nudge:10,outsidePageColour:"#808080",pageBorderColour:"rbga(0,0,0,0.0)",pageInflation:20,pagePlacement:"centre",pageSelectorDiv:"",pageShadow:!0,pageView:!1,pasteOffset:10,pasteOffsetX:0,pasteOffsetY:0,persistent:!1,pixelsPerUnit:1,preciseNudge:1,readOnly:!1,scrollbars:!0,setFocus:!0,showArrowTool:!0,showBackgroundSelector:!1,showBrushTool:!0,
showCircleTool:!0,showColourPanel:!0,showCopyPaste:!0,showCurveTool:!0,showDebug:!1,showFontNameProperty:!0,showFontSizeProperty:!0,showHints:!0,showImageSelector:!1,showImageTool:!1,showKeyboardHelp:!0,showLineTool:!0,showMathTool:!1,showMoveToFrontBack:!1,showPageSelector:!1,showPageSelectorControls:!0,showPickTool:!0,showPropertyPanel:!1,showRoundRectTool:!1,showRuler:!1,showShapeBrushTool:!1,showSloppinessProperty:!0,showSmoothnessProperty:!0,showSquareTool:!0,showTextTool:!0,showToolbar:!0,showUndoRedo:!0,
simulateGestures:!1,singleStrokeBrush:!1,sloppy:!1,snap:0,spotHighlightColour:"rgba(0,0,0,0.2)",spotHighlightZIndex:1,symmetry:0,textMode:"interactive",toolbarButtonSize:50,useTouch:"auto",units:"",colourPalette:"auto",drawCircleStyle:"box",enableArrowKeysNudge:!1,showMenu:!1},Vc={},Wc;for(Wc in Uc)Vc[Wc.toLowerCase()]=Wc;
var Xc=function(c){function a(a,d){var b=c.call(this)||this;b.options=JSON.parse(JSON.stringify(Uc));b.Dc="";b.log=w.create("CONFIG");for(var g in d)g.toLowerCase()in Vc||alert("Zwibbler: Unknown option '"+g+"'"),b.set(g,d[g],!0);a.addEventListener(window,"hashchange",function(){b.log("Reload parameters from url hash");b.wo()});a.add(function(){b.bb={}});b.wo();""===b.Dc&&b.set("imageFolder",b.options.imageFolder);"auto"===b.options.useTouch&&b.log("Detected touch support: %s","ontouchstart"in window||
"onmsgesturechange"in window);b.log("Detect clipboard support: %s",b.$k());for(var f in b.options)b.log("%s=%s",f,b.options[f]);return b}n(a,c);a.prototype.wo=function(){if(void 0===a)var a=window.location.hash;0===a.indexOf("#/")&&(a="#"+a.substr(2));var d=a,c;a={};var g=d.indexOf("#");0<=g&&(d=d.substr(g+1));g=d.indexOf("#");0<=g&&(d=d.substr(0,g));d=d.split("&");g=0;for(c=d.length;g<c;g++){var f=d[g];var h=f.split("=");f=Rc(h[0]);h=1<h.length?Rc(h[1]):"";f.length&&(a[f]=h)}for(var l in a)this.set(l,
a[l])};a.Pp=function(a){return a.toLowerCase()in Vc};a.prototype.set=function(a,d,c){void 0===c&&(c=!1);a.toLowerCase()in Vc&&(a=Vc[a.toLowerCase()]);"debug"===a&&(a="showDebug");if(!(a in this.options))return this.log("Error: %s is not a configuration option.",a),!1;if("defaultZoom"===a){if("page"!==d&&"width"!==d&&!J(d)&&(d=parseFloat(d),isNaN(d)))return this.log("Error: Config option %s must be a number or 'page' or 'width'",a),!1}else if("allowSelectBox"!==a)if("imageFolder"===a){var b=this.rs();
""===b?(this.Dc=d.replace("$SCRIPT/",""),this.Dc=this.Dc.replace("$SCRIPT","")):this.Dc=d.replace("$SCRIPT/","$SCRIPT").replace("$SCRIPT",b);""!==this.Dc&&"/"!==this.Dc[this.Dc.length-1]&&(this.Dc+="/");this.log("scriptPath=%s imageFolder=%s, result:%s",b,this.options.imageFolder,this.Dc)}else if("string"===typeof d)if("number"===typeof this.options[a]){if(d=parseFloat(d),isNaN(d))return this.log("Error: Config option %s expects a number",a),!1}else if("boolean"===typeof this.options[a]||"useTouch"===
a&&"auto"!==d)d="1"===d||"true"===d||""===d;this.log("Set config %s=%s",a,d);this.options[a]=d;c||(this.Re("update",a,d),this.Re(a,d,!1));return!0};a.prototype.sa=function(a,d){if("update"!==a&&!(a in this.options))throw Error(a+" is not a valid config setting.");d(this.options[a],!0);return c.prototype.sa.call(this,a,d)};a.prototype.rs=function(){var a=Tc;var d=a.lastIndexOf("/");return a=0<=d?a.substr(0,d+1):""};a.prototype.vv=function(){return this.options.showBrushTool};a.prototype.yv=function(){return this.options.showPropertyPanel};
a.prototype.wv=function(){return this.options.showColourPanel};a.prototype.xv=function(){return this.options.showDebug};a.prototype.zv=function(){return this.options.showToolbar};a.prototype.Oa=function(a){if(!(a in this.options))throw Error(a+" is not a valid config setting.");return this.options[a]};a.prototype.get=function(a){switch(a){case "useTouch":return this.sg();default:return this.Oa(a)}};a.prototype.sg=function(){return"auto"===this.options.useTouch?"ontouchstart"in window||"onmsgesturechange"in
window:this.options.useTouch};a.prototype.Hr=function(){if("auto"===this.options.allowSelectBox){var a=this.sg(),d=document.documentElement.offsetHeight,c=window.innerHeight,g=!a||a&&0<c-d+50;this.log("Allowing select box: %s (useTouch=%s, documentHeight=%s, windowHeight=%s)",g,a,d,c);return g}return this.options.allowSelectBox};a.prototype.Qr=function(){var a=(""+this.options.defaultSmoothness).toLowerCase();return"sharpest"===a?0:"sharper"===a?.1:"sharp"===a?.2:"smoothest"===a?.5:.3};a.prototype.Pk=
function(a){return 0===a.indexOf("http:")||0===a.indexOf("https:")||0===a.indexOf("/")?a:this.Dc+a};a.prototype.Vg=function(a){return qb(this.get(a))};a.prototype.sq=function(a){function b(a){for(var b="",d=0;d<a.length;d++){var c=a.charAt(d);b=c===c.toUpperCase()?b+("-"+c.toLowerCase()):b+c}return b}var c=this,g={keyCut:1,keyCopy:1,keyPaste:1},f;for(f in this.options)this.options.hasOwnProperty(f)&&(0!==f.indexOf("key")||g[f]||a.map(this.options[f],b(f).substr(4)));this.sa("allowSystemClipboard",
function(){var b=!c.$k();b?c.log("Not using system clipboard. Mapping cut/copy/paste keys"):c.log("Using system clipboard. Ignore keyCut/keyCopy/keyPaste.");a.map(c.options.keyCut,"cut",b);a.map(c.options.keyCopy,"copy",b);a.map(c.options.keyPaste,"paste",b)})};a.prototype.Wn=function(){return"radial"===this.get("drawCircleStyle")||"radial"===this.get("drawShapeStyle")?"circle":"rectangle"};a.prototype.Dl=function(a){var b=a;0<this.options.maximumZoom&&(a=Math.min(a,this.options.maximumZoom));0<this.options.minimumZoom&&
(a=Math.max(a,this.options.minimumZoom));a!==b&&this.log("Zoom restricted to %s",a);return a};a.prototype.$k=function(){var a=document;return this.get("allowSystemClipboard")&&void 0!==a.oncopy&&void 0!==a.oncut&&void 0!==a.onpaste};return a}(Sc);var Yc=function(){function c(a,b){this.name=b;this.ta=y("div").Wc({borderTop:"1px solid #888",padding:"5px",cursor:"default"}).yd(a);this.update(0)}c.prototype.update=function(a){this.ta.Aa.innerText=this.name+"... "+Math.round(100*a)+"%"};c.prototype.error=function(a){var b=this,d=document.createElement("input");d.setAttribute("type","button");d.value="OK";d.addEventListener("click",function(){b.done()});this.ta.Aa.innerText=this.name+"... "+a+" ";this.ta.Aa.appendChild(d)};c.prototype.done=function(){this.ta.remove()};
c.all=[];return c}();var V=function(){function c(){this.keys={}}c.prototype.contains=function(a){return a in this.keys};c.prototype.add=function(a){if(a instanceof Array)for(var b=0;b<a.length;b++)this.keys[a[b]]=!0;else this.keys[a]=!0};c.prototype.remove=function(a){delete this.keys[a]};c.prototype.Sf=function(a){var b,d;void 0===d&&(d="");if(!(a instanceof c))throw d||"Assertion failed";d=new c;for(b in this.keys)a.contains(b)||d.add(b);return d};c.prototype.Tb=function(){var a;var b=[];for(a in this.keys)this.keys.hasOwnProperty(a)&&
b.push(a);return b};c.prototype.ud=function(){var a;var b=[];for(a in this.keys)this.keys.hasOwnProperty(a)&&b.push(parseFloat(a));return b};c.prototype.clear=function(){this.keys={}};c.prototype.zc=function(a){for(var b in this.keys)if(this.keys.hasOwnProperty(b)&&a(b))break};c.prototype.empty=function(){for(var a in this.keys)if(this.keys.hasOwnProperty(a))return!1;return!0};return c}();var Zc=function(c){function a(b,d){var e=c.call(this,b,d,a)||this;e.log=w.create("PAGE",!0);e.children=[];return e}n(a,c);a.prototype.type=function(){return"PageNode"};a.prototype.setProperty=function(a,d){switch(a){case "width":case "height":this.aa[a]=d;break;default:c.prototype.setProperty.call(this,a,d)}};a.prototype.Gb=function(){return"width"in this.aa&&"height"in this.aa?new Hb(this.aa.width,this.aa.height):null};a.prototype.format=function(){};a.prototype.qb=function(){return null};a.prototype.ha=
function(){};return a}(ic);K.xd("PageNode",Zc);var $c=new Hb(816,1056),ad=function(){function c(){this.log=w.create("NullObserver")}c.prototype.createNode=function(a,b,d,c){this.log("Create node "+c.type+" "+a+" at "+b+":"+d)};c.prototype.xc=function(a,b,d){this.log("Delete node "+a+" from "+b+":"+d)};c.prototype.bf=function(a,b,d,c,g){this.log("Move node "+a+" from "+c+":"+g+" to "+b+":"+d)};c.prototype.Ib=function(a,b){this.log("Set properties for node "+a+" to "+JSON.stringify(b))};c.prototype.qa=function(){};return c}(),bd=function(c){function a(a){void 0===
a&&(a=!1);var b=c.call(this)||this;b.nv=a;b.Xb=new ad;b.Yb=new Ac;b.ua={};b.ve=new V;b.Pn=!0;b.vi=!0;b.lb=0;b.Qc=new V;b.removedNodes=new V;b.fe=new V;b.root=new ic(b.Wa(),b);b.wj=0;b.Tl="magenta";b.readOnly=!1;b.xk=new V;b.aa={};b.ah=new V;b.tm=new V;b.td=[];b.Ya=[];b.Ra=0;b.Lg=0;b.$f=0;b.cp=0;b.log=w.create("DOC");b.ua[b.root.id]=b.root;b.zo();a||(b.Vj(b.root,0),b.Sb(b.Si(0)));return b}n(a,c);a.prototype.empty=function(){return 0===this.root.children.length};a.prototype.zo=function(){this.cp=this.Yb.next};
a.prototype.he=function(){return this.cp!==this.Yb.next};a.prototype.Wa=function(){for(;;){var a=this.lb++;if(!(a in this.ua))return a}};a.prototype.Ue=function(a){return a in this.ua};a.prototype.Vj=function(a,d,c,g,f){void 0===c&&(c=!0);void 0===g&&(g=null);void 0===f&&(f=0);var b,e=!1;if(a.id in this.ua)null!==g&&a.parent&&(this.Xb.bf(a.id,a.parent.id,a.Ze(),g,f),this.log("Node %s inserted at %s:%s; was at %s",a.id,a.parent.id,a.Ze(),f));else if(e=!0,this.ua[a.id]=a,a.parent&&(g=a.dc(),g.type=
a.type(),this.Xb.createNode(a.id,a.parent.id,a.Ze(),g)),a instanceof ic){var k=a.children;f=0;for(b=k.length;f<b;f++)g=k[f],this.Vj(g,d,c)}"PageNode"!==a.type()&&e&&(this.Qc.add(a.id),this.removedNodes.remove(a.id));a.mg(this.readOnly);c&&this.ve.add(a.id);this.tm.add(a.od());a.ja("spotHighlight")&&"PathNode"===a.type()&&this.td.push(a);this.$f=void 0===d||null===d?this.nd(a.id)||0:d;"DomNode"===a.type()?this.xk.add(a.id):"PageNode"===a.type()&&(this.Lg=-1);e&&a.bj()};a.prototype.gh=function(a){this.fe.add(a);
this.$f=this.nd(a)||0;this.ve.add(a)};a.prototype.Wh=function(a){this.Ya[this.Ra]||console.log("FATAL: Asked to add a node but bad page.",this.Ra,this.Ya);this.nb(this.Ya[this.Ra],a,-1)};a.prototype.xa=function(a,d){void 0===d&&(d=!1);if(a in this.ua){var b=this.ua[a];d&&(this.ve.add(a),this.fe.add(a),this.$f=this.nd(a)||0);return b}return null};a.prototype.nd=function(a){for(a=this.xa(a,!1);;)if(a)if("PageNode"===a.type())break;else{if(null===a.parent)return null;a=a.parent}else return null;for(var b=
0;b<this.Ya.length;b++)if(this.Ya[b]===a)return b;return null};a.prototype.Qk=function(a,d,c){for(var b=[],e=0;e<a.length;e++){var h=this.xa(a[e],c);h&&b.push(h)}return b=d?this.mr(b):this.ai(b)};a.prototype.vr=function(a){var b=[],c;for(c in this.ua)if(this.ua.hasOwnProperty(c)){var g=this.ua[c];g.ja("tag")===a&&b.push(g)}return b};a.prototype.qa=function(a,d){void 0===d&&(d=!1);this.Qc=new V;this.removedNodes=new V;this.fe=new V;if(d){this.log("Performing actions without adding to undo stack");
for(var b=0;b<a.length;b++)a[b].tb(this)}else this.Yb.qa(a,!1,this);this.Xb.qa();b=this.Qc.ud();for(var c=0;c<b.length;c++){var f=b[c];f>=this.lb&&(this.lb=f+1)}return{$b:b,rf:this.removedNodes.ud(),rg:this.fe.Sf(this.Qc).Sf(this.removedNodes).ud()}};a.prototype.gb=function(){this.Qc=new V;this.removedNodes=new V;this.fe=new V;this.Yb.gb(this);this.Xb.qa();return{$b:this.Qc.ud(),rf:this.removedNodes.ud(),rg:this.fe.Sf(this.Qc).Sf(this.removedNodes).ud()}};a.prototype.Sd=function(){this.Qc=new V;this.removedNodes=
new V;this.fe=new V;this.Yb.Sd(this);this.Xb.qa();return{$b:this.Qc.ud(),rf:this.removedNodes.ud(),rg:this.fe.Sf(this.Qc).Sf(this.removedNodes).ud()}};a.prototype.Ad=function(){return this.Yb.Ad()};a.prototype.zd=function(){return this.Yb.zd()};a.prototype.rh=function(){this.Yb=new Ac};a.prototype.format=function(a,d){var b=this,c;var f=[];if(this.Pn)for(k in this.ua)f.push(this.ua[k]);else this.ve.zc(function(a){f.push(b.ua[parseInt(a,10)]);return!1});var h=this.ai(f);var l=0;for(c=h.length;l<c;l++){var k=
h[l];k.format(a,d)}this.ve.clear();this.Pn=!1;return f.length};a.prototype.fr=function(a,d,c){if(0!==this.td.length&&d===this.wj){a.save();a.beginPath();d=c||this.Gb();a.moveTo(d.x,d.y);a.lineTo(d.x,d.bottom());a.lineTo(d.right(),d.bottom());a.lineTo(d.right(),d.y);a.closePath();c=!1;for(var b=0;b<this.td.length;b++)this.nd(this.td[b].id)===this.Ra&&(this.td[b].clip(a),c=!0);c&&(a.clip(),a.fillStyle=this.Tl,a.fillRect(d.x,d.y,d.width,d.height));a.restore()}};a.prototype.Dd=function(a,d){var b=d||
this.Gb(),c=this.aa.background;c&&(c=u.xi(c))&&(a.fillStyle=c.toString(),a.fillRect(b.x,b.y,b.width,b.height))};a.prototype.ha=function(a,d){function b(b){f.Lc(function(d){f.ah.contains(d.Ac())||d.od()!==b||d.hidden()||(d.np(l++),d.ha(a))});f.fr(a,b,d)}var c,f=this;this.tm.add(this.wj);var h=this.tm.ud();h.sort(function(a,b){return a-b});var l=0;var k=0;for(c=h.length;k<c;k++)b(h[k])};a.prototype.qb=function(a,d,c,g){var b=null;this.Lc(function(e){e.Ac()===c&&e.qb(a,d)&&(!(null===b||b.od()<=e.od())||
g&&g!==e.type()||(b=e))});return b};a.prototype.Ds=function(a,d){var b=[],c=0,f={};this.Lc(function(e){e.qb(a,d)&&(b.push(e),f[e.id]=c,c+=1)});b.sort(function(a,b){return a.od()!=b.od()?a.od()-b.od():f[a.id]-f[b.id]});b.reverse();return b};a.prototype.ms=function(a){var b=[];this.Lc(function(d){a.contains(d.rect)&&b.push(d)});return b};a.prototype.ai=function(a){var b,c;var g=[];var f={};var h=0;for(c=a.length;h<c;h++){for(b=a[h];b.qo()&&b.parent;)this.log("Node type %s:%s is a group member",b.id,
b.type()),b=b.parent;b.id in f||(f[b.id]=b,g.push(b))}this.su(g);return g};a.prototype.mr=function(a){function b(a){if(!(a.id in g)&&(g[a.id]=a,c.push(a),a.children))for(var d=0;d<a.children.length;d++)b(a.children[d])}for(var c=[],g={},f=0;f<a.length;f++)b(a[f]);return c};a.prototype.zc=function(a,d){function b(c){var e;if(c.children){a&&d(c);var g=c.children;var l=0;for(e=g.length;l<e;l++)c=g[l],b(c)}else d(c)}b(this.root)};a.prototype.Lc=function(a,d){function b(d){if(d.children)for(var c=0;c<
d.children.length;c++)b(d.children[c]);else"PageNode"!==d.type()&&a(d)}void 0===d&&(d=this.Ra);d<this.Ya.length&&b(this.Ya[d||0])};a.prototype.Jr=function(a){var b=!1,c=a.yi(),g=[];this.Lc(function(d){b?d.yi().Fs(c)&&g.push(d):d===a&&(b=!0)});return g};a.prototype.filter=function(a){var b=[];this.zc(!1,function(d){if(a(d))return b.push(d)});return b};a.prototype.su=function(a){var b=0;this.vi&&(this.vi=!1,this.zc(!0,function(a){a.order=b++}));a.sort(function(a,b){return a.order-b.order})};a.prototype.Hg=
function(a,d){var b;var c=new ic(a,this);this.Wh(c);var f=0;for(b=d.length;f<b;f++){var h=d[f];this.nb(c,this.ua[h],-1)}return c};a.prototype.Rt=function(a){var b,c=[];var g=0;var f=this.ai(a);var h=0;for(b=f.length;h<b;h++)a=f[h],g=this.Vm(a,c,g,null);return"zwibblerclip."+JSON.stringify(c)};a.prototype.Vm=function(a,d,c,g){var b=a.dc(),e={},l;for(l in b){var k=b[l];k instanceof F&&(k=["Matrix",k.m11,k.m12,k.m21,k.m22,k.Fa,k.Ga]);e[l]=k}d.push({type:"CreateAction",node:a.type(),parent:g,properties:e});
g=c+1;if(a.children)for(b=0,a=a.children;b<a.length;b++)g=this.Vm(a[b],d,g,c);return g};a.prototype.xo=function(a,d){var b,c;0===a.indexOf("zwibblerclip.")&&(a=a.substr(13));var f=[];var h=JSON.parse(a);var l=[];var k={},m=0,q=0;var p=0;for(c=h.length;p<c;p++){var r=h[p];if("GroupAction"===r.type){var t=this.Wa();k[m++]=t;var v=[];var A=0;for(r=r.members;A<r.length;A++)v.push(k[r[A]]);l.push(new Jc(t,v));f.push(t)}else if("CreateAction"===r.type){A=r.properties;v={};for(b in A)A.hasOwnProperty(b)&&
(t=A[b],"[object Array]"===Object.prototype.toString.apply(t)&&"Matrix"===t[0]&&(t.splice(0,1),t=new F(t)),v[b]=t);t=this.Wa();k[m++]=t;A=null;var I=-1;"parent"in r&&r.parent in k?A=k[r.parent]:"PageNode"===r.node&&(A=this.root.id,I=this.Ra+1+q,q+=1);l.push(new U(t,r.node,v,A,I));f.push(t)}}0!==q||d.al()||l.push(new Hc(f,d));return l};a.prototype.nb=function(a,d,c){var b=null,e=0;d.parent&&(b=d.parent.id,e=d.Ze(),this.removeNode(d,!1));-1===c?a.children.push(d):a.children.splice(c,0,d);d instanceof
Zc&&(-1===c?this.Ya.push(d):this.Ya.splice(c,0,d));d.parent=a;this.Vj(d,this.nd(a.id),!0,b,e);this.vi=!0};a.prototype.Kt=function(a,d){var b="function"!==typeof d?function(a){return a===d}:d;for(var c=0,f=0;f<a.length;f++)b(a[f])?c+=1:c&&(a[f-c]=a[f]);a.length-=c};a.prototype.removeNode=function(a,d){void 0===d&&(d=!0);var b=this,c=this.nd(a.id);if(!a.parent||null===c)return this.log("Error: removeNode -- should not happen!"),-1;var f=a.parent.Hk(a);if(0<=f&&(d&&this.Xb.xc(a.id,a.parent.id,f),a.parent.children.splice(f,
1),a.parent=null,d)){var h=function(a){var d;delete b.ua[a.id];b.Qc.remove(a.id);b.removedNodes.add(a.id);a.ej();b.ve.remove(a.id);if(a.children){var c=a.children;var e=0;for(d=c.length;e<d;e++){var g=c[e];h(g)}}a.ja("spotHighlight")&&b.Kt(b.td,a);b.xk.remove(a.id)};h(a)}"PageNode"===a.type()?(this.Ya.splice(f,1),f===this.Ra&&(this.log("Removed current page."),this.Sb(Math.min(f,this.Ya.length-1)),this.$f=this.Ra),this.Lg=-1):this.$f=c;return f};a.prototype.Sn=function(a){function b(a){if(!l||a.rect.x<
c)c=a.rect.x;if(!l||a.rect.right()>g)g=a.rect.right();if(!l||a.rect.y<f)f=a.rect.y;if(!l||a.rect.bottom()>h)h=a.rect.bottom();l=!0}var c=0,g=0,f=0,h=0,l=!1;"number"===typeof a?this.Lc(b,a):this.zc(!1,b);return l?new B(c,f,g-c,h-f):new B(0,0,10,10)};a.prototype.Bs=function(){var a=this.Wg(void 0),d=null;a instanceof Zc&&(d=a.Gb());return d||"width"in this.aa};a.prototype.Gb=function(a,d){var b=this.Wg(a),c=null;b instanceof Zc&&(c=b.Gb());return c?c.yp():this.aa.width?new B(0,0,this.aa.width,this.aa.height):
d?d.yp():this.Sn(a)};a.prototype.ja=function(a){return this.aa[a]};a.prototype.As=function(){return"background"in this.aa};a.prototype.setProperty=function(a,d){var b=this.aa[a]||null;null===d?a in this.aa&&delete this.aa[a]:this.aa[a]=d;var c={};c[a]=d;var f={};f[a]=b;this.Xb.Ib(this.root.id,c,f)};a.prototype.Vc=function(a,d,c){a===this.root&&this.setProperty(d,c);var b={};b[d]=c;var e={};e[d]=a.ja(d);a.setProperty(d,c);this.Xb.Ib(a.id,b,e);if("spotHighlight"===d&&"PathNode"===a.type()){for(d=0;d<
this.td.length;d++)if(this.td[d]===a){this.td.splice(d,1);break}c?(this.log("Added node %s to spotHighlightNodes",a.id),this.td.push(a)):this.log("Removed node %s from spotHighlightNodes",a.id)}};a.prototype.xh=function(a,d){this.log("showLayer(%s, %s)",a,d);d?(this.ah.remove(a),this.Lc(function(b){b.Ac()===a&&b.bj()})):(this.ah.add(a),this.Lc(function(b){b.Ac()===a&&b.ej()}))};a.prototype.bl=function(a){return!this.ah.contains(a)};a.prototype.Si=function(a){this.log("Adding page to document with index %s",
a);if(a>this.Ya.length)return this.log("Error: Can insert page with index %s",a),-1;var b=K.create("PageNode",this.Wa(),this);this.nb(this.root,b,a);return a};a.prototype.Bc=function(){return this.Ya.length};a.prototype.Sb=function(a){if(a!==this.Ra){if(0<=a&&a<this.Ya.length)return this.log("Set current page to %s/%s",a,this.Ya.length),this.Ra=a,!0;this.log("Tried to set page to non-existing %s",a);return!1}};a.prototype.nu=function(){this.Lg!==this.Ra&&(this.em(this.Lg,!1),this.em(this.Ra,!0),this.Lg=
this.Ra)};a.prototype.em=function(a,d){var b=this;d?this.Lc(function(a){"DomNode"!==a.type()||b.ah.contains(a.Ac())||a.bj()},a):this.xk.zc(function(a){(a=b.xa(parseInt(a,10),!1))&&a.ej()})};a.prototype.Wg=function(a){return 0===this.Ya.length?this.root:void 0===a?this.Ya[this.Ra]:this.Ya[a]};a.prototype.Sk=function(){return this.Gb(this.Ra,$c)};a.prototype.mg=function(a){this.zc(!1,function(b){b.mg(a)})};a.prototype.getRootNode=function(){return this.root};a.prototype.qp=function(a,d){void 0===d&&
(d=!0);this.Xb=a;d&&(this.Xb.Ib(this.root.id,this.aa,{}),this.zc(!0,function(b){if(b.parent){var d=b.dc();d.type=b.type();a.createNode(b.id,b.parent.id,b.Ze(),d)}}),this.Xb.qa())};return a}(Sc);var cd=function(c){function a(a){a=c.call(this,a)||this;a.ff=0;a.rd=0;a.Ao=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8193];a.log=w.create("BITWRITER");return a}n(a,c);a.prototype.hb=function(a){this.Hp(a,8)};a.prototype.Hp=function(a,d){this.ff=this.ff<<d|a&this.Ao[d];for(this.rd+=d;8<=this.rd;)this.next.hb(this.ff>>>this.rd-8&255),this.rd-=8,this.ff&=this.Ao[this.rd]};a.prototype.flush=function(){this.rd&&(this.next.hb(this.ff<<8-this.rd),this.ff=this.rd=0);this.next.flush()};return a}(Ma);var dd=function(c){function a(a){var b=c.call(this,a)||this;b.ag=258;b.ov=0;b.Bf=0;b.first=!0;b.Fg=[];b.tl=[];b.ek=[];b.rv=0;b.kk=9;b.log=w.create("LZWEncoder");b.zq=new cd(a);b.Nm();return b}n(a,c);a.prototype.hb=function(a){if(this.first)this.Bf=a,this.first=!1;else{var b=this.Zp(this.Bf,a);void 0!==this.Fg[b]?this.Bf=this.Fg[b]:(this.Uh(this.Bf),this.Fg[b]=this.ag,this.tl[b]=this.Bf,this.Bf=this.ek[b]=a,4095>this.ag?(this.ag+=1,this.kk=Math.ceil(Math.log(this.ag)/Math.log(2))):this.Nm())}};a.prototype.Zp=
function(a,d){var b;var c=d<<4^a;for(b=0===c?1:18041-c;;){if(void 0===this.Fg[c]||this.tl[c]===a&&this.ek[c]===d)return c;c-=b;0>c&&(c+=18041)}};a.prototype.Nm=function(){this.Uh(a.Kp);this.ag=258;this.kk=9;this.Fg.length=0;this.tl.length=0;this.ek.length=0};a.prototype.flush=function(){this.first||(this.Uh(this.Bf),this.Uh(a.Op))};a.prototype.Uh=function(a){this.zq.Hp(a,this.kk)};a.Kp=256;a.Op=257;return a}(Ma);Na.Fm("LZWEncoder",function(c){return new dd(c)});var ed=function(){function c(a,b,d,c){this.x=a;this.y=b;this.width=d;this.height=c;this.Wb=[];this.fonts={};this.images=[];this.Dj={};this.lb=1;this.Oq=!0;this.page={};this.log=w.create("PdfWriter");this.Ya=this.object("Pages",{Kids:[],Count:0});this.Eq=this.object("Catalog",{Pages:this.Ya._id+" 0 R"});this.pg()}c.prototype.Gs=function(){if(null!==c.Wj)return c.Wj;var a=document.createElement("canvas"),b=!1;a.width=10;a.height=10;"toDataURL"in a&&(b=0<a.toDataURL("image/jpeg").indexOf("jpeg"));c.Wj=
b;this.log("JPEG supported: %s",b);return b};c.prototype.pg=function(a,b,d,c){void 0===a&&(a=this.x);void 0===b&&(b=this.x);void 0===d&&(d=this.width);void 0===c&&(c=this.height);this.log("StartPage MediaBox=[%s %s %s %s]",a,b,d,c);this.page=this.object("Page",{MediaBox:[a,b,a+d,b+c],Parent:this.Ya._id+" 0 R"});this.Ya.Kids.push(this.page._id+" 0 R");this.Ya.Count+=1;this.Dj={}};c.prototype.object=function(a,b){var d=this.Wb.length+1;a&&(b.Type=a);b._id=d;this.Wb.push(b);return b};c.prototype.nq=
function(a){this.page.Contents=a._id+" 0 R"};c.prototype.stream=function(a){if(this.Oq){var b=Na.vg("LZWEncoder");b.Ip(a);b.flush();a=b.Tf().toString();a=this.object(null,{_stream:a,Filter:"[/LZWDecode]",DecodeParms:"[ << /EarlyChange 0 >> ]"})}else a=this.object(null,{_stream:a});return a};c.prototype.Ju=function(a){if(!(a in this.fonts)){var b="F"+this.lb;this.lb+=1;var d="/"+a.replace(/ /g,"");b=this.object("Font",{_name:b,BaseFont:d,Encoding:"/StandardEncoding",Subtype:"/Type1"});this.fonts[a]=
b}this.Mh("Font",this.fonts[a]);return"/"+this.fonts[a]._name};c.prototype.Fp=function(a,b){var d=""+a+"-"+b;if(!(d in this.Dj)){var c="gs"+this.lb;this.lb+=1;var g=this.object("ExtGState",{_name:c});b?g.ca=this.Ic(a):g.CA=this.Ic(a);this.Dj[d]=c;this.Mh("ExtGState",g)}return this.Dj[d]};c.prototype.Mh=function(a,b){"Resources"in this.page||(this.page.Resources={});a in this.page.Resources||(this.page.Resources[a]={});this.page.Resources[a][b._name]=b._id+" 0 R"};c.prototype.Tj=function(a,b){void 0===
b&&(b="");for(var d=0;d<this.images.length;d++)if(this.images[d].bh===a&&b===this.images[d].jo)return this.images[d].mh;return null};c.prototype.Fj=function(a,b){var d,c=this.Tj(a);if(!c){var g="I"+this.lb;this.lb+=1;b instanceof HTMLCanvasElement?c=b:(c=document.createElement("canvas"),c.width=b.width,c.height=b.height,c.getContext("2d").drawImage(b,0,0));var f=c.getContext("2d").getImageData(0,0,c.width,c.height),h=!1;if(this.Gs()){this.log("Using JPEG encoding");var l="[/DCTDecode]";var k=Na.vg("");
for(d=0;d<f.data.length;d+=4)h=h||255>f.data[d+3];d=c.toDataURL("image/jpeg");var m=atob(d.split(",")[1]);for(d=0;d<m.length;d++)k.hb(m.charCodeAt(d))}else{this.log("Using LZW encoding");l="[/LZWDecode]";k=Na.vg("LZWEncoder");for(d=0;d<f.data.length;d+=4)k.hb(f.data[d]),k.hb(f.data[d+1]),k.hb(f.data[d+2]),h=h||255>f.data[d+3];var q="[ <</EarlyChange 0 >> ]"}k.flush();k=k.Tf().toString();g=this.object("XObject",{Subtype:"/Image",Width:c.width,Height:c.height,ColorSpace:"/DeviceRGB",BitsPerComponent:8,
Length:k.length,Interpolate:"true",Filter:l,_name:g,_stream:k});q&&(g.DecodeParms=q);if(h){k=Na.vg("LZWEncoder");for(d=0;d<f.data.length;d+=4)k.hb(f.data[d+3]);k.flush();k=k.Tf().toString();q=this.object("XObject",{Subtype:"/Image",Width:c.width,Height:c.height,ColorSpace:"/DeviceGray",BitsPerComponent:8,Length:k.length,Filter:"[/LZWDecode]",DecodeParms:"[ << /EarlyChange 0 >> ]",_stream:k});g.SMask=q._id+" 0 R"}this.images.push({bh:a,jo:"",mh:g});c=g}this.Mh("XObject",c);return"/"+c._name};c.prototype.Gj=
function(a,b){var d=this.Tj(a.Ja,b.toString());if(!d){d="P"+this.lb;this.lb+=1;this.Fj(a.Ja,a.Ja);var c=this.Tj(a.Ja),g=new F(a.Ja.width,0,0,-a.Ja.height,0,a.Ja.height);g=b.multiply(g);var f="1",h="1",l=b.ec();l=Math.max(l.x,l.y);if("no-repeat"===a.repeat||"repeat-y"===a.repeat)f=""+Math.ceil(this.width/a.Ja.width/l);if("no-repeat"===a.repeat||"repeat-x"===a.repeat)h=""+Math.ceil(this.height/a.Ja.height/l);d=this.object("Pattern",{_name:d,PatternType:"1",PaintType:"1",TilingType:"2",BBox:"[0 0 1 1]",
XStep:f,YStep:h,Matrix:"[ "+this.Ic(g.m11,g.m21,g.m12,g.m22,g.Fa,g.Ga)+"]",Resources:"<< /XObject << /"+c._name+" "+c._id+" 0 R >> >>"});d._stream="/"+c._name+" Do";this.images.push({bh:a.Ja,jo:b.toString(),mh:d})}this.Mh("Pattern",d);return"/"+d._name};c.prototype.sf=function(){var a=[],b=[],d;a.push("%PDF-1.4\n%\u0080\u0081\u0082\u0083\n");for(d=0;d<this.Wb.length;d++)this.$m(a,b,this.Wb[d],!1);var c=a.join("").length;a.push("xref\n0 "+(this.Wb.length+1)+"\n");a.push("0000000000 65535 f\n");for(d=
0;d<this.Wb.length;d++){for(var g=""+b[d];10>g.length;)g="0"+g;a.push(g+" 00000 n \n")}a.push("trailer\n");a.push("<< /Size "+(this.Wb.length+1)+"\n");a.push("   /Root "+this.Eq._id+" 0 R\n");a.push(">>\n");a.push("startxref\n");a.push(c+"\n");a.push("%%EOF\n");return a.join("")};c.prototype.toBlob=function(){for(var a=this.sf(),b=new Uint8Array(a.length),d=0;d<a.length;d++)b[d]=a.charCodeAt(d);return new Blob([b],{type:"application/pdf"})};c.prototype.$m=function(a,b,d,c){c?a.push("<<\n"):(b.push(a.join("").length),
a.push(d._id+" 0 obj\n"),"Type"in d?a.push("<< /Type /"+d.Type+"\n"):a.push("<<\n"));"_stream"in d&&(d.Length=d._stream.toString().length);for(var e in d)if(d.hasOwnProperty(e)&&"Type"!==e&&"_"!==e.charAt(0)){c&&a.push("    ");a.push("   /"+e+" ");var f=d[e];"object"===typeof f&&"[object Array]"===Object.prototype.toString.apply(f)?a.push("[ "+f.join(" ")+" ]"):"object"===typeof f?this.$m(a,b,f,!0):a.push(f);a.push("\n")}c&&a.push("    ");a.push(">>\n");"_stream"in d&&(a.push("stream\n"),a.push(d._stream+
"\n"),a.push("endstream\n"));c||a.push("endobj\n")};c.prototype.lr=function(a){return"("+a.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")+")"};c.prototype.Ic=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];b=[];for(var d=0;d<a.length;d++){var c=""+a[d];0<c.indexOf("e")&&(c=a[d].toFixed(20));b.push(c)}return b.join(" ")};c.Wj=null;return c}(),fd=function(c){function a(a,d){var b=c.call(this)||this;b.zr=d;b.path=[];b.x=0;b.y=0;b.Ro=[];b.hf="";b.pf="";b.nf=-1;b.mf=
"";b.lf="";b.kf="";b.jf="";b.gf=-1;b.log=w.create("PDFContext");b.Qd=a.clone();b.Qd.transform(new Kb(.75,.75,0,0));b.jb=new ed(72*a.x/96,72*a.y/96,72*a.width/96,72*a.height/96);b.stream=[];b.x=0;b.y=0;b.fillStyle="#000000";b.strokeStyle="#000000";b.Xm=b.eq;b.Wm();return b}n(a,c);a.prototype.save=function(){c.prototype.save.call(this);this.stream.push("q");this.Ro.push({hf:this.hf,pf:this.pf,nf:this.nf,mf:this.mf,lf:this.lf,kf:this.kf,jf:this.jf,gf:this.gf})};a.prototype.restore=function(){c.prototype.restore.call(this);
var a=this.Ro.pop();a&&(this.stream.push("Q"),this.hf=a.hf,this.pf=a.pf,this.nf=a.nf,this.mf=a.mf,this.lf=a.lf,this.kf=a.kf,this.jf=a.jf,this.gf=a.gf)};a.prototype.pg=function(a){var b=new Kb(.75,.75,0,0);a&&(this.Qd=a.clone(),this.Qd.transform(b));this.Dk();this.jb.pg(this.Qd.x,this.Qd.y,this.Qd.width,this.Qd.height);this.Wm();this.beginPath()};a.prototype.beginPath=function(){this.path.length=0};a.prototype.Wm=function(){this.log("Start page: %s",this.Qd);this.setTransform(1,0,0,1,0,0);this.pf=
this.hf="";this.nf=-1;this.jf=this.kf=this.lf=this.mf="";this.gf=-1};a.prototype.Dk=function(){this.stream.length&&this.jb.nq(this.jb.stream(this.stream.join("\n")));this.stream.length=0};a.prototype.toString=function(){this.Dk();return this.jb.sf()};a.prototype.toBlob=function(){this.Dk();return this.jb.toBlob()};a.prototype.setTransform=function(a,d,c,g,f,h){var b=this.Qd.ed();this.pa=(new F(a,c,d,g,f,h)).multiply(new Lb(0,b.x,b.y)).multiply(new Kb(.75,.75,0,0))};a.prototype.closePath=function(){this.path.push("h")};
a.prototype.fill=function(){this.Zj();for(var a=0;a<this.path.length;a++)this.stream.push(this.path[a]);this.stream.push("f")};a.prototype.stroke=function(){this.$j();for(var a=0;a<this.path.length;a++)this.stream.push(this.path[a]);this.stream.push("S")};a.prototype.moveTo=function(a,d){var b=this.pa.apply(a,d);this.path.push(this.jb.Ic(b.x,b.y)+" m");this.x=a;this.y=d};a.prototype.lineTo=function(a,d){var b=this.pa.apply(a,d);this.path.push(this.jb.Ic(b.x,b.y)+" l");this.x=a;this.y=d};a.prototype.bezierCurveTo=
function(a,d,c,g,f,h){a=this.pa.apply(a,d);c=this.pa.apply(c,g);g=this.pa.apply(f,h);this.path.push(this.jb.Ic(a.x,a.y,c.x,c.y,g.x,g.y)+" c");this.x=f;this.y=h};a.prototype.quadraticCurveTo=function(a,d,c,g){this.bezierCurveTo(2/3*a+1/3*this.x,2/3*d+1/3*this.y,2/3*a+1/3*c,2/3*d+1/3*g,c,g)};a.prototype.fillText=function(a,d,c){this.Xm(a,d,c,0)};a.prototype.strokeText=function(a,d,c){this.Xm(a,d,c,1)};a.prototype.measureText=function(a){var b=document.createElement("canvas").getContext("2d");b.font=
this.font;return b.measureText(a)};a.prototype.Zj=function(){if(this.hf!==this.fillStyle){if(this.fillStyle instanceof ac){var a=this.jb.Gj(this.fillStyle,this.pa);this.stream.push("/Pattern cs");this.stream.push(a+" scn")}else"string"===typeof this.fillStyle&&(a=u.Fd(this.fillStyle).ei(u.RGBA),this.stream.push(this.jb.Ic(a.values[0],a.values[1],a.values[2])+" rg"),a=this.jb.Fp(a.values[3],!0),this.stream.push("/"+a+" gs"));this.hf=this.fillStyle}};a.prototype.$j=function(){function a(a){return"bevel"===
a?2:"round"===a?1:0}function d(a){return"butt"===a?0:"round"===a?1:2}if(this.pf!==this.strokeStyle){if(this.strokeStyle instanceof ac){var c=this.jb.Gj(this.strokeStyle,this.pa);this.stream.push("/Pattern CS");this.stream.push(c+" SCN")}else"string"===typeof this.strokeStyle&&(c=u.Fd(this.strokeStyle).ei(u.RGBA),this.stream.push(this.jb.Ic(c.values[0],c.values[1],c.values[2])+" RG"),c=this.jb.Fp(c.values[3],!1),this.stream.push("/"+c+" gs"));this.pf=this.strokeStyle}this.nf!==this.lineWidth&&(this.nf=
this.lineWidth,this.stream.push(this.jb.Ic(72*this.lineWidth/96)+" w"));this.mf!==this.lineJoin&&(this.mf=this.lineJoin,this.stream.push(a(this.lineJoin)+" j"));this.lf!==this.lineCap&&(this.lf=this.lineCap,this.stream.push(d(this.lineCap)+" J"))};a.prototype.fq=function(a,d,c,g){var b=this.Ge(this.font);if(this.kf!==b.fontSize||this.jf!==b.fontFamily){var e=this.jb.Ju(b.fontFamily);this.stream.push(e+" "+this.jb.Ic(parseFloat(b.fontSize))+" Tf");this.kf=b.fontSize;this.jf=b.fontFamily}this.gf!==
g&&(this.stream.push(g+" Tr"),this.gf=g);0===g?this.Zj():this.$j();this.stream.push("BT");d=this.pa.multiply(new F(1,0,0,-1,d,c));this.stream.push(this.jb.Ic(d.m11,d.m21,d.m12,d.m22,d.Fa,d.Ga)+" Tm");this.stream.push(this.jb.lr(a)+" Tj");this.stream.push("ET")};a.prototype.eq=function(a,d,c,g){var b=this.Ge(this.font),e=this.zr.get(b.fontFamily);e?(0===g?this.Zj():this.$j(),this.beginPath(),e.gr(this,a,d,c,parseFloat(b.fontSize)),0===g?this.fill():this.stroke()):this.fq(a,d,c,g)};a.prototype.Ge=function(a){var b=
"",c="",g="normal",f="normal",h="normal",l="normal";a=a.split(/\s+/);a:for(;;){var k=a.shift();if(!k)break;switch(k){case "normal":break;case "italic":case "oblique":g=k;break;case "small-caps":h=k;break;case "bold":case "bolder":case "lighter":case "100":case "200":case "300":case "400":case "500":case "600":case "700":case "800":case "900":f=k;break;default:if(""===c)k=k.split("/"),c=k[0],1<k.length&&(l=k[1]);else{b=k;a.length&&(b+=" "+a.join(" "));break a}}}b&&(b=b.replace(/"/g,""));return{fontStyle:g,
fontVariant:h,fontWeight:f,fontSize:c,lineHeight:l,fontFamily:b}};a.prototype.Rj=function(a,d,c,g,f,h,l,k,m){this.log("DrawImage(%s, %s, %s, %s, %s, %s, %s %s)",d,c,g,f,h,l,k,m);l+=m;var b=document.createElement("canvas"),e=b.getContext("2d");b.width=g;b.height=f;e.drawImage(a,-d,-c);a=this.jb.Fj(a instanceof HTMLImageElement?[a.src,d,c,g,f].join():a,b);this.stream.push("q");h=this.pa.multiply(new F(k,0,0,-m,h,l));this.stream.push(this.jb.Ic(h.m11,h.m21,h.m12,h.m22,h.Fa,h.Ga)+" cm");this.stream.push(a+
" Do");this.stream.push("Q")};a.prototype.sf=function(){return this.jb.sf()};a.prototype.Uj=function(){return{}};a.prototype.Yj=function(){};a.prototype.clip=function(){for(var a=0;a<this.path.length;a++)this.stream.push(this.path[a]);this.stream.push("W");this.stream.push("n");this.path.length=0};return a}(dc);var gd=function(){function c(){this.ba=[]}c.prototype.lineTo=function(a,b,d){a.apply(b,d);this.ba.push({Eg:"L",dg:a.apply(b,d)})};c.prototype.moveTo=function(a,b,d){a.apply(b,d);this.ba.push({Eg:"M",dg:a.apply(b,d)})};c.prototype.quadraticCurveTo=function(a,b,d,c,g){this.ba.push({Eg:"Q",dg:a.apply(b,d),fj:a.apply(c,g)})};c.prototype.bezierCurveTo=function(a,b,d,c,g,f,h){this.ba.push({Eg:"C",dg:a.apply(b,d),fj:a.apply(c,g),rl:a.apply(f,h)})};c.prototype.closePath=function(){this.ba.push({Eg:"Z"})};
c.prototype.bm=function(a){a=a.inverse();for(var b="",d=0;d<this.ba.length;d++){var c=this.ba[d];0<d&&(b+=" ");b+=c.Eg;if(c.dg){var g=a.apply(c.dg.x,c.dg.y);b+=g.x+","+g.y;c.fj&&(g=a.apply(c.fj.x,c.fj.y),b+=","+g.x+","+g.y,c.rl&&(c=a.apply(c.rl.x,c.rl.y),b+=","+c.x+","+c.y))}}return b};return c}(),hd=function(c){function a(a){var b=c.call(this)||this;b.pa=new F;b.ba=[];b.path=new gd;b.Me="";b.Wb=[];b.lb=0;b.log=w.create("SvgContext");b.xg=1;b.If=2;b.Oj=4;b.log("SVG context rect: %s",a);b.root=new ra("svg",
{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink","xmlns:zwibbler":"https://web.archive.org/web/20191223142120/http://zwibbler.com/xml",version:1.2,baseProfile:"tiny",width:a.width,height:a.height,viewBox:a.x+" "+a.y+" "+a.width+" "+a.height});b.li=new ra("defs",{});b.root.Bd(b.li);b.Kd=[b.root];return b}n(a,c);a.prototype.Ss=function(){return"clip"+this.lb++};a.prototype.ph=function(a){a=new ra("g",a||{});this.nk().Bd(a);this.Kd.push(a)};a.prototype.oh=function(){var a=this.Kd.pop();if(a&&1===a.children.length){var d=
a.children[0];d.rj(a.attributes);a.name=d.name;a.attributes=d.attributes;a.children=d.children;a.text=d.text}};a.prototype.nk=function(){return this.Kd[this.Kd.length-1]};a.prototype.node=function(a,d,c,g){function b(a,b){if(b instanceof ac)c[a]="url(#"+e.Gj(b)+")";else if("string"===typeof b){var d=u.Fd(b),g=d.values[3];1>g&&(d.values[3]=1,c[a+"-opacity"]=""+g);c[a]=d.toString()}}void 0===c&&(c={});var e=this;this.pa.al()||(c.transform="matrix("+this.pa.m11+" "+this.pa.m21+" "+this.pa.m12+" "+this.pa.m22+
" "+this.pa.Fa+" "+this.pa.Ga+")");d&this.xg?b("fill",this.fillStyle):c.fill="none";d&this.If&&(b("stroke",this.strokeStyle),c["stroke-width"]=this.lineWidth,"miter"!==this.lineJoin&&(c["stroke-linejoin"]=this.lineJoin),"butt"!==this.lineCap&&(c["stroke-linecap"]=this.lineCap));d&this.Oj&&(d=this.Ge(this.font),c["font-weight"]=d.fontWeight,c["font-size"]=parseFloat(d.fontSize),c["font-style"]=d.fontStyle,c["font-family"]=d.fontFamily);""!==this.Me&&(c["clip-path"]="url(#"+this.Me+")");this.lq(new ra(a,
c,g))};a.prototype.lq=function(a){var b=!0,c=null,g={},f,h=this.nk();0===h.children.length?b=!1:c=h.children[h.children.length-1];!c||a.name===c.name&&a.text===c.text||(b=!1);if(b&&c)for(f in c.attributes)if(c.attributes.hasOwnProperty(f))if(f in a.attributes){var l=c.attributes[f],k=a.attributes[f];if(l!==k)if(0===f.indexOf("fill")||0===f.indexOf("stroke"))if("none"===l)g[f]=k;else if("none"===k)g[f]=l;else{b=!1;break}else{b=!1;break}}else g[f]=c.attributes[f];if(b&&c)for(f in a.attributes)a.attributes.hasOwnProperty(f)&&
(f in c.attributes||(g[f]=a.attributes[f]));b&&c?c.rj(g):h.Bd(a)};a.prototype.Ti=function(a){if(a===this.If){if(0===this.lineWidth)return!1;a=this.strokeStyle}else a=this.fillStyle;return a instanceof ac?!0:"string"===typeof a?0<u.Fd(a).values[3]:!1};a.prototype.Sm=function(a){for(var b=0;b<this.Wb.length;b++)if(this.Wb[b].bh===a)return this.Wb[b].mh;return null};a.prototype.Fj=function(a){var b=this.Sm(a);if(b)return b;b="image"+this.Wb.length;this.Wb.push({bh:a,mh:b});var c=document.createElement("canvas"),
g=c.getContext("2d");c.width=a.width;c.height=a.height;g.drawImage(a,0,0);c=c.toDataURL();a=new ra("image",{id:b,x:0,y:0,width:a.width,height:a.height,"xlink:href":c});this.li.Bd(a);return b};a.prototype.Gj=function(a){var b=this.Sm(a);if(b)return b;var c=this.Fj(a.Ja);b="pattern"+this.Wb.length;this.Wb.push({bh:a,mh:b});var g=new ra("pattern",{id:b});"no-repeat"===a.repeat?(g.attributes.width="1",g.attributes.height="1"):"repeat-x"===a.repeat?(g.attributes.patternUnits="userSpaceOnUse",g.attributes.width=
a.Ja.width,g.attributes.height=1E4):("repeat-y"===a.repeat?(g.attributes.patternUnits="userSpaceOnUse",g.attributes.width=1E4):(g.attributes.patternUnits="userSpaceOnUse",g.attributes.width=a.Ja.width),g.attributes.height=a.Ja.height);g.Bd(new ra("use",{"xlink:href":"#"+c}));this.li.Bd(g);return b};a.prototype.toString=function(){return'<?xml version="1.0" encoding="UTF-8"?>\n'+this.root.toString()};a.prototype.toBlob=function(){for(var a=this.toString(),d=new Uint8Array(a.length),c=0;c<a.length;c++)d[c]=
a.charCodeAt(c);return new Blob([d],{type:"image/svg+xml"})};a.prototype.beginPath=function(){this.path=new gd};a.prototype.transform=function(a,d,c,g,f,h){a=new F(a,c,d,g,f,h);this.pa=this.pa.multiply(a)};a.prototype.closePath=function(){this.path.closePath()};a.prototype.fill=function(){this.Ti(this.xg)&&this.node("path",this.xg,{d:this.path.bm(this.pa)})};a.prototype.stroke=function(){this.Ti(this.If)&&this.node("path",this.If,{d:this.path.bm(this.pa)})};a.prototype.moveTo=function(a,d){this.path.moveTo(this.pa,
a,d)};a.prototype.lineTo=function(a,d){this.path.lineTo(this.pa,a,d)};a.prototype.quadraticCurveTo=function(a,d,c,g){this.path.quadraticCurveTo(this.pa,a,d,c,g)};a.prototype.bezierCurveTo=function(a,d,c,g,f,h){this.path.bezierCurveTo(this.pa,a,d,c,g,f,h)};a.prototype.fillText=function(a,d,c){this.Ti(this.xg)&&(this.Ge(this.font),this.node("text",this.xg|this.Oj,{x:d,y:c},a))};a.prototype.strokeText=function(a,d,c){this.Ti(this.If)&&(this.Ge(this.font),this.node("text",this.If|this.Oj,{x:d,y:c},a))};
a.prototype.Rj=function(a,d,c,g,f,h,l,k,m){var b=document.createElement("canvas"),e=b.getContext("2d");b.width=g;b.height=f;e.drawImage(a,-d,-c);a=b.toDataURL();this.nk().Bd(new ra("image",{transform:"matrix("+this.pa.m11+" "+this.pa.m21+" "+this.pa.m12+" "+this.pa.m22+" "+this.pa.Fa+" "+this.pa.Ga+")",x:h,y:l,width:k,height:m,"xlink:href":a}))};a.prototype.measureText=function(a){var b=document.createElement("canvas").getContext("2d");b.font=this.font;return b.measureText(a)};a.prototype.pg=function(){};
a.prototype.Uj=function(){return{name:this.Me}};a.prototype.Yj=function(a){this.Me=a?a.name:""};a.prototype.clip=function(){var a=this.Ss(),d=new ra("clipPath",{id:a});d.Bd(new ra("path",{d:this.path.bm(this.pa)}));this.li.Bd(d);this.Me=a;this.path=new gd};return a}(dc);var id=new (function(){function c(){this.log=w.create("serializer");this.vm={pdf:"application/pdf",svg:"image/svg+xml",png:"image/png",jpeg:"image/jpeg",jpg:"image/jpeg",bmp:"image/bmp"}}c.prototype.Kh=function(a){if(a instanceof Array)var b=this.lo(a);else{if("string"!==typeof a)return this.log("Can only open an array or string as a document."),null;if("{"===a.charAt(0))b=this.Ps(a);else if(0===a.indexOf("zwibbler3."))b=JSON.parse(a.substr(10)),b=this.lo(b);else if(0===a.indexOf("zwibblerclip."))b=
new bd(!1),a=b.xo(a,new F),b.qa(a),b.rh();else throw Error("Format detection failed.");}for(a=1;a<b.Bc();a++)b.em(a,!1);return b};c.prototype.Ps=function(a){function b(a){var b=new F;b.m11=a.m11;b.m12=a.m12;b.m21=a.m21;b.m22=a.m22;b.Fa=a.dx;b.Ga=a.dy;return b}function d(a,c){switch(a.type){case "Node":for(var e=[],h=a.children,k=h.length-1;0<=k;k--){var l=g.lb;try{d(h[k],c+1)}catch(N){continue}e.push(l)}0<c&&f.push(new Jc(g.Wa(),e));break;case "PathNode":case "ArrowNode":var t=a;h=0;"arrowSize"in
t&&(h=t.arrowSize,t=t.path);e=b(t.matrix);h={strokeStyle:t.strokeStyle,fillStyle:t.fillStyle,lineWidth:t.lineWidth,smoothness:t.smoothness,sloppiness:t.sloppiness,shadow:t.shadow,arrowSize:h,seed:Math.round(65535*Math.random())};"textNode"in t&&(k=t.textNode,h.fontSize=k.fontSize,h.fontName=k.fontName,h.text=k.text,h.textFillStyle="textFillStyle"in k?k.textFillStyle:k.fillStyle);"path"in t&&(t=t.path);var v=t.startX,A=t.startY;k=t.closed;l=new T;t=t.segments;v=e.apply(v,A);l.moveTo(v.x,v.y);for(v=
0;v<t.length;v++){var I=t[v];switch(I.type){case 1:A=e.apply(I.x,I.y);l.lineTo(A.x,A.y);break;case 2:A=e.apply(I.x,I.y);l.Ig(A.x,A.y);break;case 3:A=e.apply(I.x1,I.y1);I=e.apply(I.x,I.y);l.Pe(A.x,A.y,I.x,I.y);break;default:throw"Unknown path segment type: "+I.type;}}k&&l.close();h.commands=l.Tb();f.push(new U(g.Wa(),"PathNode",h));break;case "TextNode":e=b(a.matrix);e=e.multiply(new E(0,1.3*a.fontSize));e={fillStyle:a.fillStyle,lineWidth:0,text:a.text,fontName:a.fontName,fontSize:a.fontSize,matrix:e};
f.push(new U(g.Wa(),"TextNode",e));break;default:throw Error("Unknown node type: "+a.type);}}var c=w.create("IMPORT"),g=new bd,f=[];try{var h=JSON.parse(a)}catch(l){a=a.replace(/\\\\/g,"\\").replace(/\\"/g,'"');try{h=JSON.parse(a)}catch(k){throw c("Couldn't parse file."),"Couldn't parse file.";}}c("Successfully parsed!");d(h,0);g.qa(f);return g};c.prototype.lo=function(a){function b(a,d){if(void 0!==a){var e={};for(var f in a)a.hasOwnProperty(f)&&"children"!==f&&"parent"!==f&&"id"!==f&&"type"!==f&&
(e[f]="matrix"===f?new F(a[f]):a[f]);f=g;0!==a.id&&c.push(new U(f,a.type,e,d,-1));g+=1;if(void 0!==a.children)for(e=0;e<a.children.length;e++)b(a.children[e],f)}}var d;a=JSON.parse(JSON.stringify(a));var c=[],g=0,f={},h=!1;for(d=0;d<a.length;d++){var l=a[d];if("document"===l.type)delete l.type,c.push(new Pc(l));else{"PageNode"===l.type&&(h=!0);if("parent"in l){if(!(l.parent in f))throw"Error: child "+l.id+" references parent "+l.parent+" before it was defined.";var k=f[l.parent];void 0!==k.children?
k.children.push(l):k.children=[l]}"GroupNode"!==l.type&&"PageNode"!==l.type||void 0!==l.children||(l.children=[]);f[l.id]=l}}h||(g+=1);b(f[0],g);for(d=0;d<c.length;d++)this.log(c[d].toString());a=new bd(h);a.qa(c);a.rh();return a};c.prototype.Jn=function(a){function b(a,c){var e={id:c.id,type:c.type()};d.push(e);a&&(e.parent=a.id);var g=c.dc(),f;for(f in g)g.hasOwnProperty(f)&&("matrix"===f?e[f]=g[f].Tb():"inverse"!==f&&(e[f]=g[f]));if(c.po()&&c.children)for(e=0;e<c.children.length;e++)b(c,c.children[e])}
var d=[],c={type:"document"},g=!1,f;for(f in a.aa)a.aa.hasOwnProperty(f)&&(c[f]=a.aa[f],g=!0);g&&d.push(c);b(null,a.getRootNode());return d};c.prototype.Lh=function(a,b,d){b in this.vm&&(b=this.vm[b]);if("list"===b)a=this.Jn(a),b="application/json";else if("zwibbler3"===b)a=this.Jn(a),a="zwibbler3."+JSON.stringify(a),b="application/octet-stream";else if("image/svg+xml"===b){var c=a.Gb();var g=new hd(c);a.Dd(g);a.ha(g);a=g;b="image/svg+xml"}else if("application/pdf"===b){c=a.Gb(0);g=new fd(new B(0,
0,c.width,c.height),Q.fonts);var f=a.Ra;for(b=0;b<a.Bc();b++)0<b&&(c=a.Gb(b),g.pg(c)),g.translate(-c.x,-c.y),a.Sb(b),a.Dd(g),a.ha(g);a.Sb(f);a=g;b="application/pdf"}else if(!(c="image/png"===b||"image/bmp"===b)&&(c="image/jpeg"==b)&&(c=document.createElement("canvas"),g=!1,c.width=10,c.height=10,"toDataURL"in c&&(g=0<c.toDataURL("image/jpeg").indexOf("jpeg")),pb("JPEG supported: %s",g),c=g),c)g=document.createElement("canvas"),c=a.Gb(),g.width=c.width,g.height=c.height,f=g.getContext("2d"),f.translate(-c.x,
-c.y),a.Dd(f),a.ha(f),a="image/bmp"===b?Cb(g):g.toDataURL(b),a=a.split(",")[1],a=atob(a);else throw"Unknown save format: "+b;if("string"===typeof a)if("string"===d)var h=a;else if("data-uri"===d)h="data:"+b+";base64,"+qa(a);else{if("blob"===d)for(d=new Uint8Array(a.length),b=0;b<a.length;b++)d[b]=a.charCodeAt(b)}else if(a.toBlob&&a.toString)"string"===d?h=a.toString():"data-uri"===d?h="data:"+b+";base64,"+qa(a.toString()):"blob"===d&&(h=a.toBlob());else if("object"===d)h=a;else throw"Error in ZwibblerDocument.save()";
return h};return c}());var jd=function(){function c(a,b,d){void 0===d&&(d=!1);var c=this;this.ta=a;this.Cv=d;this.hl=0;this.dl={};this.mb=!1;this.timeout=null;this.lines=[];this.filter=null;this.Lq="#5da700 #ed81ff #02ab34 #f92798 #59ff91 #ff6b80 #3cffe4 #ffd32b #5e8caa #ffdb7f #e5cdff #00c17e #f6f6f5 #9a861e #daff9d #808d40".split(" ");this.Mq="#2f361e #6b35c2 #416323 #431b77 #af2f21 #5451ad #805221 #962e7f #456354 #a52e4f #273c4c #692d25 #455b8a #3f1a2a #382454 #774f63".split(" ");this.lk=[];jb('\n\n.z-inner-debug.black {\n    background: #000;\n}\n\n.z-inner-debug.white {\n    background: #fff;\n}\n\n.z-debug-panel {\n    font-family: "monospace";\n    font-size: 12px;\n    display: flex;\n    flex-flow: column nowrap;\n}\n\n.z-inner-debug {\n    flex: 1 1 auto;\n    overflow: scroll;\n}\n\n.z-inner-debug.black div {\n    border-bottom: 1px solid #222;\n    margin-bottom: 3px;\n}\n\n.z-inner-debug.white div {\n    border-bottom: 1px solid #eee;\n    margin-bottom: 3px;\n}\n');
a.classList.add("z-debug-panel");var g=0;y("input").rj({type:"text",placeholder:"regexp...",onclick:"this.select()"}).yd(a).addEventListener("input",function(a){g&&window.clearTimeout(g);g=setTimeout(function(){c.du(a.target.value);g=0},200)});this.Ec=y("div").He("z-inner-debug").yd(a).Aa;y("button").yd(this.ta).wh("Scroll to bottom/top").addEventListener("click",function(){c.Ec.scrollTop=c.kn()?0:c.Ec.scrollHeight});this.Ns=w.addListener(function(a,b){return c.an(a,b)});b.add(function(){w.removeListener(c.Ns)});
this.an("DEBUG","Debug window starting");y(this.Ec).He(d?"white":"black");this.lk=d?this.Mq:this.Lq}c.prototype.show=function(){this.ta.style.display="flex";this.mb=!0;this.Km();this.Ec.scrollTop=this.Ec.scrollHeight};c.prototype.ne=function(){this.ta.style.display="none";this.mb=!1};c.prototype.Mr=function(a){a in this.dl||(this.dl[a]=this.lk[this.hl],this.hl=(this.hl+1)%this.lk.length);return this.dl[a]};c.prototype.an=function(a,b){for(var d=this,c=0,g=b.split("\n");c<g.length;c++)this.lines.push({key:a,
line:g[c]});this.mb&&null===this.timeout&&(this.timeout=setTimeout(function(){d.timeout=null;d.Km()},100))};c.prototype.du=function(a){this.filter=2>a.length?null:new RegExp(a,"i");for(a=this.Ec.firstChild;a;){var b=a;1===b.nodeType&&"DIV"===b.tagName&&(!this.filter||this.filter.exec(b.textContent)?b.style.display="block":b.style.display="none");a=a.nextSibling}};c.prototype.kn=function(){return this.Ec.scrollTop>=this.Ec.scrollHeight-this.Ec.clientHeight};c.prototype.Km=function(){for(var a=this.kn(),
b=0,d=this.lines;b<d.length;b++){var c=d[b],g=this.Mr(c.key),f=document.createElement("div");f.style.color=g;c=c.key+": "+c.line;this.filter&&!this.filter.exec(c)&&(f.style.display="none");f.appendChild(document.createTextNode(c));this.Ec.appendChild(f)}a&&(this.Ec.scrollTop=this.Ec.scrollHeight);this.lines.length=0};return c}();var kd=function(){function c(){this.Kg=[];this.log=w.create("DESTRUCTOR")}c.prototype.add=function(a){this.Kg.push(a)};c.prototype.addEventListener=function(a,b,d){a.addEventListener(b,d);this.add(function(){a.removeEventListener(b,d)})};c.prototype.Kc=function(){this.log("Running %s destructors",this.Kg.length);for(var a=this.Kg.length-1;0<=a;a--)this.Kg[a]();this.Kg.length=0};return c}();var ld=function(c){function a(){var a=c.call(this)||this;a.keys={};a.ih=!0;a.tu=new RegExp("alt backspace cmd command control ctrl del delete down end enter esc escape f4 home ins insert left meta pagedown pageup right shift up \u2318".split(" ").sort(function(a,b){return b.length-a.length}).join("|"),"g");a.log=w.create("KEYMAP");a.co=function(b){a.ys(b)};return a}n(a,c);a.prototype.map=function(a,d,c){void 0===c&&(c=!0);a=a.toLowerCase().split(",");var b;if("string"===typeof d)for(d=d.split(","),
b=0;b<a.length;b++)for(var e=0;e<d.length;e++)this.Lm(a[b],d[e],!c);else for(b=0;b<a.length;b++)this.Lm(a[b],d,!c)};a.prototype.Lm=function(a,d,c){if(0!==a.length){var b=a.match(this.tu)||[],e=!1,h=!1,l=!1,k=!1,m=[],q;for(q=0;q<b.length;q++)switch(b[q]){case "alt":l=!0;break;case "control":case "ctrl":h=!0;break;case "shift":e=!0;break;case "home":m.push(36);break;case "end":m.push(35);break;case "pageup":m.push(33);break;case "pagedown":m.push(34);break;case "delete":case "del":m.push(46);break;
case "backspace":m.push(8);break;case "up":m.push(38);break;case "right":m.push(39);break;case "down":m.push(40);break;case "left":m.push(37);break;case "escape":case "esc":m.push(27);break;case "enter":m.push(13);break;case "ins":case "insert":m.push(45);break;case "f4":m.push(115);break;case "meta":case "command":case "cmd":case "\u2318":k=!0;break;default:alert("key entry not found: "+b[q])}var p=this;b=function(a){e&&-1===a.indexOf("-shift")&&(a+="-shift");h&&-1===a.indexOf("-control")&&(a+="-control");
l&&-1===a.indexOf("-alt")&&(a+="-alt");k&&-1===a.indexOf("-meta")&&(a+="-meta");"string"===typeof d?p.log("%sKeyboard mapping: %s->%s",c?"Remove ":"",a,d):p.log("%sKeyboard mapping: %s->%s",c?"Remove ":"",a,"function()");if(c){if(a in p.keys){for(var b=[],g=0,f=p.keys[a];g<f.length;g++){var m=f[g];m!==d&&b.push(m)}p.keys[a]=b}}else if(a in p.keys){g=p.keys[a];for(b=0;b<g.length&&g[b]!==d;b++);b===g.length&&p.keys[a].push(d)}else p.keys[a]=[d]};if(0===m.length)switch(a=a.toUpperCase().charAt(a.length-
1),a){case "=":b("107-shift");b("187");b("61");break;case "+":b("107");b("61-shift");break;case "-":b("109");b("189");b("173");break;default:m.push(a.charCodeAt(0))}for(q=0;q<m.length;q++)b(""+m[q])}};a.prototype.$r=function(a){var b="";a.keyCode&&(b+=a.keyCode);a.shiftKey&&(b+="-shift");a.ctrlKey&&(b+="-control");a.altKey&&(b+="-alt");a.metaKey&&(b+="-meta");return b};a.prototype.translate=function(a){var b=[];a=this.$r(a);a in this.keys&&(b=this.keys[a]);this.log("%s",a);return b};a.prototype.ys=
function(a){for(var b=0,c=this.translate(a);b<c.length;b++){var g=c[b];"string"===typeof g?(this.log("action: %s",g),this.Re("*",g,a)):g(a)}};a.prototype.tq=function(a){a.addEventListener("keydown",this.co)};a.prototype.detach=function(a){a.removeEventListener("keydown",this.co)};return a}(Sc);var md=new (function(){function c(){this.Fk={}}c.prototype.Yh=function(){if("localStorage"in window)try{var a=window.localStorage}catch(b){}return void 0!==a};c.prototype.setItem=function(a,b){this.Yh()?window.localStorage.setItem(a,b):this.Fk[a]=""+b};c.prototype.getItem=function(a){return this.Yh()?window.localStorage.getItem(a):this.Fk[a]};c.prototype.removeItem=function(a){this.Yh()?window.localStorage.removeItem(a):delete this.Fk[a]};return c}());function nd(c){function a(a){b&&clearTimeout(b);b=setTimeout(function(){b=null;c()},arguments.length?a:1E3)}var b=null;a.cancel=function(){b&&(clearTimeout(b),b=null)};return a};var pd=function(){function c(a,b,d,c,g,f,h){this.view=a;this.node=b;this.handle=d;this.qf=f;this.Zc=this.Yc=0;this.log=w.create("MoveEditNode");this.Oo=b.Ci(d);this.Na=b.ja("snap")||0;this.wb(c,g,h)}c.prototype.Mc=function(){this.log("Entering MoveEditNode")};c.prototype.Fc=function(){this.log("Leaving MoveEditNode")};c.prototype.wb=function(a,b){var d=this.view.Na(new z(a,b),this.Na);a=d.x;b=d.y;this.log("onMouseDown(%s,%s)",a,b);this.Yc=a;this.Zc=b;return!0};c.prototype.Hb=function(a,b){var d=this.view.Na(new z(a,
b),this.Na);a=d.x;b=d.y;this.node.af(this.handle,a,b);this.node.format(this.view.ia,this.view.request);this.view.ha();return!1};c.prototype.Ob=function(a,b){var d=this.view.Na(new z(a,b),this.Na);a=d.x;b=d.y;this.log("onMouseUp(%s,%s)",a,b,this.Yc,this.Zc);a!==this.Yc||b!==this.Zc?this.view.qa([new Ic(this.node.id,this.handle,this.Oo.x,this.Oo.y,a,b)]):this.view.Tt(this.node.id,this.handle);this.view.ha();this.view.$a(this.qf||new od(this.view));return!0};return c}();var qd=function(){function c(a,b,d,c){this.view=a;this.qf=b;this.Ga=this.Fa=0;this.Va=!1;this.log=w.create("SELECT");this.Lo(d,c)}c.prototype.ib=function(a){this.log("Gesture detected; aborting select box.");this.view.$a(this.qf);return this.qf.ib?this.qf.ib(a):!1};c.prototype.wb=function(a,b){return this.Lo(a,b)};c.prototype.Lo=function(a,b){this.Fa=a;this.Ga=b;return this.Va=!0};c.prototype.Hb=function(a,b){if(this.Va){var d=this;this.view.ha(function(c){c.save();c.strokeStyle="#0050B7";c.lineWidth=
2/d.view.scale;c.fillStyle="rgba(0, 80, 183, 0.2)";var e=new B(d.Fa+.5,d.Ga+.5,a-d.Fa,b-d.Ga);c.fillRect(e.x,e.y,e.width,e.height);c.strokeRect(e.x,e.y,e.width,e.height);c.restore()});return!0}return!1};c.prototype.Ob=function(a,b){this.Va=!1;this.view.ob();this.view.St(new B(this.Fa,this.Ga,a-this.Fa,b-this.Ga));this.view.Mb();this.view.ha();this.view.$a(this.qf);return!0};return c}();var rd={type:"translate",position:new z(0,0),offset:new z(0,0),$e:""},sd={type:"translate",position:new z(0,0),offset:new z(0,0),$e:""},td={type:"translate",position:new z(0,0),offset:new z(0,0),$e:""},ud=function(){function c(a,b,d){this.xe=a;this.pa=b;this.Ka=d}c.prototype.Ki=function(a,b){void 0===a&&(a=this.pa);void 0===b&&(b=1);var d=a.ec();return new z(this.Ka.x+this.Ka.width*this.xe.position.x+this.xe.offset.x/d.x/b,this.Ka.y+this.Ka.height*this.xe.position.y+this.xe.offset.y/d.y/b)};c.prototype.Hi=
function(){var a=this.Ki();return this.pa.apply(a.x,a.y)};c.prototype.ha=function(a,b,d,c){a.save();c=c.multiply(this.pa);var e=c.ec();e.x=1/e.x/d;e.y=1/e.y/d;d=this.Ki(c,d);c=c.multiply(new Kb(e.x,e.y,d.x,d.y));c.Df(a);(b=b.get(this.xe.$e))?(c=b.width,e=b.height,a.drawImage(b,d.x-c/2,d.y-e/2,c,e)):this.Ak(a,d);a.restore()};c.prototype.Ak=function(a,b){a.strokeStyle="red";a.lineWidth=1;a.strokeRect(b.x-10,b.y-10,20,20)};c.prototype.qb=function(a,b,d,c,g){var e=a.get(this.xe.$e);a=this.Ki(this.pa,
g);b=this.pa.inverse().apply(b,d);d=this.pa.ec();d.x*=g;d.y*=g;e?(c=e.height,g=e.width/2/d.x,c=c/2/d.y):(g=c/d.x,c/=d.y);return(new B(a.x-g,a.y-c,2*g,2*c)).fd(b.x,b.y,0)};c.prototype.click=function(){return!1};return c}(),vd=function(c){function a(a,d,e,g){a=c.call(this,a,d,e)||this;a.origin=g;return a}n(a,c);a.prototype.Wf=function(a){var b=1,c=1,g=this.pa.inverse(),f=this.Hi(),h=this.Ki();a=g.apply(f.x+a.x,f.y+a.y);h=new z(h.x-this.origin.x,h.y-this.origin.y);a=new z(a.x-this.origin.x,a.y-this.origin.y);
a=(a.x*h.x+a.y*h.y)/(h.x*h.x+h.y*h.y);0!==h.x&&0!==h.y?c=b=a:0!==h.x?b=a:c=a;return this.pa.multiply(new Kb(b,c,this.origin.x,this.origin.y)).multiply(g)};a.prototype.Ak=function(a,d){a.beginPath();a.strokeStyle="#000";a.lineWidth=1;a.rect(d.x-4,d.y-4,8,8);a.stroke()};return a}(ud),wd=function(c){function a(a,d,e,g,f){a=c.call(this,a,d,e)||this;a.di=f;a.log=w.create("RotationSelHandle");d=a.Hi();a.origin=a.pa.apply(g.x,g.y);a.Ul=Math.atan2(d.y-a.origin.y,d.x-a.origin.x);a.di=f;return a}n(a,c);a.prototype.Wf=
function(a){var b=this.Hi();a=Math.atan2(b.y+a.y-this.origin.y,b.x+a.x-this.origin.x)-this.Ul;this.di&&(b=Math.PI/16,a=Math.floor(a/b)*b);return new Jb(-a,this.origin.x,this.origin.y)};a.prototype.Ak=function(a,d){a.beginPath();a.strokeStyle="#008000";a.lineWidth=3;a.moveTo(d.x,d.y);a.arc(d.x,d.y,6,0,1.5*Math.PI,!1);a.stroke()};return a}(ud),xd=function(c){function a(a,d){return c.call(this,a,d,new B(0,0,0,0))||this}n(a,c);a.prototype.Wf=function(a){return new E(a.x,a.y)};return a}(ud),yd=function(c){function a(){return c.call(this,
td,new F,new B(0,0,0,0))||this}n(a,c);a.prototype.Wf=function(){return new F};return a}(ud),zd=function(c){function a(a,d,e){return c.call(this,a,d,e)||this}n(a,c);a.prototype.click=function(){this.xe.tn&&this.xe.tn();return!0};a.prototype.Wf=function(){return new F};return a}(ud);
function Ad(c,a,b,d){var e=void 0,g=new z(0,0),f=b.ec();g.x=a.x+a.width*c.position.x+c.offset.x/f.x;g.y=a.y+a.height*c.position.y+c.offset.y/f.y;switch(c.type){case "translate":return new xd(c,b);case "scale":return e||(e=new z(a.right()-c.position.x*a.width,a.bottom()-c.position.y*a.height)),new vd(c,b,a,e);case "rotate":return e||(e=a.ed()),new wd(c,b,a,e,d||!1);case "click":return new zd(c,b,a)}};function Bd(c){for(var a=[],b=0;b<c.length;b++)a.push(c[b].id);return a}
var Cd=function(){function c(a,b,d,c,g){this.view=a;this.handle=b;this.zu=d;new B(0,0,0,0);this.ua=[];this.Zf=[];this.Ab=new z(0,0);this.log=w.create("TransformSelectionBehaviour");this.Ni=!1;this.Na=0;this.wb(c,g)}c.prototype.ib=function(a){if("gesturestart"!==a.type&&"gesturechange"!==a.type&&"gestureend"!==a.type)return!1;this.log("%s scale=%s rotation=%s",a.type,a.scale,a.rotation);this.Ni=!0;var b=this.view.sh(a.pageX,a.pageY,!0),d=b.x;b=b.y;"gesturestart"===a.type&&(this.Ab.x=d,this.Ab.y=b);
d-=this.Ab.x;b-=this.Ab.y;var c=a.scale,g=a.rotation;this.view.th||(c=1);this.view.ig||(g=0);g=-g/180*Math.PI;if(0<this.view.fa.get("snap")){var f=Math.PI/16;g=Math.floor(g/f)*f}c=new Kb(c,c,this.Ab.x,this.Ab.y);g=new Jb(g,this.Ab.x,this.Ab.y);d=(new E(d,b)).multiply(c).multiply(g);for(b=0;b<this.ua.length;b++)this.ua[b].lg(d.multiply(this.Zf[b])),this.ua[b].format(this.view.ia,this.view.request);this.view.Cj(d);this.view.ha();if("gestureend"===a.type){for(b=0;b<this.ua.length;b++)this.ua[b].lg(this.Zf[b]);
this.view.qa([new Hc(Bd(this.ua),d)]);this.In()}return!0};c.prototype.wb=function(a,b){if(this.Ni)return!0;this.ua=this.view.Cc();this.pr(this.ua);this.Ab=this.view.Na(new z(a,b),this.Na);this.log("onMouseDown(%s,%s)",this.Ab.x,this.Ab.y);new B(this.view.Uc.x,this.view.Uc.y,this.view.Uc.width,this.view.Uc.height);return!0};c.prototype.pr=function(a){this.Zf=[];for(var b=0;b<a.length;b++)this.Zf.push(a[b].Ha()),this.Na=this.Na||a[b].ja("snap")};c.prototype.Hb=function(a,b){if(this.Ni)return!0;var d=
this;var c=this.view.Na(new z(a,b),this.Na);var g=c.x;var f=c.y;for(var h=this.handle.Wf(new z(c.x-this.Ab.x,c.y-this.Ab.y)),l=0;l<this.ua.length;l++)c=h.multiply(this.Zf[l]),this.ua[l].lg(c),this.ua[l].format(this.view.ia,this.view.request);this.view.Cj(h);this.view.ha(function(){if(d.handle instanceof wd){var a=d.view.ia;a.save();a.beginPath();a.strokeStyle="#0050B7";a.lineWidth=1/d.view.scale;a.moveTo(d.handle.origin.x,d.handle.origin.y);a.lineTo(g,f);a.stroke();a.restore()}});return!0};c.prototype.Ob=
function(a,b){if(this.Ni)return!0;var d=a,c=b,g=this.view.Na(new z(a,b),this.Na);a=g.x;b=g.y;this.log("onMouseUp(%s,%s)",a,b);if(g.Ed(this.Ab))this.zu?(d=this.view.ea.qb(d,c,this.view.Qa))&&d.Zg()?(this.log("Didn't move, and has edit mode. Selecting node %s",d.id),this.view.ob(),this.view.yf(d)):this.log("Didn't move, but node has no edit mode or failed hittest"):this.log("Didn't move, but toggleEditNode=false");else{this.log("Moved by %s,%s",a-this.Ab.x,b-this.Ab.y);d=this.handle.Wf(new z(g.x-this.Ab.x,
g.y-this.Ab.y));for(c=0;c<this.ua.length;c++)this.ua[c].lg(this.Zf[c]);this.view.qa([new Hc(Bd(this.ua),d)])}this.In();return!0};c.prototype.In=function(){this.view.Cj(new F);this.view.Pf();this.view.update(!0);this.view.Za()};return c}();var Dd=function(){function c(a,b){this.view=a;this.aa=b;this.ti=!1;this.ya=this.le=this.ka=null;this.fillStyle="#000000";this.zj=!1;this.va=new kd;this.Yl="normal";this.log=w.create("Text");this.multiline=a.fa.get("multilineText");this.pb=document.createElement("div");a.fa.get("iPadNoScrollText")&&null!==navigator.userAgent.match(/iPad|iPhone|Android/i)&&(this.Yl="top")}c.prototype.Mc=function(){this.log("Entering text mode");this.view.canvas.style.cursor="text"};c.prototype.Fc=function(){this.ti&&
this.hi();this.view.canvas.style.cursor="default";this.log("Leaving text mode");this.ka&&this.ka.parentNode&&this.ka.parentNode.removeChild(this.ka);this.ka=null;this.pb.parentNode&&this.pb.parentNode.removeChild(this.pb);this.va.Kc()};c.prototype.wb=function(a,b,d){this.log("onMouseDown(%s)",d.type);this.ti?(this.log("Editing somewhere else on mousedown; submit that first."),this.hi(),this.view.fa.get("autoPickToolText")&&this.view.Za()):(d=this.view.ea.qb(a,b,this.view.Qa),this.Wl(d,a,b));this.log("Eating click");
this.view.si=!0;return!1};c.prototype.nr=function(){if(this.pb&&this.ka){this.pb.style.fontSize=this.ka.style.fontSize;this.pb.style.fontFamily=this.ka.style.fontFamily;this.pb.style.fontWeight=this.ka.style.fontWeight;this.pb.style.fontStyle=this.ka.style.fontStyle;this.pb.style.whiteSpace="pre-line";this.pb.style.position="absolute";this.pb.style.visibility="hidden";this.pb.style.backgroundColor="rgba(0,0,0,0.2)";document.body.appendChild(this.pb);this.pb.style.left="0";for(this.pb.style.top="0";this.pb.firstChild;)this.pb.removeChild(this.pb.firstChild);
this.pb.appendChild(document.createTextNode(this.ka.value));var a=this.pb.clientWidth,b=this.ka.clientWidth;b<a&&(b=a,this.view.fa.get("multilineText")&&b>500*this.view.scale&&(b=500*this.view.scale),this.ka.style.width=b+2+"px")}};c.prototype.Wl=function(a,b,d){function c(){p.ka&&(p.log("Set editBox height to %s",""+p.ka.scrollHeight+"px"),p.ka.style.height=""+p.ka.scrollHeight+"px",p.ka.style.width=""+p.ka.scrollWidth+"px");r=null}function g(){null===p.ya&&p.nr()}var f=0;this.zj=!1;if(a&&"TextNode"===
a.type()||a&&"PathNode"===a.type()&&this.view.fa.get("allowTextInShape")||a&&a.$g()){this.ya=a;"top"!==this.Yl&&"TextNode"===a.type()&&this.ya.Vd(!0);this.view.ha();this.le=new z(a.rect.x,a.rect.y);if(f=a.ja("font")){f=cc(f);var h=f.fontFamily||"arial";var l=parseFloat(f.fontSize)||10;var k="bold"===f.fontWeight;var m="italic"===f.fontStyle}else h=a.ja("fontName"),l=a.ja("fontSize"),k=a.ja("bold"),m=a.ja("italic");var q=a.ja("textDecoration");f=a.rect.width*this.view.scale;f=Math.max(f,200);this.fillStyle=
a.ja("textFillStyle")||this.La("textFillStyle")}else this.ya=null,this.le=new z(b,d),h=this.La("fontName"),l=this.La("fontSize"),k=this.La("bold"),m=this.La("italic"),q=this.La("textDecoration"),this.fillStyle=this.aa.fillStyle||this.La("textFillStyle")||this.La("fillStyle"),this.La("wrap")&&(d-=l);var p=this;this.ka=document.createElement("textarea");a=this.ka.clientHeight;this.ka.style.width=f?""+f+"px":"auto";f=this.view.wk(this.le.x,this.le.y);this.ka.style.position="absolute";this.ka.style.fontFamily=
h;this.ka.style.fontSize=""+l*this.view.scale+"px";this.ka.style.overflow="auto";this.ka.style.fontWeight=k?"bold":"normal";this.ka.style.fontStyle=m?"italic":"normal";this.ka.style.padding="0";this.ka.style.border="1px solid #888";this.ka.style.color=this.fillStyle;this.ka.style.backgroundColor=this.La("background");this.ya&&"PathNode"===this.ya.type()&&(this.ka.style.backgroundColor="white");this.ka.style.textDecoration=q||"none";this.ka.style.textAlign=this.La("textAlign");this.ka.style.zIndex=
""+(this.view.od()+1);this.log("Using z-index %s",this.ka.style.zIndex);"#ffffff"===u.Fd(this.fillStyle).toString()&&(this.ka.style.backgroundColor="#808080");h=this.view.canvas.parentElement;l=y(h).pc();m=k=0;"top"===this.Yl?(m=y(this.view.canvas).pc(),k=this.view.canvas.clientWidth,f=this.ka.clientWidth,k=m.left+k/2-f/2,m=m.top):(k=Math.round(f.x)-1,m=Math.round(f.y)-1);this.ka.style.WebkitTransitionDuration="0";this.ka.style.MozTransitionDuration="0";this.ka.style.msTransitionDuration="0";this.ka.style.OTransitionDuration=
"0";this.ka.style.transitionDuration="0";this.ka.style.left=k-l.left+"px";this.ka.style.top=m-l.top+"px";h.appendChild(this.ka);Bb(this.ka);this.ti=!0;this.le=new z(b,d+a);this.ya&&(this.ka.value=this.ya.ja("text"));var r=null;r=setTimeout(c,0);this.va.addEventListener(this.ka,"keydown",function(a){"keydown"===a.type&&(27===a.keyCode&&p.multiline||13===a.keyCode&&(a.shiftKey||!p.multiline)?(p.log("Enter pressed. create text."),p.hi(),p.view.Ea.mb&&p.view.ou(),p.view.fa.get("autoPickToolText")&&p.view.Za()):
27===a.keyCode?(p.log("ESC pressed; cancel."),p.cancel(),p.view.Za(),p.view.cc.ma("goto-toolbar")):13===a.keyCode&&(r||(r=setTimeout(c,0))))});this.va.addEventListener(this.ka,"input",g);this.va.addEventListener(this.ka,"propertychange",g);this.view.fa.get("leaveTextToolOnBlur")&&(this.va.addEventListener(this.ka,"focus",function(){p.log("Text focus received.")}),this.va.addEventListener(this.ka,"blur",function(){p.ka&&!p.ka.zl&&(p.log("Text blur received -- removing=%s",!0===p.ka.zl),p.ka.zl=!0,
p.hi())}));setTimeout(function(){p.ka&&p.ka.focus()},200);this.ka.focus();this.view.Ba.ma("edit-text-shown",p.ka)};c.prototype.cancel=function(){this.ka&&(this.ka.zl=!0,this.ka.parentNode&&this.ka.parentNode.removeChild(this.ka),this.view.Ba.ma("edit-text-hidden"),this.view.Ea.mb&&this.view.cc.ma("goto-canvas"));this.ka=null;this.ti=!1;this.ya&&(this.ya.Vd(!1),this.view.ha())};c.prototype.La=function(a){if(this.ya){var b=this.ya.ja(a);if(b)return b}return a in this.aa?this.aa[a]:"background"===a?
this.view.fa.get("defaultTextBackground"):"wrap"===a?this.view.fa.get("multilineText"):this.view.za[a]};c.prototype.Ji=function(){return{textFillStyle:this.La("textFillStyle"),fillStyle:this.La("textFillStyle"),bold:this.La("bold"),italic:this.La("italic"),textDecoration:this.La("textDecoration"),strokeStyle:this.La("strokeStyle"),lineWidth:this.La("lineWidth"),fontName:this.La("fontName"),fontSize:this.La("fontSize"),textAlign:this.La("textAlign")}};c.prototype.hi=function(){if(this.ka){var a=this.ka.value;
this.cancel();if(this.ya&&this.ya.ja("text")===a&&!this.zj)this.log("Text was not changed.");else if(null===this.ya&&""===a)this.log("No text entered.");else if(this.ya)this.log("Update text in node %s",this.ya.id),a=[new Gc([this.ya.id],"text",a),new Gc([this.ya.id],"textFillStyle",this.fillStyle),new Gc([this.ya.id],"textAlign",this.La("textAlign")),new Gc([this.ya.id],"textDecoration",this.La("textDecoration"))],"bold"in this.aa&&a.push(new Gc([this.ya.id],"bold",this.aa.bold)),"italic"in this.aa&&
a.push(new Gc([this.ya.id],"italic",this.aa.bold)),this.view.qa(a);else if(this.le){this.log("Create new text node.");var b=this.view.ea.lb,d=0,c=this.La("fontSize");this.view.fa.get("multilineText")||(d=c);d=new E(this.le.x,this.le.y+d);this.view.qa([new U(this.view.ea.Wa(),"TextNode",Eb({text:a,background:this.La("background"),fontSize:c,fontName:this.La("fontName"),bold:this.La("bold"),italic:this.La("italic"),textAlign:this.La("textAlign"),textFillStyle:this.La("textFillStyle"),textDecoration:this.La("textDecoration"),
strokeStyle:this.La("textStrokeStyle"),lineWidth:this.La("textLineWidth"),layer:this.aa.layer||this.view.Qa,wrap:this.view.fa.get("multilineText")},this.aa)),new Hc([b],d)])}}};c.prototype.Hb=function(){return!1};c.prototype.Rc=function(a){this.log("keyboard: %s",a);"cancel"===a&&null===this.ka&&(this.view.Za(),this.view.cc.ma("goto-toolbar"))};c.prototype.qe=function(a){this.log("Set text colour to %s",a);this.zj=!0;this.fillStyle=a;this.aa.textFillStyle=a;this.ka&&(this.ka.style.color=a,"#ffffff"===
u.Fd(a).toString()?this.ka.style.backgroundColor="#808080":this.ka.style.backgroundColor="#ffffff")};c.prototype.re=function(a,b){this.view.Nl(a,b)};c.prototype.Pd=function(a,b){"defaultBold"===a?(a="bold",this.ka&&(this.ka.style.fontWeight=b?"bold":"normal")):"defaultItalic"===a?(a="italic",this.ka&&(this.ka.style.fontStyle=b?"italic":"normal")):"defaultTextBackground"===a?(a="background",this.ka&&(this.ka.style.backgroundColor=b)):"defaultFont"===a?(a="fontName",this.ka&&(this.ka.style.fontFamily=
b)):"defaultFontSize"===a?(a="fontSize",this.ka&&(this.ka.style.fontSize=b+"px")):"defaultTextFillStyle"===a?(a="textFillStyle",this.ka&&(this.ka.style.color=b)):"defaultTextDecoration"===a?(a="textDecoration",this.ka&&(this.ka.style.textDecoration=b)):"defaultTextAlign"===a&&(a="textAlign",this.ka&&(this.ka.style.textAlign=b));this.log("Update %s=%s",a,b);this.zj=!0;this.aa[a]=b};c.prototype.rc=function(){return"text"};c.prototype.sd=function(a,b){this.aa[a]=b;"fillStyle"===a&&(this.aa.textFillStyle=
b);if(this.ka)switch(a){case "textFillStyle":case "fillStyle":this.ka.style.color=b}};return c}();var Ed=function(){function c(a){this.view=a;this.start=new z(0,0);this.Vl=new z(0,0);this.active=!1;this.rect=null;this.log=w.create("PanZoomMixin")}c.prototype.ib=function(a){this.log("onGesture(%s)",a.type);if(!this.view.fa.get("allowZoom"))return!1;if("gesturestart"===a.type)this.start=new z(a.pageX,a.pageY),this.Vl=this.view.sh(a.pageX,a.pageY),this.rect=this.view.Jd(),this.active=!0;else if("gesturechange"===a.type&&this.rect){var b=a.pageX-this.start.x,d=a.pageY-this.start.y;a=this.view.fa.Dl(1/
a.scale);a=new Kb(a,a,this.Vl.x,this.Vl.y);a=(new E(-b/this.view.scale,-d/this.view.scale)).multiply(a);b=this.rect.clone();b.transform(a);this.view.og(b)}else"gestureend"===a.type&&(this.active=!1);return!0};return c}();var od=function(){function c(a){this.view=a;this.ep=1;this.log=w.create("DefaultBehaviour");this.view.sj("");if(this.sg=this.view.fa.sg())this.ep=2;this.fc=new Ed(a)}c.prototype.Mc=function(){this.log("Entering pick tool.");this.view.canvas.style.cursor="default"};c.prototype.Fc=function(){this.log("Leaving pick tool.")};c.prototype.ib=function(a){return this.fc.ib(a)};c.prototype.wb=function(a,b,d){var c,g;this.log("onMouseDown");if(d.button)return this.log("   -- not main button. ignore."),!1;if(this.view.fa.get("readOnly"))return(c=
this.view.ea.qb(a,b,this.view.Qa))?(this.log("layer=%s active=%s",c.Ac(),this.view.Qa),this.view.Ba.ma("node-clicked",c.id,a,b)):this.log("readOnly mode: Ignoring click."),!1;if(g=this.view.Xr(a,b)){if(g.click())return this.view.Ba.digest(),!0;this.view.$a(new Cd(this.view,g,!1,a,b));return!0}this.view.selection.length&&this.view.Is(d)&&this.view.Jg();if(this.view.ya&&(c=this.view.ya,g=c.Oi(a,b,1/this.view.scale*this.ep),null!==g))return this.view.$a(new pd(this.view,c,g,a,b,this,d)),!0;if(c=this.view.ea.qb(a,
b,this.view.Qa))this.log("layer=%s active=%s",c.Ac(),this.view.Qa),this.view.Ba.ma("node-clicked",c.id,a,b);if(c&&c.Ac()===this.view.Qa){g=c===this.view.ya;var f=this.view.Hs(c);this.log("wasEditNode: %s, wasSelected: %s",g,f);f||(d.shiftKey||this.view.ob(),this.view.de(c),this.view.Mb());this.view.$a(new Cd(this.view,this.view.hg?new xd(rd,c.Ha()):new yd,!g&&f,a,b))}else if(this.view.So(a,b))this.view.$a(new Cd(this.view,this.view.hg?new xd(rd,this.view.selection[0].Ha()):new yd,!0,a,b));else if(this.view.fa.Hr())this.view.yf(null),
this.view.$a(new qd(this.view,this,a,b));else return this.log("Disabled select box -- mobile touch active."),this.view.yf(null),this.view.ob(),this.view.Mb(),this.view.ha(),!1;return!0};c.prototype.Ob=function(){this.log("onMouseUp");return!1};c.prototype.Rc=function(a,b){this.log("keyboard: %s on target %s",a,b.target.tagName);if("INPUT"!==b.target.tagName){var d=!0,c=this.view.fa.get("nudge");b&&b.ctrlKey&&(c=this.view.fa.get("preciseNudge"));var g=this.view.Ea.mb;switch(a){case "bring-to-front":this.view.Zh();
break;case "send-to-back":this.view.pj();break;case "left":g||this.view.$i(-1,0,c)||(this.view.sb=Math.min(this.view.sb+16,0),this.view.mc(),this.view.ha());break;case "right":g||this.view.$i(1,0,c)||(c=this.view.Je.width,this.view.sb=Math.max(-(c*this.view.scale-c),this.view.sb-16),this.view.mc(),this.view.ha());break;case "up":g||this.view.$i(0,-1,c)||(this.view.fb=Math.min(this.view.fb+16,0),this.view.mc(),this.view.ha());break;case "down":g||this.view.$i(0,1,c)||(c=this.view.Je.height,this.view.fb=
Math.max(-(c*this.view.scale-c),this.view.fb-16),this.view.mc(),this.view.ha());break;case "select-none":this.view.ob();this.view.Mb();this.view.ha();g&&this.view.cc.ma("goto-toolbar");break;case "select-all":var f=[];this.view.ea.Lc(function(a){f.push(a)});this.view.selectNodes(f);this.view.ha();g&&this.view.cc.ma("goto-toolbar");break;case "duplicate":this.view.duplicate();break;case "move-up":this.view.Zi();break;case "move-down":this.view.Yi();break;case "delete":this.view.Jg();break;case "curve-tool":this.view.yn({});
break;case "line-tool":this.view.vo({},!1,!1);break;case "group":this.view.group();break;case "ungroup":this.view.Dh();break;case "undo":this.view.gb();break;case "redo":this.view.Sd();break;case "cut":this.view.rk();break;case "copy":this.view.Oe();break;case "paste":this.view.nh();break;case "zoom-normal":this.view.fa.get("allowZoom")?this.view.Xc(1):this.log("Zooming is disabled.");break;case "zoom-in":this.view.fa.get("allowZoom")?this.view.Hj():this.log("Zooming is disabled.");break;case "zoom-out":this.view.fa.get("allowZoom")?
this.view.Ij():this.log("Zooming is disabled.");break;default:d=!1}d&&(b.preventDefault(),b.stopPropagation())}};c.prototype.qe=function(a,b){if(b){this.view.xb=a;this.view.Vb=a;var d="fillStyle"}else this.view.Kb=a,d="strokeStyle";this.view.setProperty(d,a)};c.prototype.re=function(a,b){b?(this.view.xb=yb(this.view.xb,a),this.view.Vb=yb(this.view.Vb,a)):this.view.Kb=yb(this.view.Kb,a);this.view.Nl(a,b)};c.prototype.nl=function(a,b){this.log("onDoubleClick");var d=this.view.ea.qb(a,b,this.view.Qa);
this.log("hittest: %s, hasText: %s",null!==d,null!==d&&d.$g());this.view.Ba.ma("double-click",a,b,d?d.id:null);if(d&&"PathNode"===d.type()&&!this.view.fa.get("allowTextInShape"))this.log("Editing text in shape is disabled.");else if(d&&d.$g()&&!this.view.fa.get("readOnly"))this.log("Text double-clicked."),this.view.Zl({}),this.view.oa instanceof Dd&&this.view.oa.Wl(d,a,b);else return!1;return!0};c.prototype.rc=function(){return"pick"};return c}();var Fd=w.create("FitCurve");
function Gd(c){function a(a,b){N.bezierCurveTo(b[1].x,b[1].y,b[2].x,b[2].y,b[3].x,b[3].y);Fd("Bezier: (%s,%s), (%s,%s), (%s,%s), (%s,%s)",b[0].x,b[0].y,b[1].x,b[1].y,b[2].x,b[2].y,b[3].x,b[3].y)}function b(a,b){return a.x*b.x+a.y*b.y}function d(a){var b=1-a;return 3*a*b*b}function e(a){return 3*a*a*(1-a)}function g(a,b){var d=a.x-b.x,c=a.y-b.y;return Math.sqrt(d*d+c*c)}function f(a){return a.x*a.x+a.y*a.y}function h(a,b){var d=Math.sqrt(f(a));0!==d&&(a.x*=b/d,a.y*=b/d);return a}function l(a,b,d){void 0===
d&&Fd("Undef!");d.x=a.x+b.x;d.y=a.y+b.y;return d}function k(a,b){return{x:a.x+b.x,y:a.y+b.y}}function m(a,b){return{x:a.x*b,y:a.y*b}}function q(a,b){return{x:a.x-b.x,y:a.y-b.y}}function p(a,c,f,p,r,t){var v,L=[],G=[[],[]],x=[];var A=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}];var ca=f-c+1;for(v=0;v<ca;v++){var M={x:r.x,y:r.y};var I={x:t.x,y:t.y};h(M,d(p[v]));h(I,e(p[v]));L[v]=[M,I]}G[0][0]=0;G[0][1]=0;G[1][0]=0;G[1][1]=0;x[0]=0;for(v=x[1]=0;v<ca;v++)G[0][0]+=b(L[v][0],L[v][0]),G[0][1]+=b(L[v][0],L[v][1]),
G[1][0]=G[0][1],G[1][1]+=b(L[v][1],L[v][1]),M=1-p[v],I=p[v],M=q(a[c+v],k(m(a[c],M*M*M),k(m(a[c],d(p[v])),k(m(a[f],e(p[v])),m(a[f],I*I*I))))),x[0]+=b(L[v][0],M),x[1]+=b(L[v][1],M);p=G[0][0]*G[1][1]-G[1][0]*G[0][1];v=G[0][0]*x[1]-G[0][1]*x[0];x=x[0]*G[1][1]-x[1]*G[0][1];0===p&&(p=G[0][0]*G[1][1]*1E-11);G=x/p;x=v/p;if(0>G||0>x)return G=g(a[f],a[c])/3,A[0]=a[c],A[3]=a[f],l(A[0],h(r,G),A[1]),l(A[3],h(t,G),A[2]),A;A[0]=a[c];A[3]=a[f];l(A[0],h(r,G),A[1]);l(A[3],h(t,x),A[2]);return A}function r(a,b,d){var c;
var e=[];for(c=0;c<=a;c++)e[c]={x:b[c].x,y:b[c].y};for(c=1;c<=a;c++)for(b=0;b<=a-c;b++)e[b].x=(1-d)*e[b].x+d*e[b+1].x,e[b].y=(1-d)*e[b].y+d*e[b+1].y;return e[0]}function t(a){var b=Math.sqrt(Math.sqrt(f(a)));0!==b&&(a.x/=b,a.y/=b);return a}function v(a,b,d,c,e){var g,h=(d-b+1)/2;var l=0;for(g=b+1;g<d;g++){var k=r(3,c,e[g-b]);k=q(k,a[g]);k=f(k);k>=l&&(l=k,h=g)}return{Bo:l,up:h}}function A(b,d,c,e,f,k){var m;var L=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}];var G=k*k;if(2===c-d+1)k=g(b[c],b[d])/3,L[0]=
b[d],L[3]=b[c],l(L[0],h(e,k),L[1]),l(L[3],h(f,k),L[2]),a(3,L);else{var x=[0];for(m=d+1;m<=c;m++)x[m-d]=x[m-d-1]+g(b[m],b[m-1]);for(m=d+1;m<=c;m++)x[m-d]/=x[c-d];var N=x;L=p(b,d,c,N,e,f);m=v(b,d,c,L,N);x=m.Bo;m=m.up;if(x<k)a(3,L);else{if(x<G||I)for(G=0;4>G;G++){m=b;x=d;var M=c;var ca=L;var Ea=[];for(L=x;L<=M;L++){var kb=Ea,Ta=L-x,P,Ua=ca,lb=m[L],mb=N[L-x],ua=[];var Aa=[];var nb=r(3,Ua,mb);for(P=0;2>=P;P++)ua[P]={x:0,y:0},ua[P].x=3*(Ua[P+1].x-Ua[P].x),ua[P].y=3*(Ua[P+1].y-Ua[P].y);for(P=0;1>=P;P++)Aa[P]=
{x:0,y:0},Aa[P].x=2*(ua[P+1].x-ua[P].x),Aa[P].y=2*(ua[P+1].y-ua[P].y);P=r(2,ua,mb);Aa=r(1,Aa,mb);kb[Ta]=mb-((nb.x-lb.x)*P.x+(nb.y-lb.y)*P.y)/(P.x*P.x+P.y*P.y+(nb.x-lb.x)*Aa.x+(nb.y-lb.y)*Aa.y)}M=Ea;L=p(b,d,c,M,e,f);m=v(b,d,c,L,M);x=m.Bo;m=m.up;if(x<k||I){a(3,L);return}N=M}M={x:0,y:0};G=q(b[m-1],b[m]);x=q(b[m],b[m+1]);M.x=(G.x+x.x)/2;M.y=(G.y+x.y)/2;G=M=t(M);A(b,d,m,e,G,k);G.x=-G.x;G.y=-G.y;A(b,m,c,G,f,k)}}}var I=!0;void 0===I&&(I=!1);var N=new H;N.moveTo(c[0].x,c[0].y);(function(a,b,d){var c=q(a[1],
a[0]);c=t(c);var e=b-1;e=q(a[e-1],a[e]);e=t(e);A(a,0,b-1,c,e,d)})(c,c.length,25);return N};var Hd=function(){function c(a,b,d,c){var e=this;this.view=a;this.qf=b;this.options=d;this.mode=c;this.Va=!1;this.se=[];this.from=this.Gk=null;this.log=w.create("Brush");this.fc=new Ed(this.view);this.view.ob(!0);this.$o=function(){return e.df()}}c.prototype.df=function(){this.fl(this.md()/2)};c.prototype.Mc=function(){this.view.canvas.style.cursor="crosshair";this.fl(this.md()/2);window.addEventListener("resize",this.$o)};c.prototype.Fc=function(){this.view.canvas.style.cursor="default";this.view.ha();
window.removeEventListener("resize",this.$o)};c.prototype.reset=function(){this.Va=!1;this.se=[]};c.prototype.ib=function(a){a=this.fc.ib(a);this.Va&&this.fc.active&&this.reset();return a};c.prototype.fl=function(a){var b=document.createElement("canvas");a*=this.view.scale;a=Math.ceil(a+1);b.width=2*a+2;b.height=2*a+2;var d=b.getContext("2d");d.beginPath();"round"===(this.options.lineCap||"round")?d.arc(a+1,a+1,a,0,2*Math.PI):d.rect(1,1,2*a-2,2*a-2);d.lineWidth=2;d.strokeStyle="#ffffff";d.stroke();
d.lineWidth=1;d.strokeStyle="#000000";d.stroke();b=b.toDataURL();this.view.canvas.style.cursor="url("+b+") "+(a+1)+" "+(a+1)+", auto"};c.prototype.jg=function(a){this.options.strokeStyle=a};c.prototype.md=function(){var a=this.options.lineWidth;this.view.fa.get("adaptiveBrushWidth")&&(a/=this.view.scale);return a};c.prototype.tj=function(a){this.options.lineWidth=a;this.fl(this.md()/2)};c.prototype.wb=function(a,b){var d=new z(a,b);this.Va=!0;this.se.push([d]);1===this.se.length&&(this.Gk=this.view.$s());
return!0};c.prototype.dj=function(a){var b,d,c,g=this.view.un();a.lineCap=this.options.lineCap||"round";a.lineJoin="round"===a.lineCap?"round":"bevel";a.lineWidth=this.md();var f=a.globalAlpha;"opacity"in this.options&&(a.globalAlpha=this.options.opacity);a.beginPath();var h=this.se;var l=0;for(d=h.length;l<d;l++){var k=h[l];a.moveTo(k[0].x,k[0].y);var m=b=1;for(c=k.length-1;b<=c;m=b+=1)m=k[m],a.lineTo(m.x,m.y)}Db(a,this.options.strokeStyle);g&&a.restore();a.globalAlpha=f};c.prototype.Hb=function(a,
b){var d=new z(a,b);this.Va&&(this.from=this.se[0][this.se[0].length-1],d.x!==this.from.x||d.y!==this.from.y)&&(this.se[0].push(d),this.Gk?this.Gk.ha(this.dj,this):this.view.ha());return!0};c.prototype.Ob=function(a,b,d){this.Hb(a,b,d);this.Va=!1;this.qa();return!0};c.prototype.qa=function(){var a,b,d,c;var g=[];var f=this.se;var h=this.view.ea.lb;var l=0;for(d=f.length;l<d;l++){var k=f[l];if("brush"===this.mode){var m=[];1===k.length&&k.push(new z(k[0].x+.1,k[0].y+.1));if(1<k.length){var q=a=0;for(b=
k.length-1;a<=b;q=a+=1)m.push(k[q].x),m.push(k[q].y);g.push(new U(this.view.ea.Wa(),"BrushNode",Eb({points:m,layer:this.view.Qa},this.options,{lineWidth:this.md()})))}}else{if("shapebrush"===this.mode){k=Rb(k,20);b=k;if(!(2>b.length)){k=b[0];q=b[b.length-1];m=40>k.Lb(q);for(a=0;a<b.length;a++){var p=b[a];for(c=a+1;c<b.length;c++){var r=b[c];20>Math.abs(p.x-r.x)&&(r.x=p.x);20>Math.abs(p.y-r.y)&&(r.y=p.y)}}p=B.wg(b).ed();for(a=0;a<b.length;a++)c=b[a],20>Math.abs(c.x-p.x)&&(c.x=p.x),20>Math.abs(c.y-
p.y)&&(c.y=p.y);m&&(k.x=q.x,k.y=q.y)}k=b}else if("freehand"===this.mode)m=k,m=Rb(m,2),m=Ub(m,4),k=m=Rb(m,.5);else if("quadratic"===this.mode){k=Rb(k,10);a=Gd(k);m=a.ba[1];q=a.ba[2];c=a.ba[4];b=a.ba[5];k=a.ba[8];a=a.ba[9];c=((3*c-m)/2+(3*c-k)/2)/2;b=((3*b-q)/2+(3*b-a)/2)/2;p=new H;p.moveTo(m,q);p.quadraticCurveTo(c,b,k,a);m=p;m=S.Lp(m);g.push(new U(this.view.ea.Wa(),"PathNode",Eb({commands:m,fillStyle:this.view.xb,sloppiness:0,layer:this.view.Qa},this.options,{lineWidth:this.md()})));continue}1===
k.length&&"freehand"===this.mode&&k.push(new z(k[0].x+.1,k[0].y+.1));if(1<k.length){m=new T;m.moveTo(k[0].x,k[0].y);a=k[0].Ed(k[k.length-1]);q=b=1;for(c=k.length-1;b<=c;q=b+=1)m.lineTo(k[q].x,k[q].y);a&&m.close();g.push(new U(this.view.ea.Wa(),"PathNode",Eb({commands:m.Tb(),fillStyle:this.view.xb,sloppiness:0,layer:this.view.Qa},this.options,{lineWidth:this.md()})))}}}this.view.qa(g);this.view.ob();l=this.view.ea.xa(h,!1);g.length&&"quadratic"===this.mode?(l&&this.view.yf(l),this.view.Za()):this.view.fa.get("singleStrokeBrush")?
(l&&this.view.de(l),this.view.Za()):this.reset();this.view.Mb()};c.prototype.qe=function(a,b){this.options.strokeStyle=a;if(b){this.view.xb=a;this.view.Vb=a;var d="fillStyle"}else this.view.Kb=a,d="strokeStyle";this.view.setProperty(d,a)};c.prototype.re=function(a){this.view.Vb=yb(this.view.Vb,a);this.options.strokeStyle=yb(this.options.strokeStyle,a);this.view.xb=this.view.Vb};c.prototype.Rc=function(a){this.log("keyboard: %s",a);"cancel"===a&&(this.log("ESC pressed. Abort brush and go back to toolbar."),
this.view.Za(),this.view.cc.ma("goto-toolbar"))};c.prototype.Pd=function(a,b){"defaultBrushWidth"===a?this.tj(b):"defaultBrushColour"===a&&this.jg(b)};c.prototype.sd=function(a,b){switch(a){case "lineWidth":this.tj(b);break;case "strokeStyle":this.jg(b)}};c.prototype.rc=function(){return"circle"===this.mode?"ellipse":this.mode};c.prototype.Ji=function(){return this.options};return c}();var Id=function(){function c(a,b,d,c,g,f){void 0===d&&(d="");void 0===c&&(c={});void 0===g&&(g=!1);void 0===f&&(f=!1);this.view=a;this.type=b;this.url=d;this.aa=c;this.pu=g;this.di=f;this.node=null;this.Ik=new z(0,0);this.Vi=new z(0,0);this.index=0;this.state="start";this.log=w.create("DRAWLINES");"wrap"in this.aa||(this.aa.wrap=this.view.fa.get("multilineText"));"fontSize"in this.aa||(this.aa.fontSize=this.view.fa.get("defaultFontSize"));this.fc=new Ed(this.view);this.view.ob(!0)}c.prototype.Mc=
function(){this.log("Entering DrawLinesBehaviour");this.view.canvas.style.cursor="crosshair";this.view.fa.sg()||this.view.sj("click-to-place-first-point-of-line");this.view.ha()};c.prototype.reset=function(){this.Mc()};c.prototype.ib=function(a){a=this.fc.ib(a);this.fc.active&&this.node&&this.reset();return a};c.prototype.Rc=function(a){"cancel"===a&&(null!==this.node&&this.view.Ea.mb&&"curve"===this.type&&this.qa(),null!==this.node&&this.view.ea.removeNode(this.node),this.view.Ea.mb?this.view.cc.ma("goto-toolbar"):
this.view.Za())};c.prototype.done=function(){this.view.fa.get("autoPickTool")?(this.view.Za(),this.view.ul()):this.state="start"};c.prototype.bn=function(a,b){this.node instanceof S&&("curve"===this.type||"arrow"===this.type||"linear-bezier"===this.type?this.node.Ig(a,b):this.node.lineTo(a,b))};c.prototype.wb=function(a,b){var d=this.view.Na(new z(a,b));this.log("onMouseDown(%s, %s) state=%s, index=%s",a,b,this.state,this.index);if("start"===this.state){this.Ik=d;this.node=new S(this.view.ea.Wa(),
this.view.ea);this.node.setProperty("seed",Math.round(65535*Math.random()));this.node.setProperty("strokeStyle",this.view.Kb);this.node.setProperty("lineWidth",this.md());this.node.setProperty("sloppiness",this.view.za.sloppiness);this.node.setProperty("smoothness",this.view.za.smoothness);"arrow"===this.type&&(this.node.setProperty("arrowSize",this.view.fa.Oa("defaultArrowSize")),this.node.setProperty("arrowStyle",this.view.fa.Oa("defaultArrowStyle")),this.node.setProperty("arrowXOffset",this.view.fa.Oa("defaultArrowXOffset")));
for(var c in this.aa)this.aa.hasOwnProperty(c)&&this.node.setProperty(c,this.aa[c]);this.view.ea.Wh(this.node);this.node.moveTo(d.x,d.y);this.bn(d.x,d.y);this.index=3;this.view.update();this.state="predrag"}else if("placing"===this.state)if(c=this.Vi.Lb(d),this.log("Mouse moved by %s",c),"arrow"!==this.type&&8>this.Ik.Lb(d)&&3<this.index)this.log("Clicked close to start; automatically closing path"),this.node instanceof S&&this.node.close(),this.qa(),this.done();else if(8>this.Vi.Lb(d))this.log("Didn't move. Stop drawing."),
this.wn(),this.done();else{if(this.pu)return this.qa(),this.done(),!0;this.node&&(this.bn(d.x,d.y),this.index+=3,this.view.ea.gh(this.node.id),this.view.update())}else return this.log("Invalid state %s",this.state),!0;this.Vi=new z(d.x,d.y);return!0};c.prototype.wn=function(){3<this.index?(this.node instanceof S&&this.node.Lt(this.index),this.qa()):this.cancel()};c.prototype.Ob=function(a,b){var d=new z(a,b);d=this.Ik.Lb(d);this.log("onMouseUp (%s,%s) %s",a,b,this.state);"predrag"===this.state&&(this.log("MovedBy: %s",
d),10<d?(this.qa(),this.done()):(this.state="placing",this.view.sj("click-to-place-another-point-or-double-click-to-end-the-line")));return!0};c.prototype.Hb=function(a,b,d){b=this.view.Na(new z(a,b));a=b.x;b=b.y;if(d.ctrlKey||this.di){d=this.Vi;var c=Math.atan2(b-d.y,a-d.x),g=Math.PI/8;c>=-g&&c<g?b=d.y:c>=g&&c<3*g?(a=Math.max(b-d.y,a-d.x),b=d.y+a,a=d.x+a):c>=3*g&&c<5*g?a=d.x:c>=5*g&&c<7*g?(a=Math.max(b-d.y,d.x-a),b=d.y+a,a=d.x-a):c>=7*g||c<=7*-g?b=d.y:c<5*-g?(a=Math.max(d.y-b,d.x-a),b=d.y-a,a=d.x-
a):c<3*-g?a=d.x:(a=Math.max(d.y-b,a-d.x),b=d.y-a,a=d.x+a)}this.node&&(this.node.af(this.index,a,b),this.node.format(this.view.ia,this.view.request),this.view.ha());return!1};c.prototype.cj=function(){this.log("onMouseClick()");return!0};c.prototype.Rq=function(a){for(var b=0,c=[],e,g,f,h,l,k;b<a.length;){var m=a[b];switch(m){case S.Gf:f=a[b+1];h=a[b+2];c.push(m,f,h);break;case S.be:e=a[b+1],g=a[b+2],void 0!==f&&void 0!==h&&void 0!==l&&void 0!==k&&c.push(S.ug,e,g,(l+f)/2,(k+h)/2,(f+e)/2,(h+g)/2),l=
f,k=h,f=e,h=g}b+=S.Ta[m]+1}return c};c.prototype.qa=function(){if(this.node){this.node instanceof S&&this.node.uq();this.view.ea.removeNode(this.node);var a=this.view.fa.Oa("defaultArrowSize"),b=this.node.ja("commands");"linear-bezier"===this.type&&(b=this.Rq(b));a={arrowSize:"arrow"===this.type?a:0,arrowStyle:this.view.fa.Oa("defaultArrowStyle"),arrowXOffset:this.view.fa.Oa("defaultArrowXOffset"),commands:b,seed:this.node.ja("seed"),fillStyle:this.view.xb,strokeStyle:this.view.Kb,lineWidth:this.md(),
sloppiness:this.view.za.sloppiness,smoothness:this.view.za.smoothness,layer:this.view.Qa};for(var c in this.aa)this.aa.hasOwnProperty(c)&&(a[c]=this.aa[c]);this.view.qa([new U(this.view.ea.Wa(),"PathNode",a)]);this.node=null}};c.prototype.cancel=function(){this.node&&(this.view.ea.removeNode(this.node),this.node=null)};c.prototype.Fc=function(){this.wn();this.view.canvas.style.cursor="default";this.view.sj("");this.view.ha()};c.prototype.qe=function(a,b){if(b){this.view.xb=a;this.view.Vb=a;var c=
"fillStyle";this.log("We are drawing lines. Set strokeStyle instead of fillStyle")}else c="strokeStyle";this.view.Kb=a;this.view.setProperty(c,a)};c.prototype.re=function(a,b){b?(this.view.xb=yb(this.view.xb,a),this.view.Vb=yb(this.view.Vb,a)):this.view.Kb=yb(this.view.Kb,a);this.view.Nl(a,b)};c.prototype.rc=function(){return this.type};c.prototype.sd=function(a,b){this.aa[a]=b};c.prototype.md=function(){return this.view.zg(this.view.za.lineWidth)};return c}();var Jd=function(){function c(a,b,c,e,g,f,h,l){var d=this;this.view=a;this.nodeType=b;this.aa=c;this.width=e;this.height=g;this.fp=f;this.Bu=h;this.state="initial";this.start=new z(0,0);this.end=new z(0,0);this.node=null;this.log=w.create("DrawShape");"rectangle-tl"===f&&(this.Dn=function(a){a.lineWidth=1/d.view.scale;a.strokeStyle="#ccc";a.beginPath();a.rect(d.start.x,d.start.y,d.end.x-d.start.x,d.end.y-d.start.y);a.stroke()});this.ln=null===l?this.view.fa.get("autoPickTool"):l;this.fc=new Ed(this.view);
this.view.ob(!0)}c.prototype.Dn=function(){};c.prototype.Mc=function(){this.log("Entering DrawShapeBehaviour");this.view.canvas.style.cursor="crosshair"};c.prototype.Fc=function(){this.log("Leaving DrawShapeBehaviour");this.cancel()};c.prototype.cancel=function(){this.node&&(this.view.ea.removeNode(this.node),this.view.update(),this.node=null);this.state="initial"};c.prototype.ib=function(a){a=this.fc.ib(a);this.node&&this.fc.active&&(this.view.ea.removeNode(this.node),this.node=null,this.state="initial");
return a};c.prototype.Rc=function(a){"cancel"===a&&this.view.Za()};c.prototype.wb=function(a,b){"initial"===this.state&&(this.start=this.view.Na(new z(a,b)),this.state="predraw",this.log("initial -> predraw"));return!0};c.prototype.Hb=function(a,b,c){a=this.view.Na(new z(a,b));c=c.ctrlKey;"predraw"===this.state&&10<this.start.Lb(a)&&(this.create(),this.state="drawing",this.log("predraw -> drawing"));"drawing"===this.state&&(this.transform(this.start,a,c),this.end=a,this.view.update(!1,this.Dn));return!0};
c.prototype.Ob=function(a,b,c){"predraw"===this.state?this.view.fa.get("clickToDrawShapes")?(this.create(),this.transform(this.start,null,c.ctrlKey),this.qa(),this.ln&&this.view.Za(),this.state="initial"):this.cancel():"drawing"===this.state&&(this.transform(this.start,this.view.Na(new z(a,b)),c.ctrlKey),this.qa(),this.ln&&this.view.Za(),this.state="initial");return!0};c.prototype.create=function(){if(this.node=Ec(this.nodeType,this.view.ea.Wa(),this.view.ea))this.node.Ib(this.aa),this.view.ea.Wh(this.node)};
c.prototype.transform=function(a,b,c){if(b)if("circle"===this.fp){var d=a;a=a.Lb(b);var g=2*a/this.width;a=2*a/this.height}else{if("rectangle-tl"===this.fp)a=a.clone(),b=b.clone(),a.x>b.x&&(g=a.x,a.x=b.x,b.x=g),a.y>b.y&&(g=a.y,a.y=b.y,b.y=g),d=a;else if(g=[a,b],0===g.length)d=new z(0,0);else{d=g[0].x;for(var f=g[0].y,h=1;h<g.length;h++)d+=g[h].x,f+=g[h].y;d=new z(d/g.length,f/g.length)}g=(b.x-a.x)/this.width;a=(b.y-a.y)/this.height}else d=a,a=g=1;c&&(a=g=Math.min(g,a));c=new E(d.x,d.y);c=c.multiply(new Kb(g,
a));this.node&&(this.node.lg(c),this.view.ea.gh(this.node.id))};c.prototype.qa=function(){this.node&&(this.aa.matrix=this.node.Ha(),this.view.ea.removeNode(this.node),this.node=null,this.view.qa([new U(this.view.ea.Wa(),this.nodeType,this.aa)]))};c.prototype.tj=function(a){this.aa.lineWidth=this.view.zg(a)};c.prototype.qe=function(a,b){od.prototype.qe.call(this,a,b);this.aa[b?"fillStyle":"strokeStyle"]=a};c.prototype.re=function(a,b){od.prototype.re.call(this,a,b);var c=b?"fillStyle":"strokeStyle",
e=yb(this.aa[c],a);this.log("oldColour=%s+opacity %s = %s",this.aa[c],a,e);this.aa[c]=e};c.prototype.rc=function(){return this.Bu};c.prototype.sd=function(a,b){this.aa[a]=b};c.prototype.Ji=function(){return this.aa};c.prototype.Pd=function(a,b){"defaultLineWidth"===a&&this.tj(b)};return c}();function Kd(c,a,b){this.Ja=c;this.xj=a;this.fn=b;this.Aj=0}
var Ld=new (function(){function c(){this.vb=[];this.am=!1;this.log=w.create("ImageLoader")}c.prototype.timeout=function(){var a=[];this.log("Timeout running... %s images remaining",this.vb.length);for(var b=0;b<this.vb.length;b++)this.vb[b].Ja.complete?this.vb[b].fn(this.vb[b].Ja,this.vb[b].xj):5E3>this.vb[b].Aj?(this.vb[b].Aj+=250,a.push(this.vb[b])):this.vb[b].fn(this.vb[b].Ja,this.vb[b].xj);this.vb=a;this.vb.length?setTimeout(this.timeout,250):(this.log("Timeout Stopped"),this.am=!1)};c.prototype.load=
function(a,b,c){var d=this;void 0===c&&(c=!1);var g=document.createElement("img"),f=new Kd(g,a,b);this.vb.push(f);var h=0<=a.indexOf("://"),l="://"+window.location.host,k=0!==a.indexOf("data:")&&h&&-1===a.indexOf(l);k&&!c&&(this.log("Using cross origin request for img"),g.crossOrigin="");g.addEventListener("load",function(){d.log("LoadFn called. complete=%s",g.complete);if(g.complete)for(var a=0;a<d.vb.length;a++){var c=d.vb[a];if(c.Ja===g){d.vb.splice(a,1);b(g,c.xj);break}}else d.am||(d.am=!0,setTimeout(d.timeout,
250),f.Aj=250)},!1);g.addEventListener("error",function(){d.log("Error loading %s; useCors=%s disableCors=%s",a,k,c);!k||c?b(null,f.xj):d.load(a,b,!0)},!1);g.src=a;return g};return c}());var Md=function(c){function a(){var a=c.call(this)||this;a.fg=[];a.Of=!1;a.canvas=null;a.fa=null;a.log=w.create("FORMAT",!0);return a}n(a,c);a.prototype.add=function(a,c,e,g,f){var b;var d=this.fg;var k=0;for(b=d.length;k<b;k++){var m=d[k];m.type===c&&m.il===a&&m.url===e&&(m.Pl=!0)}this.log("Request URL %s",e.substr(0,64));this.fg.push({il:a,type:c,url:e,Po:g||{},Cq:f,Pl:!1});this.check()};a.prototype.check=function(){for(var a=0;!this.Of&&a<this.fg.length;)this.fg[a].Pl?this.fg.shift():(this.bq(this.fg[0]),
a+=1);this.Of||this.ma("done")};a.prototype.bq=function(a){var b=this;b.Of=!0;b.log("Processing request for item %s url=%s",a.il,a.url.substr(0,64));0===a.type.indexOf("image")&&Ld.load(a.url,function(c,d){null!==c?(b.log("Image request completed for item %s url %s",a.il,d.substr(0,64)),a.Cq(c,d)):b.log("Image request failed for url %s",d);b.Of=!1;a.Pl=!0;b.check()})};a.prototype.Qq=function(a,c){this.ma("convert-dom-request",a,c)};a.prototype.gg=function(a){this.ma("reformat",a)};a.prototype.Gd=
function(){if(null===this.canvas)return new B(0,0,0,0);var a=y(this.canvas).pc();return new B(a.left,a.top,this.canvas.width,this.canvas.height)};a.prototype.Nc=function(a){return this.fa?this.fa.get(a):null};return a}(Sc);var Nd=function(){function c(a,b,c){this.view=a;this.aa=b;this.Ys=c;this.state="none";this.scale=1;this.log=w.create("ImageStamp");this.Ja=document.createElement("img");this.url=this.Ja.src=b.url;"scale"in this.aa&&(this.scale=this.aa.scale,delete this.aa.scale)}c.prototype.rc=function(){return"imagestamp"};c.prototype.Mc=function(){this.log("Entering ImageStampBehaviour");this.view.canvas.style.cursor="move"};c.prototype.Fc=function(){this.log("Leaving ImageStampBehaviour");this.view.ha()};c.prototype.Na=
function(a,b){this.Ja.complete&&(a-=this.Ja.width/2,b-=this.Ja.height/2);return this.view.Na(new z(a,b))};c.prototype.wb=function(a,b,c){this.log("onMouseDown type %s",c.type);a=this.Na(a,b);this.view.qa([new U(this.view.ea.Wa(),"ImageNode",Eb({},this.aa,{url:this.url,layer:this.view.Qa,matrix:(new E(a.x,a.y)).multiply(new Kb(this.scale,this.scale))}))]);this.Ys||(this.log("MultiStamp not set; return to pick mode."),this.view.Za());return!0};c.prototype.Hb=function(a,b){this.Ja.complete||this.log("Don't draw; image not loaded.");
var c=this.Na(a,b),e=this;this.view.ha(function(a){var b=a.globalAlpha;a.globalAlpha=.5;a.drawImage(e.Ja,c.x,c.y,e.Ja.naturalWidth*e.scale,e.Ja.naturalHeight*e.scale);a.globalAlpha=b});return!0};c.prototype.Ob=function(){return!0};c.prototype.Rc=function(a){"cancel"===a&&(this.view.Za(),this.view.cc.ma("goto-toolbar"))};return c}();var Od=function(){function c(a){this.view=a;this.state="none";this.start=new z(0,0);this.xp=this.wp=0;this.log=w.create("PanTool");this.fc=new Ed(a)}c.prototype.Mc=function(){this.log("Entering PanToolBehaviour");this.view.canvas.style.cursor="all-scroll"};c.prototype.Fc=function(){this.log("Leaving PanToolBehaviour")};c.prototype.ib=function(a){return this.fc.ib(a)};c.prototype.$n=function(a){return new z(a.pageX,a.pageY)};c.prototype.wb=function(a,b,c){this.log("onMouseDown type %s",c.type);this.state=
"dragging";this.start=this.$n(c);this.wp=this.view.sb;this.xp=this.view.fb;return!0};c.prototype.Hb=function(a,b,c){if("dragging"!==this.state)return!1;a=this.$n(c);b=this.xp+a.y-this.start.y;this.view.sb=this.wp+a.x-this.start.x;this.view.fb=b;this.view.mc();this.view.ha();return!0};c.prototype.Ob=function(){this.state="none";return!0};c.prototype.ol=function(a,b,c,e){if(!this.view.fa.get("allowZoom"))return this.log("Zooming is disabled."),!1;this.log("onMouseWheel(%s, %s, %s)",a,b,c);c=0<c?1/1.1:
1.1;a=new Kb(c,c,a,b);b=this.view.Jd();b.transform(a);this.view.og(b);e.stopPropagation();e.preventDefault();return!0};c.prototype.Rc=function(a){"cancel"===a&&this.view.Za()};c.prototype.rc=function(){return"pan"};return c}();var Pd=function(c){function a(a,d,e){var b=c.call(this)||this;b.id=a;b.Ld=d;b.ih=!0;b.width=32;b.height=500;b.Av=0;b.Cb=new B(0,0,0,0);b.Va=!1;b.vq="#c0c0c0";b.pn="#808080";b.borderWidth=1;b.je=0;b.ie=100;b.nm=10;b.position=5;b.offset=0;b.log=w.create("SCROLLBAR",!0);b.ih=!0;b.canvas=rb(document.body);b.canvas.style.position="absolute";b.canvas.style.border="none";b.canvas.classList.add("zwibbler-scrollbar");b.ia=b.canvas.getContext("2d");e.addEventListener(b.canvas,"mousedown",function(a){b.wb(a)});
e.addEventListener(document.body,"mousemove",function(a){b.Hb(a)});e.addEventListener(document.body,"mouseup",function(a){b.Ob(a)});e.addEventListener(b.canvas,"touchstart",function(a){b.pl(a)});e.addEventListener(document.body,"touchmove",function(a){b.pl(a)});e.addEventListener(document.body,"touchend",function(a){b.pl(a)});b.format();return b}n(a,c);a.prototype.yd=function(a){a.appendChild(this.canvas)};a.prototype.moveTo=function(a,c){this.canvas.style.left=""+a+"px";this.canvas.style.top=""+
c+"px"};a.prototype.ng=function(a,c){this.width=a;this.height=c;this.canvas.width=this.width;this.canvas.height=c;this.format();this.ha()};a.prototype.ne=function(){this.canvas.style.display="none"};a.prototype.show=function(){this.canvas.style.display="block"};a.prototype.Js=function(){return"block"===this.canvas.style.display};a.prototype.sp=function(a,c,e,g){this.je=a;this.ie=c-a;this.nm=e;this.position=g;this.format();this.ha()};a.prototype.format=function(){var a=this.Ld?this.width:this.height;
var c=this.nm/this.ie*a;a*=(this.position-this.je)/this.ie;this.Cb=this.Ld?new B(a,0,c-1,this.height-1):new B(0,a,this.width-1,c-1);this.Cb.x=Math.round(this.Cb.x)+.5;this.Cb.y=Math.round(this.Cb.y)+.5;this.Cb.width=Math.round(this.Cb.width);this.Cb.height=Math.round(this.Cb.height)};a.prototype.ha=function(){this.ia.beginPath();this.ia.fillStyle=this.vq;this.ia.strokeStyle=this.pn;this.ia.lineWidth=this.borderWidth;this.ia.rect(this.borderWidth/2,this.borderWidth/2,this.width-this.borderWidth,this.height-
this.borderWidth);this.ia.fill();this.ia.stroke();this.ia.beginPath();this.ia.fillStyle=this.pn;this.ia.strokeStyle="#000000";this.ia.rect(this.Cb.x,this.Cb.y,this.Cb.width,this.Cb.height);this.ia.fill();this.ia.stroke()};a.prototype.Kn=function(a){var b=y(this.canvas).pc(),c=0,g=0;if("touchstart"===a.type||"touchend"===a.type||"touchmove"===a.type)c=a.changedTouches[0].pageX,g=a.changedTouches[0].pageY;else if("mousedown"===a.type||"mouseup"===a.type||"mousemove"===a.type)c=a.pageX,g=a.pageY;return new z(c-
b.left,g-b.top)};a.prototype.pl=function(a){switch(a.type){case "touchstart":this.wb(a);break;case "touchend":this.Ob(a);break;case "touchmove":this.Hb(a)}};a.prototype.Uo=function(a){a=this.Ld?a.x/this.width*this.ie+this.je:a.y/this.height*this.ie+this.je;a=Math.min(a,this.ie-this.nm+this.je);return a=Math.max(a,this.je)};a.prototype.wb=function(a){a.preventDefault();a=this.Kn(a);this.Cb.fd(a.x,a.y)?this.Ld?(this.offset=a.x-this.Cb.x,a.x-=this.offset):(this.offset=a.y-this.Cb.y,a.y-=this.offset):
(this.position=this.Uo(a),this.offset=0,this.Ld?this.Cb.x=(this.position-this.je)/this.ie*this.width:this.Cb.y=(this.position-this.je)/this.ie*this.height,this.ma("scroll",this.position),this.ha());this.Va=!0};a.prototype.Hb=function(a){this.Va&&(this.Va&&"mousemove"===a.type&&0===a.buttons?this.Va=!1:(a.preventDefault(),a=this.Kn(a),this.Ld?a.x-=this.offset:a.y-=this.offset,this.position=this.Uo(a),this.ma("scroll",this.position),this.format(),this.ha()))};a.prototype.Ob=function(){this.Va&&(this.Va=
!1)};a.prototype.Tk=function(){return this.Ld?this.height:this.width};a.jv=0;a.hv=1;a.dv=2;a.iv=3;return a}(Sc);function Qd(c,a,b,d,e,g){var f=!1;c.save();switch(b){case 0:case 3:var h=a.height;var l=a.width;break;default:h=a.width,l=a.height}switch(b){case 2:f=!0}c.translate(a.x,a.y);c.fillStyle="rgba(0, 0, 0, 0.2)";c.fillStyle="#ccc";c.fillRect(0,0,a.width,a.height);c.lineWidth=1;c.fillStyle="black";c.strokeStyle="black";c.font="10px sans-serif";a=Math.ceil(50/e);b=g/e;var k=Math.ceil(b/a)*a;g=k;c.beginPath();if(f)for(b=(k-b)*e;b<l;)c.moveTo(0,b),c.lineTo(h,b),f=g.toString()+d,c.fillText(f,0,b+1+10),g+=a,
b+=e*a;else for(b=(k-b)*e;b<l;)c.moveTo(b,h),c.lineTo(b,0),f=g.toString()+d,c.fillText(f,b+1,10),g+=a,b+=e*a;c.stroke();c.restore()};var Rd=function(){function c(){this.images={}}c.prototype.add=function(a,b){var c=this.images[a];c||(c={Ja:null,mj:0},Ld.load(b,function(a){c.Ja=a}),this.images[a]=c);c.mj+=1};c.prototype.release=function(a){var b=this.images[a];b&&(--b.mj,0>=b.mj&&delete this.images[a])};c.prototype.get=function(a){return(a=this.images[a])&&a.Ja?a.Ja:null};return c}();var Sd="ontouchstart"in window,Td="onpointerdown"in window,Ud={touchstart:"down",touchmove:"move",touchend:"up",touchcancel:"up",pointerdown:"down",pointermove:"move",pointerup:"up",mousedown:"down",mousemove:"move",mouseup:"up",pointercancel:"up"},Vd=[],Wd=function(c){function a(a,d,e,g,f,h,l,k,m,q,p,r,t,v,A,I,N){void 0===I&&(I=Vd);void 0===N&&(N=0);h=c.call(this,a,d,e,h,k,m)||this;h.type=a;h.pageX=d;h.pageY=e;h.Yc=g;h.Zc=f;h.startTime=l;h.pointerId=q;h.data=p;h.index=r;h.buttons=t;h.ctrlKey=v;h.shiftKey=
A;h.la=I;h.angle=N;h.scale=0;h.rotation=0;return h}n(a,c);a.prototype.clone=function(){return new a(this.type,this.pageX,this.pageY,this.Yc,this.Zc,this.timestamp,this.startTime,this.target,this.qd,this.pointerId,this.data,this.index,this.buttons,this.ctrlKey,this.shiftKey,this.la,this.angle)};a.prototype.Hi=function(){return this.offset({x:this.pageX,y:this.pageY})};a.prototype.Bi=function(){return this.timestamp-this.startTime};a.prototype.zi=function(){return C(this.pageX,this.pageY,this.Yc,this.Zc)};
a.prototype.toString=function(){var a=c.prototype.toString.call(this)+(" "+this.Bi()+"ms "+Math.round(this.zi())+"px");0!=this.scale&&(a+=" scale="+Math.round(100*(this.scale||0))/100,a+=" "+Math.round(this.rotation||0)+"deg");return a};a.prototype.setData=function(a,c){this.data[a]=c};a.prototype.getData=function(a){return this.data[a]};return a}(function(){function c(a,b,c,e,g,f){this.type=a;this.pageX=b;this.pageY=c;this.timestamp=e;this.target=g;this.qd=f}c.prototype.toString=function(){return"["+
this.type+" ("+this.qd.type+")] ("+this.pageX+","+this.pageY+")"};c.prototype.offset=function(a){var b=y(this.target).pc();return{x:a.x-b.left,y:a.y-b.top}};c.prototype.stopPropagation=function(){this.qd.stopPropagation()};c.prototype.preventDefault=function(){this.qd.preventDefault()};return c}()),Xd=w.create("TouchListener"),be=function(c){function a(a,d){function b(a){g.handleEvent(a)}void 0===d&&(d={});var g=c.call(this)||this;g.Aa=a;g.options=d;g.Nd=[];g.Rf=[];g.active=[];g.io={};g.ih=!0;Sd?
(g.cb(a,"touchstart",b),g.cb(document,"touchmove",b),g.cb(document,"touchend",b),g.cb(document,"touchcancel",b)):Td&&!1!==d.en&&(g.cb(a,"pointerdown",b),g.cb(document,"pointermove",b),g.cb(document,"pointerup",b),g.cb(document,"pointercancel",b));Td&&!1!==d.en||(g.cb(a,"mousedown",b),g.cb(document,"mousemove",b),g.cb(document,"mouseup",b));return g}n(a,c);a.prototype.cb=function(a,c,e){this.Nd.push({element:a,event:c,fn:e});a.addEventListener(c,e,!0===this.options.Dp)};a.prototype.sa=function(a,d){var b=
"";switch(a){case "gesturestart":case "gesturechange":case "gestureend":b="gesture";break;case "tap":case "doubletap":b="tap";break;case "swipe":b="swipe";break;case "hold":b="hold"}if(""!==b&&!this.io[b]){switch(b){case "gesture":this.Rf.push(new Yd(this));break;case "tap":this.Rf.push(new Zd(this));break;case "swipe":this.Rf.push(new $d(this));break;case "hold":this.Rf.push(new ae(this))}this.io[b]=!0;Xd("Created new detector "+b+" to handle "+a)}c.prototype.sa.call(this,a,d)};a.prototype.ma=function(a,
d){c.prototype.Re.call(this,a,d)};a.prototype.Kc=function(){for(var a=0,c=this.Nd;a<c.length;a++){var e=c[a];e.element.removeEventListener(e.event,e.fn,!0===this.options.Dp)}a=0;for(c=this.Rf;a<c.length;a++)e=c[a],e.Kc&&e.Kc();this.Nd.length=0;this.Rf.length=0;this.active.length=0;this.bb={}};a.prototype.handleEvent=function(a){var b=Ud[a.type],c=(new Date).getTime();switch(a.type){case "touchstart":case "touchend":a.target===this.Aa&&a.preventDefault();case "touchmove":case "touchcancel":for(var g=
0;g<a.changedTouches.length;g++){var f=a.changedTouches[g];this.Vk(a,b,f.identifier,f.pageX,f.pageY,c)}break;case "pointerdown":case "pointerup":case "pointermove":case "pointercancel":this.Vk(a,b,a.pointerId,a.pageX,a.pageY,c);break;case "mousedown":case "mousemove":case "mouseup":this.Vk(a,b,0,a.pageX,a.pageY,c)}};a.prototype.Vk=function(a,c,e,g,f,h){switch(c){case "down":c=this.oq(e,g,f,h);e=new Wd("down",g,f,g,f,h,h,this.Aa,a,e,c.data,c.index,a.buttons,a.ctrlKey,a.shiftKey);break;case "move":c=
this.xr(e);e=new Wd("move",g,f,c?c.Yc:g,c?c.Zc:f,h,c?c.$c:h,this.Aa,a,e,c?c.data:{},c?c.index:-1,a.buttons,a.ctrlKey,a.shiftKey);break;case "up":c=this.Mt(e);e=new Wd("up",g,f,c?c.Yc:g,c?c.Zc:f,h,c?c.$c:h,this.Aa,a,e,c?c.data:{},c?c.index:-1,a.buttons,a.ctrlKey,a.shiftKey);break;default:return}null!==c&&(c.Se=g,c.Te=f);(c||a.target===this.Aa)&&this.ma(e.type,e)};a.prototype.xr=function(a){for(var b=0,c=this.active;b<c.length;b++){var g=c[b];if(g.id===a)return g}return null};a.prototype.oq=function(a,
c,e,g){for(var b=0;b<this.active.length;b++){var d=this.active[b];if(d.id===a)return d.Yc=d.Se=c,d.Zc=d.Te=e,d.$c=g,d.la=[new z(c,e)],d}this.active.push({index:this.active.length,id:a,$c:g,Yc:c,Zc:e,Se:c,Te:e,la:[new z(c,e)],data:{}});return this.active[this.active.length-1]};a.prototype.Mt=function(a){for(var b=0;b<this.active.length;b++)if(this.active[b].id===a)return a=this.active[b],this.active.splice(b,1),a;return null};return a}(Sc);
function Zd(c){var a=[];c.sa("up",function(b){Xd("Duration: %s distance: %s",b.Bi(),b.zi());if(200>b.Bi()&&20>b.zi()){var d=b.clone();d.type="tap";c.ma("tap",d);a:{for(d=0;d<a.length;d++){var e=a[d];if(300>b.timestamp-e.$c&&20>C(b.pageX,b.pageY,e.x,e.y)){e.x=b.pageX;e.y=b.pageY;e.$c=b.timestamp;d=!0;break a}}4===a.length&&a.splice(0,1);a.push({x:b.pageX,y:b.pageY,id:b.pointerId,$c:b.timestamp});d=!1}d&&(d=b.clone(),d.type="doubletap",c.ma("doubletap",d))}})}
function Yd(c){function a(){for(var a=0,b=0,c=0;c<e.length;c++)Xd("Active touch: %s,%s",e[c].Se,e[c].Te),a+=e[c].Se,b+=e[c].Te;return{x:a/e.length,y:b/e.length}}function b(a,b){for(var c=0,d=0;d<e.length;d++){var g=e[d];c+=Math.sqrt((g.Se-a)*(g.Se-a)+(g.Te-b)*(g.Te-b))}return c/e.length}function d(a,b,d,e,g){a=a.clone();a.type=b;a.pageX=d.x;a.pageY=d.y;a.scale=e;a.rotation=g;c.ma(a.type,a)}var e=[],g=!1,f=0,h=1,l=1,k={x:0,y:0};c.sa("down move up",function(m){e=c.active;switch(m.type){case "down":2<=
e.length&&!g&&(g=!0,k=a(),l=b(k.x,k.y),h=1,f=0,d(m,"gesturestart",k,h,f));break;case "move":if(2<=e.length&&g){k=a();h=b(k.x,k.y)/l;for(var q=k.x,p=k.y,r=0,t=0;t<e.length;t++){var v=Math.atan2(e[t].Te-p,e[t].Se-q)-Math.atan2(e[t].Zc-p,e[t].Yc-q);v>Math.PI?v-=2*Math.PI:v<=-Math.PI&&(v+=2*Math.PI);r+=v}f=r/e.length/Math.PI*180;d(m,"gesturechange",k,h,f)}break;case "up":g&&2>e.length&&(g=!1,d(m,"gestureend",k,h,f))}})}
function $d(c){c.sa("up",function(a){var b=a.la;if(!(200>a.zi()||1E3<a.Bi()||2>b.length)){for(var d=b[0],e=b[b.length-1],g=1;g<b.length-1;g++)if(40<b[g].Bn(d,e))return!1;b=Math.atan2(e.y-d.y,e.x-d.x);Xd("Swipe angle %s",Math.round(b/Math.PI*180));a=a.clone();a.type="swipe";a.angle=b;c.ma("swipe",a)}})}function ce(c){this.vt=c;this.time=(new Date).getTime();this.timeout=0}
var ae=function(){function c(a){function b(a){var b=c.te[a];b&&(Xd("Remove pointer %s",a),clearTimeout(b.timeout),delete c.te[a])}var c=this;this.te={};a.sa("down",function(d){b(d.pointerId);c.te[d.pointerId]=new ce(new z(d.pageX,d.pageY));c.te[d.pointerId].timeout=setTimeout(function(){var b=d.clone();b.type="hold";b.timestamp=(new Date).getTime();a.ma("hold",b)},1E3)});a.sa("move",function(a){var d=a.pointerId;if(d in c.te){var e=c.te[d];20<(new z(a.pageX,a.pageY)).Lb(e.vt)&&b(d)}});a.sa("up",function(a){b(a.pointerId)})}
c.prototype.Kc=function(){for(var a in this.te)clearTimeout(this.te[a].timeout)};return c}();for(var de,ee=[],fe=0;4>fe;fe++)ee.push(String.fromCharCode(">2$-".charCodeAt(fe)^"zwibbler3".charCodeAt(fe%9)));de=ee.join("");for(var ge,he=[115,116,114,111,107,101,84,101,120,116],ie=[],je=0;je<he.length;je++)ie.push(String.fromCharCode(he[je]));ge=ie.join("");
var ke=function(){function c(a,b,d,e,g,f,h,l){var k=this;this.oc=a;this.canvas=b;this.ea=d;this.cc=e;this.fa=g;this.language=f;this.Ba=h;this.va=l;this.vd="none";this.Bh=this.Ah=0;this.scale=1;this.fb=this.sb=0;this.Uc=new B(0,0,0,0);this.Fl=new Sb;this.hg=this.ig=this.th=!0;this.oj=new F;this.selection=[];this.wf=[];this.Qa="default";this.Wd=this.si=!1;this.cd=this.background=this.Ie=null;this.backgroundRepeat="no-repeat";this.hd=this.ya=null;this.Am=4;this.Bm=3*this.Am;this.Ae=this.Mg=null;this.Bk=
!1;this.gd=null;this.Jf=!1;this.Vb=this.xb=this.Kb="#000000";this.Qf=5;this.Xf="";this.Rb=0;this.jl=new B(0,0,0,0);this.kl=new B(0,0,0,0);this.Ea={mb:!1,Va:!1,ik:!1,x:100,y:100};this.ul=function(){};this.Ri=new Rd;this.Li=[];this.log=w.create("VIEW");this.ia=this.canvas.getContext("2d");this.Wd=!0===g.get("pageView");this.Jt();this.oa=new od(this);this.va.add(function(){k.oa&&k.oa.Fc&&k.oa.Fc();k.request.Dg();k.Oc.Dg();k.Zb.Dg();k.ul=function(){};k.oa={}});this.Oc=new Pd("horizontal",!0,this.va);
this.Oc.yd(this.canvas.parentNode);this.Zb=new Pd("vertical",!1,this.va);this.Zb.yd(this.canvas.parentNode);this.aj=this.Ug();this.Je=new Hb(this.canvas.width/this.aj,this.canvas.height/this.aj);var m=this;this.request=new Md;this.request.canvas=this.canvas;this.request.fa=this.fa;this.request.sa("reformat",function(a){m.log("Node %s requests reformat",a);m.ea.Ue(a)&&(m.log("   Reformatting... zoom=%s",m.vd),m.ea.gh(a));m.update();a===m.cd&&m.fi();m.tf();m.Ba.ma("resource-loaded")});this.request.sa("convert-dom-request",
function(a,b){m.Ba.ma("convert-dom-request",b,a)});this.request.sa("mouseevent",function(a){k.Cu.handleEvent(a)});g.sa("useTouch",function(){m.Ae=null;m.Bm=3*m.Am});this.Zb.sa("scroll",function(a){m.fb=-a*m.scale;m.Ba.ma("scroll");m.ha()});this.Oc.sa("scroll",function(a){m.sb=-a*m.scale;m.ha();m.Ba.ma("scroll")});this.fi();this.ea=this.Ud(d);(a=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame)?(this.log("Using requestAnimationFrame"),this.requestAnimationFrame=
a):this.log("Emulating requestAnimationFrame");this.fa.sa("update",function(a,b){m.Pd(a,b)});this.va.addEventListener(document,"webkitfullscreenchange",function(){0<=navigator.userAgent.search("Safari")&&0>navigator.userAgent.search("Chrome")&&(k.log("SAFARI WORKAROUND: Disabling requestAnimationFrame."),k.requestAnimationFrame=c.prototype.requestAnimationFrame)});a=document;a.fonts&&this.va.addEventListener(a.fonts,"loadingdone",function(){k.log("Font loading done, redraw now.");k.ha()});this.wc(.5,
0,0,-30,"","rotate");this.wc(0,0,0,0,"","scale");this.wc(1,0,0,0,"","scale");this.wc(1,1,0,0,"","scale");this.wc(0,1,0,0,"","scale");this.wc(.5,0,0,0,"","scale");this.wc(1,.5,0,0,"","scale");this.wc(.5,1,0,0,"","scale");this.wc(0,.5,0,0,"","scale");this.oa=this.Za()}c.prototype.zg=function(a){this.fa.get("adaptiveBrushWidth")&&(a/=this.scale);return a};c.prototype.bo=function(a){var b,c=-1,e=!1;for(b=0;b<a.rf.length;b++){var g=a.rf[b];g===this.cd&&(this.log("Background node has been removed"),c=-1)}for(b=
0;b<a.$b.length;b++){g=a.$b[b];var f=this.ea.xa(g,!1);"background"===f.ja("layer")&&(this.log("Background node has been added"),c=g)}for(b=0;b<a.rg.length;b++)g=a.rg[b],f=this.ea.xa(g,!1),"background"===f.ja("layer")?(this.log("Background node has been changed"),c=g,e=!0):g===this.cd&&(this.log("Node removed from background layer"),c=-1);-1===c||!e&&c===this.cd||(this.cd=c,this.fi(),this.cd&&this.ea.xa(this.cd,!1).Vd(!0));a.$b.length&&this.Ba.ma("nodes-added",a.$b);a.rg.length&&this.Ba.ma("nodes-changed",
a.rg);a.rf.length&&this.Ba.ma("nodes-removed",a.rf)};c.prototype.requestAnimationFrame=function(a){a()};c.prototype.Kk=function(){return parseInt(y(this.canvas).me("borderLeftWidth"),10)||0};c.prototype.Rg=function(){this.log("getActiveLayer() -> %s",this.Qa);return this.Qa};c.prototype.qj=function(a){this.log("setActiveLayer(%s)",a);this.Qa=a;this.ob();this.Mb();this.ha()};c.prototype.xh=function(a,b){this.ea.xh(a,b);this.Ba.Ng("document-changed");b||a!==this.Qa||(this.ob(),this.Mb());this.ha()};
c.prototype.Ud=function(a){this.log("setDocument()");this.Za();this.ea=a;this.scale=1;this.fb=this.sb=0;this.selection=[];this.hd=this.ya=null;this.Rb+=1;this.Uc=new B(0,0,0,0);this.Fl=new Sb(this.Uc);this.oj=new F;this.Xf="";this.Qa="default";this.xb="#ffffff";this.Vb=this.fa.Oa("defaultBrushColour");this.Kb=this.fa.Oa("defaultStrokeStyle");this.za={};this.za.lineWidth=this.fa.Oa("defaultLineWidth");this.za.sloppiness=.5;this.za.fontName=this.fa.Oa("defaultFont");this.za.fontSize=this.fa.Oa("defaultFontSize");
this.za.bold=this.fa.Oa("defaultBold");this.za.italic=this.fa.Oa("defaultItalic");this.za.smoothness=.3;this.za.textFillStyle=this.fa.Oa("defaultTextFillStyle");this.za.textStrokeStyle=this.fa.Oa("defaultTextStrokeStyle");this.za.textLineWidth=this.fa.Oa("defaultTextLineWidth");this.za.textDecoration=this.fa.Oa("defaultTextDecoration");this.za.textAlign=this.fa.Oa("defaultTextAlign");this.Qf=this.fa.get("defaultBrushWidth");var b=this.Ye();this.sb=-b.x;this.fb=-b.y;this.mc();this.ea.Tl=this.fa.get("spotHighlightColour");
this.ea.wj=this.fa.get("spotHighlightZIndex");this.ea.format(this.ia,this.request);this.kl=new B(0,0,0,0);this.jl=new B(0,0,0,0);"none"!==this.vd?this.Xc(this.vd):(this.Xc(this.fa.get("defaultZoom")),this.ha());return a};c.prototype.Pd=function(a,b){var c=!1;switch(a){case "allowResize":this.Pf();this.ha();break;case "defaultBrushColour":this.Vb=b;break;case "defaultFillStyle":this.xb=this.za.fillStyle=b;break;case "defaultStrokeStyle":this.Kb=b;this.za.strokeStyle=b;break;case "defaultLineWidth":this.za.lineWidth=
b;break;case "defaultFont":this.za.fontName=b;break;case "defaultBold":this.za.bold=b;break;case "defaultTextAlign":this.za.textAlign=b;break;case "defaultTextDecoration":this.za.textDecoration=b;break;case "defaultItalic":this.za.italic=b;break;case "defaultFontSize":this.za.fontSize=b;break;case "defaultTextFillStyle":this.za.textFillStyle=b;break;case "defaultTextStokeStyle":this.za.textStrokeStyle=b;break;case "defaultTextLineWidth":this.za.textLineWidth=b;break;case "defaultBrushWidth":this.Qf=
b;break;case "defaultZoom":this.Xc(b);break;case "pageView":this.Wd=b;c=!0;break;case "pagePlacement":case "pageInflation":this.Xc(this.vd);break;case "snap":case "background":case "gridSpacing":case "gridBlocks":case "gridColour":case "backgroundImage":this.fi();c=!0;break;case "pageShadow":case "outsidePageColour":c=!0;break;case "readOnly":!0===b&&(this.Za(),this.ob(),this.Mb(),c=!0);this.ea.mg(b);break;case "spotHighlightColour":this.ea.Tl=b;c=!0;break;case "spotHighlightZIndex":this.ea.wj=b;
c=!0;break;case "showRuler":case "pixelsPerUnit":case "units":c=!0}this.oa.Pd&&this.oa.Pd(a,b);c&&this.ha()};c.prototype.we=function(a,b){this.za[a]=b;"fillStyle"===a?this.xb=b:"strokeStyle"===a&&(this.Kb=b)};c.prototype.Xc=function(a){a!==this.vd&&this.log("Zooming to: %s (scale %s)",a,this.scale);var b=this.Gd().width-20;var c=this.ea.Bs()||this.Wd;var e=!0;this.vd=a;c||"number"===typeof a||(this.log("WARNING: Cannot zoom to page/width because the document size has not been set."),e="page"===a||
"width"===a);if("number"===typeof a)this.scale=a;else if("none"===a||this.ea.empty()||!c)this.scale=1;else{if("page"===a)return c=this.Ye(),this.og(c,"centre"===this.fa.get("pagePlacement"),!0),this.vd=a,this.oa.df&&this.oa.df(),e;"width"===a&&(c=this.Ye(),this.scale=b/c.width,this.sb=-c.x*this.scale,this.fb=-c.y*this.scale,this.log("RECT=%s scale=%s tx=%s ty=%s",c,this.scale,this.sb,this.fb),this.vd=a)}this.mc();this.ha();this.oa.df&&this.oa.df();return e};c.prototype.sh=function(a,b,c){void 0===
c&&(c=!1);a=this.Uk().apply(a,b);c||(a=this.Na(a));return a};c.prototype.wk=function(a,b){return this.Uk().inverse().apply(a,b)};c.prototype.dt=function(a,b,c){return a.Id().multiply(this.Uk()).apply(b,c)};c.prototype.ze=function(a){return this.sh(a.pageX,a.pageY,!0)};c.prototype.Rc=function(a,b){if("TEXTAREA"!==b.target.tagName&&"INPUT"!==b.target.tagName&&!b.target.isContentEditable&&(this.oa.Rc&&this.oa.Rc(a,b),!this.xs(a,b))){switch(a){case "next-page":this.Sb(this.ea.Ra+1);break;case "previous-page":this.Sb(this.ea.Ra-
1);break;case "zoom-to-page":this.fa.get("allowZoom")&&this.Xc("page");break;case "zoom-to-width":this.fa.get("allowZoom")&&this.Xc("width")}b.preventDefault();b.stopPropagation()}};c.prototype.ij=function(a){var b=(b=a instanceof Wd?a.qd.target:a.target)&&b.classList.contains("zwibbler-scrollbar")||this.oa.rc&&"pick"===this.oa.rc()&&b&&b.matches&&b.matches(".zwibbler-dom-node *")&&!b.classList.contains("zwibbler-passthrough")&&!b.matches(".zwibbler-passthrough *");a instanceof Wd&&((b=b&&!a.getData("not-passthrough"))||
"down"!==a.type||a.setData("not-passthrough",!0));return b};c.prototype.Jt=function(){function a(a){c.log(a.type)}function b(a){a.stopPropagation();a.preventDefault()}var c=this,e=this;this.Kk();"";var g=new be(this.oc,{en:this.fa.get("allowPointerEvents"),Dp:!0});this.Cu=g;this.va.add(function(){g.Kc()});g.sa("gesturestart",function(a){e.log("GestureStart");e.oa.ib&&!1!==e.oa.ib(a)?(a.stopPropagation(),a.preventDefault()):e.log("Pass to browser")});g.sa("gesturechange",function(a){e.oa.ib&&!1!==
e.oa.ib(a)?(a.stopPropagation(),a.preventDefault()):e.log("Pass to browser")});g.sa("gestureend",function(a){e.log("GestureEnd");e.oa.ib&&!1!==e.oa.ib(a)?(a.stopPropagation(),a.preventDefault()):e.log("Pass to browser")});var f="onpointerdown"in window,h="ongesturestart"in window,l="onmousedown"in window;this.log("Have TouchEvents: %s","ontouchstart"in window);this.log("Have PointerEvents: %s",f);this.log("Have GestureEvents: %s",h);this.log("Have MouseEvents: %s",l);f&&!this.fa.get("allowPointerEvents")&&
this.log("Configuration does not allow PointerEvents");var k=!1,m;this.ul=function(){e.log("Preventing next double click.")};g.sa("down",function(a){e.log(a.toString());c.ij(a)||(k=!0,e.oa.wb&&(m=e.ze(a),!1!==e.oa.wb(m.x,m.y,a)&&(a.stopPropagation(),a.preventDefault())))});g.sa("move",function(a){c.ij(a)||(k&&0===a.buttons&&(e.log("MISSED POINTERUP! Fixing."),q(a)),e.oa.Hb&&(m=e.ze(a),!1!==e.oa.Hb(m.x,m.y,a)&&(a.stopPropagation(),a.preventDefault())))});var q=function(a){c.ij(a)||(e.log(a.toString()),
m=e.ze(a),e.oa.Ob&&k&&!1!==e.oa.Ob(m.x,m.y,a)&&(a.stopPropagation(),a.preventDefault()),k=!1)};g.sa("up",q);g.sa("tap",function(a){e.log(a.toString());e.oa.cj&&(m=e.ze(a),!1!==e.oa.cj(m.x,m.y,a)&&(a.stopPropagation(),a.preventDefault()))});g.sa("doubletap",function(a){e.log("doubletap: "+a.toString());e.oa.nl&&(m=e.ze(a),!1!==e.oa.nl(m.x,m.y,a)&&(a.stopPropagation(),a.preventDefault()))});this.va.addEventListener(this.oc,"pointerleave",function(a){e.oa.Mo&&(m=e.ze(a),!1!==e.oa.Mo(m.x,m.y,a)&&(a.stopPropagation(),
a.preventDefault()))});this.va.addEventListener(this.oc,"contextmenu",function(a){var b=e.ze(a);e.oa.Ko&&!1!==e.oa.Ko(b.x,b.y,a)?(a.stopPropagation(),a.preventDefault()):e.log("Pass contextmenu to browser")});this.va.addEventListener(this.oc,"mouseenter",b);this.va.addEventListener(this.oc,"mouseleave",b);this.va.addEventListener(this.oc,"mouseover",b);this.va.addEventListener(this.oc,"mouseout",b);!window.parent&&this.fa.get("setFocus")&&this.oc.focus();f="mousewheel";"onwheel"in document.createElement("div")&&
(f="wheel");e.log("Binding to '%s' for mouse wheel",f);this.va.addEventListener(this.oc,f,function(a){if("wheel"===a.type||"mousewheel"===a.type){var b=a.wheelDelta||-40*a.deltaY,c=b/120*32;m=e.ze(a);if((!e.oa.ol||!1===e.oa.ol(m.x,m.y,c,a))&&e.Zb.Js()){var d=e.Ye();e.fb=-120>=b?Math.max(e.fb+c,-(d.bottom()*e.scale-e.canvas.clientHeight)):Math.min(e.fb+c,-d.y*e.scale);e.mc();e.ha();a.stopPropagation();a.preventDefault()}}});this.va.addEventListener(this.oc,"dragover",function(a){e.log("Dragover");
a.preventDefault()});this.va.addEventListener(this.oc,"drop",a);this.va.addEventListener(this.oc,"dragenter",a);this.va.addEventListener(this.oc,"dragleave",a)};c.prototype.ml=function(a){this.log("Received clipboard event: %s",a.type);if(this.fa.get("allowSystemClipboard"))if(null===a.clipboardData)this.log("Ignored; clipboardData is null.");else{var b=this;switch(a.type){case "copy":case "cut":if(!this.ho())break;this.log("Cut to system clipboard.");var c=this.Oe(!0,this.qc(!1));a.clipboardData.setData("application/zwibbler",
c);a.preventDefault();"cut"===a.type&&this.Jg();break;case "paste":for(this.log("There are %s items on the clipboard",a.clipboardData.items.length),c=0;c<a.clipboardData.items.length;c++){var e=a.clipboardData.items[c];this.log("Item [%s] type is %s",c,e.type);if(b.vl(e)){a.preventDefault();break}else if("application/zwibbler"===e.type){this.log("Pasting from system clipboard");e.getAsString(function(a){b.nh(a)});a.preventDefault();break}}}}else this.log("   ignored due to allowSystemClipboard setting.")};
c.prototype.vl=function(a){var b=this;if(0!==a.type.indexOf("image/"))return!1;a instanceof File||(a=a.getAsFile());var c=new FileReader;c.readAsDataURL(a);c.onloadend=function(){b.at(c.result)};return!0};c.prototype.xs=function(a,b){if(!this.Ea.mb)return!1;var c=0,e=0,g=this.fa.get("nudge");switch(a){case "right":c=g;break;case "left":c=-g;break;case "down":e=g;break;case "up":e=-g;break;case "enter":if(this.oa.cj){this.Ea.Va=!1;var f="tap"}else this.Ea.Va=!this.Ea.Va,f=this.Ea.Va?"down":"up"}if(c||
e)f=this.Gd(),this.Ea.x+=c,this.Ea.x=Math.max(this.Ea.x,0),this.Ea.x=Math.min(f.width,this.Ea.x),this.Ea.y+=e,this.Ea.y=Math.max(this.Ea.y,0),this.Ea.y=Math.min(f.height,this.Ea.y),this.ha(),f="move";return f?(b.preventDefault(),b.stopPropagation(),this.ha(),e=y(this.canvas).pc(),c=this.Ea.x+e.left-window.pageXOffset,g=this.Ea.y+e.top-window.pageYOffset,e=this.sh(c,g),this.log("Simulate a %s at (%s,%s)",f,c,g),c=new Wd(f,c,g,c,g,(new Date).getTime(),(new Date).getTime(),b.target,b,0,{},0,0,!1,!1),
"down"!==f&&"tap"!==f||!this.oa.wb||this.oa.wb(e.x,e.y,c),"move"===f&&this.oa.Hb&&this.oa.Hb(e.x,e.y,c),"up"!==f&&"tap"!==f||!this.oa.Ob||this.oa.Ob(e.x,e.y,c),!0):!1};c.prototype.Ol=function(a){void 0===a&&(a=!1);this.Ea.mb=!0;this.Ea.Va=!1;this.Ea.ik=a;this.log("Showing keyboard cursor, caret=%s",a);this.ha()};c.prototype.ou=function(){this.Ea.mb=!0;this.Ea.ik=!1;if(0<this.selection.length){this.log("showKeyboardCursorAndStartMoving()");this.Ea.Va=!0;var a=this.Uc.ed();this.Ea.x=a.x;this.Ea.y=a.y;
this.Za();this.$a(new Cd(this,new xd(rd,this.selection[0].Ha()),!1,a.x-4,a.y-4))}this.ha()};c.prototype.Cs=function(){this.Ea.mb&&(this.log("Hiding keyboard cursor"),this.Ea.mb=!1,this.ha())};c.prototype.Is=function(a){var b=this.Kk(),c=y(this.canvas).pc(),e=this.Zb.Tk();var g=a.pageX-c.left-b;a=a.pageY-c.top-b;b=this.Gd();return this.Ae&&g>b.width-this.Ae.width-e&&a<this.Ae.height};c.prototype.Na=function(a,b){void 0===b&&(b=0);b=b||this.fa.get("snap")||0;this.fa.get("autoSnap");if(0<b){var c=Math.round(a.x/
b)*b;var e=Math.round(a.y/b)*b}else c=a.x,e=a.y;return new z(c,e)};c.prototype.Zi=function(){var a=this.qc(!1);a.length&&this.qa([new Nc(a,Nc.Dm)])};c.prototype.Yi=function(){var a=this.qc(!1);a.length&&this.qa([new Nc(a,Nc.Cm)])};c.prototype.Zh=function(a){void 0===a&&(a=this.qc(!1));a.length&&this.qa([new Nc(a,Nc.um)])};c.prototype.pj=function(a){void 0===a&&(a=this.qc(!1));a.length&&this.qa([new Nc(a,Nc.Pj)])};c.prototype.setProperty=function(a,b){var c=this.qc(!0);this.za[a]=b;if(c.length){var e=
[new Gc(c,a,b)];if("fillStyle"===a)for(var g=0;g<c.length;g++){var f=this.ea.xa(c[g],!1);f&&(this.log("nodeType=%s closed=%s",f.type(),f.ja("closed")),"PathNode"===f.type()&&!1===f.ja("closed")&&e.push(new Gc([c[g]],"strokeStyle",b)))}this.qa(e)}0<this.selection.length&&"lineWidth"===a&&"BrushNode"===this.selection[0].type()?this.Qf=b:"textFillStyle"===a&&(this.za.textFillStyle=b)};c.prototype.sd=function(a,b){this.oa.sd&&this.oa.sd(a,b)};c.prototype.Ei=function(){return this.za.fillStyle};c.prototype.Ii=
function(){return this.za.strokeStyle};c.prototype.Nl=function(a,b){this.log("setSelectionOpacity(%s, fill=%s)",a,b);for(var c=this.qc(!0),e=[],g=b?"fillStyle":"strokeStyle",f=0;f<c.length;f++){var h=c[f],l=this.ea.xa(h);l&&(l=l.ja(g))&&(l=yb(l,a),e.push(new Gc([h],g,l)),this.log("   set %s of %s to %s",g,h,l))}e.length&&this.qa(e);this.log("   Affected %s of %s nodes",e.length,c.length)};c.prototype.group=function(){var a=this.qc(!1);a.length&&this.qa([new Jc(this.ea.Wa(),a)])};c.prototype.Dh=function(){var a=
this.qc(!1);a.length&&this.qa([new Kc(a)])};c.prototype.Jg=function(){var a=this.qc(!1);a.length&&this.qa([new Fc(a)])};c.prototype.ob=function(a){void 0===a&&(a=!1);var b=!1;0<this.selection.length&&(this.Rb+=1,this.selection.length=0,this.log("Clear selection. selectGeneration=%s",this.Rb),b=!0);null!==this.hd&&(this.Ba.ma("selected-edit-handle",null,null),b=!0);this.ya&&(this.log("Clear selection."),this.hd=this.ya=null,b=!0);b&&a&&(this.Mb(),this.ha())};c.prototype.de=function(a,b){void 0===b&&
(b=!0);this.yf(null);if(a.Rb!==this.Rb&&a.Ac()===this.Qa){this.selection.push(a);a.Rb=this.Rb;if(a.qo()){for(var c=a.parent,e=0;e<c.children.length;e++)this.de(c.children[e]);this.de(c)}a.children&&0<a.children.length&&this.de(a.children[0]);if(this.fa.get("autoGroup")&&b)for(c=0,e=this.ea.Jr(a);c<e.length;c++)this.de(e[c],!1)}};c.prototype.selectNodes=function(a){this.ob();for(var b=0;b<a.length;b++)a[b].ja("locked")||"PageNode"===a[b].type()||this.de(a[b]);this.Mb()};c.prototype.Tt=function(a,b){var c=
this.ea.xa(a,!1);c?c.no()?(c!==this.ya&&this.yf(c),this.log("Select edit handle %s",b),this.hd=b,this.Ba.ma("selected-edit-handle",a,b)):this.log("selectEditHandle: That handle is not selectable."):this.log("selectEditHandle: nodeid %s does not exist.",a)};c.prototype.qa=function(a,b){void 0===b&&(b=!1);if(this.fa.get("readOnly")&&!b)this.log("readOnly mode: Ignoring change.");else if(0!==a.length){var c=this.ea.qa(a,b),e;this.ea.format(this.ia,this.request);if(c.$b.length&&!b){var g=[];for(e=0;e<
c.$b.length;e++)g.push(this.ea.xa(c.$b[e],!1));this.fa.get("autoPickTool")&&this.selectNodes(g)}else if(this.selection.length||this.ya){e=!1;for(g=0;g<a.length;g++){var f=a[g];if(f instanceof Gc&&("lockSize"===f.name||"lockRotate"===f.name||"lockPosiiton"===f.name||"lockAspectRatio"===f.name)||f instanceof Nc){e=!0;break}}if(0<c.rf.length||e){g=0;this.Rb+=1;f=this.ea.Ra;for(e=0;e<this.selection.length;e++)e!==g&&(this.selection[g]=this.selection[e]),this.ea.Ue(this.selection[g].id)&&this.ea.nd(this.selection[g].id)===
f&&(this.selection[g].Rb=this.Rb,g++);this.selection.length!==g&&(this.selection.length=g);this.ya&&!this.ea.Ue(this.ya.id)&&(this.log("EditNode %s no longer exists",this.ya.id),this.ya=null,null!==this.hd&&this.Ba.ma("selected-edit-handle",null,null),this.hd=null);0!==this.selection.length||this.ya||this.ob();this.Mb();this.log("Done selecting called.")}}this.bo(c);this.tf();this.ha();this.Ba.Ng("document-changed")}};c.prototype.St=function(a){a=this.ea.ms(a);for(var b=0;b<a.length;b++)this.de(a[b])};
c.prototype.Mb=function(){this.Pf();this.Ba.Ng("selected-nodes")};c.prototype.yl=function(){for(var a=0,b=this.Li;a<b.length;a++){var c=b[a];""!==c.$e&&this.Ri.release(c.$e)}this.Li.length=0};c.prototype.wc=function(a,b,c,e,g,f,h){this.Li.push({type:f,position:new z(a,b),offset:new z(c,e),$e:g,tn:h});""!==g&&this.Ri.add(g,g)};c.prototype.Pf=function(){var a;this.hg=this.ig=this.th=!0;var b=!1;this.wf.length=0;if(0!==this.selection.length){this.Uc=this.selection[0].rect.clone();this.selection[0].ja("lockSize")&&
(this.th=!1);this.selection[0].ja("lockRotation")&&(this.ig=!1);this.selection[0].ja("lockPosition")&&(this.hg=!1);this.selection[0].ja("lockAspectRatio")&&(b=!0);for(a=1;a<this.selection.length;a++)this.Uc.Eh(this.selection[a].rect),this.selection[a].ja("lockSize")&&(this.th=!1),this.selection[a].ja("lockRotation")&&(this.ig=!1),this.selection[a].ja("lockAspectRatio")&&(b=!0),this.selection[a].ja("lockPosition")&&(this.hg=!1);this.Fl=1===this.selection.length?this.selection[0].yi():new Sb(this.Uc);
var c=0<this.fa.get("snap");if(1<this.selection.length){var e=new F;a=null;var g=this.Uc}else a=this.selection[0],g=a.Ka,e=a.Ha();for(var f=0,h=this.Li;f<h.length;f++){var l=h[f];if("scale"===l.type){if(!this.fa.get("allowResize")||!this.th)continue;if("scale"===l.type&&(0!==l.position.x&&1!==l.position.x||0!==l.position.y&&1!==l.position.y)&&b)continue}else if("rotate"===l.type&&!this.ig)continue;this.wf.push(Ad(l,g,e,c))}if(this.ig&&a&&a.ja("rotationHandles"))for(b=a.ja("rotationHandles"),a=0;a<
b.length;a+=4)new z(b[a],b[a+1]),f=new z(b[a+2],b[a+3]),this.wf.push(new wd(sd,e,g,f,c))}};c.prototype.Gq=function(){for(var a=0,b=0;b<this.selection.length;b++)b!==a&&(this.selection[a]=this.selection[b]),this.ea.Ue(this.selection[a].id)&&(a+=1);this.selection.length!==a&&(this.selection.length=a);this.ya&&!this.ea.Ue(this.ya.id)&&(this.ya=null,null!==this.hd&&this.Ba.ma("selected-edit-handle",null,null),this.hd=null)};c.prototype.So=function(a,b){return this.selection.length&&this.Fl.fd(a,b)};c.prototype.ho=
function(){return 0!==this.selection.length||null!==this.ya};c.prototype.Cc=function(){var a=this.selection.concat();this.ya&&a.push(this.ya);return a};c.prototype.ls=function(a){if(0===a.length)return new z(0,0);for(var b=a[0].rect.clone(),c=1;c<a.length;c++)b.Eh(a[c].rect);return b.ed()};c.prototype.Yn=function(a){for(var b=[],c=0;c<a.length;c++)this.log("Selected id=%s",a[c].id),b.push(a[c].id);return b};c.prototype.Uk=function(){var a=y(this.canvas).pc();this.fa.get("showRuler")&&(a.left+=20,
a.top+=20);return(new F).multiply(new Kb(1/this.scale,1/this.scale)).multiply(new E(-this.sb,-this.fb)).multiply(new E(-a.left,-a.top))};c.prototype.qc=function(a){var b=this.Cc();a||(b=this.ea.ai(b));return this.Yn(b)};c.prototype.Lk=function(a){for(var b=null,c=0;c<a.length;c++){var e=this.ea.xa(a[c]);e&&(null===b?b=e.rect.clone():b.Eh(e.rect))}null===b&&(b=new B(0,0,0,0));return b};c.prototype.update=function(a,b){void 0===a&&(a=!1);if(this.ea.format(this.ia,this.request)||a)this.Pf(),this.ha(b)};
c.prototype.fi=function(){var a=this.fa.get("snap"),b=null,c;var e=this.fa.get("background");var g=u.xi(e),f=this.fa.get("backgroundImage");this.background=this.Ie=null;this.backgroundRepeat="no-repeat";var h=this;this.log("createBackground() background=%s",e);this.log("backgroundNodeId==%s",this.cd);if("grid"===e){this.backgroundRepeat="repeat";a=this.fa.get("gridBlocks");f=this.fa.get("gridSpacing");var l=(a||1)*f;b=rb(document.body);b.width=l;b.height=l;e=b.getContext("2d");e.fillStyle="#ffffff";
e.fillRect(0,0,l,l);e.beginPath();for(c=0;c<l;c+=f)if(c%l||1>a)e.moveTo(c+.5,0),e.lineTo(c+.5,l);for(c=0;c<l;c+=f)if(c%l||1>a)e.moveTo(0,c+.5),e.lineTo(l,c+.5);e.strokeStyle=this.fa.get("gridColour");e.lineWidth=.5;e.stroke();if(0<a){e.beginPath();for(c=0;c<=l;c+=l)e.moveTo(c,0),e.lineTo(c,l);for(c=0;c<=l;c+=l)e.moveTo(0,c+.5),e.lineTo(l,c+.5);e.lineWidth=2;e.stroke()}}else if(f)this.request.add(0,"image",f,null,function(a){h.log("Background image finished loading");h.background=a});else if(this.cd){if(this.log("Regenerate background image"),
a=this.ea.xa(this.cd,!1))e=a.rect.clone(),b=rb(document.body),b.width=e.x+e.width,b.height=e.y+e.height,e=b.getContext("2d"),a.ha(e)}else g?(this.log("Using background colour %s",g.toString()),this.Ie=function(a,b,c,d,e){a.fillStyle=g.toString();a.fillRect(b,c,d,e)}):0<a&&"clear"!==e&&(this.backgroundRepeat="repeat",b=rb(document.body),b.width=a,b.height=a,e=b.getContext("2d"),e.beginPath(),e.moveTo(0,0),e.arc(0,0,3,0,2*Math.PI,!1),e.moveTo(a,0),e.arc(a,0,3,0,2*Math.PI,!1),e.moveTo(a,a),e.arc(a,a,
3,0,2*Math.PI,!1),e.moveTo(0,a),e.arc(0,a,3,0,2*Math.PI,!1),e.fillStyle="#c0c0c0",e.fill());b&&document.body.removeChild(b);this.background=b};c.prototype.Dd=function(a,b,c,e,g){a.wd=null;this.background?(a.wd=a.createPattern(this.background,this.backgroundRepeat),a.fillStyle=a.wd||"magenta",a.fillRect(b,c,e,g)):this.Ie?this.Ie(a,b,c,e,g):"G_vmlCanvasManager"in window&&(a.fillStyle="rgba(0, 0, 0, 0.0)",a.fillRect(b,c,e,g))};c.prototype.cr=function(a){var b=this.ea.Sk();a.beginPath();a.fillStyle="#FFFFFF";
this.fa.get("pageShadow")&&(a.shadowOffsetX=3/this.scale,a.shadowOffsetY=3/this.scale,a.shadowBlur=5/this.scale,a.shadowColor="rgba(0,0,0,1.0)");a.rect(0,0,b.width,b.height);a.fill();a.shadowColor="rgba(0,0,0,0.0)";a.shadowBlur=0;a.shadowOffsetX=0;a.shadowOffsetY=0;a.strokeStyle=this.fa.get("pageBorderColour");a.stroke();this.Dd(a,0,0,b.width,b.height);this.Ie&&this.Ie(a,0,0,b.width,b.height)};c.prototype.Jl=function(a){a?(this.log("Setting a custom background function."),this.Ie=a):this.log("Clearing custom background function.")};
c.prototype.br=function(a){if(this.Ea.mb){var b=this.Ea.x,c=this.Ea.y,e=this.Ug();a.save();a.setTransform(e,0,0,e,0,0);a.beginPath();this.Ea.ik?(a.moveTo(b-3,c-10),a.lineTo(b+3,c-10),a.moveTo(b-3,c+10),a.lineTo(b+3,c+10),a.moveTo(b,c-10),a.lineTo(b,c+10)):(a.moveTo(b,c-3),a.lineTo(b,c-15),a.moveTo(b,c+3),a.lineTo(b,c+15),a.moveTo(b-3,c),a.lineTo(b-15,c),a.moveTo(b+3,c),a.lineTo(b+15,c));this.Ea.Va&&this.ia.arc(b,c,8,0,2*Math.PI,!1);a.lineWidth=2;a.strokeStyle="#000000";a.stroke();a.restore()}};c.prototype.df=
function(){var a=this.fa.get("showRuler")?20:0,b=y(this.canvas).pc(),c=y(this.canvas.parentElement).pc(),e=this.canvas.clientWidth,g=this.canvas.clientHeight,f=b.left-c.left;b=b.top-c.top;c=this.Kk();this.Zb.moveTo(f+e-20+c,b+c+a);this.Zb.ng(20,g-20);this.Oc.moveTo(f+c+a,b+g-20+c);this.Oc.ng(e-20,20);this.tf();this.ha()};c.prototype.tf=function(){if(!this.cl()){var a=this.Ye(),b=this.Gd();b=new B(0,0,b.width,b.height);a.Ed(this.kl)&&b.Ed(this.jl)||!this.Xc(this.vd)||(this.kl=a,this.jl=b)}};c.prototype.un=
function(){if(this.Wd){var a=this.ea.Sk();this.ia.save();this.ia.beginPath();this.ia.rect(0,0,a.width,a.height);this.ia.clip()}return this.Wd};c.prototype.ha=function(a){if(!this.cl()&&(this.gd=a||null,!this.Bk)){this.Bk=!0;var b=this;this.requestAnimationFrame.call(window,function(){if(!b.Ba.mi){b.Bk=!1;var a=b.Ug();a!==b.aj&&(b.log("Detected DPR change; resize canvas now"),b.jp(b.Je.width,b.Je.height),b.aj=a);var c=b.Jd(),g=c.x,f=c.y,h=c.width,l=c.height;b.ia.setTransform(1,0,0,1,0,0);b.ia.clearRect(0,
0,b.canvas.width,b.canvas.height);b.Wd&&(b.ia.fillStyle=b.fa.get("outsidePageColour"),b.ia.fillRect(0,0,b.canvas.width,b.canvas.height));b.ia.scale(a,a);b.ia.translate(b.sb,b.fb);b.ia.scale(b.scale,b.scale);b.fa.get("showRuler")&&b.ia.translate(20/b.scale,20/b.scale);var k=new E(b.sb,b.fb);k=k.multiply(new Kb(b.scale,b.scale));b.ia.Hh=k;b.Wd?b.cr(b.ia):b.Dd(b.ia,g,f,Math.max(h,h-g),Math.max(l,l-g));b.ea.nu();g=b.un();b.ea.ha(b.ia,c);b.Ba.gd&&(b.ia.save(),b.Ba.gd(b.ia),b.ia.restore());0<b.selection.length&&
(b.ia.save(),b.dr(b.ia),b.ia.restore());g&&b.ia.restore();b.ya&&b.ya.ri(b.ia,1/b.scale,b.hd);""!==b.Xf&&b.fa.get("showHints")&&(b.ia.save(),b.ia.font=15/b.scale+"px Arial",b.ia.fillStyle="#000000",b.ia.textBaseline="top",b.ia.fillText(b.Xf,0,0),b.ia.restore());b.br(b.ia);b.oa.dj&&b.oa.dj(b.ia);b.gd&&b.gd(b.ia);b.Ba.Re("draw",b.ia);b.fa.get("showRuler")&&(b.ia.setTransform(a,0,0,a,0,0),c=b.fa.get("pixelsPerUnit")*b.scale,g=b.fa.get("units"),b.ia.fillStyle="#ccc",b.ia.fillRect(0,0,20,20),Qd(b.ia,new B(20,
0,b.canvas.width-20,20),0,g,c,-b.sb),Qd(b.ia,new B(0,20,20,b.canvas.height-20),2,g,c,-b.fb));b.ia.setTransform(1,0,0,1,0,0);0<b.selection.length&&b.Ae&&b.Ae.naturalWidth&&(c=b.Ae.width,b.ia.drawImage(b.Ae,b.canvas.width-c-b.Zb.Tk(),0));b.Mg&&b.Mg.complete&&b.Mg.naturalWidth&&(c=b.Mg.naturalWidth,b.ia.drawImage(b.Mg,b.canvas.width-c-b.Zb.Tk(),0));b.ia.setTransform(a,0,0,a,0,0);b.ia.beginPath();b.ia.font="20px Arial";h=b.ia.measureText(de).width;a=b.canvas.width/a/h;b.ia.scale(a,a);b.ia.textBaseline=
"top";b.ia.lineWidth=4/a;b.ia.strokeStyle="rgba(128, 128, 128, 0.1)";b.ia[ge](de,0,0)}})}};c.prototype.dr=function(a){a.lineWidth=1/this.scale;a.strokeStyle="#888888";a.beginPath();for(var b=0;b<this.selection.length;b++){var c=this.selection[b];var e=c.Ha();c=new H(c.Ka);c.transform(e);c.pi(a,[3/this.scale,3/this.scale])}a.stroke();for(b=0;b<this.wf.length;b++)this.wf[b].ha(a,this.Ri,this.scale,this.oj)};c.prototype.yf=function(a){this.ya=a};c.prototype.Nk=function(){return this.ya};c.prototype.Cj=
function(a){this.oj=a};c.prototype.Hs=function(a){return a.Rb===this.Rb};c.prototype.Xr=function(a,b){if(this.ya)return null;for(var c=this.Bm,e=null,g=0;g<this.wf.length;g++){var f=this.wf[g];if(f.qb(this.Ri,a,b,c,this.scale)){e=f;break}}return e};c.prototype.gb=function(){this.Bp(!1)};c.prototype.Sd=function(){this.Bp(!0)};c.prototype.Bp=function(a){if(a?this.ea.zd():this.ea.Ad())a=a?this.ea.Sd():this.ea.gb(),this.ea.format(this.ia,this.request),this.Gq(),this.Pf(),this.tf(),this.mc(),this.bo(a),
a=this.ea.$f,this.log("Most recent change page=%s",a),a!==this.ea.Ra?(this.log("Undo/redo switched page %s->%s",this.ea.Ra,a),this.Sb(a)):this.ha(),this.Ba.ma("document-changed")};c.prototype.rk=function(){this.Oe();this.Jg()};c.prototype.Oe=function(a,b){void 0===a&&(a=!1);var c=b?this.ea.Qk(b,!1,!1):this.Cc();var e=this.ea.Rt(c);0<c.length&&(!0!==a&&md.setItem("clipboard",e),this.log("Reset paste offset to 0"),this.Bh=this.Ah=0);return e};c.prototype.duplicate=function(){var a=this.qc(!1),b=this.fa.get("pasteOffset"),
c=b||this.fa.get("pasteOffsetX");b=b||this.fa.get("pasteOffsetY");0<a.length&&this.qa([new Mc(a,c,b)])};c.prototype.nh=function(a){if(!a&&(a=md.getItem("clipboard"),!a))return;var b=this.fa.get("pasteOffset"),c=b||this.fa.get("pasteOffsetX");b=b||this.fa.get("pasteOffsetY");this.Ah+=c;this.Bh+=b;this.log("Using paste offset %s,%s",this.Ah,this.Bh);c=new E(this.Ah,this.Bh);a=this.ea.xo(a,c);this.qa(a);this.update()};c.prototype.sj=function(a){""!==a?(this.Xf=this.language.get(a),this.Ba.ma("hint",
this.Xf)):(this.Xf="",this.Ba.ma("hint",""))};c.prototype.Za=function(){return this.$a(new od(this))};c.prototype.$a=function(a){this.oa&&this.oa.Fc&&this.oa.Fc();this.oa=a;a.Mc&&a.Mc();a.rc&&this.Ba.ma("tool-changed",a.rc());return a};c.prototype.Tg=function(){var a=null;this.oa.rc&&(a=this.oa.rc());return a};c.prototype.Zl=function(a){a=new Dd(this,a);this.$a(a);return a};c.prototype.vo=function(a,b,c){this.$a(new Id(this,"line",void 0,a,b,c))};c.prototype.zk=function(a){a.lineWidth=a.lineWidth||
this.Qf;a.strokeStyle=a.strokeStyle||this.Vb;this.$a(new Hd(this,this.oa,a,"brush"))};c.prototype.er=function(a){a.lineWidth=a.lineWidth||this.Qf;a.strokeStyle=a.strokeStyle||this.Vb;this.$a(new Hd(this,this.oa,a,"shapebrush"))};c.prototype.Cn=function(a,b){a.lineWidth=a.lineWidth||this.Qf;a.strokeStyle=a.strokeStyle||this.Vb;this.$a(new Hd(this,this.oa,a,b))};c.prototype.yn=function(a){this.$a(new Id(this,"curve",void 0,a))};c.prototype.rq=function(a,b){this.$a(new Id(this,"arrow",void 0,a,b))};
c.prototype.Ye=function(){if(this.Wd){var a=this.ea.Sk();var b=this.fa.get("pageInflation");a.pd(b,b)}else a=this.ea.Gb();return a};c.prototype.mc=function(){if(!this.cl())if(this.Ba.ma("scroll"),this.fa.get("scrollbars")){var a=this.Gd(),b=this.Ye(),c=this.Jd(),e=!1,g=!1;c.y<=b.y&&c.bottom()>=b.bottom()?this.Zb.ne():(this.Zb.show(),this.Zb.sp(Math.min(c.y,b.y),Math.max(c.bottom(),b.bottom()),c.height,-this.fb/this.scale),e=!0);c.x<=b.x&&c.right()>=b.right()?this.Oc.ne():(this.Oc.show(),this.Oc.sp(Math.min(c.x,
b.x),Math.max(c.right(),b.right()),c.width,-this.sb/this.scale),g=!0);g&&e?(this.Zb.ng(20,a.height-20),this.Oc.ng(a.width-20,20)):e?this.Zb.ng(20,a.height):g&&this.Oc.ng(a.width,20)}else this.Zb.ne(),this.Oc.ne()};c.prototype.kg=function(a,b,c){this.log("Set document size %s,%s",a,b);c?c.push(new Pc({width:a,height:b})):(this.ea.setProperty("width",a),this.ea.setProperty("height",b),this.mc(),this.tf(),this.Ba.ma("document-changed"));return!0};c.prototype.$i=function(a,b,c){if(this.hg)if(this.Ea.mb)this.log("Not nudging; keyboard cursor shown.");
else return a*=c/this.scale,b*=c/this.scale,this.log("Nudge selection by %s, %s",a,b),c=this.qc(!0),c.length&&(a=new E(a,b),this.qa([new Hc(c,a)]),this.Cj(a.multiply(this.oj))),0<c.length;else this.log("Can't nudge; selection motion is locked.")};c.prototype.Fh=function(a){var b=new T;var c=new z(-50,-50);var e=new z(50,-50);var g=new z(50,50);var f=new z(-50,50);b.moveTo(c.x,c.y);b.lineTo(e.x,e.y);b.lineTo(g.x,g.y);b.lineTo(f.x,f.y);b.lineTo(c.x,c.y);b.close();a=Eb({},{commands:b.Tb(),fillStyle:this.xb,
strokeStyle:this.Kb,seed:Math.round(65535*Math.random()),lineWidth:this.zg(this.za.lineWidth),sloppiness:this.za.sloppiness,layer:this.Qa,wrap:this.fa.get("multilineText"),fontSize:this.fa.get("defaultFontSize")},a);this.log("Create an item on layer %s",this.Qa);this.$a(new Jd(this,"PathNode",a,100,100,"rectangle","rectangle",null))};c.prototype.km=function(a,b,c,e){var d=new T;for(var f=0;f<=a;f++){var h=50*Math.sin(b),l=50*-Math.cos(b);f&1&&(h*=c,l*=c);"matrix"in e&&(l=e.matrix.apply(h,l),h=l.x,
l=l.y);0===f?d.moveTo(h,l):d.lineTo(h,l);b+=2*Math.PI/a}d.close();"matrix"in e&&delete e.matrix;e=Eb({},{commands:d.Tb(),fillStyle:this.xb,strokeStyle:this.Kb,seed:Math.round(65535*Math.random()),lineWidth:this.zg(this.za.lineWidth),sloppiness:this.za.sloppiness,layer:this.Qa,wrap:this.fa.get("multilineText"),fontSize:this.fa.get("defaultFontSize")},e);this.log("Create an item on layer %s",this.Qa);this.$a(new Jd(this,"PathNode",e,100,100,this.fa.Wn(),"polygon",null))};c.prototype.rt=function(){this.$a(new Od(this))};
c.prototype.Ej=function(a){var b=new z(0,0);var c=new T;c.moveTo(b.x,b.y-50);c.Pe(b.x+50,b.y-50,b.x+50,b.y);c.Pe(b.x+50,b.y+50,b.x,b.y+50);c.Pe(b.x-50,b.y+50,b.x-50,b.y);c.Pe(b.x-50,b.y-50,b.x,b.y-50);c.closePath();b=c.Tb();a=Eb({},{commands:b,fillStyle:this.xb,strokeStyle:this.Kb,seed:Math.round(65535*Math.random()),lineWidth:this.zg(this.za.lineWidth),sloppiness:this.za.sloppiness,layer:this.Qa,wrap:this.fa.get("multilineText"),fontSize:this.fa.get("defaultFontSize")},a||{});this.$a(new Jd(this,
"PathNode",a,100,100,this.fa.Wn(),"circle",null))};c.prototype.lm=function(a,b,c,e,g,f){this.$a(new Jd(this,a,b,c,e,g,"shape",f))};c.prototype.Lu=function(a,b){this.$a(new Nd(this,a,b))};c.prototype.jm=function(a){var b=this.ea.xa(a,!1);if(!b)return this.log("useEditHandleTool: node %s doesn't exist.",a),!1;if(!b.Zg())return this.log("useEditHandleTool: nodetype %s has no edit mode",b.type()),!1;this.Za();this.ob();this.Mb();this.yf(b);this.ha()};c.prototype.at=function(a){var b=this.ea.Wa();var c=
this.Na(new z(100,100));c=new E(c.x,c.y);this.qa([new U(b,"ImageNode",{url:a,layer:this.Qa}),new Hc([b],c)]);this.Za()};c.prototype.od=function(){return vb()};c.prototype.ht=function(a,b){this.oa.qe?(this.log("Simulating click of colour %s",a),this.oa.qe(a,b)):this.log("A colour is not needed for this tool.")};c.prototype.mt=function(a,b){this.oa.re?(this.log("Simulating opacity change %s",a),this.oa.re(a,b)):this.log("An opacity is not needed for this tool.")};c.prototype.Sb=function(a){this.ea.Sb(a)&&
(this.ob(),this.Mb(),this.tf(),this.ha(),this.Ba.ma("set-page",a))};c.prototype.Ll=function(a){this.Wd=a;a=this.Ye();this.sb=-a.x;this.fb=-a.y;this.mc();this.ha()};c.prototype.gp=function(a){var b=this.Jd(),c=b.width/a;a=b.height/a;b.x-=(c-b.width)/2;b.y-=(a-b.height)/2;b.width=c;b.height=a;this.og(b)};c.prototype.Hj=function(){this.gp(this.fa.Dl(1.1*this.scale)/this.scale)};c.prototype.Ij=function(){this.gp(this.fa.Dl(this.scale/1.1)/this.scale)};c.prototype.Qg=function(a,b,c){c=c||this.ls(a);b=
new Lb(b,c.x,c.y);this.qa([new Hc(this.Yn(a),b)])};c.prototype.Nn=function(a,b){this.ho()||this.log("flipSelection: selection is empty");this.Qg(this.Cc(),a,b)};c.prototype.Ug=function(){var a=this.ia;return(window.devicePixelRatio||1)/(a.Bv||a.pv||a.qv||a.sv||a.mv||1)};c.prototype.Gd=function(){var a=this.Je,b=this.fa.get("showRuler")?20:0;return new B(b,b,a.width-b,a.height-b)};c.prototype.jp=function(a,b){var c=this.Ug();this.canvas.width=a*c;this.canvas.height=b*c;this.canvas.style.width=a+"px";
this.canvas.style.height=b+"px";this.Je.width=a;this.Je.height=b};c.prototype.Jd=function(){var a=this.Gd();return new B((0-this.sb)/this.scale,(0-this.fb)/this.scale,a.width/this.scale,a.height/this.scale)};c.prototype.og=function(a,b,c){void 0===b&&(b=!1);void 0===c&&(c=!1);this.log("setViewRect(%s)",a);var d=this.Gd(),g=Math.min(d.width/a.width,d.height/a.height),f=a.x*g,h=a.y*g;this.sb=b?(d.width-a.width*g)/2-f:-f;this.fb=c?(d.height-a.height*g)/2-h:-h;this.vd=this.scale=g;this.mc();this.ha()};
c.prototype.Cr=function(a){this.request.Of?(this.log("Formatting in progress; will call function soon"),this.request.once("done",a)):(this.log("Format already done; call function in 1 tick"),setTimeout(a,0))};c.prototype.Xi=function(a){!this.Jf&&a?(this.log("Locking updates."),this.Jf=!0):this.Jf&&!a&&(this.log("Resuming updates"),this.Jf=!1,this.tf(),this.mc(),this.ha())};c.prototype.cl=function(){this.Jf&&this.log("Updates are locked. Ignoring draw/format request");return this.Jf};c.prototype.$s=
function(){function a(){e.drawImage(b.canvas,g.x*f,g.y*f,g.width*f,g.height*f,g.x*f,g.y*f,g.width*f,g.height*f);l=!0;k=b.Jd();b.log("Got new FASTDRAW buffer.")}var b=this,c=document.createElement("canvas");c.width=this.canvas.width;c.height=this.canvas.height;var e=c.getContext("2d"),g=this.Gd(),f=this.Ug(),h=this,l=!1,k=new B(0,0,0,0);h.ha(a);return{ha:function(b,d){k.Ed(h.Jd())||(l=!1,h.ha(a));h.requestAnimationFrame.call(window,function(){l&&(h.ia.setTransform(1,0,0,1,0,0),h.ia.clearRect(g.x*f,
g.y*f,g.width*f,g.height*f),h.ia.drawImage(c,0,0),b&&(h.ia.scale(f,f),h.ia.translate(g.x,g.y),h.ia.translate(h.sb,h.fb),h.ia.scale(h.scale,h.scale),b.call(d,h.ia)))})}}};return c}();var le=function(){function c(a,b,c){var d=this;this.Ba=a;this.ta=b;this.log=w.create("APP");this.va=new kd;this.bd=null;this.Fo=this.Jo=-1;this.oi=[];this.Gh="";this.El=this.gm=null;for(this.ef=[];null!==b.firstChild;)b.removeChild(b.firstChild);b=y(this.ta).me("position");"absolute"!==b&&"fixed"!==b&&(this.ta.style.position="relative");this.ta.style.overflow="none";this.ta.style.textAlign="left";this.ta.classList.add("zwibbler-main");Q.Md(".zwibbler-main { font-size: 16px; }\n        .zwibbler-passthrough { cursor: pointer; }");
this.ki=new jd(y("div").Wc({width:"300px"}).Aa,this.va);this.log("Zwibbler built on "+new Date(1576802161233)+" for 'web'");this.fa=new Xc(this.va,c);this.language=new La("\nen:arrowhead-size:Arrowhead size\nes:arrowhead-size:Flecha tama\u00f1o\n\nen:arrowhead-size-large:Large\nes:arrowhead-size-large:Grande\n\nen:arrowhead-size-medium:Medium\nes:arrowhead-size-medium:Medio\n\nen:arrowhead-size-none:None\nes:arrowhead-size-none:Nada\n\nen:arrowhead-size-small:Small\nes:arrowhead-size-small:Peque\u00f1o\n\nen:arrowhead-size-tiny:Tiny\nes:arrowhead-size-tiny:Diminuto\n\nen:arrowhead-style:Arrowhead style\nes:arrowhead-style:Flecha estilo\n\nen:arrowhead-style-simple:Simple\nes:arrowhead-style-simple:Llanura\n\nen:arrowhead-style-solid:Solid\nes:arrowhead-style-solid:Denso\n\nen:arrow-keys:Arrow Keys\nes:arrow-keys:Teclas de flecha\n\nen:arrow-tool:Arrow tool\nes:arrow-tool:Flecha\nfr:arrow-tool:Fl\u00e8che\nnl:arrow-tool:Pijl\n\nen:break-apart-group:Break apart group\nes:break-apart-group:Dividir el grupo\n\nen:bring-to-front:Bring to front\nes:bring-to-front:Traer al frente\n\nen:brush-tool:Brush tool\nes:brush-tool:Brocha\nfr:brush-tool:Brosse\nnl:brush-tool:Penseel\n\nen:circle-tool:Circle tool\nes:circle-tool:C\u00edrculo\nfr:circle-tool:Cercle\nnl:circle-tool:Cirkel\n\nen:click-to-place-another-point-or-double-click-to-end-the-line:Click to place another point, or double-click to end the line.\nes:click-to-place-another-point-or-double-click-to-end-the-line:Haga clic para colocar otro punto, o doble clic para finalizar la l\u00ednea\nfr:click-to-place-another-point-or-double-click-to-end-the-line:Cliquez pour placer un autre point, ou double-cliquez pour terminer la ligne.\nnl:click-to-place-another-point-or-double-click-to-end-the-line:Klik op een ander punt te plaatsen, of dubbelklik om de lijn te be\u00ebindigen.\n\nen:click-to-place-first-point-of-line:Click to place first point of line\nes:click-to-place-first-point-of-line:Haga clic para colocar el primer punto de la l\u00ednea\nfr:click-to-place-the-first-point-of-line:Cliquez pour placer le premier point de la ligne\nnl:click-to-place-the-first-point-of-line:Klik om het eerste punt van de lijn te plaatsen.\n\nen:click-to-set-the-end-of-the-line:Click to set the end of the line\nes:click-to-set-the-end-of-the-line:Haga clic para colocar el extremo de la l\u00ednea\nfr:click-to-set-the-end-of-the-line:Cliquez pour d\u00e9finir la fin de la ligne\nnl:click-to-set-the-end-of-the-line:Klik hier voor het einde van de lijn in te stellen.\n\nen:copy:Copy\nes:copy:Copiar\nfr:copy:Copie\nnl:copy:Kopi\u00ebren\n\nen:curve-tool:Curve tool\nes:curve-tool:Curva\nfr:curve-tool:Courbes\nnl:curve-tool:Kromme\n\nen:delete-selection:Delete selection\nes:delete-selection:Eliminar la selecci\u00f3n\n\nen:del-key:Del\nes:del-key:Del\n\nen:double-arrows:Double arrows\nes:double-arrows:flechas dobles\n\nen:draw-curves:Draw curves\nes:draw-curves:Dibuje las curvas\n\nen:draw-lines:Draw lines\nes:draw-lines:Dibujar l\u00edneas\n\nen:duplicate-selection:Duplicate selection\nes:duplicate-selection:Duplica la selecci\u00f3n\n\nen:fill-colour:Fill colour\nes:fill-colour:Color de relleno\n\nen:font:Font\nes:font:Font\n\nen:font-size:Font size\nes:font-size:Tama\u00f1o de letra\n\nen:group-selection:Group selection\nes:group-selection:Grupo la selecci\u00f3n\n\nen:image-tool:Image tool\nes:image-tool:Imagen\nfr:image-tool:Image\nnl:image-tool:Afbeelding\n\nen:image-url:Image URL\nes:image-url:URL de la imagen\n\nen:keyboard:Keyboard\nes:keyboard:Teclado\n\nen:line-style:Line style\nes:line-style:Estilo de l\u00ednea\n\nen:line-style-long-dashes:Long dashes\nes:line-style-long-dashes:Gui\u00f3n largo\n\nen:line-style-short-dashes:Short dashes\nes:line-style-short-dashes:Gui\u00f3n corto\n\nen:line-style-solid:Solid\nes:line-style-solid:Denso\n\nen:line-tool:Line tool\nes:line-tool:Raya\nfr:line-tool:Lignes\nnl:line-tool:Lijn\n\nen:move-selection-away:Move selection away\nes:move-selection-away:Mover la selecci\u00f3n de distancia\n\nen:move-selection-closer:Move selection closer\nes:move-selection-closer:Mover la selecci\u00f3n de distancia\n\nen:move-while-zoomed:Move while zoomed\nes:move-while-zoomed:Desplazarse por la pantalla\n\nen:none:None\nes:none:Nada\n\nen:no:No\nes:no:No\n\nen:outline-colour:Outline colour\nes:outline-colour:Color del contorno\n\nen:outline-thickness:Outline thickness\nes:outline-thickness:Grosor del contorno\n\nen:page-down-key:Page Down\nes:page-down-key:Page Down\n\nen:page-up-key:Page Up\nes:page-up-key:Page Up\n\nen:paste:Paste\nes:paste:Pegar\nfr:paste:Coller\nnl:paste:Plak\n\nen:pick-tool:Pick tool\nes:pick-tool:Seleccionar\nfr:pick-tool:S\u00e9lectionner\nnl:pick-tool:Uitkiezen\n\nen:rectangle-tool:Rectangle tool\nes:rectangle-tool:rect\u00e1ngulo\nfr:rectangle-tool:Rectangle\nnl:rectangle-tool:Rechthoek\n\nen:redo:Redo\nes:redo:Rehacer\nfr:redo:Refaire\nnl:redo:Opnieuw maken\n\nen:rounded-rectangle-tool:Rounded rectangle tool\nes:rounded-rectangle-tool:Rect\u00e1ngulo redondeado\n\nen:save:Save\nes:save:Guardar\n\nen:send-to-back:Send to back\nes:send-to-back:Enviar a la parte posterior\n\nen:shadow:Shadow\nes:shadow:Sombra\n\nen:shape-brush-tool:Shape brush tool\nes:shape-brush-tool:Brush que dibuja formas\n\nen:sloppiness-artist:Artist\nes:sloppiness-artist:Artista\n\nen:sloppiness-cartoonist:Cartoonist\nes:sloppiness-cartoonist:Caricaturista\n\nen:sloppiness-child:Child\nes:sloppiness-child:Ni\u00f1o\n\nen:sloppiness-draftsman:Draftsman\nes:sloppiness-draftsman:Dibujante\n\nen:sloppiness-drunk:Drunk\nes:sloppiness-drunk:Borracho\n\nen:sloppiness:Sloppiness\nes:sloppiness:La dejadez\n\nen:smoothness-sharper:Sharper\nes:smoothness-sharper:Muy afilado\n\nen:smoothness-sharpest:Sharpest\nes:smoothness-sharpest:M\u00e1s afilado\n\nen:smoothness-sharp:Sharp\nes:smoothness-sharp:Afilado\n\nen:smoothness-smoothest:Smoothest\nes:smoothness-smoothest:Muy liso\n\nen:smoothness:Smoothness\nes:smoothness:Lisura\n\nen:smoothness-smooth:Smooth\nes:smoothness-smooth:Liso\n\nen:text-colour:Text colour\nes:text-colour:Color del texto\n\nen:text:Text\nes:text:Texto\n\nen:text-tool:Text tool\nes:text-tool:Texto\nfr:text-tool:Texte\nnl:text-tool:Tekst\n\nen:thickness-brush:Brush\nes:thickness-brush:Brocha\n\nen:thickness-marker:Marker\nes:thickness-marker:Rotulador\n\nen:thickness-pencil:Pencil\nes:thickness-pencil:L\u00e1piz\n\nen:thickness-pen:Pen\nes:thickness-pen:Pluma\n\nen:undo:Undo\nes:undo:Deshacer\nfr:undo:D\u00e9faire\nnl:undo:Ongedaan maken\n\nen:yes:Yes\nes:yes:S\u00ed\n\nen:zoom-in:Zoom in\nes:zoom-in:Zoom\n\nen:zoom-out:Zoom out\nes:zoom-out:Disminuir el zoom\n");
this.language.pp(this.fa.get("language"));this.Ag=y("div").He("zwibbler-canvas-holder").Wc({position:"absolute",overflow:"hidden"}).Aa;this.ta.appendChild(this.Ag);this.canvas=rb(this.Ag);y(this.canvas).He("zwibbler-main-canvas").Wc({outline:"0",position:"absolute",left:"0",top:"0",touchAction:"none",pointerEvents:"none"});this.canvas.setAttribute("tabindex","0");this.ia=this.canvas.getContext("2d");this.cc=new Sc;this.view=new ke(this.Ag,this.canvas,new bd,this.cc,this.fa,this.language,this.Ba,this.va);
this.kp();this.so=this.lu();this.va.addEventListener(window,"resize",function(){d.Ba.resize()});window.$&&(this.log("jQuery detected; register for bootstrap events"),window.$(document).bind("shown.bs.modal",function(){d.log("Bootstrap modal shown; resize now");d.Ba.resize()}));null!==this.fa.Oa("backgroundImage")&&(this.Il(this.fa.Oa("backgroundImage")),this.view.ea.rh());this.fa.sa("update",function(a,b){d.Pd(a,b)});Q.Md(".zwibbler-progress-notification {\n            position: absolute;\n            top: 0;\n            right: 0;\n            box-shadow: 3px 3px 3px #444;\n            background: #ccc;\n            color: black;\n            border-bottom-left-radius: 4px;\n            font-family: arial,sans;\n        }");
this.Wo=y("div").He("zwibbler-progress-notification").yd(this.ta).Aa;a.resize();this.fa.get("setFocus")&&this.focus("toolbar");this.Pd("showDebug",this.fa.get("showDebug"));this.Ba.ma("document-changed");this.Ba.ma("set-page",this.view.ea.Ra);if(md.Yh()){if(this.fa.get("persistent")&&(a=md.getItem("zwibbler-document")))try{var g=id.Kh(a);if(g)this.Ud(g);else throw Error("Failed to open document.");}catch(f){this.log("Failed to load persistent document: %s",f.message)}this.gm=nd(function(){d.fa.get("persistent")&&
(d.log("Saving document"),md.setItem("zwibbler-document",d.Ba.save()))});this.Ba.sa("document-changed",function(){d.gm()});this.va.add(function(){d.gm.cancel()})}this.va.add(function(){for(;d.ta.firstChild;)d.ta.removeChild(d.ta.firstChild);d.so.Dg();d.cc.Dg()})}c.prototype.Kc=function(){this.va.Kc()};c.prototype.Pd=function(a,b){var c=!1;this.log("onConfigChange %s=%s",a,b);switch(a){case "showDebug":b?(this.ki.show(),this.yg(0,"right",this.ki.ta)):(this.ki.ne(),this.qh(this.ki.ta));c=!0;break;case "backgroundImage":this.Il(b);
break;case "language":this.language.pp(b)}c&&this.Th()};c.prototype.kp=function(){this.fa.Oa("sloppy")||this.view.we("sloppiness",0);this.view.we("smoothness",this.fa.Qr());this.view.we("fillStyle",this.fa.Oa("defaultFillStyle"));this.view.we("strokeStyle",this.fa.Oa("defaultStrokeStyle"));this.view.we("fontName",this.fa.Oa("defaultFont"));this.view.we("fontSize",this.fa.Oa("defaultFontSize"));this.view.we("lineWidth",this.fa.Oa("defaultLineWidth"));this.view.we("textFillStyle",this.fa.Oa("defaultTextFillStyle"))};
c.prototype.Ud=function(a){this.bd=null;this.view.Ud(a);this.kp();this.sr();this.Ba&&(this.Ba.ma("document-changed"),this.Ba.ma("set-page",a.Ra));for(a=0;a<this.oi.length;a++){var b=this.oi[a];this.log("Removing old DomElement of type %s",b.tagName);y(b).remove()}this.oi=[]};c.prototype.sn=function(){this.view.ea.rh()};c.prototype.lu=function(){var a=this,b=this;this.Gh="none";var c=new ld;this.fa.sq(c);c.sa("*",function(a,c){"canvas"===b.Gh?b.view.Rc(a,c):b.log("Ignore key action -- don't have focus.")});
this.ta.setAttribute("tabindex","0");c.tq(this.ta);this.va.add(function(){a.so.detach(a.ta)});this.view.si=!1;this.va.addEventListener(this.Ag,"click",function(c){if(!a.view.ij(c)){if(ub)c=tb;else{c=-1;if("Microsoft Internet Explorer"===navigator.appName){var d=sb.exec(navigator.userAgent);null!==d&&(c=parseFloat(d[1]))}tb=c;ub=!0;pb("IE version is %s",c)}0<=c&&9>c||b.view.si?b.Gh="canvas":b.focus("canvas");b.view.si=!1}});this.cc.sa("goto-toolbar",function(){b.fa.get("showToolbar")?b.focus("toolbar"):
(a.El&&a.El.focus(),b.Ba.ma("blur"))});this.cc.sa("goto-canvas",function(){b.focus("canvas")});this.va.addEventListener(this.ta,"blur",function(){"text"!==b.view.Tg()&&(b.log("Blur event received -- hide keyboard cursor"),b.view.Cs())});this.fa.sa("allowSystemClipboard",function(b){a.log("allowSystemClipboard=>%s",b);a.fa.$k()&&(a.va.addEventListener(document,"cut",function(b){return a.view.ml(b)}),a.va.addEventListener(document,"copy",function(b){return a.view.ml(b)}),a.va.addEventListener(document,
"paste",function(b){return a.view.ml(b)}))});return c};c.prototype.iu=function(a){this.El=a};c.prototype.focus=function(a){this.log("Set focus to %s",a);if("toolbar"!==a&&"canvas"!==a&&"none"!==a)throw"Focus must be toolbar or canvas or none, not "+a;this.Gh=a;"canvas"===this.Gh&&this.fa.get("setFocus")&&this.ta.focus()};c.prototype.Ol=function(a){void 0===a&&(a=!1);this.focus("canvas");this.view.Ol(a)};c.prototype.createNode=function(a,b,c){var d=this.view.ea.Wa();"layer"in c||(c.layer=this.view.Qa);
a.push(new U(d,b,c));return d};c.prototype.transformNode=function(a,b,c){a.push(new Hc(b,c));return!0};c.prototype.Kl=function(a,b,c,e,g,f,h,l){c=new F(c,g,e,f,h,l);a.push(new Gc(b,"matrix",c));return!0};c.prototype.Ch=function(a,b,c,e){c=new E(c,e);a.push(new Hc(b,c));return!0};c.prototype.nj=function(a,b,c,e,g,f){c=new Kb(c,e,g,f);a.push(new Hc(b,c));return!0};c.prototype.xc=function(a,b){a.push(new Fc(b));return!0};c.prototype.sr=function(){var a=this;this.bd=null;this.view.ea.zc(!1,function(b){"ImageNode"!==
b.type()||"background"!==b.ja("layer")&&"background"!==b.ja("tag")||(a.log("Found background image at nodeid %s",b.id),a.bd=b.id,b.Vd(!0))})};c.prototype.Il=function(a){var b=[];null!==this.bd&&this.view.ea.Ue(this.bd)&&b.push(new Fc([this.bd]));if(a){var c=this.view.ea.Wa();b.push(new U(c,"ImageNode",{url:a,locked:!0,tag:"background",layer:this.view.Qa}));b.push(new Nc([c],Nc.Pj))}this.bd=c||null;this.view.qa(b,!0);c&&this.view.ea.xa(c,!1).Vd(!0);this.view.ob();this.view.Mb()};c.prototype.Lr=function(){return null!==
this.bd&&this.view.ea.Ue(this.bd)?this.view.ea.xa(this.bd).ja("url"):null};c.prototype.gl=function(){this.Ud(new bd);null!==this.fa.Oa("backgroundImage")&&(this.Il(this.fa.Oa("backgroundImage")),this.view.ea.rh())};c.prototype.Th=function(){var a=!0;void 0===a&&(a=!1);var b=this.ta.clientWidth,c=this.ta.clientHeight;if(a||b!==this.Jo||c!==this.Fo){this.log("onResize()");this.Jo=b;this.Fo=c;for(var e=a=0,g=0,f=0,h=0,l=this.ef;h<l.length;h++){var k=l[h];switch(k.position){case "left":case "right":k.ta.style.top=
g+"px";k.ta.style.bottom=f+"px";break;case "top":case "bottom":k.ta.style.left=a+"px",k.ta.style.right=e+"px"}switch(k.position){case "left":k.ta.style.left=a+"px";a+=k.ta.offsetWidth;break;case "right":k.ta.style.right=e+"px";e+=k.ta.offsetWidth;break;case "top":k.ta.style.top=g+"px";g+=k.ta.offsetHeight;break;case "bottom":k.ta.style.bottom=f+"px",f+=k.ta.offsetHeight}}y(this.Ag).Wc({left:a+"px",right:e+"px",top:g+"px",bottom:f+"px"});this.view.jp(b-e-a,c-f-g);y(this.Wo).Wc({top:"0",right:e+"px"});
this.view.df();this.Ba.ma("resize")}else this.log("Ignoring resize; div size did not change.")};c.prototype.Qj=function(a,b,c){void 0===c&&(c=this.view.ea.Ra);var d=this.view.ea.Ra;this.view.ea.Sb(c);a.translate(-b.x,-b.y);this.view.Dd(a,b.x,b.y,b.width,b.height);this.view.ea.ha(a);this.Ba.gd&&this.Ba.gd(a);this.view.ea.Sb(d)};c.prototype.bp=function(a,b,c){0==c&&(c=b.width);var d=c/b.width;if("image/svg+xml"===a||"application/pdf"===a){var g=!1;"image/svg+xml"===a?c=new hd(new B(0,0,b.width,b.height)):
(b=this.view.ea.Gb(0),c=new fd(new B(0,0,b.width,b.height),Q.fonts),g=!0);if(g)for(g=0;g<this.view.ea.Bc();g++)0<g&&(b=this.view.ea.Gb(g),c.pg(b)),this.Qj(c,b,g);else this.Qj(c,b);return"data:"+a+";base64,"+qa(c.toString())}g=document.createElement("canvas");g.setAttribute("width",Math.ceil(b.width*d).toString());g.setAttribute("height",Math.ceil(b.height*d).toString());c=g.getContext("2d");c.scale(d,d);if("image/jpeg"===a||"image/bmp"===a)c.fillStyle="#ffffff",c.fillRect(0,0,b.width,b.height);this.Qj(c,
b);return"image/bmp"===a?Cb(g):g.toDataURL(a)};c.prototype.Vc=function(a,b,c,e){this.log("External app setItemProperty %s: %s=%s",b,c,e);a.push(new Gc(b,c,e));return!0};c.prototype.uh=function(a,b,c){var d;this.log("External app setNodeProperty %s: %s",b,c);for(d in c)c.hasOwnProperty(d)&&a.push(new Gc(b,d,c[d]));return!0};c.prototype.Vf=function(a,b){var c,e;(c=this.view.ea.xa(a))&&(e=c.ja(b));this.log("GetItemProperty %s: %s=%s",a,b,e);return e};c.prototype.mk=function(a,b){var c,e;if(6>b.length)this.log("newShape: Cannot create shape with fewer than three points.");
else{var g=new T;var f=c=0;for(e=b.length-1;c<=e;f=c+=2){var h=this.view.Na(new z(b[f],b[f+1]));if(0===f){g.moveTo(h.x,h.y);var l=h}else g.lineTo(h.x,h.y)}l&&(g.lineTo(l.x,l.y),g.close());return this.gi(a,g.Tb())}};c.prototype.gi=function(a,b){return this.createNode(a,"PathNode",{commands:b,fillStyle:this.view.xb,strokeStyle:this.view.Kb,seed:Math.round(65535*Math.random()),lineWidth:this.view.za.lineWidth,sloppiness:this.view.za.sloppiness,angleArcs:this.fa.get("angleArcs")})};c.prototype.Hg=function(a,
b){var c=this.view.ea.Wa();a.push(new Jc(c,b));return c};c.prototype.Dh=function(a,b){a.push(new Kc(b));return!0};c.prototype.Xq=function(a){return new Yc(this.Wo,a)};c.prototype.yg=function(a,b,c){for(var d=0,g=this.ef;d<g.length;d++)if(g[d].ta===c)return;this.ta.appendChild(c);this.ef.push({order:a,ta:c,position:b});c.style.position="absolute";this.ef.sort(function(a,b){return a.order<b.order?-1:1});this.Th()};c.prototype.qh=function(a){for(var b=0;b<this.ef.length;b++)if(this.ef[b].ta===a){this.ef.splice(b,
1);this.ta.removeChild(a);break}this.Th()};return c}();var me=function(){function c(a,b){this.view=a;this.methods=b;this.log=w.create("CustomToolBehaviour");this.fc=new Ed(a)}c.prototype.Mc=function(){this.log("Entering CustomToolBehaviour");this.methods.enter&&this.methods.enter()};c.prototype.Fc=function(){this.log("Leaving CustomToolBehaviour");this.methods.leave&&this.methods.leave()};c.prototype.cj=function(a,b,c){return this.methods.onMouseClick?this.methods.onMouseClick(a,b,c.qd):!1};c.prototype.wb=function(a,b,c){return this.methods.onMouseDown?
this.methods.onMouseDown(a,b,c.qd):!1};c.prototype.Hb=function(a,b,c){return this.methods.onMouseMove?this.methods.onMouseMove(a,b,c.qd):!1};c.prototype.Ob=function(a,b,c){return this.methods.onMouseUp?this.methods.onMouseUp(a,b,c.qd):!1};c.prototype.Mo=function(a,b,c){return this.methods.onMouseLeave?this.methods.onMouseLeave(a,b,c):!1};c.prototype.nl=function(a,b,c){return this.methods.onDoubleClick?this.methods.onDoubleClick(a,b,c.qd):!1};c.prototype.Ko=function(a,b,c){return this.methods.onContextMenu?
this.methods.onContextMenu(a,b,c):!1};c.prototype.qe=function(a,b){return this.methods.onColour?this.methods.onColour(a,b):!1};c.prototype.re=function(a,b){return this.methods.onOpacity?this.methods.onOpacity(a,b):!1};c.prototype.Rc=function(a,b){this.log("keyboard: %s",a);this.methods.onKeyCommand&&!1===this.methods.onKeyCommand(a,b)||"cancel"!==a||(this.log("ESC pressed. Abort and go back to toolbar."),this.view.Za(),this.view.cc.ma("goto-toolbar"))};c.prototype.dj=function(a){if(this.methods.onRedraw)this.methods.onRedraw(a)};
c.prototype.ib=function(a){return this.methods.onGesture?this.methods.onGesture(a):this.fc.ib(a)};c.prototype.ol=function(a,b,c,e){return this.methods.onMouseWheel?this.methods.onMouseWheel(a,b,c,e):!1};c.prototype.rc=function(){return this.methods.getToolName?this.methods.getToolName():"custom"};return c}();function ne(c){for(var a=[],b=0;b<c;b++)a.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz01234567890"[Math.floor(63*Math.random())]);return a.join("")};w.create("OTDocument");
var oe=function(){function c(a,b,c,e,g){void 0===e&&(e=[]);void 0===g&&(g=!1);this.Ua=a;this.sc=b;this.$c=c;this.Gc=e;this.local=g}c.prototype.clone=function(a,b){void 0===b&&(b=this.$c);for(var d=[],e=0,g=this.Gc;e<g.length;e++)d.push(g[e].clone());return new c(a,this.sc,b,d,this.local)};c.prototype.inverse=function(a,b){void 0===a&&(a=this.Ua);void 0===b&&(b=this.$c);for(var d=[],e=this.Gc.length-1;0<=e;e--)d.push(this.Gc[e].inverse());return new c(a,this.sc,b,d,this.local)};return c}(),pe=function(){function c(a,
b,c){this.Fq=a;this.xq=b;this.to=c}c.prototype.getData=function(){return this.Fq};c.prototype.Uf=function(){return this.to};c.prototype.empty=function(){return this.xq===this.to};return c}(),qe=function(){function c(a,b){void 0===a&&(a=!1);this.mn=a;this.Le=b;this.log=w.create("OTDocument");this.Yb=[];this.next=0;this.local=[];this.all=[];this.Db=0;this.Be={};this.zb=!1;this.Um=-1;this.Nh=""}c.prototype.Ad=function(){return 0<this.next};c.prototype.zd=function(){return this.next<this.Yb.length};c.prototype.gb=
function(){this.Ad()&&this.Yo(this.Yb[--this.next],!0)};c.prototype.Sd=function(){this.zd()&&this.Yo(this.Yb[this.next++],!1)};c.prototype.sn=function(){this.next=this.Yb.length=0};c.prototype.Sg=function(){return this.local.length?0===this.Le?new pe(this.encode(this.local),this.Db.toString(),(this.Db+this.local.length).toString()):new pe(this.encode(this.local),this.local[0].sc,this.local[this.local.length-1].Ua):new pe("","0","0")};c.prototype.Yf=function(a){if(0===this.Le){a=parseInt(a,10)-this.Db;
for(var b=0;b<a;b++)this.all[this.Db+b].Ua=(this.Db+b+1).toString(),this.Db+b+1<this.all.length&&(this.all[this.Db+b+1].sc=this.all[this.Db+b].Ua);this.Db+=a;this.local.splice(0,a)}else for(b=this.local.length-1;0<=b;b--)if(a===this.local[b].Ua){this.local.splice(0,b+1);break}};c.prototype.Uf=function(){return this.all.length?this.all[this.all.length-1].Ua:this.ui()};c.prototype.bk=function(a){this.zb||(a.local=!0,this.Yb.length=this.next,this.Yb.push(a),this.next+=1,this.local.push(a),this.all.push(a),
this.mn?(this.log("Executing LOCAL %s",a.Ua),this.Og(a)):this.log("adding LOCAL %s",a.Ua),1===this.Le&&(this.Be[a.Ua]=a))};c.prototype.Og=function(a){var b=0;for(a=a.Gc;b<a.length;b++)this.tb(a[b])};c.prototype.wr=function(a){for(var b=this.all.length-1;0<=b&&this.all[b].Ua!==a;b--);return b};c.prototype.Yo=function(a,b){var c=this.wr(a.Ua);if(-1===c)this.log("ERROR");else{var e=this.hh();b?(e=a.inverse(e,this.now()),e.sc=this.all[c].Ua):e=a.clone(e,this.now());for(c=b?c+1:c;c<this.all.length;c++)this.all[c].local||
this.Bj(this.all[c],[e]);this.local.push(e);this.all.push(e);this.mn&&this.Og(e)}};c.prototype.Bj=function(a,b){if(a.sc!==b[0].sc)throw Error("Error: Expected same parentage.");for(var c=0,e=a.Gc;c<e.length;c++)for(var g=e[c],f=0,h=b;f<h.length;f++){var l=h[f];g=this.Du(g,l.Gc,a.Ua,l.Ua)}b[0].sc=a.Ua};c.prototype.Du=function(a,b,c,e){this.log("Transform "+c+" agaisnt list "+e);for(var d=0;d<b.length;d++){var f=b[d];b[d]=this.fm(a,f,c,e);a=this.fm(f,a,e,c)}return a};c.prototype.Mf=function(a,b){var c=
this.decode(a);if(null===c||0===c.length)return null!==c;this.log("Entering addRemoteChanges");var e=null;b&&(e=new oe(this.hh(!0),this.Uf(),(new Date).getTime()/1E3,b,!0));var g=this.all.length;if(0===this.Le){if(this.Db===this.all.length)for(var f=0;f<c.length;f++){var h=c[f];this.all.push(h);e&&this.Bj(h,[e])}else{for(this.zb=!0;g!==this.Db;)--g,this.Og(this.all[g].inverse());this.zb=!1;h=this.all.slice(this.Db);e&&h.push(e);this.all.length=this.Db;for(var l=0;l<c.length;l++)f=c[l],this.Bj(f,h);
e&&h.pop();this.all=this.all.concat(c,h)}this.Db+=c.length}else{for(g=0;g<c.length;g++)f=c[g],f.Ua in this.Be||(this.Be[f.Ua]=f);g={};g[this.ui()]=[];for(h in this.Be)g[h]=[];for(h in this.Be)f=this.Be[h],f.sc in g&&g[f.sc].push(f.Ua);for(h in g)g[h].sort();f=g[this.ui()];c=this.ui();for(e=0;e<this.all.length&&1===f.length&&f[0]===this.all[e].Ua;e++)c=f[0],f=g[f[0]];this.zb=!0;for(f=this.all.length-1;f>=e;f--){this.log("[%s] Executing INVERSE %s",f,this.all[f].Ua);try{this.Og(this.all[f].inverse())}catch(k){throw this.log("Error occurred HEREEEEEE %s",
this.all[f].Ua),k;}}this.zb=!1;this.all.length=e;e=[];this.Rk(g,c,e);g=this.all.length;for(c=1;c<e.length;c++)this.all.push(e[c])}this.zb=!0;for(e=g;e<this.all.length;e++)this.log("[%s] Executing REMOTE %s",e,this.all[e].Ua),this.Og(this.all[e]);0<this.all.length-g&&this.qa();this.zb=!1;this.log("Done addremotechanges");return!0};c.prototype.Rk=function(a,b,c){c.push(this.Be[b]);for(b=a[b];1===b.length;)c.push(this.Be[b[0]]),b=a[b[0]];if(0!==b.length){var d=c.length;this.Rk(a,b[0],c);for(var g=1;g<
b.length;g++){var f=[];this.Rk(a,b[g],f);for(var h=d;h<c.length;h++)this.Bj(c[h],f);c.push.apply(c,f)}}};c.prototype.ui=function(){return(0).toString()};c.prototype.hh=function(a){void 0===a&&(a=!1);if(0===this.Le){var b=this.Um.toString();a||--this.Um;return b}return this.Nh+Math.floor(1E6*Math.random()).toString(36)};c.prototype.show=function(){this.log("%s",JSON.stringify(this.all,null,2))};c.prototype.now=function(){return Math.floor((new Date).getTime()/1E3)};c.prototype.Ut=function(a){this.Nh=
a};c.prototype.rn=function(a,b){if(0===this.Le){var c=parseInt(a,10),e=parseInt(b,10);return 0>c&&0>e?c>e:0<c&&0<e?c<e:0<e?!1:!0}return a<b};c.prototype.qa=function(){};return c}(),re=function(){function c(a,b,c){this.type=a;this.Pb=b;this.newValue=c}c.prototype.clone=function(){return new c(this.type,this.Pb,this.newValue)};c.prototype.inverse=function(){return"a"===this.type?new c("a",-this.Pb,this.newValue-this.Pb):new c("m",1/this.Pb,this.newValue/this.Pb)};return c}();
(function(c){function a(a,d){var b=c.call(this,!0,a)||this;b.prefix=d;b.value=0;b.Ut(d);return b}n(a,c);a.prototype.tb=function(a){"a"===a.type?(this.log("Add to  %s  %s",this.value,a.Pb),this.value+=a.Pb):"m"===a.type&&(this.log("Multiply %s by %s",this.value,a.Pb),this.value*=a.Pb);if(this.value!==a.newValue)throw Error("Document value should be "+a.newValue+", but got "+this.value);};a.prototype.decode=function(a){a=JSON.parse(a,function(a,b){if(b instanceof Object){if(b.Pb)return new re(b.type,
b.Pb,b.newValue);if(b.Gc)return new oe(b.Ua,b.sc,b.$c,b.Gc)}return b});if(0===this.Le)for(var b=this.Db,c=b+1,g=0;g<a.length;g++){var f=a[g];f.sc=b.toString();f.Ua=c.toString();b=c;c+=1}return a};a.prototype.encode=function(a){return JSON.stringify(a)};a.prototype.fm=function(a,c,e,g){this.log("transform %s/,%s",e,g);if(this.rn(e,g))return e=a.newValue,e="a"===c.type?e+c.Pb:e*c.Pb,new re(c.type,c.Pb,e);e=c.newValue;e="a"===a.type?e+a.Pb:e*a.Pb;this.log("   Modified op2 with value "+e);return new re("a",
e-a.newValue,e)};a.prototype.add=function(a){var b=this.hh();this.bk(new oe(b,this.Uf(),Math.round((new Date).getTime()/1E3),[new re("a",a,this.value+a)]))};a.prototype.multiply=function(a){var b=this.hh();this.bk(new oe(b,this.Uf(),Math.round((new Date).getTime()/1E3),[new re("m",a,this.value*a)]))};return a})(qe);var se=function(){function c(a,b){this.Qb=a;this.index=b}c.prototype.encode=function(){return this.Qb+";"+this.index};return c}(),ue=function(){function c(a,b,c,e){this.Xa=a;this.aa=e;this.type="c";this.Ma=new se(b,c)}c.prototype.encode=function(){var a=JSON.stringify(this.aa);return"C"+this.Xa+";"+this.Ma.encode()+";"+a.length+";"+a+";"};c.prototype.clone=function(){return new c(this.Xa,this.Ma.Qb,this.Ma.index,this.aa)};c.prototype.inverse=function(){return new te(this.Xa,this.Ma.Qb,this.Ma.index)};
c.Ce=function(a,b){var d=/C([^;]+);([^;]+);(\d+);(\d+);/g;d.lastIndex=b;var e=d.exec(a);if(e&&e.index===b){var g=parseInt(e[4],10),f=JSON.parse(a.substr(d.lastIndex,g));return{Ke:new c(e[1],e[2],parseInt(e[3],10),f),position:d.lastIndex+g+1}}return null};return c}(),te=function(){function c(a,b,c){this.Xa=a;this.Qb=b;this.index=c;this.aa=null;this.type="d";this.Ma=new se(b,c)}c.prototype.clone=function(){return new c(this.Xa,this.Ma.Qb,this.Ma.index)};c.prototype.inverse=function(){if(null===this.aa)throw Error("DeleteOp should have been executed before inverse");
return new ue(this.Xa,this.Ma.Qb,this.Ma.index,this.aa)};c.prototype.encode=function(){return"D"+this.Xa+";"+this.Ma.encode()+";"};c.Ce=function(a,b){var d=/D([^;]+);([^;]+);(\d+);/g;d.lastIndex=b;var e=d.exec(a);return e&&e.index===b?{Ke:new c(e[1],e[2],parseInt(e[3],10)),position:d.lastIndex}:null};return c}(),ve=function(){function c(a,b,c){this.Xa=a;this.aa=b;this.bg=c;this.type="s"}c.prototype.clone=function(){return new c(this.Xa,this.aa,this.bg)};c.prototype.inverse=function(){if(null===this.bg)throw Error("SetPropertiesOp was not executed before inversion");
return new c(this.Xa,this.bg,this.aa)};c.prototype.encode=function(){var a=JSON.stringify(this.aa);return"S"+this.Xa+";"+a.length+";"+a+";"};c.Ce=function(a,b){var d=/S([^;]+);(\d+);/g;d.lastIndex=b;var e=d.exec(a);if(e&&e.index===b){var g=parseInt(e[2],10),f=JSON.parse(a.substr(d.lastIndex,g));return{Ke:new c(e[1],f,null),position:d.lastIndex+g+1}}return null};return c}(),we=function(){function c(a,b,c,e,g){this.Xa=a;this.type="m";this.src=new se(b,c);this.Ma=new se(e,g)}c.prototype.clone=function(){return new c(this.Xa,
this.src.Qb,this.src.index,this.Ma.Qb,this.Ma.index)};c.prototype.inverse=function(){return new c(this.Xa,this.Ma.Qb,this.Ma.index,this.src.Qb,this.src.index)};c.prototype.encode=function(){return"M"+this.Xa+";"+this.src.encode()+";"+this.Ma.encode()+";"};c.Ce=function(a,b){var d=/M([^;]+);([^;]+);(\d+);([^;]+);(\d+);/g;d.lastIndex=b;var e=d.exec(a);return e&&e.index===b?{Ke:new c(e[1],e[2],parseInt(e[3],10),e[4],parseInt(e[5],10)),position:d.lastIndex}:null};return c}(),xe=function(c){function a(a,
d,e){void 0===e&&(e=!1);e=c.call(this,e,1)||this;e.Zd=a;e.Ef=[];e.Vt(d);return e}n(a,c);a.prototype.Vt=function(a){this.Nh=a};a.prototype.Ts=function(a){return"N-"+this.Nh+"-"+a};a.prototype.createNode=function(a,c,e,g){this.zb||(c=new ue(a,c,e,g),this.Ef.push(c));return a};a.prototype.xc=function(a,c,e){this.zb||(c=new te(a,c,e),c.aa=this.Zd.dc(a),this.Ef.push(c))};a.prototype.bf=function(a,c,e,g,f){this.zb||(a=new we(a,g,f,c,e),this.Ef.push(a))};a.prototype.Ib=function(a,c,e){this.zb||(a=new ve(a,
c,e),this.Ef.push(a))};a.prototype.dc=function(a){return this.Zd.dc(a)};a.prototype.qa=function(){if(!this.zb&&this.Ef.length){for(var a=new oe(this.hh(),this.Uf(),this.now()),c=0,e=this.Ef;c<e.length;c++)a.Gc.push(e[c]);this.bk(a)}else this.zb&&this.Zd.qa();this.Ef.length=0};a.prototype.tb=function(a){this.log("Execute "+a.type);switch(a.type){case "c":this.Zd.createNode(a.Xa,a.Ma.Qb,a.Ma.index,a.aa);break;case "d":-1===a.Ma.index?this.log("op was nullified."):(a.aa=this.Zd.dc(a.Xa),this.Zd.xc(a.Xa,
a.Ma.Qb,a.Ma.index));break;case "s":a.bg={};var b=this.Zd.dc(a.Xa),c;for(c in a.aa)a.bg[c]=b[c];this.Zd.Ib(a.Xa,a.aa,a.bg);break;case "m":-1!==a.src.index&&this.Zd.bf(a.Xa,a.Ma.Qb,a.Ma.index,a.src.Qb,a.src.index)}};a.prototype.decode=function(a){for(var b=[],c=0,g=/B([^;]+);([^;]+);([^;]+);\d+;/g;c<a.length;){var f;switch(a[c]){case "B":g.lastIndex=c;if((f=g.exec(a))&&f.index===c){c=parseInt(f[1],36);var h=f[2];f=f[3];if(isNaN(c))return this.log("Error: TS is not a number."),null;f=new oe(f,h,c);
b.push(f);c=g.lastIndex}else return null;continue;case "C":f=ue.Ce(a,c);break;case "D":f=te.Ce(a,c);break;case "S":f=ve.Ce(a,c);break;case "M":f=we.Ce(a,c);break;default:return null}if(0===b.length)return this.log("Got change outside of batch"),null;c=f.position;b[b.length-1].Gc.push(f.Ke)}return b};a.prototype.encode=function(a){for(var b="",c=0;c<a.length;c++){var g=a[c];b+="B"+g.$c.toString(36)+";"+g.sc+";"+g.Ua+";"+g.Gc.length+";";var f=0;for(g=g.Gc;f<g.length;f++)b+=g[f].encode()}return b};a.prototype.fm=
function(a,c,e,g){function b(b,c,e){b="c"===a.type?1:-1;switch(e.type){case "c":e=e.clone();d(c,e.Ma,b,"c");l.log("Result is "+g+":"+e.type+"."+e.Ma.index);break;case "d":e=e.clone();d(c,e.Ma,b,"d");l.log("Result is "+g+":"+e.type+"."+e.Ma.index);break;case "m":e=e.clone(),d(c,e.src,b,"d"),d(c,e.Ma,b,"c")}return e}function d(b,d,f,h){b.Qb===d.Qb&&0<=d.index&&(b.index<d.index||b.index==d.index&&0<f?(d.index+=f,l.log("Shift "+g+":"+c.type+" by "+f)):b.index===d.index&&0>f&&"d"===h?(d.index=-1,l.log("NULLIFY")):
l.log("No conflict; "+e+":"+a.type+" "+b.index+" "+g+":"+c.type+" "+d.index))}var l=this;this.log("xform "+e+":"+a.type+"/"+g+":"+c.type);if(this.rn(g,e))return this.log("Not doing anything; "+g+"<"+e),c;"c"===a.type?c=b(a.type,a.Ma,c):"d"===a.type?c=b(a.type,a.Ma,c):"m"===a.type&&(c=b("d",a.src,c),c=b("c",a.Ma,c));return c};return a}(qe);
(function(){function c(){this.ua={};this.log=w.create("DebugTree");this.root={Xa:"0",parent:null,children:[],aa:{name:"root"}};this.ua["0"]=this.root}c.prototype.createNode=function(a,b,c,e){this.log("create node "+a+" child of "+b);b=this.ua[b];e={Xa:a,parent:b,children:[],aa:e};b.children.splice(c,0,e);this.ua[a]=e};c.prototype.xc=function(a){this.log("delete node "+a);if(a in this.ua){var b=this.ua[a].parent;if(b)for(var c=0;c<b.children.length;c++)if(b.children[c].Xa===a){b.children.splice(c,
1);break}delete this.ua[a]}};c.prototype.bf=function(a,b,c){this.log("move "+a+" to "+b+":"+c);if(a in this.ua){var d=this.ua[a];this.xc(a);this.createNode(a,b,c,d.aa)}};c.prototype.Ib=function(a,b){if(a in this.ua)for(var c in b)b.hasOwnProperty(c)&&(this.ua[a].aa[c]=b[c])};c.prototype.dc=function(a){return a in this.ua?this.ua[a].aa:{}};c.prototype.qa=function(){};c.prototype.toString=function(){return this.encode(this.root)};c.prototype.encode=function(a){for(var b="("+a.aa.name,c=0;c<a.children.length;c++)b+=
" "+this.encode(a.children[c]);return b+")"};return c})();var ye="IDLE CONNECTING CONNECTED WAIT_FOR_ACK ERROR_WAIT STOPPING".split(" "),Ce=function(){function c(a,b,c){this.view=a;this.rb=null;this.log=w.create("DocumentSharer");var d=new ze;a=new Ae(a,d);this.vj=new xe(a,b);b=new Be(this.vj,d);this.view.ea.qp(b,c)}c.prototype.Mf=function(a){this.vj.Mf(a)};c.prototype.zs=function(){return null!==this.rb};c.prototype.Sg=function(){this.rb||(this.rb=this.vj.Sg(),this.rb.empty()&&(this.rb=null));return this.rb?this.rb.getData():""};c.prototype.Yf=function(a){this.log("Marking outstanding changes sent");
if(!this.rb||this.rb.getData()!==a)throw Error("markChangesSent(): does not match outstanding changes.");this.vj.Yf(this.rb.Uf());this.rb=null};c.prototype.end=function(){this.view.ea.qp(new ad)};return c}(),De=function(c){function a(a,d,e){var b=c.call(this)||this;b.name=a;b.ia=d;b.create=e;b.log=w.create("Sharing");b.state=0;b.paused=!1;b.k=0;b.timeout=null;b.ct=1;b.ee="0";b.rb="";b.Cg=!1;b.Gl=null;b.wl=null;b.xl=[];b.listener=function(a){b.log("Got some more changes to send: %s",a.substr(0,30));
b.rb=a;b.Cg=!1;b.ip()};d.sa("local-changes",b.listener);e||(b.ee="1");b.connect();return b}n(a,c);a.prototype.zf=function(a){this.log(ye[this.state]+" -> "+ye[a]);this.state=a;switch(a){case 2:this.ma("connected");break;case 4:this.ma("connect-error")}};a.prototype.connect=function(){var a=this;this.log("connect(): "+ye[this.state]);if(0!==this.state)this.log("Bad state");else{this.zf(1);var c=this.ia.Nc("collaborationServer").replace("{name}",this.name);this.yh=new Q.WebSocket(c);this.yh.onopen=
function(){return a.jt()};this.yh.onclose=function(){return a.gt()};this.yh.onmessage=function(b){return a.kt(b)}}};a.prototype.jt=function(){this.log("onConnected(): "+ye[this.state]);1!==this.state?this.log("Bad state"):(this.zf(2),this.ip())};a.prototype.gt=function(){this.log("onClose(): "+ye[this.state]);this.Cg=!1;4!==this.state&&(1===this.state?(this.zf(4),this.Ht()):(this.zf(0),this.paused||(this.k=0,this.connect())))};a.prototype.Ht=function(){var a=this;4===this.state&&(this.timeout&&(clearTimeout(this.timeout),
this.timeout=null),this.timeout=setTimeout(function(){4===a.state&&(a.log("onTimeout(): "+ye[a.state]),a.timeout=null,a.zf(0),a.connect())},1E3*Math.pow(2,this.k)),5>this.k&&(this.k+=1))};a.prototype.ip=function(){var a=this,c=this.ia.Nc("latency");this.Gl||(this.Gl=setTimeout(function(){a.Gl=null;if(2===a.state){if(a.paused)a.log("Currently paused; ignoring changes.");else if(""!==a.rb&&a.Cg){a.log("Have outstanding changes... not sending more.");return}if(""!==a.rb){a.log("Sending outstanding changes");
a.Cg=!0;var b=JSON.stringify({type:"Data",MID:""+a.ct++,oldCID:a.ee,newCID:"1",data:a.rb});a.yh.send(b)}}},c))};a.prototype.kt=function(a){var b=this;this.xl.push(JSON.parse(a.data));var c=this.ia.Nc("latency");this.wl||(this.wl=setTimeout(function(){b.wl=null;for(var c=0,d=b.xl;c<d.length;c++){var e=d[c];if("Data"===e.type){b.log("Got message from socket %s->%s: %s",b.ee,e.newCID,a.data.substr(0,100));if(b.create&&"0"===e.oldCID&&""!==e.data){b.ma("rejected");return}b.ia.Mf(e.data);"1"===b.ee&&""===
e.data?b.ma("empty"):b.create||""===e.data||"0"!==e.oldCID||b.ma("joined");b.ee=e.newCID}else"Ack"===e.type&&""!==b.rb?(b.log("Marking changes sent %s->%s: %s",e.oldCID,e.newCID,b.rb.substr(0,30)),b.ia.Yf(b.rb),b.ee=e.newCID,b.rb="",b.Cg=!1,"0"===e.oldCID&&b.ma("created")):"Nack"===e.type&&(b.log("Change was rejected by server. baseCID=%s theirs=%s",b.ee,e.oldCID),"0"===b.ee&&b.ma("rejected"))}b.xl.length=0},c))};a.prototype.pause=function(a){this.log("SharedSession.pause(): "+ye[this.state]);(this.paused=
a)?this.stop():0===this.state&&(this.zf(1),this.connect())};a.prototype.stop=function(){this.log("SharedSession.stop(): "+ye[this.state]);this.paused=!0;4>this.state?this.yh.close():this.zf(0);this.ia.removeEventListener("local-changes",this.listener)};return a}(Sc),ze=function(){function c(){this.local={};this.remote={};this.add("0",0)}c.prototype.add=function(a,b){this.local[a]=b;this.remote[b]=a};c.prototype.remove=function(a,b){delete this.local[a];delete this.remote[b]};c.prototype.qg=function(a){return this.local[a]};
c.prototype.Cf=function(a){a in this.remote||console.log("LocalId "+a+" has no remote");return this.remote[a]};return c}();function Ee(c){var a={},b;for(b in c)a[b]="matrix"===b?c[b].Tb():c[b];return a}function Fe(c){var a={},b;for(b in c)a[b]="matrix"===b&&c[b]instanceof Array?new F(c[b]):c[b];return a}
var Ae=function(){function c(a,b){this.view=a;this.map=b;this.ge={};this.actions=[];this.log=w.create("Remote")}c.prototype.createNode=function(a,b,c,e){if(!e.type)throw console.log(e),Error("Tried to create node with bad type");var d=Fe(e),f=d.type;delete d.type;var h=this.view.ea.Wa();this.log("Create node "+f+" "+a+"/"+h+" at "+b+":"+c);this.map.add(a,h);b=new U(h,f,d,this.map.qg(b),c);this.actions.push(b);this.ge[a]=e};c.prototype.xc=function(a,b,c){var d=this.map.qg(a);this.log("Delete node "+
a+"/"+d+" from "+b+":"+c);b=new Fc([d]);this.actions.push(b);this.map.remove(a,d)};c.prototype.bf=function(a,b,c){this.log("Move node "+a+" to "+b+":"+c);this.actions.push(new Oc(this.map.qg(a),this.map.qg(b),c))};c.prototype.Ib=function(a,b){b=Fe(b);var c=this.map.qg(a);this.log("Set properties for node "+a+"/"+c+" to "+JSON.stringify(b));for(var e in b)this.actions.push(new Gc([c],e,b[e]));if(a in this.ge)for(var g in b)this.ge[a][g]=b[g]};c.prototype.dc=function(a){var b={};if(a in this.ge)b=this.ge[a];
else if(a=this.view.ea.xa(this.map.qg(a)))b=Ee(a.dc()),b.type=a.type();return b};c.prototype.qa=function(){this.ge={};this.view.qa(this.actions,!0);this.view.Pf();this.view.ha();this.actions=[]};return c}(),Be=function(){function c(a,b){this.Tc=a;this.map=b;this.log=w.create("LOCAL")}c.prototype.createNode=function(a,b,c,e){if(!this.Tc.zb){this.log("Create node "+e.type+" "+a+" at "+b+":"+c);if(!e.type)throw Error("Error: Local tried to create node with bad type.");e=Ee(e);var d=this.Tc.Ts(a);this.map.add(d,
a);a=this.map.Cf(b);this.Tc.createNode(d,a,c,e)}};c.prototype.xc=function(a,b,c){this.Tc.zb||(this.log("Delete node "+a+" from "+b+":"+c),b=this.map.Cf(b),a=this.map.Cf(a),this.Tc.xc(a,b,c))};c.prototype.bf=function(a,b,c,e,g){this.Tc.zb||(this.log("Move node "+a+" from "+e+":"+g+" to "+b+":"+c),this.Tc.bf(this.map.Cf(a),this.map.Cf(b),c,this.map.Cf(e),g))};c.prototype.Ib=function(a,b,c){this.Tc.zb||(this.log("Set properties for node "+a+" to "+JSON.stringify(b)),b=Ee(b),c=Ee(c),this.Tc.Ib(this.map.Cf(a),
b,c))};c.prototype.qa=function(){this.Tc.zb||this.Tc.qa()};return c}();var Ge={style:".zwibbler-builtin-toolbar {\n    background: white;\n    width: 130px;\n    overflow-y: auto;\n    -webkit-touch-callout: none;\n    -webkit-user-select: none; \n     -khtml-user-select: none; \n       -moz-user-select: none; \n        -ms-user-select: none; \n            user-select: none; \n}\n\n.zwibbler-builtin-toolbar button {\n    font-family: inherit;\n    font-size: 100%;\n    padding: 5px;\n    background-color: white;\n    border: none;\n}\n\n.zwibbler-builtin-toolbar button img {\n    margin: 0;\n}\n\n.zwibbler-builtin-toolbar button:hover,\n.zwibbler-builtin-toolbar button.selected {\n    background-color: #9fb3e7;\n}\n",
Pi:'<div class="zwibbler-builtin-toolbar">\n<button \n    z-if="getConfig(\'showPickTool\')"\n    z-click="usePickTool()"\n    z-selected="getCurrentTool()===\'pick\'"\n    title="Pick">\n    <img z-bind:src="getImageUrl(\'wd-pick.png\')">\n</button>\n<button \n    z-if="getConfig(\'showSquareTool\')"\n    z-click="useRectangleTool()"\n    z-selected="getCurrentTool()===\'rectangle\'"\n    title="Rectangle">\n    <img z-bind:src="getImageUrl(\'wd-box.png\')">\n</button>\n<button \n    z-if="getConfig(\'showRoundRectTool\')"\n    z-click="useRoundRectTool()"\n    title="Rounded Rectangle">\n    <img z-bind:src="getImageUrl(\'wd-roundrect.png\')">\n</button>\n<button \n    z-if="getConfig(\'showCircleTool\')"\n    z-click="useCircleTool()"\n    z-selected="getCurrentTool()===\'circle\'"\n    title="Circle">\n    <img z-bind:src="getImageUrl(\'wd-circle.png\')">\n</button>\n<button \n    z-if="getConfig(\'showShapeBrushTool\')"\n    z-click="useShapeBrushTool()"\n    title="Shape brush">\n    <img z-bind:src="getImageUrl(\'wd-shapebrush.png\')">\n</button>\n<button \n    z-if="getConfig(\'showBrushTool\')"\n    z-click="useBrushTool()"\n    z-selected="getCurrentTool()===\'brush\'"\n    title="Brush">\n    <img z-bind:src="getImageUrl(\'wd-brush.png\')">\n</button>\n<button \n    z-if="getConfig(\'showLineTool\')"\n    z-click="useLineTool()"\n    z-selected="getCurrentTool()===\'line\'"\n    title="Lines">\n    <img z-bind:src="getImageUrl(\'wd-line.png\')">\n</button>\n<button \n    z-if="getConfig(\'showCurveTool\')"\n    z-click="useCurveTool()"\n    z-selected="getCurrentTool()===\'curve\'"\n    title="Curves">\n    <img z-bind:src="getImageUrl(\'wd-curve.png\')">\n</button>\n<button \n    z-if="getConfig(\'showArrowTool\')"\n    z-click="useArrowTool()"\n    z-selected="getCurrentTool()===\'arrow\'"\n    title="Arrows">\n    <img z-bind:src="getImageUrl(\'wd-arrow.png\')">\n</button>\n<button \n    z-if="getConfig(\'showTextTool\')"\n    z-selected="getCurrentTool()===\'text\'"\n    z-click="useTextTool()"\n    title="Text">\n    <img z-bind:src="getImageUrl(\'wd-text.png\')">\n</button>\n<button \n    z-if="getConfig(\'showImageTool\')"\n    z-click="insertImage()"\n    title="Insert image...">\n    <img z-bind:src="getImageUrl(\'wd-image.png\')">\n</button>\n<button \n    z-if="getConfig(\'showMoveToFrontBack\')"\n    z-click="bringToFront()"\n    title="Bring to front">\n    <img z-bind:src="getImageUrl(\'wd-moveup.png\')">\n</button>\n<button \n    z-if="getConfig(\'showMoveToFrontBack\')"\n    z-click="sendToBack()"\n    title="Send to back">\n    <img z-bind:src="getImageUrl(\'wd-movedown.png\')">\n</button>\n<button \n    z-if="getConfig(\'showUndoRedo\')"\n    z-disabled="!canUndo()"\n    z-click="undo()"\n    title="Undo">\n    <img z-bind:src="getImageUrl(\'wd-undo.png\')">\n</button>\n<button \n    z-if="getConfig(\'showUndoRedo\')"\n    z-disabled="!canRedo()"\n    z-click="redo()"\n    title="Redo">\n    <img z-bind:src="getImageUrl(\'wd-redo.png\')">\n</button>\n<button \n    z-if="getConfig(\'showCopyPaste\')"\n    z-click="copy()"\n    title="Copy">\n    <img z-bind:src="getImageUrl(\'wd-copy.png\')">\n</button>\n<button \n    z-if="getConfig(\'showCopyPaste\')"\n    z-click="paste()"\n    title="Paste">\n    <img z-bind:src="getImageUrl(\'wd-paste.png\')">\n</button>\n<button\n    z-for="button in _zwibblerButtons"\n    z-bind:title="button.name"\n    z-click="_zwibblerButtonClicked(this, button)">\n    <img z-bind:src="getImageUrl(button.image)">\n</button>\n</div>\n',
controller:function(c){c._zwibblerButtons=Q.buttons;c._zwibblerButtonClicked=function(a,b){b.onclick.call(a,c)}}};var He={style:".zwibbler-page-selector {\n    overflow-y: scroll;\n    background: #888;\n    width: 160px;\n    text-align: center;\n}\n\n.zwibbler-page-selector [z-page] {\n    border: 3px solid transparent;\n    margin: 5px;\n    display: inline-block;\n    box-shadow: 2px 2px 2px rgba(0,0,0,0.2);\n}\n\n.zwibbler-page-selector [z-page].selected {\n    border: 3px solid #9fb3e7;\n}\n",Pi:'<div class="zwibbler-page-selector">\n    <button z-if="getConfig(\'showPageSelectorControls\')"\n        z-click="setCurrentPage(insertPage(getCurrentPage()+1))">\n        Add Page\n    </button>\n    <button z-if="getConfig(\'showPageSelectorControls\')"\n        z-click="deletePage(getCurrentPage())">\n        Delete Page\n    </button>\n    <br>\n    <div z-sort="movePage($from,$to)">\n        <div z-for="page in getPageCount()"\n            draggable="TRUE"\n            z-sortable\n            z-page="page"\n            z-width="130"\n            z-height="130"\n            z-click="setCurrentPage(page)"\n            z-selected="page==getCurrentPage()">\n        </div>\n    </div>\n</div>\n'};var Ie={style:".zwibbler-property-panel {\n    width: 200px;\n    background: #f5f5f5;\n    display:flex;\n    flex-flow: column nowrap;\n    overflow-y: scroll;\n    padding: 10px;\n    font-family: sans-serif;\n    -webkit-touch-callout: none;\n    -webkit-user-select: none; \n     -khtml-user-select: none; \n       -moz-user-select: none; \n        -ms-user-select: none; \n            user-select: none;     \n}\n\n.zwibbler-property-panel h3 {\n    margin-bottom: 0.5em;\n}\n\n.zwibbler-property-panel button {\n    font-family: inherit;\n    font-size: 100%;\n    padding: 5px;\n    display: block;\n    background-color: white;\n    color: black;\n    border: none;\n    border-radius: 2px;\n    border-bottom: 2px solid #ddd;\n    width: 100%;\n}\n\n.zwibbler-property-panel button[tool] {\n    display: inline-block;\n    width: 60px;\n    height: 60px;\n    font-size: 30px;\n}\n\n.zwibbler-property-panel button.zwibbler-option {\n    border: 0;\n    padding: 10px;\n    border-radius: 3px;\n    background: transparent;\n    text-align: left;\n}\n\n.zwibbler-property-panel button.selected {\n    background: #9fb3e7;\n}\n\n.zwibbler-property-panel button.hover {\n    background: #ddd;\n}\n\n.zwibbler-property-panel hr {\n    border: none;\n    border-top: 1px solid #ccc;\n}\n\n.zwibbler-property-panel select {\n    width: 100%;\n}\n\n.zwibbler-property-panel .colour-picker {\n    padding: 10px 0;\n}\n\n.zwibbler-property-panel [swatch] {\n    border: 1px solid black;\n    display: inline-block;\n    height: 2em;\n    width: 4em;\n    vertical-align:middle;\n    margin-right: 10px;\n}\n",
Pi:'<div class="zwibbler-property-panel">\n<h3>Shape options</h3>\n<div z-if="summary.empty">\n    There are no selected shapes.\n</div>\n<div z-has="AnyNode">\n    <button z-click="deleteNodes()">Delete</button>                    \n    <button z-click="bringToFront()">\n        Move to front\n    </button>\n    <button z-click="sendToBack()">\n        Send to back\n    </button>\n</div>\n<div z-has="fontName">\n    <h3>Font</h3>\n    <select z-property="fontName">\n        <option z-for="font in getConfig(\'fonts\')" z-text="font" z-bind:value="font"></option>\n    </select>\n</div>\n<div z-has="fontSize">\n    <h3>Font size</h3>\n    <select z-property="fontSize">\n        <option value="8">8</option>\n        <option value="10">10</option>\n        <option value="12">12</option>\n        <option value="16">16</option>\n        <option value="20">20</option>\n        <option value="24">24</option>\n        <option value="50">50</option>\n    </select>\n</div>\n<div z-has="fillStyle|strokeStyle|background">\n    <h3>Colours</h3>\n    <div class="colour-picker" z-has="fillStyle">\n        <div swatch z-property="fillStyle" z-colour></div>\n        Fill style\n    </div>\n    <div class="colour-picker" z-has="strokeStyle">\n        <div swatch z-property="strokeStyle" z-colour></div>\n        Outline\n    </div>\n    <div class="colour-picker" z-has="background">\n        <div swatch z-property="background" z-colour></div>\n        Background\n    </div>\n</div>\n<div z-has="arrowSize">\n    <h3>Arrows</h3>\n    <button class="zwibbler-option" z-property="arrowSize" z-value="0">None</button>\n    <button class="zwibbler-option" z-property="arrowSize" z-value="10">Small</button>\n    <button class="zwibbler-option" z-property="arrowSize" z-value="15">Large</button>\n    <hr>\n    <button class="zwibbler-option" z-property="arrowStyle" z-value="solid">Solid</button>\n    <button class="zwibbler-option" z-property="arrowStyle" z-value="open">Open</button>\n</div>\n<div z-has="lineWidth">\n        <h3>Line width</h3> \n        <select z-property="lineWidth">\n            <option value="0">None</option>\n            <option value="1">1</option>\n            <option value="2">2</option>\n            <option value="4">4</option>\n            <option value="8">8</option>\n        </select>\n    </div>\n<div z-has="dashes">\n    <h3>Line style</h3>\n    <button class="zwibbler-option" z-property="dashes" z-value="">Solid</button>\n    <button class="zwibbler-option" z-property="dashes" z-value="3,3">Dots</button>\n    <button class="zwibbler-option" z-property="dashes" z-value="8,2">Dashes</button>\n</div>\n<div z-has="opacity">\n    <h3>Opacity</h3>\n    <input z-property="opacity" type="range" min="0.1" max="1.0" step="0.05">\n</div>              \n'};var Je=function(c){function a(a){var b=c.call(this)||this;b.ia=a;b.path=new T;b.node=0;return b}n(a,c);a.prototype.beginPath=function(){this.path=new T;this.node=0};a.prototype.closePath=function(){this.path.close()};a.prototype.moveTo=function(a,c){this.path.moveTo(a,c)};a.prototype.lineTo=function(a,c){this.path.lineTo(a,c)};a.prototype.quadraticCurveTo=function(a,c,e,g){this.path.quadraticCurveTo(a,c,e,g)};a.prototype.bezierCurveTo=function(a,c,e,g,f,h){this.path.bezierCurveTo(a,c,e,g,f,h)};a.prototype.fill=
function(){this.Pm(!0)};a.prototype.stroke=function(){this.Pm(!1)};a.prototype.Pm=function(a){this.node||(this.node=this.ia.createNode("PathNode",{ba:this.path.Tb(),pa:this.pa.clone(),lineWidth:this.lineWidth}));a?this.ia.Vc(this.node,"fillStyle",this.fillStyle):this.ia.Vc(this.node,"strokeStyle",this.strokeStyle)};a.prototype.fillText=function(a,c,e){this.Qm(a,c,e,!0)};a.prototype.strokeText=function(a,c,e){this.Qm(a,c,e,!1)};a.prototype.Qm=function(a,c,e,g){c=this.pa.multiply(new E(c,e));e=this.Ge(this.font);
a={text:a,matrix:c,fontName:e.fontFamily,fontSize:e.fontSize,italic:"italic"===e.fontStyle,bold:"bold"===e.fontWeight};g?a.fillStyle=this.fillStyle:a.strokeStyle=this.strokeStyle;this.ia.createNode("TextNode",a)};a.prototype.Rj=function(){throw Error("drawImage: not implented");};a.prototype.measureText=function(a){var b=document.createElement("canvas").getContext("2d");b.font=this.font;return b.measureText(a)};a.prototype.clip=function(){throw Error("clip: not implemented.");};a.prototype.Uj=function(){return{}};
a.prototype.Yj=function(){};return a}(dc);function Ke(c){return c instanceof Array?c:[c]}function Le(c,a,b,d){c.fillStyle="#ffffff";c.fillRect(a,b,d,d);c.beginPath();c.strokeStyle="#000000";c.moveTo(a,b);c.lineTo(a+d,b+d);c.moveTo(a+d,b);c.lineTo(a,b+d);c.stroke()}
function Me(c,a,b,d){for(var e,g=0;g<d;g+=5){e=0===g/5%2;for(var f=0;f<d;f+=5)c.fillStyle=e?"#000000":"#ffffff",e=!e,c.fillRect(a+f,b+g,5,5)}e=c.createLinearGradient(a+d,b+d,a,b);e.addColorStop(0,"rgba(255, 255, 255, 1.0)");e.addColorStop(1,"rgba(255, 255, 255, 0.0)");c.fillStyle=e;c.fillRect(a,b,d,d)}
var X=function(){function c(a,b){var c=this;this.bb={};this.Ek={};this.ub=0;this.actions=[];this.ii=new V;this.uk=new V;this.gj=[];this.pk=-1;this.el=null;this.Kf={};this.Jc=this.yc=this.gd=null;this.mi=!1;this.log=w.create("CONTEXT");this.cn=!1;this.Cl=0;this.eg=null;this.vn="";this.da=new le(this,a,b);this.No();var e=this;Q.Zk.push(this);this.da.va.add(function(){c.log("Running ZwibblerContext destructor");c.Af();delete a.zwibbler;delete e.bb;delete e.actions;delete e.da;delete e.gd;for(var b=Q.Zk,
d=0;d<b.length;d++)if(b[d]===e){b.splice(d,1);break}c.Jc&&c.Jc.stop()});this.sa("document-changed",function(){c.summary=c.Xg();if(c.yc)if(c.yc.zs())c.log("Have outstanding changes; not sending more");else{var a=c.yc.Sg();""!==a&&c.ma("local-changes",a)}});this.cq();this.sa("selected-nodes",function(){c.summary=c.Xg()});this.sa("tool-changed",function(){c.summary=c.Xg()});this.summary=this.Xg();this.Oh(Ge,"left","showToolbar");this.Oh(He,"right","showPageSelector");this.Oh(Ie,"right","showPropertyPanel");
this.Oh(Ne,"bottom","showColourPanel")}c.prototype.Mf=function(a){this.yc&&this.yc.Mf(a)};c.prototype.lc=function(a,b){var d=this;W.lc(a,b);W.digest();this.da.va.add(function(){d.log("DESTROYING A PANEL");W.detach(b)});!this.cn&&a instanceof c&&(this.cn=!0,this.sa("tool-changed",function(){return W.digest()}),this.da.fa.sa("update",function(){return W.digest()}),this.sa("document-changed",function(){return W.digest()}),this.sa("selected-nodes",function(){return W.digest()}));this.resize()};c.prototype.digest=
function(a){W.digest(a)};c.prototype.hq=function(){1<this.ub&&this.Ca("abortTransaction is not implemented for nested calls. Please contact support.");this.ub=0;this.actions=[]};c.prototype.wc=function(a,b,c,e,g,f){switch(f){case "scale":case "rotate":case "translate":var d=f;break;default:if("function"===typeof f){d="click";var l=f}else{this.Ca('addSelectionHandle: action must be "scale", "rotate", "translate", or a function');return}}this.da.view.wc(a,b,c,e,g,d,l)};c.prototype.ck=function(a){this.da.language.ck(a)};
c.prototype.mq=function(a,b,c){if(!this.wa())return this.Si(this.Bc(),b,c)};c.prototype.yg=function(a,b,c){this.da.yg(a,b,c)};c.prototype.gk=function(){this.ub+=1;1===this.ub?(this.Om(),this.log("beginTransaction() -- beginning new")):this.log("beginTransaction() -- already in one, bump counter")};c.prototype.Om=function(){this.actions=[];this.uk.clear();this.ii.clear();this.gj.length=0;this.pk=this.da.view.ea.Ra};c.prototype.Zh=function(a){this.wa()||(a||this.Cc(),this.da.view.Zh())};c.prototype.zd=
function(){return this.wa()?!1:this.da.view.ea.zd()};c.prototype.Ad=function(){return this.wa()?!1:this.da.view.ea.Ad()};c.prototype.ob=function(){this.da.view.ob();this.da.view.Mb();this.da.view.ha()};c.prototype.Iq=function(){this.da.sn()};c.prototype.Jq=function(a,b){if(this.wa())return!1;this.jg(a,!b)};c.prototype.Nq=function(){this.ub=Math.max(0,this.ub-1);0===this.ub?(this.da.view.qa(this.actions,!0),this.actions=[],this.log("committing irreversible transaction.")):this.log("delaying transaction commit -- nested call (count=%s)",
this.ub)};c.prototype.bi=function(){this.ub=Math.max(0,this.ub-1);0===this.ub?(this.da.view.qa(this.actions),this.log("committing transaction."),this.Om()):this.log("delaying transaction commit -- nested call (count=%s)",this.ub)};c.prototype.Oe=function(a,b){void 0===a&&(a=!1);"boolean"!==typeof a&&this.Ca("First parameter of copy() must be true/false");return this.da.view.Oe(a,b)};c.prototype.Vq=function(){function a(a){for(var c=30;100>c;c+=20)a.values[2]=c/100,b.push(a.toString())}var b="rgba(0,0,0,0.0) rgba(0,0,0,0.5) #000000 #ffffff #000088 #008800 #008888 #880000 #880088 #884400 #888888 #444444 #0000ff #00ff00 #00ffff #ff0000 #ff00ff #ffff00".split(" ");
a(new u(u.De,[0,0,0,1]));for(var c=0;720>c;c+=35){var e=new u(u.De,[c,.5,0,1]);a(e)}return b};c.prototype.Hg=function(a){if(this.wa())return!1;if(0<a.length)return this.Jb(this.da.Hg(this.actions,a))};c.prototype.Eb=function(a){void 0===a&&(a={});var b={};if(a instanceof Array)return a.concat();if(!(a instanceof Object))return a;for(var c in a)if(a.hasOwnProperty(c)){var e=a[c];"matrix"===c&&("[object Array]"===Object.prototype.toString.apply(e)&&"Matrix"===e[0]?(e.splice(0,1),e=new F(e)):e instanceof
F||(e=new F(e)));b[c]=e}return b};c.prototype.createNode=function(a,b){this.log("createNode(%s)",a);Xb(a)||this.Ca("createNode: node type must be string");var c=this.Eb(b);return this.Jb(this.da.createNode(this.actions,a,c))};c.prototype.gi=function(a){return this.Jb(this.da.gi(this.actions,a))};c.prototype.Oh=function(a,b,c){var d=this,g;this.da.fa.sa(c,function(c){c?(g||(a.style&&Q.Md(a.style),c=document.createElement("div"),c.innerHTML=a.Pi,g=c.firstChild,d.lc(d,g),a.controller&&a.controller(d)),
d.da.yg(1,b,g)):g&&d.da.qh(g)})};c.prototype.Zq=function(a,b){var c=qb(a);if(c){Wb(b)||this.Ca("createToolbar: second parameter must be array");Q.Md("a.zwibbler-button {\n            background-repeat: no-repeat;\n            background-position: center;\n            display: inline-block;\n            overflow: hidden;\n        }");for(var e=this,g=function(a,b){b.addEventListener("click",function(b){a.onclick.call(this,e,b)})},f=0;f<b.length;f++){var h=b[f],l=y("a").He("zwibbler-button").Aa;l.setAttribute("href",
"javascript:void(0)");h.toolName&&y(l).He(h.toolName);h.onclick&&g(h,l);h.title&&l.setAttribute("title",h.title);h.background?l.style.background=h.background:h.image&&(l.style.backgroundImage="url("+h.image+")");h.html&&(l.innerHTML=h.html);c.appendChild(l)}var k;this.sa("tool-changed",function(a){k&&k.classList.remove("zwibbler-selected");(k=c.querySelector("."+a))&&k.classList.add("zwibbler-selected")})}else this.Ca("createToolbar: Could not convert first parameter to an HTML element")};c.prototype.mk=
function(a){if(a=this.da.mk(this.actions,a))return this.Jb(a);this.Ca("createShape needs an array of at least 6 numbers");return null};c.prototype.rk=function(){if(this.wa())return!1;var a=this.da.view.Oe(!1);this.An();return a};c.prototype.Kc=function(){this.da.Kc();for(var a in this)this.hasOwnProperty(a)&&delete this[a];this.mi=!0};c.prototype.Jb=function(a){this.ub?"number"===typeof a&&this.ii.add(a):(this.log("Not in a transaction. committing immediately. id=%s",a),this.bi());return"number"===
typeof a?a:0};c.prototype.xc=function(a){this.tk(a)};c.prototype.Yp=function(a){for(var b=0;b<a.length;b++){var c=a[b],e=this.da.view.ea.xa(c,!1);e&&!this.uk.contains(c)||!e&&this.ii.contains(c)||(a.splice(b,1),--b)}return 0<a.length};c.prototype.tk=function(a){void 0===a&&(a=this.Cc());if(this.wa())return!1;this.log("deleteNodes()");a=Ke(a);this.Yp(a)&&(this.uk.add(a),this.Jb(this.da.xc(this.actions,a)))};c.prototype.$q=function(){if(this.wa())return!1;1<this.ub&&this.Ca("deletePage is not implemented inside transactions. Please contact support.");
1===this.Bc()?this.tk(this.Jk()):(this.actions.push(new Fc([this.da.view.ea.Wg().id])),this.Jb())};c.prototype.An=function(){if(this.wa())return!1;this.da.view.Jg()};c.prototype.he=function(){1===arguments.length&&!1===arguments[0]&&this.da.view.ea.zo();return this.da.view.ea.he()};c.prototype.download=function(a,b,c,e){void 0===e&&(e=0);"jpeg"===a&&(a="jpg");var d;if("pdf"===a||"svg"===a||"png"===a||"jpg"===a||"bmp"===a||"zwibbler3"===a){var f="zwibbler3"===a?id.Lh(this.da.view.ea,a,"data-uri"):
this.save(a,c,e);"Blob"in window&&(d=zb(f));if(d){if(window.navigator.msSaveOrOpenBlob){this.log("Using msSaveOrOpenBlob()");window.navigator.msSaveOrOpenBlob(d,b);return}f=window.URL.createObjectURL(d);this.log("Using blob object url %s",f);this.da.va.add(function(){window.URL.revokeObjectURL(f)})}var h=document.createElement("a");h.innerHTML="download";h.setAttribute("href",f);h.setAttribute("download",b);h.style.display="none";document.body.appendChild(h);h.click();setTimeout(function(){document.body.removeChild(h)},
1E3)}else this.log("unsupported format for download: %s",a)};c.prototype.ha=function(a,b){void 0===b&&(b={});var c=b.page||0,e=this.da.view.ea.Ra,g=this.da.view.ea.Gb();this.da.view.ea.Sb(c);this.da.view.Dd(a,0,0,g.width,g.height);this.da.view.ea.ha(a);this.da.view.ea.Sb(e)};c.prototype.hr=function(a){if(this.wa())return!1;var b=this.da.view.ea.xa(a,!1);b?b.$g()?(a=this.da.view.Zl({}))&&a.Wl(b,b.rect.x,b.rect.y):this.log("editNodeText: node %s (%s) cannot contain text.",a,b.type()):this.log("editNodeText: nodeid %s does not exist.",
a)};c.prototype.duplicate=function(){if(this.wa())return!1;this.da.view.duplicate()};c.prototype.Sj=function(a,b,c){var d=this;if(!(this.mi||this.Ek[a]||this.aq(a))){var g=function(){if(!d.mi&&(d.Ek[a]=!1,a in d.bb))for(var c=0,e=d.bb[a];c<e.length;c++)e[c].apply(null,b)};if("once"===c&&(this.Ek[a]=!0,b.length))throw Error("emitOnce("+a+") with args not supported.");"now"===c?g():setTimeout(g,0);return this}};c.prototype.ma=function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];return this.Sj(a,
b,"normal")};c.prototype.Re=function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];return this.Sj(a,b,"now")};c.prototype.Ng=function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];return this.Sj(a,b,"once")};c.prototype.qu=function(a){this.Kf[a]=a in this.Kf?this.Kf[a]+1:1};c.prototype.aq=function(a){return a in this.Kf&&0<this.Kf[a]?(this.log("Skipped %s event",a),--this.Kf[a],!0):!1};c.prototype.focus=function(a,b){void 0===a&&(a=!1);void 0===b&&(b=null);this.da.iu(b);
a?this.da.Ol("text"===this.Tg()):this.da.focus("canvas")};c.prototype.ur=function(a){a=this.Ln(a);return a.length?a[0]:null};c.prototype.Ln=function(a){a=this.da.view.ea.vr(a);for(var b=[],c=0;c<a.length;c++)b.push(a[c].id);return b};c.prototype.yr=function(a,b,c){if(this.wa())return!1;if(3===arguments.length)if("number"!==typeof b||"number"!==typeof c)this.Ca("flip: 2nd and 3rd args must be numbers.");else{var d=new z(b,c);this.da.view.Nn(a/180*Math.PI,d)}else this.da.view.Nn(a/180*Math.PI)};c.prototype.Qg=
function(a,b,c,e){if(this.wa())return!1;a=this.Ym(a);"number"===typeof c&&"number"===typeof e?(c=new z(c,e),this.da.view.Qg(a,b/180*Math.PI,c)):this.da.view.Qg(a,b/180*Math.PI)};c.prototype.Qn=function(a,b,c){function d(a){a.addEventListener("click contextmenu",function(b){m.call(h,a.me("backgroundColor"),0===b.button);b.preventDefault()})}function g(a,b){return y("div").Wc({width:b+"px",height:b+"px",display:"inline-block"}).yd(a)}function f(a,b){var c=document.createElement("canvas");c.width=a;
c.height=a;b(c.getContext("2d"),0,0,a);var d=g(l,a);d.Aa.appendChild(c);return d}void 0===c&&(c={});var h=this,l=qb(a),k;if(l){var m=c.onColour||c.onColor||h.jg;a=f(b,Le);a.addEventListener("click contextmenu",function(a){if("click"===a.type||"contextmenu"===a.type)m.call(h,"transparent",0===a.button),a.preventDefault()});a=f(b,Me);a.addEventListener("click contextmenu",function(a){if("click"===a.type||"contextmenu"===a.type){if(c.onOpacity)c.onOpacity(.5,0===a.button);else h.rp(.5,0===a.button);
a.preventDefault()}});for(k=0;1>=k;k+=1/13){var q=(new u(u.De,[0,0,k,1])).toString();d(g(l,b).Wc({backgroundColor:q}))}for(k=.3;1>=k;k+=.7/14)for(a=0;360>a;a+=22.5)q=(new u(u.De,[a,.7,k,1])).toString(),d(g(l,b).Wc({backgroundColor:q}));for(a=0;360>a;a+=22.5)q=(new u(u.De,[a,1,1,1])).toString(),d(g(l,b).Wc({backgroundColor:q}))}};c.prototype.Rg=function(){return this.da.view.Rg()};c.prototype.Jk=function(){var a=[];this.da.view.ea.Lc(function(b){a.push(b.id)},this.Xe());return a};c.prototype.Kr=function(){return this.da.Lr()};
c.prototype.Lk=function(a){return this.Fe(this.da.view.Lk(a))};c.prototype.Nc=function(a){Xb(a)||this.Ca("getConfig: Expected string");return this.da.fa.get(a)};c.prototype.getContext=function(){return new Je(this)};c.prototype.Xe=function(){return this.ub?this.pk:this.da.view.ea.Ra};c.prototype.Nr=function(){return this.da.view.Ei()};c.prototype.Or=function(){return this.da.view.Ii()};c.prototype.Tg=function(){return this.da.view.Tg()};c.prototype.Pr=function(a){a=this.da.view.ea.xa(a);var b=null;
a&&"CustomNode"===a.type()&&(b=a.Sa);return b};c.prototype.Vn=function(a,b){var c=this.da.view.sh(a,b);return{x:c.x,y:c.y}};c.prototype.Rr=function(a){return this.da.view.ea.ja(a)};c.prototype.Ai=function(){var a;this.Nc("pageView")&&(a=$c);return this.Fe(this.da.view.ea.Gb(this.Xe(),a))};c.prototype.Vg=function(){for(var a=this.da.ta,b=a;b;){if(b instanceof HTMLElement&&(null!==b.getAttribute("zwibbler")||"ZWIBBLER"===b.tagName)){a=b;break}b=b.parentElement}return a};c.prototype.Ei=function(){return this.da.view.Ei()};
c.prototype.Pk=function(a){return this.da.fa.Pk(a)};c.prototype.bs=function(a){return this.da.language.get(a)};c.prototype.Fe=function(a){return{x:a.x,y:a.y,width:a.width,height:a.height}};c.prototype.Rh=function(a){"object"!==typeof a&&this.Ca("Error: Rectangle object expected.");a=new B(a.x||0,a.y||0,a.width||0,a.height||0);a.Zo();return a};c.prototype.Tr=function(){return this.Fe(this.da.view.ea.Sn())};c.prototype.Zr=function(a,b){return this.Vf(a,b)};c.prototype.ds=function(){var a=[],b={};this.da.view.ea.zc(!1,
function(d){!(c=d.Ac())||c in b||(b[c]=1,a.push(c))});var c=this.Rg();c in b||a.push(c);return a};c.prototype.cs=function(a){var b=[];this.da.view.ea.zc(!1,function(c){c.Ac()===a&&b.push(c.id)});return b};c.prototype.es=function(a,b,c){var d=this.da.view.ea.xa(a);if(null===d)return this.Ca("Error: node %s does not exist",a),null;a=this.da.view.dt(d,b,c);return{x:a.x,y:a.y}};c.prototype.nd=function(a){return this.da.view.ea.nd(a)};c.prototype.Vf=function(a,b){return this.da.Vf(a,b)};c.prototype.fs=
function(a){a=Ke(a);for(var b=null,c=0;c<a.length;c++){var e=a[c],g=this.da.view.ea.xa(e);null===g?this.Ca("Error: node %s does not exist",e):b?b.Eh(g.rect):b=g.rect.clone()}b||(b=new B(0,0,0,0));return this.Fe(b)};c.prototype.gs=function(a){var b=this.da.view.ea.xa(a);if(null===b)return this.Ca("Error: node %s does not exist",a),null;a=b.Ha().ec();return{x:a.x,y:a.y}};c.prototype.hs=function(a){var b=this.da.view.ea.xa(a);if(null===b)this.Ca("Error: node %s does not exist",a);else return a=b.Ha(),
[a.m11,a.m21,a.m12,a.m22,a.Fa,a.Ga]};c.prototype.js=function(a){a=this.da.view.ea.xa(a);var b="";a&&(b=a.type(),"CustomNode"===b&&(b=a.ja("nodeType")));return b};c.prototype.ks=function(a,b){var c=this.da.view.ea.qb(a,b,this.da.view.Qa);return c?c.id:this.da.view.So(a,b)&&(c=this.Cc(),c.length)?c[0]:null};c.prototype.ns=function(a,b){for(var c=[],e=0,g=this.da.view.ea.Ds(a,b);e<g.length;e++)c.push(g[e].id);return c};c.prototype.Bc=function(){var a=this.da.view.ea.Bc();this.ub&&(a+=this.gj.length);
return a};c.prototype.Fi=function(a){for(var b=0,c=this.gj;b<c.length;b++){var e=c[b];if(e.index===a)return e.node}return(a=this.da.view.ea.Wg(a))?a.id:null};c.prototype.Zn=function(a){return this.Fe(this.da.view.ea.Gb(a,$c))};c.prototype.Gi=function(a){var b=this.da.view.ea.xa(a,!1);if(!b||"PathNode"!==b.type())return null;a=b.Gi().clone().ye();var c=[];b.Ha();for(b=0;b<a.length;b++){var e=a[b];c.push(e.x);c.push(e.y)}return c};c.prototype.ps=function(a){a=this.da.view.ea.xa(a,!1);if(!a||"PathNode"!==
a.type())return null;a=a.Gi();for(var b=[],c=[],e=0;e<a.ba.length;){switch(a.ba[e]){case H.jc:c=[{x:a.ba[e+1],y:a.ba[e+2]}];b.push(c);break;case H.ic:c.push({x:a.ba[e+1],y:a.ba[e+2]})}e+=H.kc[a.ba[e]]}return b};c.prototype.Tn=function(){return this.da.view.scale};c.prototype.Nk=function(){var a=this.da.view.Nk();return a?a.id:0};c.prototype.qs=function(a,b,c,e){var d=this.da.view.wk(a,b);if(void 0===c||void 0===e)return{x:d.x,y:d.y};a=this.da.view.wk(a+c,b+e);return this.Fe(new B(d.x,d.y,a.x-d.x,
a.y-d.y))};c.prototype.ss=function(){return this.da.view.hd};c.prototype.Ii=function(){return this.da.view.Ii()};c.prototype.Di=function(a,b){var c=this.da.view.ea.xa(a,!1);return c?c.Di(b):null};c.prototype.bu=function(a,b,c){var d=this.da.view.ea.xa(a,!1);if(!d)return this.log("setEditHandle: node %s doesn't exist.",a),!1;if("PathNode"!==d.type())return this.log("setEditHandle: node %s is not a PathNode.",a),!1;d=d.ja("commands");d=S.Vp(d,b,c);if(!d)return this.log("setEditHandle: failed"),!1;this.Vc(a,
"commands",d);return!0};c.prototype.Cc=function(a){void 0===a&&(a=!1);return this.da.view.qc(a)};c.prototype.Xg=function(a){function b(a,b){var d=c.properties[a];void 0!==b&&(c.properties[a]=d!==b&&void 0!==d?null:b);c.empty=!1}void 0===a&&(a=this.Cc());for(var c={properties:{},types:{},nodes:[],empty:!0},e=this.da.fa.get("allowTextInShape"),g=0;g<a.length;g++){var f=this.da.view.ea.xa(a[g],!1);if(f){var h=f.type();c.types[h]=!0;c.types.AnyNode=!0;c.empty=!1;c.nodes.push(f.id);"PathNode"===h&&(h=
f.ja("closed")?"PathNode-closed":"PathNode-open",c.types[h]=!0);f=f.dc();for(var l in f)f.hasOwnProperty(l)&&"matrix"!==l&&("BrushNode"!==h||"fillStyle"!==l)&&("PathNode-open"!==h||"fontSize"!==l&&"fontName"!==l&&"fillStyle"!==l)&&("PathNode-closed"!==h||(e||"fontSize"!==l&&"fontName"!==l)&&"arrowSize"!==l&&"arrowStyle"!==l)&&b(l,f[l])}}!c.nodes.length||"opacity"in c.properties||(c.properties.opacity=1);if(this.da.view.oa.Ji){a=this.da.view.oa.Ji();for(var k in a)b(k,a[k])}return c};c.prototype.vs=
function(){return this.Fe(this.da.view.Jd())};c.prototype.Ca=function(a){for(var b=1;b<arguments.length;b++);b=arguments[0].split("%s");for(var c=[],e=0;e<b.length;e++)c.push(b[e]),e<b.length-1&&c.push(JSON.stringify(arguments[e+1]));b=c.join("");this.log(b);console.log(b);throw Error(b);};c.prototype.Xj=function(a,b){var c=document.createElement("input");c.setAttribute("id","ZwibblerFileInput");c.setAttribute("type","file");a.accept&&c.setAttribute("accept",a.accept);c.style.display="none";document.body.appendChild(c);
this.da.va.add(function(){c.parentNode&&c.parentNode.removeChild(c)});var e=new FileReader;c.addEventListener("change",function(){var b=this.files;b&&0<b.length&&("data-uri"===a.format?e.readAsDataURL(b[0]):"text"===a.format&&e.readAsText(b[0]));c.parentNode&&c.parentNode.removeChild(c)});e.addEventListener("load",function(){b(e.result)});c.value="";c.click()};c.prototype.nt=function(a){var b=this;a||(a={});a.format=a.format;a.accept=a.accept;return new eb(function(c){b.Xj(a,c)})};c.prototype.Es=
function(){var a=this;if(this.wa())return!1;this.Xj({accept:"image/*",format:"data-uri"},function(b){a.createNode("ImageNode",{url:b,lv:!0})})};c.prototype.Si=function(a,b,c){if(this.wa())return!1;var d=this.da.view.ea.Wa(),g={};J(b)&&J(c)&&(g.width=b,g.height=c);this.actions.push(new U(d,"PageNode",g,this.da.view.ea.root.id,a));this.Jb(d);this.ub&&this.gj.push({node:d,index:a});return a};c.prototype.bl=function(a){return this.da.view.ea.bl(a)};c.prototype.load=function(a,b){void 0===b&&(b=a);var c=
id.Kh(b);if(c)return this.Af(),this.da.Ud(c),!0;this.log("load(): Could not open file.");return!1};c.prototype.Xi=function(a){var b=this;J(a)?(this.el&&clearTimeout(this.el),this.el=setTimeout(function(){b.da.view.Xi(!1)},a),b.da.view.Xi(!0)):this.Ca("lockUpdates: Expected a number")};c.prototype.Yf=function(a){this.yc&&(this.yc.Yf(a),a=this.yc.Sg(),""!==a&&(this.log("Releasing buffered changes"),this.ma("local-changes",a)))};c.prototype.Yi=function(){if(this.wa())return!1;this.da.view.Yi()};c.prototype.Vs=
function(a,b){if(this.wa())return!1;if(J(a)&&J(b)){var c=this.Bc();0>a||a>=c?this.Ca("From page must be > 0 and less than getPageCount()"):0>b||b>=c?this.Ca("From page must be > 0 and less than getPageCount()"):(c=this.Fi(a),null!==c&&(this.actions.push(new Nc([c],Nc.Gm,b)),this.Jb()))}else this.Ca("movePage: needs two valid page numbers.")};c.prototype.Zi=function(){if(this.wa())return!1;this.da.view.Zi()};c.prototype.gl=function(){this.Af();this.da.gl();this.No()};c.prototype.nextPage=function(){this.xf(Math.min(this.Xe()+
1,this.Bc()-1))};c.prototype.sa=function(a,b){"draw"===a?this.gd=b:a in this.bb?this.bb[a].push(b):this.bb[a]=[b];return this};c.prototype.it=function(a){"function"===typeof a||this.Ca("Error: onComplete needs a function argument.");this.da.view.Cr(a)};c.prototype.No=function(){var a=this.da.fa.get("defaultPaperSize");this.log("onNewDocument()");"none"!==a&&this.Ml(a)};c.prototype.ot=function(a){var b=this;return new eb(function(c,e){b.Xj({accept:"."+a,format:"text"},function(a){b.load(a)?c(b):e(Error("Could not open the file."))})})};
c.prototype.nh=function(a){if(this.wa())return!1;this.da.view.nh(a)};c.prototype.xt=function(){this.xf(Math.max(this.Xe()-1,0))};c.prototype.print=function(a,b){var c=[],e;if("number"===typeof a)c.push(a);else if(a instanceof Array)for(e=0;e<a.length;e++)if(J(a[e]))c.push(a[e]);else{this.Ca("print(): pageSpec must be array of numbers");return}else if(!a)for(e=0;e<this.Bc();e++)c.push(e);var g=b?this.Rh(b):this.Rh(this.Ai());var f=this.Xe(),h=document.createElement("canvas");h.width=g.width;h.height=
g.height;var l=h.getContext("2d");l.translate(-g.x,-g.y);e=window.location.hostname;var k=window.open("about:blank","_blank");k.document.write("<!DOCTYPE html><html><head><title>"+e+"</title></head><body>");for(e=0;e<c.length;e++)this.xf(c[e]),this.da.view.Dd(l,g.x,g.y,g.width,g.height),this.da.view.ea.ha(l),0<e?k.document.write("<div style='page-break-before:always'>"):k.document.write("<div>"),k.document.write("<img style='width:100%' src='"),k.document.write(h.toDataURL()),k.document.write("'></div>"),
l.clearRect(g.x,g.y,g.width,g.height);k.document.write("</body></html>");k.document.close();setTimeout(function(){k.focus();k.print();setTimeout(function(){k.close()},1E3)},1E3);this.xf(f)};c.prototype.wa=function(){return this.da.fa.get("readOnly")?(this.log("readOnly; ignore tool click."),!0):!1};c.prototype.Sd=function(){this.da.view.Sd()};c.prototype.ve=function(a){this.da.view.ha(a)};c.prototype.removeEventListener=function(a,b){if(a in this.bb){for(var c=this.bb[a],e=0;e<c.length;e++)if(c[e]===
b){c.splice(e,1);break}0===c.length&&delete this.bb[a]}};c.prototype.resize=function(){if(!this.Cl){var a=this;a.Cl=setTimeout(function(){a.Cl=0;a.da.Th()},0)}};c.prototype.save=function(a,b,c){void 0===a&&(a="zwibbler3");void 0===c&&(c=0);var d={jpeg:"image/jpeg",jpg:"image/jpeg",png:"image/png",bmp:"image/bmp",svg:"image/svg+xml",pdf:"application/pdf"};b=this.Rh(b||this.Ai());switch(a){case "list":return id.Lh(this.da.view.ea,"list","object");case "png":case "jpeg":case "jpg":case "bmp":case "svg":case "pdf":return this.da.bp(d[a],
b,c);case "zwibbler3":return id.Lh(this.da.view.ea,"zwibbler3","string");case "image/png":case "image/jpeg":case "image/bmp":b=this.da.bp(a,b,c);b=b.substr(b.indexOf(",")+1);a="";c=0;d={A:0,B:1,C:2,D:3,E:4,F:5,G:6,H:7,I:8,J:9,K:10,L:11,M:12,N:13,O:14,P:15,Q:16,R:17,S:18,T:19,U:20,V:21,W:22,X:23,Y:24,Z:25,a:26,b:27,c:28,d:29,e:30,f:31,g:32,h:33,i:34,j:35,k:36,l:37,m:38,n:39,o:40,p:41,q:42,r:43,s:44,t:45,u:46,v:47,w:48,x:49,y:50,z:51,0:52,1:53,2:54,3:55,4:56,5:57,6:58,7:59,8:60,9:61,"+":62,"/":63,"=":64};
for(b=b.replace(/[^A-Za-z0-9\-_=\+\/]/g,"");c<b.length;){var g=d[b.charAt(c++)];var f=d[b.charAt(c++)];var h=d[b.charAt(c++)];var l=d[b.charAt(c++)];g=g<<2|f>>4;f=(f&15)<<4|h>>2;var k=(h&3)<<6|l;a+=String.fromCharCode(g);64!==h&&(a+=String.fromCharCode(f));64!==l&&(a+=String.fromCharCode(k))}return a;default:return"Unsupported format: "+a}};c.prototype.Zt=function(a){this.da.view.canvas.style.cursor=a};c.prototype.sd=function(a,b){if(this.wa())return!1;this.da.view.sd(a,b)};c.prototype.Ym=function(a){for(var b=
[],c=0;c<a.length;c++){var e=this.da.view.ea.xa(a[c],!1);e&&b.push(e)}return b};c.prototype.selectNodes=function(a){a=this.Ym(Ke(a));this.da.view.selectNodes(a);this.da.view.Mb();this.da.view.ha()};c.prototype.pj=function(a){if(this.wa())return!1;a=Ke(a||this.Cc());this.da.view.pj(a)};c.prototype.qj=function(a){this.da.view.qj(a)};c.prototype.Xt=function(a,b){"defaultPaperSize"===a&&this.Ml(b);return this.da.fa.set(a,b)};c.prototype.jg=function(a,b){if(this.wa())return!1;this.da.view.ht(a,b)};c.prototype.xf=
function(a){this.ub?(this.log("Set page to %s inside transaction",a),this.actions.push(new Qc(a)),this.pk=a):this.da.view.Sb(a)};c.prototype.Jl=function(a){this.da.view.Jl(a)};c.prototype.$t=function(a,b){this.da.view.ea.setProperty(a,b)};c.prototype.kg=function(a,b){!J(a)&&null!==a||!J(b)&&null!==b?alert("setDocumentSize: width/height must be numbers"):this.da.view.kg(a,b)};c.prototype.lp=function(a,b){!J(a)&&null!==a||!J(b)&&null!==b?alert("setDocumentSize: width/height must be numbers"):this.Jb(this.da.view.kg(a,
b,this.actions))};c.prototype.mp=function(a,b){var c=this.da.view.ea.xa(a);c?("DomNode"!==c.type()&&this.Ca("setDomElement: Node %s is not a DomNode. It is %s",a,c.type()),c.cu(b),this.da.oi.push(b)):this.Ca("setDomElement: Node %s does not exist",a)};c.prototype.au=function(a,b){return this.mp(a,b)};c.prototype.cq=function(){var a=this;this.log("Setting up dragdrop");this.da.va.addEventListener(this.da.ta,"drop",function(b){b.preventDefault();if(b.dataTransfer){if(b.dataTransfer.items)for(var c=
0;c<b.dataTransfer.items.length;c++){if("file"===b.dataTransfer.items[c].kind){a.da.view.vl(b.dataTransfer.items[c]);break}}else for(c=0;c<b.dataTransfer.files.length;){a.da.view.vl(b.dataTransfer.files[c]);break}try{var e=JSON.parse(b.dataTransfer.getData("text"))}catch(h){return}if("object"===typeof e&&e["zwibbler-src"]){var g=parseFloat(e["zwibbler-width"]),f=e["zwibbler-src"];a.log("DragDrop received with src=%s size=%s",f,g);f&&Q.Xn(f,function(c,d){var e=1;g&&(e=g/c);var h=a.Vn(b.pageX,b.pageY);
h.x-=c*e/2;h.y-=d*e/2;a.gk();var l=a.createNode("ImageNode",{url:f});a.nj(l,e,e);a.Ch(l,h.x,h.y);a.bi();a.Ep()})}}})};c.prototype.Sr=function(a){var b=this.da.view.ea.xa(a);if(!b)return this.Ca("getDomElement: Node %s does not exist",a),null;b instanceof hc||this.Ca("getDomElement: Node %s is not a DomNode. It is %s",a,b.type());return b.Vg()};c.prototype.fu=function(a,b){Xb(a)&&Xb(b)?(this.Rg()===a&&this.qj(b),this.da.view.ea.zc(!1,function(c){c.Ac()===a&&c.setProperty("layer",b)})):this.Ca("setLayerName() needs string arguments.")};
c.prototype.Ml=function(a,b){var c=null,e=null,g=!0,f=!1;if(2===arguments.length)if(J(arguments[0])&&J(arguments[1])){var h=arguments[0];c=arguments[1]}else Xb(arguments[0])&&"boolean"===typeof arguments[1]?(e=arguments[0],f=arguments[1]):g=!1;else if(1===arguments.length&&Xb(arguments[0]))for(var l=arguments[0].split(" "),k=0;k<l.length;k++)"landscape"===l[k]?f=!0:"portrait"===l[k]?f=!1:e=l[k];if(!1===g)return this.log("Bad arguments to setPaperSize()."),!1;if(null===e)return this.kg(h,c),!0;switch(e.toLowerCase()){case "letter":h=
816;c=1056;break;case "legal":h=816;c=1344;break;case "11x17":h=1056;c=1632;break;case "tabloid":h=1056;c=1632;break;case "a0":h=841/25.4*96;c=1189/25.4*96;break;case "a1":h=594/25.4*96;c=841/25.4*96;break;case "a2":h=420/25.4*96;c=594/25.4*96;break;case "a3":h=297/25.4*96;c=420/25.4*96;break;case "a4":h=210/25.4*96;c=297/25.4*96;break;case "none":c=h=null;break;default:return this.log("Invalid paper size: %s",e),!1}f&&(e=h,h=c,c=e);this.kg(h,c);return!0};c.prototype.eu=function(a,b,c){this.Vc(a,
b,c)};c.prototype.uh=function(a,b){if(this.wa())return!1;if(2!==arguments.length)throw"Error: setNodeProperties takes 2 arguments.";return this.Jb(this.da.uh(this.actions,Ke(a),this.Eb(b)))};c.prototype.Vc=function(a,b,c){if(this.wa())return!1;3!==arguments.length&&this.Ca("Error: setNodeProperty takes 3 arguments.");return this.Jb(this.da.Vc(this.actions,Ke(a),b,this.Eb(c)))};c.prototype.gu=function(a,b){for(var c=Ke(a),e=0;e<c.length;e++){var g=this.da.view.ea.xa(c[e],!0);g&&g.Vd(!b)}this.da.view.ha()};
c.prototype.rp=function(a,b){if(this.wa())return!1;this.da.view.mt(a,b)};c.prototype.hu=function(a,b,c){J(a)&&J(b)&&J(c)||this.Ca("setPageSize(): requires pageNo, width, height");var d=this.Fi(a);d?this.uh(d,{width:b,height:c}):this.Ca("setPageSize: no such page %s",a)};c.prototype.Ll=function(a){this.da.view.Ll(a)};c.prototype.setProperty=function(a,b){this.Vc(this.Cc(),a,b);this.sd(a,b)};c.prototype.ku=function(a){Yb(a)&&J(a.x)&&J(a.y)&&J(a.width)&&J(a.height)||this.Ca("setViewRect: arg must be an object with numeric x, y, width, height properties");
0!==a.width&&0!==a.height||this.Ca("setViewRect: width and height must be non-zero.");this.da.view.og(this.Rh(a))};c.prototype.Xc=function(a,b,c){if(J(a)||"page"===a||"width"===a)if(1===arguments.length)this.da.view.Xc(a);else if(3===arguments.length&&"number"===typeof a&&J(b)&&J(c)){var d=this.Tn()/a,g=this.da.view.Jd();g.transform(new Kb(d,d,b,c));this.da.view.og(g)}else this.Ca("setZoom: invalid arguments.");else this.log("setZoom: invalid parameter.")};c.prototype.xh=function(a,b){void 0===b&&
(b=!0);this.da.view.xh(a,b)};c.prototype.Na=function(a,b,c){a=this.da.view.Na(new z(a,b),c);return{x:a.x,y:a.y}};c.prototype.Ui=function(){return Q.Ui()};c.prototype.zh=function(a){a?(a=qb(a))||this.Ca("toggleFullScreen: can't find element from "+a):a=this.Vg();a.style.backgroundColor="#ffffff";Q.zh(a)};c.prototype.Ch=function(a,b,c){if(this.wa())return!1;this.log("Translate node %s by %s,%s actions=%s",a,b,c,this.actions.length);return this.Jb(this.da.Ch(this.actions,Ke(a),b,c))};c.prototype.qh=
function(a){this.da.qh(a)};c.prototype.yl=function(){this.da.view.yl()};c.prototype.Pt=function(a){if(this.wa())return!1;var b=Math.round(a/(Math.PI/2));a=b*Math.PI/2;b=0===b%2;var c=this.Xe();this.gk();for(var e=0;e<this.Bc();e++){this.xf(e);var g=this.Jk(),f=this.Ai(),h=f.width/2;f=f.height/2;this.ap(g,a,h,f);b||this.Ch(g,f-h,h-f);g=this.Fi(e);h=this.Vf(g,"width");f=this.Vf(g,"height");h&&f&&this.uh(g,{width:f,height:h})}b||(h=this.da.view.ea.ja("width"),f=this.da.view.ea.ja("height"),h&&f||!this.Nc("pageView")||
(h=$c.width,f=$c.height),h&&f&&this.lp(f,h));this.bi();this.xf(c)};c.prototype.ap=function(a,b,c,e){if(this.wa())return!1;this.log("Rotate nodes by %s around (%s,%s) actions=%s",b/Math.PI*180,c,e,this.actions.length);for(var d=4===arguments.length,f=Ke(a),h=new z(0,0),l=0;l<f.length;l++){var k=f[l],m=this.da.view.ea.xa(k);!m&&!this.ii.contains(k)||!m&&!d?this.log("rotateNode: Node %s does not exist",k):!d&&m&&(k=m.rect.ed(),h.x+=k.x,h.y+=k.y)}d?(h.x=c,h.y=e):(h.x/=f.length,h.y/=f.length);d=new Jb(b,
h.x,h.y);return this.Jb(this.da.transformNode(this.actions,f,d))};c.prototype.nj=function(a,b,c,e,g){void 0===e&&(e=0);void 0===g&&(g=0);if(this.wa())return!1;this.log("Scale node %s by %s,%s actions=%s",a,b,c,this.actions.length);return this.Jb(this.da.nj(this.actions,Ke(a),b,c,e,g))};c.prototype.Kl=function(a,b,c,e,g,f,h){if(this.wa())return!1;7!==arguments.length&&this.Ca("setNodeTransform: requires 7 arguments");this.log("setNodeTransform(id=%s %s %s %s %s %s %s %s)",a,b,c,e,g,f,h);return this.Jb(this.da.Kl(this.actions,
Ke(a),b,c,e,g,f,h))};c.prototype.tp=function(a,b,c){var d=this;if(!this.eg){var g=document.createElement("div");g.style.width="320px";g.style.lineHeight="0";var f=this;this.Qn(g,20,{onColour:function(a){f.setProperty(f.vn,a)}});this.eg=Q.Jh(g);this.da.va.add(function(){d.eg&&(d.eg.destroy(),d.eg=null)})}this.vn=a;this.eg.show(b,c,!0)};c.prototype.Yq=function(a){void 0===a&&(a=ne(32));this.log("Creating shared session "+a);this.Sh(a,!0);return a};c.prototype.Sh=function(a,b){var c=this;this.log("Attach to shared session "+
a);this.Af();var e=new Ce(this.da.view,ne(4),b);this.yc=e;return new eb(function(d,f){"custom"!==c.da.fa.get("collaborationServer")?(c.Jc=new De(a,c,b),c.Jc.sa("created",function(){c.log("joinSharedSession: success.");d(a)}),c.Jc.sa("rejected",function(){c.log("joinSharedSession: Already exists.");c.Af();f(Error("Session already exists"))}),b||(c.Jc.sa("joined",function(){d(a)}),c.Jc.sa("empty",function(){c.Af();c.log("joinSharedSession: Missing document.");f(Error("Session does not exist."))})),
c.Jc.sa("connected",function(){c.ma("connected");c.digest()}),c.Jc.sa("connect-error",function(){c.ma("connect-error");c.digest()})):d(a);var g=e.Sg();""!==g&&c.ma("local-changes",g);return a})};c.prototype.Ls=function(a,b){var c=this;void 0===a&&(a="");void 0===b&&(b=!1);if(b)return this.log("Attempting to create a new session"),this.Sh(a,!0).then(null,function(b){if("Session already exists"===b.message)return c.log("Attempting to join existing session."),b=new bd(!0),c.da.Ud(b),c.Sh(a,!1);throw b;
}).then(null,function(a){console.log(a);throw a;});var e=this.da.view.ea,g=new bd(!0);this.da.Ud(g);return this.Sh(a,!1).then(function(){c.log("Successfully connected to session.")},function(a){c.log("Error connecting to session: %s",a.message);c.da.Ud(e);throw a;})};c.prototype.Af=function(){this.yc&&(this.yc.end(),this.yc=null);this.Jc&&(this.Jc.stop(),this.Jc=null,this.ma("disconnected"))};c.prototype.gb=function(){if(this.wa())return!1;this.da.view.gb()};c.prototype.Dh=function(a){if(this.wa())return!1;
this.Jb(this.da.Dh(this.actions,Ke(a)))};c.prototype.upload=function(a,b){function c(){}function e(){}var g=this.da.Xq(b||"Working"),f=new XMLHttpRequest,h=new FormData(a);f.upload.addEventListener("progress",function(a){g.update(a.loaded/a.total)},!1);f.addEventListener("load",function(){200===f.status?(g.done(),e(f.response,f)):(g.error("Error"),c(f))},!1);f.addEventListener("error",function(){g.error("Error");c(f)},!1);f.addEventListener("abort",function(){g.error("Aborted");c(f)},!1);f.open(a.method,
a.action);f.send(h);var l={success:function(a){e=a;return l},error:function(a){c=a;return l}};return l};c.prototype.Eu=function(a,b){void 0===b&&(b=!1);if(this.wa())return!1;this.da.view.rq(this.Eb(a),b)};c.prototype.Fu=function(a,b){if(this.wa())return!1;2===arguments.length?this.da.view.zk({lineWidth:b,strokeStyle:a}):1===arguments.length?this.da.view.zk(this.Eb(arguments[0])):this.da.view.zk({})};c.prototype.Gu=function(a){if(this.wa())return!1;this.da.view.Ej(this.Eb(a))};c.prototype.Hu=function(a){if(this.wa())return!1;
this.da.view.yn(this.Eb(a))};c.prototype.Iu=function(a){if(this.wa())return!1;Yb(a)?(a=new me(this.da.view,a),this.da.view.$a(a)):this.Ca("useCustomTool(): requires an object as argument.")};c.prototype.jm=function(a){if(this.wa())return!1;this.da.view.jm(a)};c.prototype.Ej=function(a){void 0===a&&(a={});if(this.wa())return!1;this.da.view.Ej(this.Eb(a))};c.prototype.Ku=function(a,b,c){void 0===c&&(c="freehand");if(this.wa())return!1;Yb(a)?(a=this.Eb(a),c=b):a={strokeStyle:a,lineWidth:b};this.da.view.Cn(a,
c)};c.prototype.Su=function(a,b){void 0===b&&(b=!0);if(this.wa())return!1;var c=a;Xb(a)?c={url:a}:"url"in c||this.Ca("useStampTool: missing url in properties");this.da.view.Lu(c,1===arguments.length||!0===b)};c.prototype.Mu=function(a,b){if(this.wa())return!1;if(Yb(b)){var c=b.singleLine;var e=b.orthogonal}else c=b;this.da.view.vo(this.Eb(a),c,e)};c.prototype.Nu=function(){this.da.view.rt()};c.prototype.Ep=function(){this.da.view.Za()};c.prototype.km=function(a,b,c,e){if(this.wa())return!1;J(a)||
this.Ca("usePolygonTool: parameter 1 must be a number.");J(b)||this.Ca("usePolygonTool: parameter 2 must be a number.");c&&!J(c)&&this.Ca("usePolygonTool: parameter 3 must be a number.");e&&!Yb(e)&&this.Ca("usePolygonTool: parameter 4 must be a object properties.");this.da.view.km(a,b,c||1,this.Eb(e||{}))};c.prototype.Ou=function(a){void 0===a&&(a={});if(this.wa())return!1;this.da.view.Cn(this.Eb(a),"quadratic")};c.prototype.Fh=function(a){void 0===a&&(a={});if(this.wa())return!1;this.da.view.Fh(this.Eb(a))};
c.prototype.Pu=function(a){void 0===a&&(a={});if(this.wa())return!1;this.da.view.Fh(Eb({roundRadius:this.da.fa.get("defaultRoundRectRadius")},a))};c.prototype.Qu=function(a,b){if(this.wa())return!1;var c={};Yb(a)?c=this.Eb(a):Xb(a)&&(c.stokeStyle=a);J(b)&&(c.lineWidth=b);this.da.view.er(c)};c.prototype.lm=function(a,b,c,e,g,f){void 0===g&&(g="rectangle-tl");void 0===f&&(f=null);if(this.wa())return!1;this.da.view.lm(a,this.Eb(b),c,e,g,f)};c.prototype.Ru=function(a){if(this.wa())return!1;this.da.view.Fh(this.Eb(a))};
c.prototype.Tu=function(a){if(this.wa())return!1;this.da.view.Zl(this.Eb(a))};c.prototype.Hj=function(){this.da.view.Hj()};c.prototype.Ij=function(){this.da.view.Ij()};return c}();X.prototype.log=X.prototype.log;X.prototype.addRemoteChanges=X.prototype.Mf;X.prototype.attach=X.prototype.lc;X.prototype.abortTransaction=X.prototype.hq;X.prototype.addSelectionHandle=X.prototype.wc;X.prototype.addToLanguage=X.prototype.ck;X.prototype.addPage=X.prototype.mq;X.prototype.addPanel=X.prototype.yg;
X.prototype.beginTransaction=X.prototype.gk;X.prototype.bringToFront=X.prototype.Zh;X.prototype.canRedo=X.prototype.zd;X.prototype.canUndo=X.prototype.Ad;X.prototype.clearSelection=X.prototype.ob;X.prototype.clearUndo=X.prototype.Iq;X.prototype.clickColour=X.prototype.Jq;X.prototype.commitIrreversibleTransaction=X.prototype.Nq;X.prototype.commitTransaction=X.prototype.bi;X.prototype.copy=X.prototype.Oe;X.prototype.createGroup=X.prototype.Hg;X.prototype.createNode=X.prototype.createNode;
X.prototype.createPath=X.prototype.gi;X.prototype.createToolbar=X.prototype.Zq;X.prototype.createShape=X.prototype.mk;X.prototype.cut=X.prototype.rk;X.prototype.destroy=X.prototype.Kc;X.prototype.deleteNode=X.prototype.xc;X.prototype.deleteNodes=X.prototype.tk;X.prototype.deletePage=X.prototype.$q;X.prototype.deleteSelection=X.prototype.An;X.prototype.dirty=X.prototype.he;X.prototype.download=X.prototype.download;X.prototype.draw=X.prototype.ha;X.prototype.editNodeText=X.prototype.hr;
X.prototype.duplicate=X.prototype.duplicate;X.prototype.emit=X.prototype.ma;X.prototype.emitNow=X.prototype.Re;X.prototype.emitOnce=X.prototype.Ng;X.prototype.skipEvent=X.prototype.qu;X.prototype.focus=X.prototype.focus;X.prototype.findNode=X.prototype.ur;X.prototype.findNodes=X.prototype.Ln;X.prototype.flip=X.prototype.yr;X.prototype.flipNodes=X.prototype.Qg;X.prototype.generatePalette=X.prototype.Qn;X.prototype.getActiveLayer=X.prototype.Rg;X.prototype.getAllNodes=X.prototype.Jk;
X.prototype.getBackgroundImage=X.prototype.Kr;X.prototype.getBoundingRectangle=X.prototype.Lk;X.prototype.getConfig=X.prototype.Nc;X.prototype.getContext=X.prototype.getContext;X.prototype.getCurrentPage=X.prototype.Xe;X.prototype.getCurrentFillColour=X.prototype.Nr;X.prototype.getCurrentOutlineColour=X.prototype.Or;X.prototype.getCurrentTool=X.prototype.Tg;X.prototype.getCustomNode=X.prototype.Pr;X.prototype.getDocumentCoordinates=X.prototype.Vn;X.prototype.getDocumentProperty=X.prototype.Rr;
X.prototype.getDocumentSize=X.prototype.Ai;X.prototype.getElement=X.prototype.Vg;X.prototype.getFillColour=X.prototype.Ei;X.prototype.getImageUrl=X.prototype.Pk;X.prototype.getLanguageString=X.prototype.bs;X.prototype.getDrawingRectangle=X.prototype.Tr;X.prototype.getItemProperty=X.prototype.Zr;X.prototype.getLayers=X.prototype.ds;X.prototype.getLayerNodes=X.prototype.cs;X.prototype.getNodeCoordinates=X.prototype.es;X.prototype.getNodePageNumber=X.prototype.nd;X.prototype.getNodeProperty=X.prototype.Vf;
X.prototype.getNodeRectangle=X.prototype.fs;X.prototype.getNodeScale=X.prototype.gs;X.prototype.getNodeTransform=X.prototype.hs;X.prototype.getNodeType=X.prototype.js;X.prototype.getNodeUnderPoint=X.prototype.ks;X.prototype.getNodesUnderPoint=X.prototype.ns;X.prototype.getPageCount=X.prototype.Bc;X.prototype.getPageNode=X.prototype.Fi;X.prototype.getPageRect=X.prototype.Zn;X.prototype.getPathData=X.prototype.Gi;X.prototype.getPathAsPoints=X.prototype.ps;X.prototype.getCanvasScale=X.prototype.Tn;
X.prototype.getEditNode=X.prototype.Nk;X.prototype.getScreenCoordinates=X.prototype.qs;X.prototype.getSelectedEditHandle=X.prototype.ss;X.prototype.getStrokeColour=X.prototype.Ii;X.prototype.getEditHandleType=X.prototype.Di;X.prototype.setEditHandle=X.prototype.bu;X.prototype.getSelectedNodes=X.prototype.Cc;X.prototype.getPropertySummary=X.prototype.Xg;X.prototype.getViewRectangle=X.prototype.vs;X.prototype.openFile=X.prototype.nt;X.prototype.insertImage=X.prototype.Es;X.prototype.insertPage=X.prototype.Si;
X.prototype.isLayerVisible=X.prototype.bl;X.prototype.load=X.prototype.load;X.prototype.lockUpdates=X.prototype.Xi;X.prototype.markChangesSent=X.prototype.Yf;X.prototype.moveDown=X.prototype.Yi;X.prototype.movePage=X.prototype.Vs;X.prototype.moveUp=X.prototype.Zi;X.prototype.newDocument=X.prototype.gl;X.prototype.nextPage=X.prototype.nextPage;X.prototype.on=X.prototype.sa;X.prototype.onComplete=X.prototype.it;X.prototype.openFromComputer=X.prototype.ot;X.prototype.paste=X.prototype.nh;
X.prototype.previousPage=X.prototype.xt;X.prototype.print=X.prototype.print;X.prototype.redo=X.prototype.Sd;X.prototype.redraw=X.prototype.ve;X.prototype.removeEventListener=X.prototype.removeEventListener;X.prototype.resize=X.prototype.resize;X.prototype.save=X.prototype.save;X.prototype.setCursor=X.prototype.Zt;X.prototype.setToolProperty=X.prototype.sd;X.prototype.selectNodes=X.prototype.selectNodes;X.prototype.sendToBack=X.prototype.pj;X.prototype.setActiveLayer=X.prototype.qj;
X.prototype.setConfig=X.prototype.Xt;X.prototype.setColour=X.prototype.jg;X.prototype.setCurrentPage=X.prototype.xf;X.prototype.setCustomBackgroundFn=X.prototype.Jl;X.prototype.setDocumentProperty=X.prototype.$t;X.prototype.setDocumentSize=X.prototype.kg;X.prototype.setDocumentSizeInTransaction=X.prototype.lp;X.prototype.setDomElement=X.prototype.mp;X.prototype.setDomNode=X.prototype.au;X.prototype.getDomElement=X.prototype.Sr;X.prototype.setLayerName=X.prototype.fu;X.prototype.setPaperSize=X.prototype.Ml;
X.prototype.setItemProperty=X.prototype.eu;X.prototype.setNodeProperties=X.prototype.uh;X.prototype.setNodeProperty=X.prototype.Vc;X.prototype.setNodeVisibility=X.prototype.gu;X.prototype.setOpacity=X.prototype.rp;X.prototype.setPageSize=X.prototype.hu;X.prototype.setPageView=X.prototype.Ll;X.prototype.setProperty=X.prototype.setProperty;X.prototype.setViewRectangle=X.prototype.ku;X.prototype.setZoom=X.prototype.Xc;X.prototype.showLayer=X.prototype.xh;X.prototype.snap=X.prototype.Na;
X.prototype.isFullscreenSupported=X.prototype.Ui;X.prototype.toggleFullscreen=X.prototype.zh;X.prototype.translateNode=X.prototype.Ch;X.prototype.removePanel=X.prototype.qh;X.prototype.removeSelectionHandles=X.prototype.yl;X.prototype.rotateDocument=X.prototype.Pt;X.prototype.rotateNode=X.prototype.ap;X.prototype.scaleNode=X.prototype.nj;X.prototype.setNodeTransform=X.prototype.Kl;X.prototype.showColourPicker=X.prototype.tp;X.prototype.createSharedSession=X.prototype.Yq;
X.prototype.joinSharedSession=X.prototype.Ls;X.prototype.stopSharing=X.prototype.Af;X.prototype.undo=X.prototype.gb;X.prototype.ungroup=X.prototype.Dh;X.prototype.upload=X.prototype.upload;X.prototype.useArrowTool=X.prototype.Eu;X.prototype.useBrushTool=X.prototype.Fu;X.prototype.useCircleTool=X.prototype.Gu;X.prototype.useCurveTool=X.prototype.Hu;X.prototype.useCustomTool=X.prototype.Iu;X.prototype.useEditHandleTool=X.prototype.jm;X.prototype.useEllipseTool=X.prototype.Ej;
X.prototype.useFreehandTool=X.prototype.Ku;X.prototype.useStampTool=X.prototype.Su;X.prototype.useLineTool=X.prototype.Mu;X.prototype.usePanTool=X.prototype.Nu;X.prototype.usePickTool=X.prototype.Ep;X.prototype.usePolygonTool=X.prototype.km;X.prototype.useQuadraticBezierTool=X.prototype.Ou;X.prototype.useRectangleTool=X.prototype.Fh;X.prototype.useRoundRectTool=X.prototype.Pu;X.prototype.useShapeBrushTool=X.prototype.Qu;X.prototype.useShapeTool=X.prototype.lm;X.prototype.useSquareTool=X.prototype.Ru;
X.prototype.useTextTool=X.prototype.Tu;X.prototype.zoomIn=X.prototype.Hj;X.prototype.zoomOut=X.prototype.Ij;function Oe(c){var a;void 0===a&&(a="Assertion failed.");if(!c)throw Error(a);}
var Pe=function(){function c(a){var b=this;this.Hc=0;this.log=w.create("BinaryReader");if("string"===typeof a)this.length=a.length,this.getUint8=function(){Oe(b.Hc<a.length);return a.charCodeAt(b.Hc++)&255};else{var c=new Uint8Array(a);this.length=c.length;this.getUint8=function(){Oe(b.Hc<c.length);return c[b.Hc++]}}}c.prototype.seek=function(a){Oe(0<=a&&a<=this.length);var b=this.Hc;this.Hc=a;return b};c.prototype.getUint16=function(){return(this.getUint8()<<8|this.getUint8())>>>0};c.prototype.getUint32=
function(){return this.getInt32()>>>0};c.prototype.getInt16=function(){var a=this.getUint16();a&32768&&(a-=65536);return a};c.prototype.getInt32=function(){return this.getUint8()<<24|this.getUint8()<<16|this.getUint8()<<8|this.getUint8()};c.prototype.Fb=function(){return this.getInt16()};c.prototype.ts=function(){this.getUint16()};c.prototype.We=function(){return this.getInt16()/16384};c.prototype.Ok=function(){return this.getInt32()/65536};c.prototype.ao=function(a){for(var b="",c=0;c<a;c++)b+=String.fromCharCode(this.getUint8());
return b};c.prototype.us=function(a){for(var b="",c=0;c<a;c+=2)b+=String.fromCharCode(this.getUint16());return b};c.prototype.getDate=function(){var a=1E3*(4294967296*this.getUint32()+this.getUint32())+Date.UTC(1904,1,1);return new Date(a)};return c}(),Qe=function(){function c(a){this.format=0;this.jn=[];this.log=w.create("CMAP0");for(var b=0;256>b;b++){var c=a.getUint8();this.log("   Glyph[%s] = %s",b,c);this.jn.push(c)}}c.prototype.map=function(a){return 0<=a&&255>=a?this.jn[a]:0};return c}(),Re=
function(){function c(a){this.file=a;this.format=4;this.cache={};this.log=w.create("CMAP4");var b,c=[],e=a.getUint16()/2;a.getUint16();a.getUint16();a.getUint16();for(b=0;b<e;b++)c.push({Qi:0,yj:0,Gn:a.getUint16(),ko:0});a.getUint16();for(b=0;b<e;b++)c[b].yj=a.getUint16();for(b=0;b<e;b++)c[b].ko=a.getUint16();for(b=0;b<e;b++){var g=a.getUint16();c[b].Qi=g?a.Hc-2+g:0}this.ra=c}c.prototype.map=function(a){if(!(a in this.cache)){for(var b=0;b<this.ra.length;b++){var c=this.ra[b];if(c.yj<=a&&c.Gn>=a){if(c.Qi){var e=
c.Qi+2*(a-c.yj);this.file.seek(e);var g=this.file.getUint16()}else g=c.ko+a&65535;this.log("Charcode %s is between %s and %s; maps to %s (%s) roffset=%s",a,c.yj,c.Gn,e,g,c.Qi);this.cache[a]=g;break}}b===this.ra.length&&(this.cache[a]=0)}return this.cache[a]};return c}(),Se=function(){function c(a,b,c){this.file=a;this.map={};this.cf=-1;this.log=w.create("KERN0");this.wu=b&&!c||!b&&c;this.file=a;this.offset=a.Hc;this.Zs=a.getUint16();a.getUint16();a.getUint16();a.getUint16();for(b=0;b<this.Zs;b++){c=
a.getUint16();var d=a.getUint16(),g=a.Fb();this.map[c<<16|d]=g}this.reset()}c.prototype.reset=function(){this.cf=-1};c.prototype.get=function(a){var b=0;if(0<=this.cf){var c=this.cf<<16|a;c in this.map&&(b=this.map[c])}this.cf=a;return this.wu?{x:0,y:b}:{x:b,y:0}};return c}(),Te=function(){function c(a){this.jk=[];this.dh=[];this.im=this.flags=this.yo=this.version=0;this.ge=new Date;this.mo=this.rm=this.pm=this.sm=this.qm=0;this.fontFamily=this.Ve="";this.jh=0;this.log=w.create("TrueType");this.file=
new Pe(a);this.eb=this.Ft(this.file);this.Bt(this.file);this.Et(this.file);this.zt(this.file);this.Ct(this.file);this.Dt(this.file);this.length=this.ws()}c.prototype.Ft=function(a){var b={};a.getUint32();var c=a.getUint16();a.getUint16();a.getUint16();a.getUint16();for(var e=0;e<c;e++){var g=a.ao(4);b[g]={Hq:a.getUint32(),offset:a.getUint32(),length:a.getUint32()};"head"!==g&&this.log("Table %s has checksum 0x%s",g,b[g].Hq.toString(16))}return b};c.prototype.Bt=function(a){Oe("head"in this.eb);a.seek(this.eb.head.offset);
this.version=a.Ok();a.Ok();a.getUint32();this.yo=a.getUint32();Oe(1594834165===this.yo);this.flags=a.getUint16();this.im=a.getUint16();this.ge=a.getDate();a.getDate();this.qm=a.Fb();this.sm=a.Fb();this.pm=a.Fb();this.rm=a.Fb();a.getUint16();a.getUint16();a.getInt16();this.mo=a.getInt16();a.getInt16()};c.prototype.zt=function(a){Oe("cmap"in this.eb);var b=this.eb.cmap.offset;a.seek(b);a.getUint16();for(var c=a.getUint16(),e=0;e<c;e++){var g=a.getUint16(),f=a.getUint16(),h=a.getUint32();this.log("CMap platformid=%s specificid=%s offset=%s",
g,f,h);3===g&&1>=f&&this.yt(a,b+h)}};c.prototype.yt=function(a,b){var c=a.seek(b),e=a.getUint16(),g=a.getUint16();a.getUint16();var f;this.log("    Cmap format %s length %s",e,g);0===e?f=new Qe(a,g):4===e&&(f=new Re(a,g));f&&this.jk.push(f);a.seek(c)};c.prototype.Dt=function(a){if("kern"in this.eb){a.seek(this.eb.kern.offset);var b=a.getUint16(),c=a.getUint16();this.log("Kern Table version: %s",b);this.log("Kern nTables: %s",c);for(var e=0;e<c;e++){b=a.getUint16();var g=a.getUint16(),f=a.getUint16(),
h=f>>8,l=f&4,k=0===(f&1);this.log("Kerning subtable version %s format %s length %s coverage: %s",b,h,g,f);b=null;0===h?b=new Se(a,k,0!=l):(this.log("Unknown format -- skip"),a.seek(a.Hc+g));b&&this.dh.push(b)}}};c.prototype.Et=function(a){Oe("name"in this.eb);var b=this.eb.name.offset;a.seek(b);a.getUint16();for(var c=a.getUint16(),e=a.getUint16(),g=0;g<c;g++){var f=a.getUint16(),h=a.getUint16(),l=a.getUint16(),k=a.getUint16(),m=a.getUint16(),q=a.getUint16();q=a.seek(b+e+q);m=0===f||3===f?a.us(m):
a.ao(m);this.log("Name %s/%s id %s language %s: %s",f,h,k,l,m);a.seek(q);switch(k){case 1:this.fontFamily=m;break;case 4:this.Ve=m}}};c.prototype.Ct=function(a){Oe("hhea"in this.eb);a.seek(this.eb.hhea.offset);a.Ok();a.Fb();a.Fb();a.Fb();a.ts();a.Fb();a.Fb();a.Fb();a.getInt16();a.getInt16();a.Fb();a.getInt16();a.getInt16();a.getInt16();a.getInt16();a.getInt16();this.jh=a.getUint16()};c.prototype.Yr=function(a){Oe("hmtx"in this.eb);var b=this.file;b.seek(this.eb.hmtx.offset+4);var c=this.eb.hmtx.offset;
if(a<this.jh){var e=this.file.seek(c+4*a);var g=b.getUint16();a=b.getInt16()}else e=b.seek(c+4*(this.jh-1)),g=b.getUint16(),b.seek(c+4*this.jh+2*(a-this.jh)),a=b.Fb();this.file.seek(e);return{dn:g,Ms:a}};c.prototype.ws=function(){Oe("maxp"in this.eb);var a=this.file.seek(this.eb.maxp.offset+4),b=this.file.getUint16();this.file.seek(a);return b};c.prototype.Wr=function(a){Oe("loca"in this.eb);var b=this.eb.loca,c=this.file;if(1===this.mo){b=c.seek(b.offset+4*a);a=c.getUint32();var e=c.getUint32()}else b=
c.seek(b.offset+2*a),a=2*c.getUint16(),e=2*c.getUint16();c.seek(b);return a===e?0:a+this.eb.glyf.offset};c.prototype.Xo=function(a){var b=this.Wr(a);a=this.file;if(0===b||b>=this.eb.glyf.offset+this.eb.glyf.length)return null;Oe(b>=this.eb.glyf.offset);Oe(b<this.eb.glyf.offset+this.eb.glyf.length);a.seek(b);b={Cd:[],lh:a.getInt16(),la:[],qm:a.Fb(),sm:a.Fb(),pm:a.Fb(),rm:a.Fb()};Oe(-1<=b.lh);-1===b.lh?this.At(a,b):this.Gt(a,b);return b};c.prototype.Gt=function(a,b){function c(b,c,d){for(var g=0,l=
0;l<f;l++){var k=h[l];k&c?g=k&d?g+a.getUint8():g-a.getUint8():~k&d&&(g+=a.getInt16());e[l][b]=g}}b.Cd=[];for(var e=b.la=[],g=0;g<b.lh;g++)b.Cd.push(a.getUint16());a.seek(a.getUint16()+a.Hc);if(0!==b.lh){var f=Math.max.apply(null,b.Cd)+1,h=[];for(g=0;g<f;g++){var l=a.getUint8();h.push(l);e.push({x:0,y:0,cg:0<(l&1)});if(l&8){var k=a.getUint8();Oe(0<k);for(g+=k;k--;)h.push(l),e.push({x:0,y:0,cg:0<(l&1)})}}c("x",2,16,b.qm,b.pm);c("y",4,32,b.sm,b.rm)}};c.prototype.At=function(a,b){var c,e,g=32;b.Cd=[];
for(b.la=[];g&32;){g=a.getUint16();var f=a.getUint16();var h=1;var l=c=0;var k=1;var m=e=0;if(g&1){var q=a.getInt16();var p=a.getInt16()}else q=a.getUint8(),p=a.getUint8();g&2&&(e=q,m=p);g&8?k=h=a.We():g&64?(h=a.We(),k=a.We()):g&128&&(h=a.We(),c=a.We(),l=a.We(),k=a.We());this.log("Read component glyph index %s",f);this.log("Transform: [%s %s %s %s %s %s]",h,c,l,k,e,m);q=a.Hc;if(f=this.Xo(f)){var r=b.la.length;for(p=0;p<f.Cd.length;p++)b.Cd.push(f.Cd[p]+r);for(p=0;p<f.la.length;p++){r=f.la[p].x;var t=
f.la[p].y;r=h*r+c*t+e;t=l*r+k*t+m;b.la.push({x:r,y:t,cg:f.la[p].cg})}}a.seek(q)}b.lh=b.Cd.length;g&256&&a.seek(a.getUint16()+a.Hc)};c.prototype.ar=function(a,b,c,e){b=this.Xo(b);if(null!==b)for(var d=0,f=0,h=0,l=0,k;f<b.la.length;f++){var m=b.la[f];0===d?(a.moveTo(m.x+c,m.y+e),d=1):1===d?m.cg?a.lineTo(m.x+c,m.y+e):d=2:(k=b.la[f-1],m.cg?(a.quadraticCurveTo(k.x+c,k.y+e,m.x+c,m.y+e),d=1):a.quadraticCurveTo(k.x+c,k.y+e,(k.x+m.x)/2+c,(k.y+m.y)/2+e));f===b.Cd[h]&&(2===d&&(k=m,m=b.la[l],m.cg?a.quadraticCurveTo(k.x+
c,k.y+e,m.x+c,m.y+e):a.quadraticCurveTo(k.x+c,k.y+e,(k.x+m.x)/2+c,(k.y+m.y)/2+e)),l=f+1,h+=1,d=0)}};c.prototype.transform=function(a,b){a.scale(b/this.im,-b/this.im)};c.prototype.gr=function(a,b,c,e,g){a.save();a.translate(c,e);this.transform(a,g);e=c=0;this.Nt();for(g=0;g<b.length;g++){var d=this.Us(b.charCodeAt(g)),h=this.Yr(d),l=this.bt(d);this.log("Metrics for %s code %s index %s: %s %s kern: %s,%s",b.charAt(g),b.charCodeAt(g),d,h.dn,h.Ms,l.x,l.y);this.ar(a,d,c+l.x,e+l.y);c+=h.dn}a.restore()};
c.prototype.Us=function(a){for(var b=0,c=0;c<this.jk.length&&!(b=this.jk[c].map(a));c++);return b};c.prototype.Nt=function(){for(var a=0;a<this.dh.length;a++)this.dh[a].reset()};c.prototype.bt=function(a){for(var b,c=0,e=0,g=0;g<this.dh.length;g++)b=this.dh[g].get(a),c+=b.x,e+=b.y;return{x:c,y:e}};return c}(),Ue=function(c){function a(){var a=c.call(this)||this;a.fonts={};a.kh=0;a.yk=[];a.log=w.create("FontCollection");return a}n(a,c);a.prototype.add=function(a,c){this.kh+=1;var b=this;return gb({url:a,
mimeType:"text/plain; charset=x-user-defined"}).then(function(d){b.$p(a,c,d.responseText)},function(c){b.Ca(a,c.message)})};a.prototype.Ar=function(a){for(var b in this.fonts){var c=this.fonts[b];if(c.url===a)return c.font}return null};a.prototype.Ca=function(a,c){this.log("Error when fetching "+a+": "+c);--this.kh;this.Mm()};a.prototype.$p=function(a,c,e){this.log("Got font %s; result is %s bytes",a,e.length);for(var b="",d=0;d<e.length;d++)b+=String.fromCharCode(e.charCodeAt(d)&255);e=new Te(b);
this.log("Loaded '%s'",e.Ve);for(d=0;d<e.Ve.length;d++)this.log("   %s, %s",e.Ve.charAt(d),e.Ve.charCodeAt(d));c=c||e.fontFamily;this.fonts[c]={name:e.Ve,url:a,data:b,font:e};--this.kh;this.Mm()};a.prototype.Mm=function(){if(0===this.kh){this.ma("done");for(var a=0;a<this.yk.length;a++)this.yk[a]();this.yk.length=0}};a.prototype.get=function(a){this.log("Lookup font %s",a);for(var b=0;b<a.length;b++)this.log("   %s, %s",a.charAt(b),a.charCodeAt(b));if(a in this.fonts)return this.fonts[a].font;this.log("Lookup font %s; not found",
a);for(var c in this.fonts)this.log("Searched: '%s'",c)};return a}(Sc);"undefined"!==typeof jQuery&&(jQuery.fn.zwibbler=function(c){void 0===c&&(c={});var a=null;this.each(function(b,d){d.zwibbler&&jQuery(d).empty();a=new X(d,c);d.zwibbler=a});return a},jQuery.fn.zwibblerContext=function(){return this[0].zwibbler});
var Ve=function(){function c(a,b,c,e){this.scope=a;this.element=b;this.name=c;this.value=e}c.prototype.emit=function(a,b){W.ma(this.element,a,b)};c.prototype.listen=function(a,b){W.cb(this.element,a,b)};c.prototype.watch=function(a,b){W.watch(this.scope,this.element,a,b)};c.prototype.destructor=function(a){W.va(this.element,a)};return c}(),Y=function(){function c(){this.Zk=[];this.buttons=[];this.qk={};this.fonts=new Ue;this.log=w.create("ZWIBBLER");this.WebSocket=WebSocket;this.controllers={};this.Np=
X}c.prototype.create=function(a,b){"string"===typeof a&&0<a.length&&"."!==a.charAt(0)&&"#"!==a.charAt(0)&&(a="#"+a);var c=qb(a);return c?new X(c,b):(alert("Zwibbler.create: Cannot find an element with id "+a),null)};c.prototype.iq=function(a){for(var b=["name","image","onclick"],c=0;c<b.length;c++)if(!(b[c]in a))return alert("Zwibbler.addButton: missing "+b[c]),!1;this.buttons.push(a);return!0};c.prototype.jq=function(a,b){this.qk[a]=b};c.prototype.Tp=function(a,b){void 0===b&&(b={});return this.Jh(a,
b)};c.prototype.Jh=function(a,b){function c(){var a=f.offsetWidth,b=f.offsetHeight,c=Ab();y(f).uj({left:c.x+c.width/2-a/2,top:c.y+c.height/2-b/2})}function e(a){var b=(new Date).getTime();q&&r&&200>b-r&&(a.preventDefault(),setTimeout(function(){p.hide()},0))}function g(){r=(new Date).getTime()}void 0===b&&(b={});var f=qb(a);if(!f)throw Error("Zwibbler.Dialog: Bad element passed in: "+a);var h=null===f.parentNode;h&&document.body.appendChild(f);"static"===y(f).me("position")&&(f.style.position="absolute");
f.style.display="none";var l=new Fb("transparent");l.insertBefore=f;var k=b.showNear,m=b.showHow,q=!1,p={hide:function(){l.ne();f.style.display="none";if(p.onhide)p.onhide();window.removeEventListener("resize",c)},isShown:function(){return"none"!==y(f).me("display")},show:function(a,b,d,e){void 0===d&&(d=!1);void 0===e&&(e=!0);var g=0,h=0,t="",v="";r=0;if("number"===typeof a&&"number"===typeof b){g=a;h=b;var A=!0}else t=a||k,v=b||m,A=!1;a=vb()+1;f.style.zIndex=a.toString();l.zIndex=a;f.style.display=
"block";a=f.offsetWidth;b=f.offsetHeight;if(A)v=Ab(),g={left:g,top:h},g.left=Math.min(g.left,v.x+v.width-a-2),g.top=Math.min(g.top,v.y+v.height-b-3),y(f).uj(g);else if(t&&v){if(h=qb(t))g=f,t=v,v=y(h).pc(),t=t.toLowerCase().split(" "),2!==t.length&&(t=["tl","tl"]),0<=t[0].indexOf("b")&&(v.top+=h.offsetHeight),0<=t[0].indexOf("r")&&(v.left+=h.offsetWidth),0<=t[1].indexOf("b")&&(v.top-=g.offsetHeight),0<=t[1].indexOf("r")&&(v.left-=g.offsetWidth),g.style.position="absolute",h=Ab(),t=g.clientHeight,v.left=
Math.min(v.left,h.x+h.width-g.clientWidth),v.top=Math.min(v.top,h.y+h.height-t),y(g).uj(v)}else window.addEventListener("resize",c),c();e&&l.show(p.hide);if(p.onshow)p.onshow();q=d},destroy:function(){window.removeEventListener("resize",c);f.removeEventListener("click",e);f.removeEventListener("pointerup",e);f.removeEventListener("touchend",e);f.removeEventListener("touchstart",g);f.removeEventListener("pointerdown",g);h&&y(f).remove()},onshow:b.onshow,onhide:b.onhide},r=0;f.addEventListener("click",
e);"ontouchstart"in window?(f.addEventListener("touchend",e),f.addEventListener("touchstart",g)):(f.addEventListener("pointerup",e),f.addEventListener("pointerdown",g));return p};c.prototype.Wq=function(a,b){return this.sf(a,b)};c.prototype.yb=function(a,b){W.yb(a,function(a,c,g,f){b(new Ve(a,c,g,f))})};c.prototype.sf=function(a,b,c){function d(){var a=t.Gb(),b=1,d=0,e=0;l&&(a.y=l);q&&(a.height=q-a.y);k&&(a.x=k);m&&(a.width=m-a.x);f&&h?b=Math.min(f/a.width,h/a.height):f?(b=f/a.width,h=a.height*b):
h?(b=h/a.height,f=a.width*b):(f=a.width,h=a.height);a.width*b<f&&(d=f/2-a.width*b/2);a.height*b<h&&(e=h/2-a.height*b/2);d-=a.x*b;e-=a.y*b;p.width=Math.ceil(f);p.height=Math.ceil(h);r.translate(d,e);r.scale(b,b);t.ha(r);g.log("Drawn.");c(p)}var g=this;void 0===b&&(b={});void 0===c&&(c=function(){});var f=b.width||0,h=b.height||0,l=b.top||0,k=b.left||0,m=b.right||0,q=b.bottom||0,p=rb(null),r=p.getContext("2d"),t=id.Kh(a);if(!t)throw Error("Zwibbler.render: Could not open document");var v=new Md;t.format(r,
v);v.sa("reformat",function(a){t.gh(a)});v.Of?v.sa("done",function(){t.format(r,v);d()}):d();return p};c.prototype.save=function(a,b){return new eb(function(c,e){var d=id.Kh(a);if(d){d.As()||d.setProperty("background","white");var f=rb(null).getContext("2d"),h=new Md;h.sa("reformat",function(a){d.gh(a)});h.sa("done",function(){try{d.format(f,h);var a=id.Lh(d,b,"string");c(a)}catch(k){e(k)}});d.format(f,h)}else e(Error("Failed to open document"))})};c.prototype.tt=function(a){a=u.Fd(a);return{r:a.values[0],
g:a.values[1],b:a.values[2],a:a.values[3]}};c.prototype.Rs=function(a){return(new u(u.RGBA,[a.r,a.g,a.b,a.a])).toString()};c.prototype.Gr=function(a){var b=document.createElement("a");b.href=a;return b.href};c.prototype.wq=function(a){return qa(a)};c.prototype.kq=function(a,b){var c=this;this.fonts.add(a,b).then(function(){if(!b){var d=c.fonts.Ar(a);d&&(b=d.Ve)}b&&c.Md('\n@font-face {\n    font-family: "'+b+'";\n    src: url("'+a+'");\n}')},function(){})};c.prototype.Sp=function(a){return new T(a)};
c.prototype.Mp=function(a){var b=new T,c;void 0===c&&(c=null);a=a.match(/[A-Z]|[-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?/gi);var e=0,g=0,f,h=0,l=0,k=[];if(a)for(f=0;f<a.length;f++){var m=a[f++];var q=a;for(k.length=0;f<q.length;f++){var p=parseFloat(q[f]);if(isNaN(p)){f--;break}else k.push(p)}if("M"===m){b.moveTo(k[0],k[1]);for(m=2;m<k.length;m+=2)b.lineTo(k[m],k[m+1]);e=k[k.length-2];g=k[k.length-1]}else if("m"===m)for(b.moveTo(k[0]+e,k[1]+g),e=k[0]+e,g=k[1]+g,m=2;m<k.length;m+=2)b.lineTo(k[m]+e,k[m+
1]+g),e=k[m]+e,g=k[m+1]+g;else if("L"===m){for(m=0;m<k.length;m+=2)b.lineTo(k[m],k[m+1]);e=k[k.length-2];g=k[k.length-1]}else if("l"===m)for(m=0;m<k.length;m+=2)b.lineTo(k[m]+e,k[m+1]+g),e=k[m]+e,g=k[m+1]+g;else if("H"===m)for(m=0;m<k.length;m+=1)b.lineTo(k[m],g),e=k[m];else if("h"===m)for(m=0;m<k.length;m+=1)b.lineTo(k[m]+e,g),e=k[m]+e;else if("V"===m)for(m=0;m<k.length;m+=1)b.lineTo(e,k[m]),g=k[m];else if("v"===m)for(m=0;m<k.length;m+=1)b.lineTo(e,k[m]+g),g=k[m]+g;else if("Q"===m)for(m=0;m<k.length;m+=
4)b.quadraticCurveTo(k[m],k[m+1],k[m+2],k[m+3]),h=k[m],l=k[m+1],e=k[m+2],g=k[m+3];else if("C"===m)for(m=0;m<k.length;m+=6)b.bezierCurveTo(k[m],k[m+1],k[m+2],k[m+3],k[m+4],k[m+5]),h=k[m+2],l=k[m+3],e=k[m+4],g=k[m+5];else if("c"===m)for(m=0;m<k.length;m+=6)b.bezierCurveTo(k[m]+e,k[m+1]+g,k[m+2]+e,k[m+3]+g,k[m+4]+e,k[m+5]+g),h=k[m+2]+e,l=k[m+3]+g,e=k[m+4]+e,g=k[m+5]+g;else if("S"===m)for(m=0;m<k.length;m+=4)h=e+e-h,l=g+g-l,b.bezierCurveTo(h,l,k[m],k[m+1],k[m+2],k[m+3]),h=k[m],l=k[m+1],e=k[m+2],g=k[m+
3];else if("s"===m)for(m=0;m<k.length;m+=4)h=e+e-h,l=g+g-l,b.bezierCurveTo(h,l,k[m]+e,k[m+1]+g,k[m+2]+e,k[m+3]+g),h=k[m]+e,l=k[m+1]+g,e=k[m+2]+e,g=k[m+3]+g;else"z"===m||"Z"===m?b.closePath():c?c(m,k):Gb("Unknown command: %s",m)}return b.Tb()};c.prototype.Xn=function(a,b){var c=document.createElement("img");c.src=a;c.onload=function(){b(c.naturalWidth,c.naturalHeight,c)}};c.prototype.Wt=function(a,b){return yb(a,b)};c.prototype.Au=function(a){return this.zh(a)};c.prototype.Ui=function(){var a=document.createElement("DIV");
return!!(a.requestFullscreen||a.msRequestFullscreen||a.Xs||a.webkitRequestFullscreen)};c.prototype.zh=function(a){var b=qb(a);if(!b)throw Error("Zwibbler.toggleFullScreen: "+a+" not found");a=document;this.oo()?document.exitFullscreen?document.exitFullscreen():a.msExitFullscreen?a.msExitFullscreen():a.Ws?a.Ws():a.webkitExitFullscreen&&a.webkitExitFullscreen():b.requestFullscreen?b.requestFullscreen():b.msRequestFullscreen?b.msRequestFullscreen():b.Xs?b.mozRequestFullScreen():b.webkitRequestFullscreen?
b.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):console.log("Element does not contain any requestFullscreen methods")};c.prototype.oo=function(){var a=document;return a.fullscreenElement||a.mozFullScreenElement||a.webkitFullscreenElement||a.msFullscreenElement?!0:!1};c.prototype.jr=function(){w.ir()};c.prototype.fo=function(a){return Xc.Pp(a)};c.prototype.Md=function(a){jb(a)};c.prototype.controller=function(a,b){this.controllers[a]=b};c.prototype.ci=function(a,b){W.ci(a,b)};c.prototype.lc=
function(a){var b=qb(a);if(!b)throw Error("Zwibbler.attach: Cannot find element from "+a);return We(b,!0)};c.prototype.pq=function(a){return"string"!==typeof a.url?eb.reject(Error("Zwibbler.ajax: settings.url missing")):gb({url:a.url,method:a.method,Po:a.params,mimeType:a.mimeType,contentType:a.contentType,withCredentials:a.withCredentials,data:a.data,zn:a.delay}).then(function(a){W.digest();return a},function(a){W.digest();throw a;})};return c}();
document.addEventListener("dragstart",function(c){var a=c.target;"IMG"===a.tagName&&(a={"zwibbler-src":a.getAttribute("zwibbler-src"),"zwibbler-width":a.getAttribute("zwibbler-width")},a["zwibbler-src"]&&c.dataTransfer.setData("text",JSON.stringify(a)))});var Q=new Y;Q.instances=Q.Zk;Y.prototype.addButton=Y.prototype.iq;Y.prototype.addCustomNode=Y.prototype.jq;Y.prototype.Popup=Y.prototype.Tp;Y.prototype.Dialog=Y.prototype.Jh;Y.prototype.createPreview=Y.prototype.Wq;Y.prototype.directive=Y.prototype.yb;
Y.prototype.render=Y.prototype.sf;Y.prototype.save=Y.prototype.save;Y.prototype.parseColour=Y.prototype.tt;Y.prototype.makeColour=Y.prototype.Rs;Y.prototype.getAbsoluteUrl=Y.prototype.Gr;Y.prototype.base64Encode=Y.prototype.wq;Y.prototype.addFont=Y.prototype.kq;Y.prototype.PathCommands=Y.prototype.Sp;Y.prototype.CommandsFromSvgPath=Y.prototype.Mp;Y.prototype.getImageSize=Y.prototype.Xn;Y.prototype.setColourOpacity=Y.prototype.Wt;Y.prototype.toggleFullScreen=Y.prototype.Au;
Y.prototype.isFullscreenSupported=Y.prototype.Ui;Y.prototype.toggleFullscreen=Y.prototype.zh;Y.prototype.isFullScreen=Y.prototype.oo;Y.prototype.enableConsoleLogging=Y.prototype.jr;Y.prototype.hasConfig=Y.prototype.fo;Y.prototype.injectStyle=Y.prototype.Md;Y.prototype.controller=Y.prototype.controller;Y.prototype.component=Y.prototype.ci;Y.prototype.attach=Y.prototype.lc;Y.prototype.ajax=Y.prototype.pq;Y.prototype.Context=Y.prototype.Np;window.Zwibbler=Q;var Xe=w.create("EVALJS"),Ye=function(){function c(a,b){this.dd=a;this.key=b}c.prototype.toString=function(){return"LValue("+this.key+")"};return c}(),Ze=function(){function c(a,b,c){this.id=a;this.Wi=b;c&&(this.oe=c)}c.prototype.oe=function(){return this};c.prototype.uo=function(a){return a};c.prototype.toString=function(){return"Token(id='"+this.id+"', lbp="+this.Wi+")"};return c}(),$e=function(){function c(a,b){return a[b]}function a(a,b,c){a[b]=c}function b(a){if(a instanceof Ye){if(a.dd===v)return A(v,
a.key);if(a.dd)return a.dd[a.key]}else return a}function d(a,b){void 0===b&&(b=0);var c=N[a];c?c.Wi=Math.max(c.Wi,b):c=N[a]=new Ze(a,b);return c}function e(a,b){var c=d(a);c.oe=function(){return b};return c}function g(a){return new Ze("(literal)",0,function(){return a})}function f(a){var b=new Ze("(name)",0,function(){return new Ye(v,a)});b.toString=function(){return"Token(name: "+a+")"};return b}function h(a,c,d){l(a,c,function(a){return d(b(a),b(t(c-1)))})}function l(a,b,c){d(a,b).uo=c}function k(a,
c,e){d(a,c).oe=function(){return e(b(t(c)))}}function m(a,b,c){d(a,b).oe=c}function q(a){return" "===a||"\t"===a||"\n"===a||"\r"===a}function p(){return Ta<Ea.length?Ea[Ta++]:N["(end)"]}function r(a){if(a&&R.id!==a)throw Error("Error: expected "+a+" but got "+R.id);return R=p()}function t(a){var b=R;R=p();for(var c=b.oe();a<R.Wi;)b=R,R=p(),c=b.uo(c);return c}var v={},A=c,I=a,N={},x=0,ca,M;e("true",!0);e("false",!1);e("null",null);e("undefined",void 0);d("(end)");(function(a,c,d){l(a,c,function(a){return d(b(a),
b(t(c)))})})(",",ca=++x,function(a,b){return b});l("=",M=++x,function(a){var c=t(M);if(!(a instanceof Ye))throw Error("Error: lhs of = must be assignable");c=b(c);if(a.dd===v)I(v,a.key,c);else if(a.dd instanceof Object)a.dd[a.key]=c;else throw Error(a.dd+"["+a.key+"] cannot be assigned to.");return c});h("&&",++x,function(a,b){return a&&b});h("||",++x,function(a,b){return a||b});h("|",++x,function(a,b){return a|b});h("^",++x,function(a,b){return a^b});h("&",++x,function(a,b){return a&b});h("===",
++x,function(a,b){return a===b});h("!==",x,function(a,b){return a!==b});h("==",x,function(a,b){return a==b});h("!=",x,function(a,b){return a!=b});h(">",++x,function(a,b){return a>b});h(">=",x,function(a,b){return a>=b});h("<",x,function(a,b){return a<b});h("<=",x,function(a,b){return a<=b});h("in",x,function(a,b){return a in b});h("<<",++x,function(a,b){return a<<b});h(">>",x,function(a,b){return a>>b});h(">>>",x,function(a,b){return a>>>b});h("+",++x,function(a,b){return a+b});h("-",x,function(a,
b){return a-b});h("*",++x,function(a,b){return a*b});h("/",x,function(a,b){return a/b});h("%",x,function(a,b){return a%b});k("!",++x,function(a){return!a});k("~",x,function(a){return~a});k("+",x,function(a){return+a});k("-",x,function(a){return-a});k("typeof",x,function(a){return typeof a});l(".",++x,function(a){var c=R;if("(name)"!==c.id)throw Error("Error: '.' expects a name, not "+R.id);if(!(a instanceof Ye))throw Error("Error: '.' must be preceded by lvalue");a.dd=b(a);a.key=c.oe().key;r();return a});
m("(",++x,function(){var a=t(0);r(")");return a});d(")");l("(",++x,function(a){var c=[];if(")"!==R.id)for(;;){c.push(b(t(ca+1)));if(","!==R.id)break;r(",")}r(")");var d=null;a instanceof Ye&&(d=a.dd);a=b(a);if("function"!==typeof a)throw Error("Tried to call a non-function; type was "+typeof a);return a.apply(d,c)});d(",");l("[",x,function(a){var c=t(0);if(!(a instanceof Ye))throw Error("Error: '[]' must be preceded by lvalue");r("]");a.dd=b(a);a.key=b(c);return a});d("]");m("{",++x,function(){for(var a=
{};"}"!==R.id;){if("(literal)"===R.id)var c=R.oe();else if("(name)"===R.id)c=R.oe().key;else throw Error("Bad {}; expecting name or string constant");r();r(":");a[c]=b(t(ca+1));if(","!==R.id)break;R=r(",")}r("}");return a});m("[",x,function(){for(var a=[];"]"!==R.id;){a.push(b(t(ca+1)));if(","!==R.id)break;R=r(",")}r("]");return a});d(",");d(":");d("}");var kb=/(\d+(\.\d+)?)|(===|!==|==|!=|\+=|-=|&&|\|\||<=|>=|<<|>>>|>>|&&|\|\||[{}\(\)\[\]\+\-\.\*\/=!,\?&\|:%~<>])|([a-zA-Z\$_][\$_a-zA-Z0-9]*)|("([^"\\]|\\.)*"|'([^'\\]|\\.)*')/g,
Ea=[],Ta=0,R;return{parse:function(a){for(var b=[],c=0;c<a.length;){for(;q(a.charAt(c));)c++;kb.lastIndex=c;var d=kb.exec(a);if(d&&d.index===c)if(c+=d[0].length,d[1])b.push(g(parseFloat(d[1])));else if(d[3]&&d[3]in N)b.push(N[d[3]]);else if(d[4])switch(d[4]){case "true":case "false":case "null":case "in":case "typeof":case "undefined":b.push(N[d[4]]);break;default:b.push(f(d[4]))}else{if(d[5]){d=d[5].substr(1,d[5].length-2);for(var e="",h=!1,l=0;l<d.length;l++){var k=d[l];if(h){switch(k){case "n":k=
"\n";break;case "r":k="\r";break;case "t":k="\t"}e+=k;h=!1}else"\\"===k?h=!0:e+=k}b.push(g(e))}}else throw Error("Parse error: Expected stuff in "+a+" near: "+a.substr(c));}b.push(N["(end)"]);return b},evaluate:function(d,e,f,g){Ta=0;Ea=e;v=d;A=f||function(a,b){return a[b]};I=g||function(a,b,c){a[b]=c};R=p();d=b(t(0));v={};A=c;I=a;return d}}}(),af=$e.parse,bf=$e.evaluate;function cf(c,a,b){try{return bf(c,af(a),b)}catch(d){console.log("When evaluating:",a),console.log(d)}}
function df(c,a){if(c===a)return!0;if(!(c instanceof Object&&a instanceof Object)||c.constructor!==a.constructor)return!1;for(var b in c)if(c.hasOwnProperty(b)&&(!a.hasOwnProperty(b)||c[b]!==a[b]&&("object"!==typeof c[b]||!df(c[b],a[b]))))return!1;for(b in a)if(a.hasOwnProperty(b)&&!c.hasOwnProperty(b))return!1;return!0}
var ef=function(){function c(){this.$d={};this.$b=0;this.dk=[];this.timeout=0}c.prototype.watch=function(a,b,c){a={scope:a,parsed:af(b),Io:void 0,Eo:c};b in this.$d?this.$d[b].push(a):this.$d[b]=[a];this.$b+=1};c.prototype.unwatch=function(a,b){if(a in this.$d){for(var c=this.$d[a],e=0;e<c.length;e++)if(c[e].Eo===b){c.splice(e,1);break}0===c.length&&delete this.$d[a]}};c.prototype.check=function(a){var b=this;a&&this.dk.push(a);0===this.timeout&&(this.timeout=setTimeout(function(){b.timeout=0;for(var a=
(new Date).getTime(),c=0,g=0,f=!0,h=0;10>h&&f;h++){f=!1;b.$b=0;for(var l in b.$d)for(var k=null,m=void 0,q=0;q<b.$d[l].length;q++){var p=b.$d[l][q];try{p.scope!==k?(m=bf(p.scope,p.parsed),k=p.scope,c+=1):g+=1,df(p.Io,m)||(p.Io=m,p.Eo(m),f=!0)}catch(r){console.log("Error when evaluating %s: ",l,r),console.log("Context was: %o",p.scope)}}b.$b&&(f=!0)}Xe("Evauated %s/%s watchers in %sms",c,c+g,(new Date).getTime()-a);a=0;for(c=b.dk;a<c.length;a++)(0,c[a])();b.dk.length=0},0))};return c}();var ff=w.create("DRAGSORT");
function gf(c){function a(a){ff(a.type);for(var b=a.target;b.parentNode!==c.parent&&b.parentNode;)b=b.parentNode;if(1===b.nodeType&&b.getAttribute("draggable")&&"false"!==b.getAttribute("draggable").toLowerCase()&&b.parentNode===c.parent)if("dragstart"===a.type){for(var d=c.parent.children,e=0;e<d.length;e++)console.log(c.Xh,d[e].getAttribute(c.Xh),d[e]),null!==d[e].getAttribute(c.Xh)&&d[e].setAttribute("sort-index",e.toString());a.dataTransfer.setData("text",b.id);a.dataTransfer.dropEffect="move";
f=g=b;a.stopPropagation()}else"dragover"===a.type&&f&&g.parentNode===b.parentNode?(f.classList.remove(c.ql),f=b,f.classList.add(c.ql),a.preventDefault()):"dragend"===a.type&&f&&g.parentNode===b.parentNode?(f.classList.remove(c.ql),b=parseInt(f.getAttribute("sort-index")||"0"),d=parseInt(g.getAttribute("sort-index")||"0"),c.lt(d,b),a.preventDefault(),a.stopPropagation()):"drop"===a.type&&(a.preventDefault(),a.stopPropagation())}var b=c.parent.Xp;c.parent.Xp=!0;for(var d=c.parent.children,e=0;e<d.length;e++)null!==
d[e].getAttribute(c.Xh)&&d[e].setAttribute("draggable","true");if(b)return function(){};y(c.parent).addEventListener("dragstart dragover dragend drop",a);var g,f;return function(){y(c.parent).removeEventListener("dragstart dragover dragend drop",a)}};var Z=w.create("Zeact");function hf(c){var a=document.createElement("div");a.innerHTML=c;c=[];for(a=a.firstChild;a;)a instanceof HTMLElement&&c.push(a),a=a.nextSibling;return c}
var W=new (function(){function c(){this.om=new ef;this.ni={};this.xn={};this.Rp=1}c.prototype.yb=function(a,b,c){void 0===c&&(c=2);this.ni[a]={name:a,link:b,vp:c}};c.prototype.ci=function(a,b){this.xn[a.toUpperCase()]=b;"string"===typeof b.template&&(b.template=b.template.trim())};c.prototype.Ff=function(a,b){var c=this;this.yb(a,function(a,d,f,h){c.watch(a,d,h,function(c){b(d,c,a)})})};c.prototype.watch=function(a,b,c,e){var d=this;this.om.watch(a,c,e);this.va(b,function(){d.om.unwatch(c,e)})};c.prototype.cb=
function(a,b,c){a.addEventListener(b,c);this.va(a,function(){a.removeEventListener(b,c)});a.zwibblerListeners||(a.zwibblerListeners={});a.zwibblerListeners[b]||(a.zwibblerListeners[b]=[]);a.zwibblerListeners[b].push(c)};c.prototype.ma=function(a,b,c){a.zwibblerListeners&&b in a.zwibblerListeners&&setTimeout(function(){for(var d=0,g=a.zwibblerListeners[b];d<g.length;d++)g[d].call(a,c)},0)};c.prototype.va=function(a,b){a.Jj?a.Jj.push(b):a.Jj=[b]};c.prototype.detach=function(a){for(var b=a.firstChild;b;)this.detach(b),
b=b.nextSibling;if(a.Jj){b=0;for(var c=a.Jj;b<c.length;b++)(0,c[b])();delete a.zwibblerWatchers}a.zwibblerListeners&&delete a.zwibblerListeners};c.prototype.digest=function(a){this.om.check(a)};c.prototype.tr=function(a,b){var c=/^z-([a-z0-9@\-]+)/.exec(a.toLowerCase());if(c&&(c=c[1],c in this.ni&&this.ni[c].vp===b))return this.ni[c]};c.prototype.gn=function(a,b,c,e){void 0===e&&(e=b);for(var d=[],f=0;f<e.attributes.length;f++)d.push({name:e.attributes[f].name,value:e.attributes[f].value});for(f=
0;f<d.length&&b.parentNode;f++){e=d[f].name;var h=d[f].value,l=this.tr(e,c);if(l&&l.vp===c&&(Z("Link directive to %s for %s=%s",b.Jm,e,h),(e=l.link(a,b,e,h))&&e!==b))return{Aa:e,Al:!0}}return{Aa:b,Al:null===b.parentNode}};c.prototype.qq=function(a,b){var c=this,e=this.xn[b.tagName];if(!e)return null;Z("Attaching component %s",b.tagName);var g=e.template;if(g instanceof HTMLElement)var f=g.cloneNode(!0);else if("string"===typeof g)if("<"===g[0]){Z("Using elementsFromString %s to instantiate component",
g);var h=hf(g);if(0===h.length)throw Error("Component "+b.tagName+": Could not interpret as HTML: "+g);if(1<h.length)throw Error("Component "+b.tagName+": Should render as a single element, but got "+h.length);f=h[0]}else{Z("Using querySelector to instantiate component");f=document.querySelector(g);if(null===f)throw Error("Component "+b.tagName+': querySelector("'+g+'") returned null');f=f.cloneNode(!0)}else throw Error("Component "+b.tagName+": Could not interpret template "+g);b.parentNode.replaceChild(f,
b);var l=this,k={$emit:function(a,b){l.ma(f,a,b)}};k.$parent=a;g=e.properties;var m={};g&&g.forEach(function(d){m[d]=1;var e=b.getAttribute(d);e&&(Z("Bind prop %s to %s",d,e),c.watch(a,f,e,function(a){k[d]=a}))});e.style&&Q.Md(e.style);for(g=0;g<b.attributes.length;g++){h=b.attributes[g].name;var q=b.attributes[g].value;m[h]||0===h.indexOf("z-")||f.setAttribute(h,q)}for(g=1;2>=g;g++)if(h=this.gn(a,f,g,b),h.Al)return h.Aa;this.digest(function(){if(e.controller)try{e.controller(k,new Ve(k,f,"",""))}catch(p){console.log(p),
console.log("When running controller for %s",b.tagName)}c.lc(k,f)});return f};c.prototype.lc=function(a,b){if(1===b.nodeType){if(b.Jm)return b;b.Jm=this.Rp++;for(var c=0;2>=c;c++){var e=this.gn(a,b,c);if(e.Al)return e.Aa;if(0===c&&(e=this.qq(a,b)))return e}for(c=b.firstChild;c;)e=c.nextSibling,this.lc(a,c),c=e}return b};return c}());function jf(c,a,b,d,e){b&&(c["this"]=b);d&&(c.$event=d);cf(c,a,e)}W.yb("init",function(c,a,b,d){jf(c,d,a)});
function kf(c){"BUTTON"===c.tagName&&(c.getAttribute("type")||c.setAttribute("type","button"))}
W.yb("click",function(c,a,b,d){function e(b){Z("z-click=["+d+"] received "+b.type);jf(c,d,a,b,g);W.digest();b.preventDefault()}function g(a,b){a instanceof X&&0<=b.indexOf("Tool")&&(Z("Called %s",b),f=!0);return a[b]}kf(a);b="onpointerdown"in window;"ontouchstart"in window?W.cb(a,"touchend",e):b?W.cb(a,"pointerup",e):W.cb(a,"mouseup",e);var f;W.cb(a,"keydown",function(b){b.target===a&&13===b.keyCode&&(f=!1,e(b),f&&c.focus(!0,a))})});W.Ff("text",function(c,a){c.textContent=a});
function lf(c,a,b){var d=a.type?a.type.toLowerCase():"",e=b;if("zwibblerValue"in a)var g="zwibblerValue";else g="value",e=""+e;if("radio"===d||"checkbox"===d)a.checked=a[g]===e;else{if("SELECT"===a.tagName){d=0;for(var f=a.querySelectorAll("option");d<f.length;d++){var h=f[d],l=h.getAttribute("z-value");if(l&&cf(c,l)===b){h.selected=!0;return}}}a[g]=e}}
function mf(c,a){var b=a.type?a.type.toLowerCase():"";if("checkbox"===b)return"zwibblerValue"in a?a.zwibblerValue:a.checked;if("radio"===b)(b=a.getAttribute("name"))&&(b=document.querySelector('input[name="'+b+"]:checked"))&&(a=b);else if("SELECT"===a.tagName){b=0;for(var d=a.querySelectorAll("option");b<d.length;b++){var e=d[b];if(e.selected&&(e=e.getAttribute("z-value")))return cf(c,e)}}return"zwibblerValue"in a?a.zwibblerValue:a.value}
W.yb("model",function(c,a,b,d){W.cb(a,"input",function(){var b=mf(c,a);Z("input -> model: New value for %s: %s",d,b);cf(c,d+"="+JSON.stringify(b));W.digest()});W.watch(c,a,d,function(b){Z("model(%s) -> %s[%s] : new value is %s",d,a.tagName,a.type,b);lf(c,a,b)});var e=a.getAttribute("z-value");e&&(W.watch(c,a,e,function(b){Z("z-value for %s[%s] is %s",a.tagName,e,b);a.zwibblerValue=b;lf(c,a,b)}),W.va(a,function(){delete a.zwibblerValue}))});
W.yb("has",function(c,a,b,d){b=[];var e=0;for(d=d.split("|");e<d.length;e++){var g=d[e];g=g.trim();b.push('("'+g+'" in summary.types || "'+g+'" in summary.properties)')}(b=b.join("||"))&&W.watch(c,a,b,function(b){a.style.display=b?"block":"none"})});function nf(c,a){var b=c.indexOf(a);return-1===b?"":c.substr(b+a.length+1)}
W.yb("on",function(c,a,b,d){var e=nf(b,"on");""!==e&&(Z("Attaching native event %s => %s",e,d),W.cb(a,e,function(b){Z("Got %s, execute %s",e,d);jf(c,d,a,b);W.digest();b&&b.preventDefault&&b.preventDefault()}))});W.yb("bind",function(c,a,b,d){var e=nf(b,"bind");""!==e&&W.watch(c,a,d,function(b){a.setAttribute(e,b)})},1);
W.yb("for",function(c,a,b,d){b=d.indexOf(" in ");if(-1!==b){var e=d.substr(0,b),g=d.substr(b+4),f=[];Z("z-for '%s' in '%s'",e,g);var h=a.parentNode,l=a.nextSibling;a.parentNode.removeChild(a);W.watch(c,h,g,function(b){if("number"===typeof b){for(var d=[],k=0;k<b;k++)d.push(k);b=d}for(k=0;k<f.length;k++)d=f[k],d.parentNode&&d.parentNode.removeChild(d),W.detach(d);f.length=0;if("object"===typeof b&&"length"in b)for(k=0;k<b.length;k++){d=document.createComment("z-for "+g+"["+k+"] = "+b[k]);h.insertBefore(d,
l);f.push(d);d=Object.create(c);d.$parent=c;d[e]=b[k];var p=a.cloneNode(!0);p.removeAttribute("z-for");h.insertBefore(p,l);d=W.lc(d,p);f.push(d)}})}},0);W.yb("if",function(c,a,b,d){var e=document.createComment(b+" "+d),g=a.parentElement,f=null;g.replaceChild(e,a);W.watch(c,g,d,function(d){d&&!f?(f=a.cloneNode(!0),f.removeAttribute(b),g.replaceChild(f,e),W.lc(c,f)):!d&&f&&(W.detach(f),g.replaceChild(e,f),f=null)})},0);W.Ff("class",function(c,a){for(var b in a)y(c).dm(b,a[b])});
W.Ff("style",function(c,a){for(var b in a)c.style[b]=a[b]});W.Ff("selected",function(c,a){y(c).dm("selected",a)});W.Ff("disabled",function(c,a){a?c.setAttribute("disabled","true"):c.removeAttribute("disabled")});W.Ff("checked",function(c,a){c.checked=a?!0:!1});
W.yb("property",function(c,a,b,d){b='summary.properties["'+d+'"]';var e=a.getAttribute("z-value"),g=null!==a.getAttribute("z-colour");W.watch(c,a,b,function(b){"value"in a&&(a.value=b);null!==e&&y(a).dm("selected",""+b===e);g&&(a.style.backgroundColor=b)});"BUTTON"===a.tagName?(kf(a),W.cb(a,"click",function(){var b=a.getAttribute("z-value")||"";c.setProperty(d,b)})):W.cb(a,"change",function(){var b=mf(c,a);void 0!==b&&c.setProperty(d,b)})});
W.yb("popup",function(c,a,b,d){var e=Q.Jh(a);a.getAttribute("z-position");var g=null!==a.getAttribute("z-click-dismiss");c.ue||(c.ue={});W.va(a.parentNode,function(){e.destroy()});e.onshow=function(){var b=a.querySelector("[z-focus]");b&&"focus"in b&&b.focus()};c.ue[d]={show:function(a,b,c){e.show(b,c,g)},hide:function(){e.hide()}};c.resize&&c.resize()});W.yb("show-popup",function(c,a,b,d){kf(a);W.cb(a,"click",function(a){c.ue&&d in c.ue&&c.ue[d].show(this,a.pageX,a.pageY)})});
W.yb("colour",function(c,a){W.cb(a,"click",function(b){c.tp(a.getAttribute("z-property")||"",b.pageX,b.pageY)})});
W.yb("page",function(c,a,b,d){function e(){var a=c.Zn(f),b=Math.min(h/a.width,l/a.height);1<b&&(b=1);g.width=a.width*b|0;g.height=a.height*b|0;k.setTransform(b,0,0,b,0,0);k.fillStyle="white";k.fillRect(0,0,a.width,a.height);c.ha(k,{page:f})}if(!a.cv){var g=document.createElement("canvas"),f=cf(c,d)||0,h=parseInt(a.getAttribute("z-width")||"1000000"),l=parseInt(a.getAttribute("z-height")||"1000000");g.style.backgroundColor="white";var k=g.getContext("2d");a.parentNode&&(a.parentNode.insertBefore(g,
a),a.parentNode.removeChild(a));e();c.sa("document-changed",e);c.sa("resource-loaded",e);W.va(g,function(){c.removeEventListener("document-changed",e);c.removeEventListener("resource-loaded",e)});for(b=0;b<a.attributes.length;b++)g.setAttribute(a.attributes[b].name,a.attributes[b].value);g.cv=!0;return W.lc(c,g)}});
W.yb("sort",function(c,a,b,d){Q.Md(".zwibbler-sort-highlight { outline: 3px solid orange }");var e=gf({parent:a,Xh:"z-sortable",ql:"zwibbler-sort-highlight",lt:function(a,b){c.$from=a;c.$to=b;cf(c,d);W.digest()}});W.va(a,function(){e()})});function of(){Z("Document loaded.");Array.prototype.forEach.call(document.querySelectorAll("zwibbler,[zwibbler]"),function(c){We(c)})}function pf(c,a,b){y(c).matches(a)&&b(c);Array.prototype.forEach.call(c.querySelectorAll(a),b)}
function We(c,a){void 0===a&&(a=!1);"ZWIBBLER"===c.tagName&&Q.Md("zwibbler {display: block}");if(a||null===c.getAttribute("z-no-auto-init")){pf(c,"[z-component]",function(a){var b=a.getAttribute("z-component"),c=a.getAttribute("z-controller"),d=(a.getAttribute("z-properties")||"").split(/[ ,]+/);if(b){var e=null;if(c)if(c in Q.controllers)e=Q.controllers[c];else if("function"===typeof window.zcontroller)e=window.zcontroller;else throw Error("While processing component: "+b+" could not find controller function "+
c);Q.ci(b,{template:a,properties:d,controller:e});a.parentNode.removeChild(a)}});for(var b,d={},e=0;e<c.attributes.length;e++){var g=c.attributes[e];Q.fo(g.name)&&(d[g.name]=g.value)}pf(c,"z-canvas,[z-canvas]",function(a){b=Q.create(a,d)});var f=b;b?b.lc(b,c):(f={},W.lc(f,c));f.$digest=function(){W.digest()};f.$watch=function(a,b){W.watch(f,c,a,b)};f.$apply=function(a){if(a)return cf(f,a);W.digest()};f.hidePopup=function(a){f.ue&&a in f.ue&&f.ue[a].hide()};e=c.getAttribute("z-controller")||"";e in
Q.controllers?(Z("Running controller: %s",e),Q.controllers[e](f)):"function"===typeof window[e]?(Z("Running controller: %s",e),window[e](f)):e&&console.log("Controller not found: %s",e);W.digest();return f}}document.addEventListener("DOMContentLoaded",function(){of()});var qf=w.create("ColourPanel");W.Ff("clear-glyph",function(c,a,b){qf("Drawing colour panel, width=%s tag=%s",JSON.stringify(a),c.tagName);"CANVAS"===c.tagName&&(c.width=a.width,c.height=a.width,"clear"===a.style?Le(c.getContext("2d"),0,0,a.width):Me(c.getContext("2d"),0,0,a.width),b.resize())});
var Ne={style:"\n.zwibbler-colour-panel {\n    overflow:hidden;\n    border-top: 1px solid black;\n    white-space: nowrap;\n    font-size: 0;\n}\n\n.zwibbler-colour-panel div { \n    display: inline-block;\n}",Pi:'<div class="zwibbler-colour-panel" z-style="{height:ColourPanelWidth()+\'px\'}">\n    <canvas z-clear-glyph="{width: ColourPanelWidth(), style:\'clear\'}"\n        z-on:click="setColour(\'rgba(0,0,0,0.0)\', true)"\n        z-on:contextmenu="setColour(\'rgba(0,0,0,0.0)\', false)">\n    </canvas>\n    <canvas z-clear-glyph="{width: ColourPanelWidth(), style:\'transparent\'}"\n        z-on:click="setOpacity(0.5, true)"\n        z-on:contextmenu="setOpacity(0.5, false)">\n    </canvas>\n    <div z-for="colour in ColourPanelColours"\n        z-style="{width: ColourPanelWidth()+\'px\', height: ColourPanelWidth()+\'px\', background: colour}"\n        z-on:click="setColour(colour, true)"\n        z-on:contextmenu="setColour(colour, false)">\n    </div>\n</div>\n',
controller:function(c){var a=c.Vq();a.shift();a.shift();c.ColourPanelColours=a;c.ColourPanelWidth=function(){return c.Nc("useTouch")?40:20}}};}).call(window);
//# sourceMappingURL=zwibbler-demo.js.map

/*
     FILE ARCHIVED ON 14:21:20 Dec 23, 2019 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 20:49:17 Mar 19, 2020.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
*/
/*
playback timings (ms):
  exclusion.robots: 0.218
  captures_list: 262.188
  LoadShardBlock: 190.092 (3)
  RedisCDXSource: 53.897
  load_resource: 237.091
  PetaboxLoader3.resolve: 155.819
  CDXLines.iter: 13.966 (3)
  esindex: 0.015
  PetaboxLoader3.datanode: 187.41 (4)
  exclusion.robots.policy: 0.202
*/